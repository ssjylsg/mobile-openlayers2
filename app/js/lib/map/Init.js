function PROXY_ControlManager(){var a=Array.prototype.slice.call(arguments),b=a.shift();return null!==NPMap.Managers.ControlManager&&"function"==typeof NPMap.Managers.ControlManager[b]?NPMap.Managers.ControlManager[b].apply(NPMap.Managers.ControlManager,a):void 0}function PROXY_LayerManager(){var a=Array.prototype.slice.call(arguments),b=a.shift();return null!==NPMap.Managers.LayerManager&&"function"==typeof NPMap.Managers.LayerManager[b]?NPMap.Managers.LayerManager[b].apply(NPMap.Managers.LayerManager,a):void 0}function PROXY_MapManager(){var a=Array.prototype.slice.call(arguments),b=a.shift();return null!==NPMap.Managers.MapManager&&"function"==typeof NPMap.Managers.MapManager[b]?NPMap.Managers.MapManager[b].apply(NPMap.Managers.MapManager,a):void 0}function PROXY_OtherManager(){var a=Array.prototype.slice.call(arguments),b=a.shift();return null!==NPMap.Managers.OtherManager&&"function"==typeof NPMap.Managers.OtherManager[b]?NPMap.Managers.OtherManager[b].apply(NPMap.Managers.OtherManager,a):void 0}function PROXY_OverlayManager(){var a=Array.prototype.slice.call(arguments),b=a.shift();return null!==NPMap.Managers.OverlayManager&&"function"==typeof NPMap.Managers.OverlayManager[b]?NPMap.Managers.OverlayManager[b].apply(NPMap.Managers.OverlayManager,a):void 0}function overlayContextMenuCallBack(a,b){try{OnOverlayContextMenuCallBack(b,a)}catch(c){window.alert(a+","+b)}}function MessageLog(a){if(EzServerClient.GlobeParams.IsDebug)try{JavaScriptLog(JSON.stringify(a))}catch(b){console.log(JSON.stringify(a))}}!function(){var e=window,NPNamespace=e.NPNamespace=NPNamespace||{};NPNamespace.register=function(fullNS){for(var nsArray=fullNS.split("."),sEval="",sNS="",i=0;i<nsArray.length;i++)0!=i&&(sNS+="."),sNS+=nsArray[i],sEval+="if (typeof("+sNS+") == 'undefined') "+sNS+" = new Object();";""!=sEval&&eval(sEval)},e.NPMap=e.NPMapLib=e.NPMapLib||{},e.NPMap.Adapter=e.NPMap.Adapter||{},e.NPMap.Controls=e.NPMap.Controls||{},e.NPMap.Geometry=e.NPMap.Geometry||{},e.NPMap.Layers=e.NPMap.Layers||{},e.NPMap.Managers=e.NPMap.Managers||{},e.NPMap.Symbols=e.NPMap.Symbols||{},e.NPMap.Tools=e.NPMap.Tools||{},e.NPMap.Utils=e.NPMap.Utils||{},e.NPMap.Services=e.NPMap.Services||{},e.EzServerClient=e.EzServerClient||{},e.EzServerClient.GlobeParams=e.EzServerClient.GlobeParams||{},e.EzServerClient.GlobeParams.MyMapType=NPMapLib.MAP_LAYER_TYPE_EZMAP_TILE,NPMap.VERSION_NUMBER="1.0.4.4",NPMap.IsDebug=!1,NPMap.ISPOINTCONVERT=!0,NPMap.ISWGS84=!0,NPMap.CULTURE="CN",NPMap.ADAPTER_TYPE_ARCGIS="Arcgis",NPMap.ADAPTER_TYPE_EZMAP="EzMap",NPMap.ADAPTER_TYPE_OPENLAYERS="OpenLayers",NPMap.MAP_LAYER_TYPE_EZMAP_OFFLINE=0,NPMap.MAP_LAYER_TYPE_EZMAP_TILE=1,NPMap.MAP_LAYER_TYPE_GOOGLE_OFFLINE=2,NPMap.MAP_LAYER_TYPE_GOOGLE_TILE=3,NPMap.MAP_LAYER_TYPE_ARCGIS_OFFLINE=4,NPMap.MAP_LAYER_TYPE_ARCGIS_TILE=5,NPMap.MAP_LAYER_TYPE_WMS=6,NPMap.MAP_LAYER_TYPE_VECTORGML=7,NPMap.MAP_LAYER_TYPE_VECTORWFS=8,NPMap.MAP_LAYER_TYPE_OVERLAY=9,NPMap.MAP_LAYER_TYPE_TDMAP=10,NPMap.MAP_LAYER_TYPE_QQMAP=11,NPMap.MAP_LAYER_TYPE_GAODEMAP=12,NPMap.GEOMETRY_TYPE_UNKNOWN=0,NPMap.GEOMETRY_TYPE_POINT=1,NPMap.GEOMETRY_TYPE_POLYLINE=2,NPMap.GEOMETRY_TYPE_POLYGON=3,NPMap.GEOMETRY_TYPE_CIRCLE=4,NPMap.GEOMETRY_TYPE_RECTANGLE=5,NPMap.GEOMETRY_TYPE_CIRCLESECTOR=6,NPMap.LINE_TYPE_SOLID=0,NPMap.LINE_TYPE_DASH=1,NPMap.LINE_TYPE_DOT=2,NPMap.LINE_TYPE_DASHDOTDOT=3,NPMap.LINE_TYPE_DASHDOT=4,NPMap.LINE_TYPE_SHORTDASH=5,NPMap.LINE_TYPE_SHORTDOT=6,NPMap.LINE_TYPE_SHORTDASHDOTDOT=7,NPMap.LINE_TYPE_SHORTDASHDOT=8,NPMap.LINE_TYPE_LONGDASH=9,NPMap.LINE_TYPE_LONGDASHDOT=10,NPMap.LINE_ARROW_TYPE_REVERSE=-1,NPMap.LINE_ARROW_TYPE_NULL=0,NPMap.LINE_ARROW_TYPE_FORWORD=1,NPMap.LINE_ARROW_TYPE_BOTH=2,NPMap.MEASURE_MODE_DISTANCE=0,NPMap.MEASURE_MODE_AREA=1,NPMap.MEASURE_MODE_LOCATION=2,NPMap.DRAW_MODE_NONE=0,NPMap.DRAW_MODE_RECT=1,NPMap.DRAW_MODE_CIRCLE=2,NPMap.DRAW_MODE_POLYLINE=3,NPMap.DRAW_MODE_POLYLGON=4,NPMap.DRAW_MODE_CIRCLE_DIAMETER=5,NPMap.DRAW_MODE_FREEHAND=6,NPMap.OVERLAY_TYPE_UNKNOWN=0,NPMap.OVERLAY_TYPE_POLYLINE=1,NPMap.OVERLAY_TYPE_POLYGON=2,NPMap.OVERLAY_TYPE_CIRCLE=3,NPMap.OVERLAY_TYPE_LABEL=4,NPMap.OVERLAY_TYPE_MARKER=5,NPMap.OVERLAY_TYPE_INFOWIN=6,NPMap.OVERLAY_TYPE_POINT=7,NPMap.OVERLAY_TYPE_CIRCLESECTOR=8,NPMap.OVERLAY_TYPE_ClusterPoints=9,NPMap.OVERLAY_TYPE_DIALOG=10,NPMap.CONTROL_TYPE_UNKNOWN=0,NPMap.CONTROL_TYPE_COPYRIGHT=1,NPMap.CONTROL_TYPE_NAVIGATION=2,NPMap.CONTROL_TYPE_OVERVIEW=3,NPMap.CONTROL_TYPE_SCALE=4,NPMap.CONTROL_TYPE_NORTH=5,NPMap.CONTROL_TYPE_MOUSEPOSITION=6,NPMap.CONTROL_TYPE_JWMOUSEPOSITION=7,NPMap.CONTROL_TYPE_ZOOMANIMATION=8,NPMap.MAP_UNITS_UNKNOWN="UnknownUnits",NPMap.MAP_UNITS_CENTIMETERS="Centimeters",NPMap.MAP_UNITS_DECIMAL_DEGREES="DecimalDegrees",NPMap.MAP_UNITS_DEGREE_MINUTE_SECONDS="DegreeMinuteSeconds",NPMap.MAP_UNITS_DECIMETERS="Decimeters",NPMap.MAP_UNITS_FEET="Feet",NPMap.MAP_UNITS_INCHES="Inches",NPMap.MAP_UNITS_KILOMETERS="Kilometers",NPMap.MAP_UNITS_METERS="Meters",NPMap.MAP_UNITS_MILES="Miles",NPMap.MAP_UNITS_MILLIMETERS="Millimeters",NPMap.MAP_UNITS_NAUTICAL_MILES="NauticalMiles",NPMap.MAP_UNITS_POINTS="Points",NPMap.MAP_UNITS_YARDS="Yards",NPMap.MAP_UNITS_ACRES="Acres",NPMap.MAP_UNITS_ARES="Ares",NPMap.MAP_UNITS_SQUARE_KILOMETERS="SquareKilometers",NPMap.MAP_UNITS_SQUARE_MILES="SquareMiles",NPMap.MAP_UNITS_SQUARE_FEET="SquareFeet",NPMap.MAP_UNITS_SQUARE_METERS="SquareMeters",NPMap.MAP_UNITS_HECTARES="Hectares",NPMap.MAP_UNITS_SQUARE_YARDS="SquareYards",NPMap.MAP_UNITS_SQUARE_INCHES="SquareInches",NPMap.MAP_UNITS_SQUARE_MILLIMETERS="SquareMillimeters",NPMap.MAP_UNITS_SQUARE_CENTIMETERS="SquareCentimeters",NPMap.MAP_UNITS_SQUARE_DECIMETERS="SquareDecimeters",NPMap.CONTROL_ANCHOR_TOP_LEFT=0,NPMap.CONTROL_ANCHOR_TOP_RIGHT=1,NPMap.CONTROL_ANCHOR_BOTTOM_LEFT=2,NPMap.CONTROL_ANCHOR_BOTTOM_RIGHT=3,NPMap.MAPTYPE_ARCGISTILE=8,NPMap.MAPTYPE_PGIS=1,NPMap.MAPTYPE_WMS=2,NPMap.MAPTYPE_GOOGLE=3,NPMap.MAPTYPE_BAIDU=4,NPMap.MAPTYPE_BING=5,NPMap.MAPTYPE_IMAGE=6,NPMap.MAPTYPE_GEOSERVER=7,NPMap.MAPTYPE_NPGIS=9,NPMap.ModifyFeature_DRAG=8,NPMap.ModifyFeature_ROTATE=4,NPMap.ModifyFeature_RESIZE=2,NPMap.ModifyFeature_RESHAPE=1,NPMap.MapMeasure_CloseMarkDispaly=!0,NPMap.USING_ADAPTER=NPMap.ADAPTER_TYPE_OPENLAYERS}(),NPMap.Utils.BaseUtils=function(){function _getScriptLocation(){for(var a,b,c=new RegExp("(^|(.*?\\/))("+scriptName+")(\\?|$)"),d=document.getElementsByTagName("script"),e="",f=0,g=d.length;g>f;f++)if(a=d[f].getAttribute("src","i"),a&&(b=a.match(c))){e=b[1];break}return e}var scriptName="Init.js",host=_getScriptLocation()+"Netposa",e={};return e.getScriptLocation=function(){var a=document.getElementsByTagName("script");return a[a.length-1].getAttribute("src")},e.getHostPath=function(){return host},e.getScriptDictoryLocation=function(){var a=this.getScriptLocation();if(a||!(a.length<0))return a.substring(0,a.lastIndexOf("/")+1)},e.createError=function(a,b){return new Error(b?a+"\r\nBecause :"+b.message:a)},e.addtrusturl=function(){},e.popupwindow=function(){},e.addtrustmyself=function(){this.addtrusturl(window.location.href)},e.addpopwinmyself=function(){this.popupwindow(window.location.href)},e.addCSSFiles=function(a){if(a&&!(a.length<=0)){for(var b=new Array(a.length),c=0,d=a.length;d>c;c++)b[c]="<link type='text/css' rel='stylesheet' href = '"+host+"/"+a[c]+"'/> ";b.length>0&&document.write(b.join(""))}},e.addJSFiles=function(a){if(a&&!(a.length<=0)){for(var b=new Array(a.length),c=0,d=a.length;d>c;c++)b[c]="<script type='text/javascript' src='"+host+"/"+a[c]+"'></script>";b.length>0&&document.write(b.join(""))}},e.toJson=function(a){switch(a.constructor){case Object:var b="{";for(var c in a)b+="'"+c+"':"+NPMap.Utils.BaseUtils.toJson(a[c])+",";return","==b.substr(b.length-1)&&(b=b.substr(0,b.length-1)),b+"}";case Array:for(var b="[",d=0;d<a.length;d++)a[d]&&(b+=NPMap.Utils.BaseUtils.toJson(a[d])+",");return","==b.substr(b.length-1)&&(b=b.substr(0,b.length-1)),b+"]";case Boolean:return'"'+a.toString()+'"';case Date:return'"'+a.toString()+'"';case Function:break;case Number:return a.toString();case String:return'"'+a.toString()+'"'}},e.JsonToStr=function(a){var b,c=[],d=function(a){return"function"!=typeof a?"object"==typeof a&&null!=a?e.JsonToStr(a):/^(string|number)$/.test(typeof a)?"'"+a+"'":a:void 0};for(var f in a)b=d(a[f]),b&&c.push("'"+f+"':"+b);return"{"+c.join(",")+"}"},e.isTypeRight=function(param,type){switch(type){case"string":return"string"==typeof param;case"int":return"number"==typeof param&&-1==param.toString().indexOf(".");case"float":return"number"==typeof param;case"number":return"number"==typeof param;case"boolean":return"boolean"==typeof param;case"Array":return param instanceof Array==1;case"function":return"function"==typeof param;case"object":return"object"==typeof param;case"undefined":return"undefined"==typeof param;default:return param instanceof eval(type)}},e}(),Function.prototype.bind=function(){var a=this,b=Array.prototype.slice.call(arguments),c=b.shift();return function(){return a.apply(c,b.concat(Array.prototype.slice.call(arguments)))}},Array.prototype.contains=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return!0;return!1},Array.prototype.indexOf=function(a){for(var b,c=0;b=this[c];c++)if(b==a)return c;return-1},String.prototype.padLeft=function(a,b){for(var c=this;c.length<b;)c=c.length+a.length<b?a+c:a.substring(0,b-c.length)+c;return c},function(){"undefined"!=typeof OpenLayersClient&&OpenLayersClient||(OpenLayersClient=new Object),"undefined"!=typeof OpenLayersClient.GlobeParams&&OpenLayersClient.GlobeParams||(OpenLayersClient.GlobeParams=new Object),OpenLayersClient.GlobeParams.MyMapType=NPMap.MAP_LAYER_TYPE_ARCGIS_TILE,OpenLayersClient.GlobeParams.IsLocal=!1;{var a=("object"==typeof OpenLayers&&OpenLayers.singleFile,"Init.js");window.OpenLayers}window.OpenLayers={_getScriptLocation:function(){for(var b,c,d=new RegExp("(^|(.*?\\/))("+a+")(\\?|$)"),e=document.getElementsByTagName("script"),f="",g=0,h=e.length;h>g;g++)if(b=e[g].getAttribute("src"),b&&(c=b.match(d))){f=c[1];break}return function(){return f+"Netposa/"}}(),ImgPath:""},OpenLayers.VERSION_NUMBER="Release 2.13"}(),OpenLayers.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d="function"==typeof c.initialize?c.initialize:function(){b.prototype.initialize.apply(this,arguments)};if(a>1){var e=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c);OpenLayers.inherit.apply(null,e)}else d.prototype=c;return d},OpenLayers.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c;var d,e,f;for(d=2,e=arguments.length;e>d;d++)f=arguments[d],"function"==typeof f&&(f=f.prototype),OpenLayers.Util.extend(a.prototype,f)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(a,b){if(a=a||{},b){for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}var e="function"==typeof window.Event&&b instanceof window.Event;!e&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&(a.toString=b.toString)}return a},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;c>b;b++){var d=arguments[b];if("string"==typeof d&&(d=document.getElementById(d)),1==arguments.length)return d;a.push(d)}return a},OpenLayers.Util.isElement=function(a){return!(!a||1!==a.nodeType)},OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);return a},OpenLayers.Util.indexOf=function(a,b){if("function"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return c;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){b&&(a.id=b.replace(OpenLayers.Util.dotless,"_")),c&&(a.style.left=c.x+"px",a.style.top=c.y+"px"),d&&(a.style.width=d.w+"px",a.style.height=d.h+"px"),e&&(a.style.position=e),f&&(a.style.border=f),g&&(a.style.overflow=g),parseFloat(h)>=0&&parseFloat(h)<1?(a.style.filter="alpha(opacity="+100*h+")",a.style.opacity=h):1==parseFloat(h)&&(a.style.filter="",a.style.opacity="")},OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var i=document.createElement("div");return d&&(i.style.backgroundImage="url("+d+")"),a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="absolute"),OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,g,h),i},OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){function i(){j.style.display="",OpenLayers.Event.stopObservingElement(j)}var j=document.createElement("img");return a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="relative"),OpenLayers.Util.modifyDOMElement(j,a,b,c,e,f,null,g),h&&(j.style.display="none",OpenLayers.Event.observe(j,"load",i),OpenLayers.Event.observe(j,"error",i)),j.style.alt=a,j.galleryImg="no",d&&(j.src=d),j},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var a=navigator.appVersion.split("MSIE"),b=parseFloat(a[1]),c=!1;try{c=!!document.body.filters}catch(d){}OpenLayers.Util.alphaHackNeeded=c&&b>=5.5&&7>b}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,i);var j=a.childNodes[0];e&&(j.src=e),OpenLayers.Util.modifyDOMElement(j,a.id+"_innerImage",null,d,"relative",g),OpenLayers.Util.alphaHack()&&("none"!=a.style.display&&(a.style.display="inline-block"),null==h&&(h="scale"),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+j.src+"', sizingMethod='"+h+"')",parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1&&(a.style.filter+=" alpha(opacity="+100*a.style.opacity+")"),j.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){var j=OpenLayers.Util.createDiv(),k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,i);return k.className="olAlphaImg",j.appendChild(k),OpenLayers.Util.modifyAlphaImageDiv(j,a,b,c,d,e,f,g,h),j},OpenLayers.Util.upperCaseObject=function(a){var b={};for(var c in a)b[c.toUpperCase()]=a[c];return b},OpenLayers.Util.applyDefaults=function(a,b){a=a||{};var c="function"==typeof window.Event&&b instanceof window.Event;for(var d in b)(void 0===a[d]||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))&&(a[d]=b[d]);return!c&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString")&&(a.toString=b.toString),a},OpenLayers.Util.getParameterString=function(a){var b=[];for(var c in a){var d=a[c];if(null!=d&&"function"!=typeof d){var e;if("object"==typeof d&&d.constructor==Array){for(var f,g=[],h=0,i=d.length;i>h;h++)f=d[h],g.push(encodeURIComponent(null===f||void 0===f?"":f));e=g.join(",")}else e=encodeURIComponent(d);b.push(encodeURIComponent(c)+"="+e)}}return b.join("&")},OpenLayers.Util.urlAppend=function(a,b){var c=a;if(b){var d=(a+" ").split(/[?&]/);c+=" "===d.pop()?b:d.length?"&"+b:"?"+b}return c},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(a){return OpenLayers.Util.getImagesLocation()+a},OpenLayers.Util.Try=function(){for(var a=null,b=0,c=arguments.length;c>b;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a},OpenLayers.Util.getXmlNodeValue=function(a){var b=null;return OpenLayers.Util.Try(function(){b=a.text,b||(b=a.textContent),b||(b=a.firstChild.nodeValue)},function(){b=a.textContent}),b},OpenLayers.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&null!=c;)c=c.parentNode;return c!=b},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(a,b){return null==b&&(b=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof a&&(a=parseFloat(a)),0===b?a:parseFloat(a.toPrecision(b))},OpenLayers.Util.rad=function(a){return a*Math.PI/180},OpenLayers.Util.deg=function(a){return 180*a/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(a,b){for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,f=c.f,g=OpenLayers.Util.rad(b.lon-a.lon),h=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(a.lat))),i=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(b.lat))),j=Math.sin(h),k=Math.cos(h),l=Math.sin(i),m=Math.cos(i),n=g,o=2*Math.PI,p=20;Math.abs(n-o)>1e-12&&--p>0;){var q=Math.sin(n),r=Math.cos(n),s=Math.sqrt(m*q*m*q+(k*l-j*m*r)*(k*l-j*m*r));if(0===s)return 0;var t=j*l+k*m*r,u=Math.atan2(s,t),v=Math.asin(k*m*q/s),w=Math.cos(v)*Math.cos(v),x=t-2*j*l/w,y=f/16*w*(4+f*(4-3*w));o=n,n=g+(1-y)*f*Math.sin(v)*(u+y*s*(x+y*t*(-1+2*x*x)))}if(0===p)return 0/0;var z=w*(d*d-e*e)/(e*e),A=1+z/16384*(4096+z*(-768+z*(320-175*z))),B=z/1024*(256+z*(-128+z*(74-47*z))),C=B*s*(x+B/4*(t*(-1+2*x*x)-B/6*x*(-3+4*s*s)*(-3+4*x*x))),D=e*A*(u-C),E=D.toFixed(3)/1e3;return E},OpenLayers.Util.destinationVincenty=function(a,b,c){for(var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,i=a.lon,j=a.lat,k=c,l=d.rad(b),m=Math.sin(l),n=Math.cos(l),o=(1-h)*Math.tan(d.rad(j)),p=1/Math.sqrt(1+o*o),q=o*p,r=Math.atan2(o,n),s=p*m,t=1-s*s,u=t*(f*f-g*g)/(g*g),v=1+u/16384*(4096+u*(-768+u*(320-175*u))),w=u/1024*(256+u*(-128+u*(74-47*u))),x=k/(g*v),y=2*Math.PI;Math.abs(x-y)>1e-12;){var z=Math.cos(2*r+x),A=Math.sin(x),B=Math.cos(x),C=w*A*(z+w/4*(B*(-1+2*z*z)-w/6*z*(-3+4*A*A)*(-3+4*z*z)));y=x,x=k/(g*v)+C}{var D=q*A-p*B*n,E=Math.atan2(q*B+p*A*n,(1-h)*Math.sqrt(s*s+D*D)),F=Math.atan2(A*m,p*B-q*A*n),G=h/16*t*(4+h*(4-3*t)),H=F-(1-G)*h*s*(x+G*A*(z+G*B*(-1+2*z*z)));Math.atan2(s,-D)}return new OpenLayers.LonLat(i+d.deg(H),d.deg(E))},OpenLayers.Util.getParameters=function(a,b){b=b||{},a=null===a||void 0===a?window.location.href:a;var c="";if(OpenLayers.String.contains(a,"?")){var d=a.indexOf("?")+1,e=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length;c=a.substring(d,e)}for(var f={},g=c.split(/[&;]/),h=0,i=g.length;i>h;++h){var j=g[h].split("=");if(j[0]){var k=j[0];try{k=decodeURIComponent(k)}catch(l){k=unescape(k)}var m=(j[1]||"").replace(/\+/g," ");try{m=decodeURIComponent(m)}catch(l){m=unescape(m)}b.splitArgs!==!1&&(m=m.split(",")),1==m.length&&(m=m[0]),f[k]=m}}return f},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(a){return a=null==a?"id_":a.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,a+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(a){var b=a>1?1/a:a;return b},OpenLayers.Util.getResolutionFromScale=function(a,b){var c;if(a){null==b&&(b="degrees");var d=OpenLayers.Util.normalizeScale(a);c=1/(d*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH)}return c},OpenLayers.Util.getScaleFromResolution=function(a,b){null==b&&(b="degrees");var c=a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH;return c},OpenLayers.Util.pagePosition=function(a){var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var d,e=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(a,"position")&&(""==a.style.top||""==a.style.left),f=null;if(a.getBoundingClientRect){d=a.getBoundingClientRect();var g=window.pageYOffset||c.scrollTop,h=window.pageXOffset||c.scrollLeft;b[0]=d.left+h,b[1]=d.top+g}else if(document.getBoxObjectFor&&!e){d=document.getBoxObjectFor(a);var i=document.getBoxObjectFor(c);b[0]=d.screenX-i.screenX,b[1]=d.screenY-i.screenY}else{if(b[0]=a.offsetLeft,b[1]=a.offsetTop,f=a.offsetParent,f!=a)for(;f;)b[0]+=f.offsetLeft,b[1]+=f.offsetTop,f=f.offsetParent;var j=OpenLayers.BROWSER_NAME;for(("opera"==j||"safari"==j&&"absolute"==OpenLayers.Element.getStyle(a,"position"))&&(b[1]-=document.body.offsetTop),f=a.offsetParent;f&&f!=document.body;)b[0]-=f.scrollLeft,("opera"!=j||"TR"!=f.tagName)&&(b[1]-=f.scrollTop),f=f.offsetParent}return b},OpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;return void 0==a&&(a="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a),a},OpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{},OpenLayers.Util.applyDefaults(c,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var d=OpenLayers.Util.createUrlObject(a,c),e=OpenLayers.Util.createUrlObject(b,c);for(var f in d)if("args"!==f&&d[f]!=e[f])return!1;for(var f in d.args){if(d.args[f]!=e.args[f])return!1;delete e.args[f]}for(var f in e.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(a,b){if(b=b||{},!/^\w+:\/\//.test(a)){var c=window.location,d=c.port?":"+c.port:"",e=c.protocol+"//"+c.host.split(":").shift()+d;if(0===a.indexOf("/"))a=e+a;else{var f=c.pathname.split("/");f.pop(),a=e+f.join("/")+"/"+a}}b.ignoreCase&&(a=a.toLowerCase());var g=document.createElement("a");g.href=a;var h={};h.host=g.host.split(":").shift(),h.protocol=g.protocol,h.port=b.ignorePort80?"80"==g.port||"0"==g.port?"":g.port:""==g.port||"0"==g.port?"80":g.port,h.hash=b.ignoreHash||"#"===g.hash?"":g.hash;var i=g.search;if(!i){var j=a.indexOf("?");i=-1!=j?a.substr(j):""}return h.args=OpenLayers.Util.getParameters(i,{splitArgs:b.splitArgs}),h.pathname="/"==g.pathname.charAt(0)?g.pathname:"/"+g.pathname,h},OpenLayers.Util.removeTail=function(a){var b=null,c=a.indexOf("?"),d=a.indexOf("#");return b=-1==c?-1!=d?a.substr(0,d):a:-1!=d?a.substr(0,Math.min(c,d)):a.substr(0,c)},OpenLayers.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return-1==a.indexOf("webkit")&&-1!=a.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var a="",b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("opera")?a="opera":-1!=b.indexOf("msie")?a="msie":-1!=b.indexOf("safari")?a="safari":-1!=b.indexOf("mozilla")&&(a=-1!=b.indexOf("firefox")?"firefox":"mozilla"),a}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement("div");f.style.visibility="hidden";for(var g=c&&c.containerElement?c.containerElement:document.body,h=!1,i=null,j=g;j&&"body"!=j.tagName.toLowerCase();){var k=OpenLayers.Element.getStyle(j,"position");if("absolute"==k){h=!0;break}if(k&&"static"!=k)break;j=j.parentNode}!h||0!==g.clientHeight&&0!==g.clientWidth||(i=document.createElement("div"),i.style.visibility="hidden",i.style.position="absolute",i.style.overflow="visible",i.style.width=document.body.clientWidth+"px",i.style.height=document.body.clientHeight+"px",i.appendChild(f)),f.style.position="absolute",b&&(b.w?(d=b.w,f.style.width=d+"px"):b.h&&(e=b.h,f.style.height=e+"px")),c&&c.displayClass&&(f.className=c.displayClass);var l=document.createElement("div");if(l.innerHTML=a,l.style.overflow="visible",l.childNodes)for(var m=0,n=l.childNodes.length;n>m;m++)l.childNodes[m].style&&(l.childNodes[m].style.overflow="visible");return f.appendChild(l),g.appendChild(i?i:f),d||(d=parseInt(l.scrollWidth),f.style.width=d+"px"),e||(e=parseInt(l.scrollHeight)),f.removeChild(l),i?(i.removeChild(f),g.removeChild(i)):g.removeChild(f),new OpenLayers.Size(d,e)},OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(null==a){var b=null,c=null,d=0,e=0;b=document.createElement("div"),b.style.position="absolute",b.style.top="-1000px",b.style.left="-1000px",b.style.width="100px",b.style.height="50px",b.style.overflow="hidden",c=document.createElement("div"),c.style.width="100%",c.style.height="200px",b.appendChild(c),document.body.appendChild(b),d=c.offsetWidth,b.style.overflow="scroll",e=c.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=d-e,a=OpenLayers.Util._scrollbarWidth}return a},OpenLayers.Util.getFormattedLonLat=function(a,b,c){c||(c="dms"),a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=(d-e)/(1/60),g=f;f=Math.floor(f);var h=(g-f)/(1/60);h=Math.round(10*h),h/=10,h>=60&&(h-=60,f+=1,f>=60&&(f-=60,e+=1)),10>e&&(e="0"+e);var i=e+"°";return c.indexOf("dm")>=0&&(10>f&&(f="0"+f),i+=f+"'",c.indexOf("dms")>=0&&(10>h&&(h="0"+h),i+=h+'"')),i+=OpenLayers.i18n("lon"==b?0>a?"W":"E":0>a?"S":"N")},OpenLayers.Util.getConstructor=function(a){var b,c=a.split(".");b="OpenLayers"===c[0]?OpenLayers:window[c[0]];for(var d=1,e=c.length;e>d;++d)b=b[c[d]];return b},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function a(a){return a?a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function b(b){if(void 0===g[b]){var c=b.replace(/(-[\s\S])/g,function(a){return a.charAt(1).toUpperCase()}),e=d(c);g[b]=a(e)}return g[b]}function c(a,b){if(void 0===h[b]){var c,d,f=0,g=e.length,i="undefined"!=typeof a.cssText;for(h[b]=null;g>f;f++)if(d=e[f],d?(i||(d=d.toLowerCase()),c=d+b.charAt(0).toUpperCase()+b.slice(1)):c=b,void 0!==a[c]){h[b]=c;break}}return h[b]}function d(a){return c(f,a)}var e=["","O","ms","Moz","Webkit"],f=document.createElement("div").style,g={},h={};return{css:b,js:c,style:d,cssCache:g,jsCache:h}}(),OpenLayers.Animation=function(a){function b(a,b,c){b=b>0?b:Number.POSITIVE_INFINITY;var d=++g,e=+new Date;return h[d]=function(){h[d]&&+new Date-e<=b?(a(),h[d]&&f(h[d],c)):delete h[d]},f(h[d],c),d}function c(a){delete h[a]}var d=OpenLayers.Util.vendorPrefix.js(a,"requestAnimationFrame"),e=!!d,f=function(){var b=a[d]||function(b){a.setTimeout(b,16)};return function(c,d){b.apply(a,[c,d])}}(),g=0,h={};return{isNative:e,requestFrame:f,start:b,stop:c}}(window),OpenLayers.String={startsWith:function(a,b){return 0===a.indexOf(b)},contains:function(a,b){return-1!==a.indexOf(b)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){for(var b=a.split("-"),c=b[0],d=1,e=b.length;e>d;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c},format:function(a,b,c){b||(b=window);var d=function(a,d){for(var e,f=d.split(/\.+/),g=0;g<f.length&&(0===g&&(e=b),void 0!==e);g++)e=e[f[g]];return"function"==typeof e&&(e=c?e.apply(null,c):e()),"undefined"==typeof e?"undefined":e};return a.replace(OpenLayers.String.tokenRegEx,d)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a,b){var c=a;return b===!0&&null!==a&&a.replace&&(a=a.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(a)?parseFloat(a):c}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;return b>0&&(c=parseFloat(a.toPrecision(b))),c},format:function(a,b,c,d){b="undefined"!=typeof b?b:0,c="undefined"!=typeof c?c:OpenLayers.Number.thousandsSeparator,d="undefined"!=typeof d?d:OpenLayers.Number.decimalSeparator,null!=b&&(a=parseFloat(a.toFixed(b)));var e=a.toString().split(".");1===e.length&&null===b&&(b=0);var f=e[0];if(c)for(var g=/(-?[0-9]+)([0-9]{3})/;g.test(f);)f=f.replace(g,"$1"+c+"$2");var h;if(0===b)h=f;else{var i=e.length>1?e[1]:"0";null!==b&&(i+=new Array(b-i.length+1).join("0")),h=f+d+i}return h},zeroPad:function(a,b,c){for(var d=a.toString(c||10);d.length<b;)d="0"+d;return d}},OpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(a,b,c){var d=[];if(!a)return d;if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if("function"!=typeof b)throw new TypeError;for(var f=0;e>f;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){OpenLayers.Util.isArray(a)&&(d=a[3],c=a[2],b=a[1],a=a[0]),null!=a&&(this.left=OpenLayers.Util.toFloat(a)),null!=b&&(this.bottom=OpenLayers.Util.toFloat(b)),null!=c&&(this.right=OpenLayers.Util.toFloat(c)),null!=d&&(this.top=OpenLayers.Util.toFloat(d))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=!1;return null!=a&&(b=this.left===a.left&&this.right===a.right&&this.top===a.top&&this.bottom===a.bottom),b
},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(a){return a===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(a,b){null==a&&(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,g=Math.round(this.top*c)/c;return b===!0?e+","+d+","+g+","+f:d+","+e+","+f+","+g},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(a,b){null==b&&(b=this.getCenterLonLat());var c,d;"OpenLayers.LonLat"===b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y);var e=(this.left-c)*a+c,f=(this.bottom-d)*a+d,g=(this.right-c)*a+c,h=(this.top-d)*a+d;return new OpenLayers.Bounds(e,f,g,h)},add:function(a,b){if(null==a||null==b)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){if(a)switch(a.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(a.lon,a.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(a.x,a.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||a.left<this.left)&&(this.left=a.left),(null==this.bottom||a.bottom<this.bottom)&&(this.bottom=a.bottom),(null==this.right||a.right>this.right)&&(this.right=a.right),(null==this.top||a.top>this.top)&&(this.top=a.top)}},extendXY:function(a,b){this.centerLonLat=null,(null==this.left||a<this.left)&&(this.left=a),(null==this.bottom||b<this.bottom)&&(this.bottom=b),(null==this.right||a>this.right)&&(this.right=a),(null==this.top||b>this.top)&&(this.top=b)},containsLonLat:function(a,b){"boolean"==typeof b&&(b={inclusive:b}),b=b||{};var c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;if(d&&!c){var e=d.getWidth(),f=(d.left+d.right)/2,g=Math.round((a.lon-f)/e);c=this.containsLonLat({lon:a.lon-g*e,lat:a.lat},{inclusive:b.inclusive})}return c},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){if(null==c&&(c=!0),null==a||null==b)return!1;a=OpenLayers.Util.toFloat(a),b=OpenLayers.Util.toFloat(b);var d;return d=c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){if("boolean"==typeof b&&(b={inclusive:b}),b=b||{},b.worldBounds){var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)}else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left===a.right||c.right===a.left||c.top===a.bottom||c.bottom===a.top;if(b.inclusive||!e){var f=a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=a.bottom&&c.bottom<=a.top,g=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,h=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,i=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right;d=(f||g)&&(h||i)}if(b.worldBounds&&!d){var j=b.worldBounds,k=j.getWidth(),l=!j.containsBounds(c),m=!j.containsBounds(a);l&&!m?(a=a.add(-k,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):m&&!l&&(c=c.add(-k,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},containsBounds:function(a,b,c){null==b&&(b=!1),null==c&&(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c),g=this.contains(a.right,a.top,c);return b?d||e||f||g:d&&e&&f&&g},determineQuadrant:function(a){var b="",c=this.getCenterLonLat();return b+=a.lat<c.lat?"b":"t",b+=a.lon<c.lon?"l":"r"},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b),d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b),e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b),f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);return this.left=Math.min(c.x,e.x),this.bottom=Math.min(c.y,d.y),this.right=Math.max(d.x,f.x),this.top=Math.max(e.y,f.y),this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(var f=a.getWidth();e.left<a.left&&e.right-d<=a.left;)e=e.add(f,0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-f,0);var g=e.left+c;g<a.right&&g>a.left&&e.right-d>a.right&&(e=e.add(-f,0))}return e},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(a,b){var c=a.split(",");return OpenLayers.Bounds.fromArray(c,b)},OpenLayers.Bounds.fromArray=function(a,b){return b===!0?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])},OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";return b+="t"===a.charAt(0)?"b":"t",b+="l"===a.charAt(1)?"r":"l"},OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(a){return a.toISOString()}:function(a){var b;return b=isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(a.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(a.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(a.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(a){var b,c=a.match(this.dateRegEx);if(c&&(c[1]||c[7])){var d=parseInt(c[1],10)||0,e=parseInt(c[2],10)-1||0,f=parseInt(c[3],10)||1;b=new Date(Date.UTC(d,e,f));var g=c[7];if(g){var h=parseInt(c[4],10),i=parseInt(c[5],10),j=parseFloat(c[6]),k=0|j,l=Math.round(1e3*(j-k));if(b.setUTCHours(h,i,k,l),"Z"!==g){var m=parseInt(g,10),n=parseInt(c[8],10)||0,o=-1e3*(3600*m+60*n);b=new Date(b.getTime()+o)}}}else b=new Date("invalid");return b}},OpenLayers.Element={visible:function(a){return"none"!==OpenLayers.Util.getElement(a).style.display},toggle:function(){for(var a=0,b=arguments.length;b>a;a++){var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?"none":"";c.style.display=d}},remove:function(a){a=OpenLayers.Util.getElement(a),a.parentNode.removeChild(a)},getHeight:function(a){return a=OpenLayers.Util.getElement(a),a.offsetHeight},hasClass:function(a,b){var c=a.className;return!!c&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){return OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b),a},removeClass:function(a,b){var c=a.className;return c&&(a.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))),a},toggleClass:function(a,b){return OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b),a},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var c=null;if(a&&a.style){if(c=a.style[OpenLayers.String.camelize(b)],!c)if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d.getPropertyValue(b):null}else a.currentStyle&&(c=a.currentStyle[OpenLayers.String.camelize(b)]);var e=["left","top","right","bottom"];window.opera&&-1!==OpenLayers.Util.indexOf(e,b)&&"static"===OpenLayers.Element.getStyle(a,"position")&&(c="auto")}return"auto"===c?null:c}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){OpenLayers.Util.isArray(a)&&(b=a[1],a=a[0]),this.lon=OpenLayers.Util.toFloat(a),this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(null==a||null==b)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))},equals:function(a){var b=!1;return null!=a&&(b=this.lon===a.lon&&this.lat===a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat)),b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);return this.lon=c.x,this.lat=c.y,this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(a){var b=a.split(",");return new OpenLayers.LonLat(b[0],b[1])},OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a),c=b&&a[0],d=b&&a[1];return new OpenLayers.LonLat(c,d)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=!1;return null!=a&&(b=this.x===a.x&&this.y===a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,b){if(null==a||null==b)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();return a&&(b=this.add(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a),this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=!1;return null!=a&&(b=this.w===a.w&&this.h===a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h)),b},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;c>b;++b)if(-1!==a[b].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(a){this.easing=a?a:OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=!0,this.begin=a,this.finish=b,this.duration=c,this.callbacks=d.callbacks,this.minFrameRate=d.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var a={};for(var b in this.begin){var c=this.begin[b],d=this.finish[b];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError("invalid value for Tween");var e=d-c;a[b]=this.easing.apply(this,[this.time,c,e,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,a),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(a){this.points.unshift({xy:a,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(a){for(var b,c,d=(new Date).getTime(),e=0,f=this.points.length;f>e&&(c=this.points[e],!(d-c.tick>this.delay));e++)b=c;if(b){var g=(new Date).getTime()-b.tick,h=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),i=h/g;if(!(0==i||i<this.threshold)){var j=Math.asin((a.y-b.xy.y)/h);return b.xy.x<=a.x&&(j=Math.PI-j),{speed:i,theta:j}}}},move:function(a,b){var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0,i=function(){if(null!=this.timerId){var a=(new Date).getTime()-f,i=-this.deceleration*Math.pow(a,2)/2+c*a,j=i*d,k=i*e,l={};l.end=!1;var m=-this.deceleration*a+c;0>=m&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,l.end=!0),l.x=j-g,l.y=k-h,g=j,h=k,b(l.x,l.y,l.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(i,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&1===a.touches.length},isMultiTouch:function(a){return a.touches&&a.touches.length>1},isLeftClick:function(a){return"undefined"!=typeof a.which&&1===a.which||"undefined"!=typeof a.button&&2!==a.button},isRightClick:function(a){return a.which&&3===a.which||a.button&&2===a.button},stop:function(a,b){b||OpenLayers.Event.preventDefault(a),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},findElement:function(a,b){for(var c=OpenLayers.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!==b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){var e=OpenLayers.Util.getElement(a);if(d=d||!1,"keypress"===b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(b="keydown"),this.observers||(this.observers={}),!e._eventCacheID){var f="eventCacheID_";e.id&&(f=e.id+"_"+f),e._eventCacheID=OpenLayers.Util.createUniqueID(f)}var g=e._eventCacheID;this.observers[g]||(this.observers[g]=[]),this.observers[g].push({element:e,name:b,observer:c,useCapture:d}),e.addEventListener?e.addEventListener(b,c,d):e.attachEvent&&e.attachEvent("on"+b,c)},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a),c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(a){if(a)for(var b=a.length-1;b>=0;b--){var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])}},stopObserving:function(a,b,c,d){d=d||!1;var e=OpenLayers.Util.getElement(a),f=e._eventCacheID;"keypress"===b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(b="keydown");var g=!1,h=OpenLayers.Event.observers[f];if(h)for(var i=0;!g&&i<h.length;){var j=h[i];if(j.name===b&&j.observer===c&&j.useCapture===d){h.splice(i,1),0===h.length&&delete OpenLayers.Event.observers[f],g=!0;break}i++}return g&&(e.removeEventListener?e.removeEventListener(b,c,d):e&&e.detachEvent&&e.detachEvent("on"+b,c)),g},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers)if(OpenLayers.Event.observers.hasOwnProperty(a)){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","contextmenu","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e),this.object=a,this.fallThrough=d,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=b&&this.attachToElement(b)},destroy:function(){for(var a in this.extensions)"boolean"!=typeof this.extensions[a]&&this.extensions[a].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(){},attachToElement:function(a){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=a;for(var b,c=!!window.navigator.msMaxTouchPoints,d=0,e=this.BROWSER_EVENTS.length;e>d;d++)b=this.BROWSER_EVENTS[d],OpenLayers.Event.observe(a,b,this.eventHandler),c&&0===b.indexOf("touch")&&this.addMsTouchListener(a,b,this.eventHandler);OpenLayers.Event.observe(a,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a)"scope"!==b&&a.hasOwnProperty(b)&&this.register(b,a.scope,a[b])},register:function(a,b,c,d){if(a in OpenLayers.Events&&!this.extensions[a]&&(this.extensions[a]=new OpenLayers.Events[a](this)),null!=c){null==b&&(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0);var f={obj:b,func:c};d?(e.splice(this.extensionCount[a],0,f),"object"==typeof d&&d.extension&&this.extensionCount[a]++):e.push(f)}},registerPriority:function(a,b,c){this.register(a,b,c,!0)},un:function(a){for(var b in a)"scope"!==b&&a.hasOwnProperty(b)&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){null==b&&(b=this.object);var d=this.listeners[a];if(null!=d)for(var e=0,f=d.length;f>e;e++)if(d[e].obj===b&&d[e].func===c){d.splice(e,1);break}},remove:function(a){null!=this.listeners[a]&&(this.listeners[a]=[])},triggerEvent:function(a,b){var c=this.listeners[a];if(!c||0===c.length)return void 0;null==b&&(b={}),b.object=this.object,b.element=this.element,b.type||(b.type=a),c=c.slice();for(var d,e=0,f=c.length;f>e;e++){var g=c[e];if(d=g.func.apply(g.obj,[b]),void 0!==d&&d===!1)break}return this.fallThrough||OpenLayers.Event.stop(b,!0),d},handleBrowserEvent:function(a){var b=a.type,c=this.listeners[b];if(c&&0!==c.length){var d=a.touches;if(d&&d[0]){for(var e,f=0,g=0,h=d.length,i=0;h>i;++i)e=this.getTouchClientXY(d[i]),f+=e.clientX,g+=e.clientY;a.clientX=f/h,a.clientY=g/h}this.includeXY&&(a.xy=this.getMousePosition(a)),this.triggerEvent(b,a)}},getTouchClientXY:function(a){var b=window.olMockWin||window,c=b.pageXOffset,d=b.pageYOffset,e=a.clientX,f=a.clientY;return 0===a.pageY&&Math.floor(f)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(e)>Math.floor(a.pageX)?(e-=c,f-=d):(f<a.pageY-d||e<a.pageX-c)&&(e=a.pageX-c,f=a.pageY-d),a.olClientX=e,a.olClientY=f,{clientX:e,clientY:f}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(a){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(a,b,c){function d(a){c(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var a=e.length-1;a>=0;--a)e[a].stopPropagation()},preventDefault:function(){for(var a=e.length-1;a>=0;--a)e[a].preventDefault()},type:b},a))}var e=this._msTouches;switch(b){case"touchstart":return this.addMsTouchListenerStart(a,b,d);case"touchend":return this.addMsTouchListenerEnd(a,b,d);case"touchmove":return this.addMsTouchListenerMove(a,b,d);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=!1,e=0,f=d.length;f>e;++e)if(d[e].pointerId===a.pointerId){b=!0;break}b||d.push(a),a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerDown",e);var f=function(a){for(var b=0,c=d.length;c>b;++b)if(d[b].pointerId===a.pointerId){d.splice(b,1);break}};OpenLayers.Event.observe(a,"MSPointerUp",f)},addMsTouchListenerMove:function(a,b,c){var d=this._msTouches,e=function(a){if(!(a.pointerType===a.MSPOINTER_TYPE_MOUSE&&0===a.buttons||1===d.length&&d[0].pageX===a.pageX&&d[0].pageY===a.pageY)){for(var b=0,e=d.length;e>b;++b)if(d[b].pointerId===a.pointerId){d[b]=a;break}a.touches=d.slice(),c(a)}};OpenLayers.Event.observe(a,"MSPointerMove",e)},addMsTouchListenerEnd:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=0,e=d.length;e>b;++b)if(d[b].pointerId===a.pointerId){d.splice(b,1);break}a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerUp",e)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a){this.target=a;for(var b=this.events.length-1;b>=0;--b)this.target.register(this.events[b],this,this.buttonClick,{extension:!0})},destroy:function(){for(var a=this.events.length-1;a>=0;--a)this.target.unregister(this.events[a],this,this.buttonClick);delete this.target},getPressedButton:function(a){var b,c=3;do{if(OpenLayers.Element.hasClass(a,"olButton")){b=a;break}a=a.parentNode}while(--c>0&&a);return b},ignore:function(a){var b=3,c=!1;do{if("a"===a.nodeName.toLowerCase()){c=!0;break}a=a.parentNode}while(--b>0&&a);return c},buttonClick:function(a){var b=!0,c=OpenLayers.Event.element(a);if(c&&(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf("mouse"))){var d=this.getPressedButton(c);if(d){if("keydown"===a.type)switch(a.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:d}),OpenLayers.Event.stop(a),b=!1}else if(this.startEvt){if(this.completeRegEx.test(a.type)){var e=OpenLayers.Util.pagePosition(d),f=OpenLayers.Util.getViewportElement(),g=window.pageYOffset||f.scrollTop,h=window.pageXOffset||f.scrollLeft;e[0]=e[0]-h,e[1]=e[1]-g,this.target.triggerEvent("buttonclick",{buttonElement:d,buttonXY:{x:this.startEvt.clientX-e[0],y:this.startEvt.clientY-e[1]}})}this.cancelRegEx.test(a.type)&&delete this.startEvt,OpenLayers.Event.stop(a),b=!1}this.startRegEx.test(a.type)&&(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)}else b=!this.ignore(OpenLayers.Event.element(a)),delete this.startEvt}return b}}),OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,curretFeature:null,activeFeature:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(a){if(this.target=a,a.object instanceof OpenLayers.Map)this.setMap(a.object);else{if(!(a.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";a.object.map?this.setMap(a.object.map):a.object.events.register("added",this,function(){this.setMap(a.object.map)})}for(var b=this.provides.length-1;b>=0;--b)a.extensions[this.provides[b]]=!0},setMap:function(a){this.map=a,this.cache={},a.events.register("mousedown",this,this.start,{extension:!0}),a.events.register("mouseup",this,this.onClick,{extension:!0}),a.events.register("touchstart",this,this.start,{extension:!0}),a.events.register("touchmove",this,this.cancel,{extension:!0}),a.events.register("touchend",this,this.onClick,{extension:!0})},start:function(a){this.startEvt=a;for(var b in this.cache)if(feature=this.cache[b]){var c=this.triggerEvent("featuremousedown",{feature:feature});if(this.curretFeature=feature,c===!1)break}},cancel:function(){delete this.startEvt},onClick:function(a){if(this.startEvt&&("touchend"===a.type||OpenLayers.Event.isLeftClick(a))){this.curretFeature&&this.triggerEvent("featuremouseup",{feature:this.curretFeature});var b=this.getFeatures(this.startEvt);delete this.startEvt;for(var c,d,e,f={},g=0,h=b.length;h>g&&(c=b[g],d=c.layer,f[d.id]=!0,e=this.triggerEvent("featureclick",{feature:c}),e!==!1);++g);for(g=0,h=this.map.layers.length;h>g;++g)d=this.map.layers[g],d instanceof OpenLayers.Layer.Vector&&!f[d.id]&&this.triggerEvent("nofeatureclick",{layer:d})}},onMousemove:function(a){for(var b,c=this.getFeatures(a,!0),d={},e=[],f=0,g=c.length;g>f;++f)b=c[f],d[b.id]=b,e.push(b);var h;e.length>0&&(h=e[0]);for(var f=0;f<e.length;f++)h.style.graphicZIndex<e[f].style.graphicZIndex&&(h=e[f]);0===e.length&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:a.offsetX,y:a.offsetY}}),delete this.cache[this.activeFeature.id]),this.activeFeature=null),this.activeFeature!==h&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:a.offsetX,y:a.offsetY}}),delete this.cache[this.activeFeature.id],this.activeFeature=null),this.triggerEvent("featureover",{feature:h,xy:{x:a.offsetX,y:a.offsetY}}),this.activeFeature=h,this.cache[c.id]=h)},triggerEvent:function(a,b){var c=b.feature?b.feature.layer:b.layer,d=this.target.object;return d instanceof OpenLayers.Map||d===c?this.target.triggerEvent(a,b):void 0},getFeatures:function(a){return this.map.getFeatures(a,!0)},destroy:function(){for(var a=this.provides.length-1;a>=0;--a)delete this.target.extensions[this.provides[a]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this}),delete this.cache,delete this.map,delete this.target}}),OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick,OpenLayers.Events.featureover=OpenLayers.Events.featureclick,OpenLayers.Events.featureout=OpenLayers.Events.featureclick,OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b){var c=0!==a.indexOf("http"),d=!c&&a.match(this.URL_SPLIT_REGEX);if(d){var e=window.location;c=d[1]==e.protocol&&d[3]==e.hostname;var f=d[4],g=e.port;(80!=f&&""!=f||"80"!=g&&""!=g)&&(c=c&&f==g)}return c||b&&(a="function"==typeof b?b(a):b+encodeURIComponent(a)),a},issue:function(a){var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});a=a||{},a.headers=a.headers||{},a=OpenLayers.Util.applyDefaults(a,b),a.headers=OpenLayers.Util.applyDefaults(a.headers,b.headers);var c,d=!1;for(c in a.headers)a.headers.hasOwnProperty(c)&&"x-requested-with"===c.toLowerCase()&&(d=!0);d===!1&&(a.headers["X-Requested-With"]="XMLHttpRequest");var e=new OpenLayers.Request.XMLHttpRequest,f=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||{}));f=OpenLayers.Request.makeSameOrigin(f,a.proxy),e.open(a.method,f,a.async,a.user,a.password);for(var g in a.headers)e.setRequestHeader(g,a.headers[g]);var h=this.events,i=this;return e.onreadystatechange=function(){if(e.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var b=h.triggerEvent("complete",{request:e,config:a,requestUrl:f});b!==!1&&i.runCallbacks({request:e,config:a,requestUrl:f})}},a.async===!1?e.send(a.data):window.setTimeout(function(){0!==e.readyState&&e.send(a.data)},0),e},runCallbacks:function(a){var b,c=a.request,d=a.config,e=d.scope?OpenLayers.Function.bind(d.callback,d.scope):d.callback;d.success&&(b=d.scope?OpenLayers.Function.bind(d.success,d.scope):d.success);var f;d.failure&&(f=d.scope?OpenLayers.Function.bind(d.failure,d.scope):d.failure),"file:"==OpenLayers.Util.createUrlObject(d.url).protocol&&c.responseText&&(c.status=200),e(c),(!c.status||c.status>=200&&c.status<300)&&(this.events.triggerEvent("success",a),b&&b(c)),c.status&&(c.status<200||c.status>=300)&&(this.events.triggerEvent("failure",a),f&&f(c))},GET:function(a){return a=OpenLayers.Util.extend(a,{method:"GET"}),OpenLayers.Request.issue(a)},POST:function(a){return a=OpenLayers.Util.extend(a,{method:"POST"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},PUT:function(a){return a=OpenLayers.Util.extend(a,{method:"PUT"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},DELETE:function(a){return a=OpenLayers.Util.extend(a,{method:"DELETE"}),OpenLayers.Request.issue(a)},HEAD:function(a){return a=OpenLayers.Util.extend(a,{method:"HEAD"}),OpenLayers.Request.issue(a)},OPTIONS:function(a){return a=OpenLayers.Util.extend(a,{method:"OPTIONS"}),OpenLayers.Request.issue(a)}}),function(){function a(){this._object=h&&!k?new h:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function b(){return new a}function c(a){if(a._object.send(a._data),i&&!a._async)for(a.readyState=b.OPENED,f(a);a.readyState<b.DONE;)if(a.readyState++,d(a),a._aborted)return}function d(a){b.onreadystatechange&&b.onreadystatechange.apply(a),a.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function e(a){var b=a.responseXML,c=a.responseText;return j&&c&&b&&!b.documentElement&&a.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(b=new window.ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.validateOnParse=!1,b.loadXML(c)),b&&(j&&0!=b.parseError||!b.documentElement||b.documentElement&&"parsererror"==b.documentElement.tagName)?null:b}function f(a){try{a.responseText=a._object.responseText}catch(b){}try{a.responseXML=e(a._object)}catch(b){}try{a.status=a._object.status}catch(b){}try{a.statusText=a._object.statusText}catch(b){}}function g(a){a._object.onreadystatechange=new window.Function}var h=window.XMLHttpRequest,i=!!window.controllers,j=window.document.all&&!window.opera,k=j&&window.navigator.userAgent.match(/MSIE 7.0/);
b.prototype=a.prototype,i&&h.wrapped&&(b.wrapped=h.wrapped),b.UNSENT=0,b.OPENED=1,b.HEADERS_RECEIVED=2,b.LOADING=3,b.DONE=4,b.prototype.readyState=b.UNSENT,b.prototype.responseText="",b.prototype.responseXML=null,b.prototype.status=0,b.prototype.statusText="",b.prototype.priority="NORMAL",b.prototype.onreadystatechange=null,b.onreadystatechange=null,b.onopen=null,b.onsend=null,b.onabort=null,b.prototype.open=function(a,c,e,h,k){delete this._headers,arguments.length<3&&(e=!0),this._async=e;var l,m=this,n=this.readyState;j&&e&&(l=function(){n!=b.DONE&&(g(m),m.abort())},window.attachEvent("onunload",l)),b.onopen&&b.onopen.apply(this,arguments),arguments.length>4?this._object.open(a,c,e,h,k):arguments.length>3?this._object.open(a,c,e,h):this._object.open(a,c,e),this.readyState=b.OPENED,d(this),this._object.onreadystatechange=function(){if(!i||e){if(m.readyState=m._object.readyState,f(m),m._aborted)return void(m.readyState=b.UNSENT);m.readyState==b.DONE&&(delete m._data,g(m),j&&e&&window.detachEvent("onunload",l)),n!=m.readyState&&d(m),n=m.readyState}}},b.prototype.send=function(a){b.onsend&&b.onsend.apply(this,arguments),arguments.length||(a=null),a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=a,c(this)},b.prototype.abort=function(){b.onabort&&b.onabort.apply(this,arguments),this.readyState>b.UNSENT&&(this._aborted=!0),this._object.abort(),g(this),this.readyState=b.UNSENT,delete this._data},b.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},b.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)},b.prototype.setRequestHeader=function(a,b){return this._headers||(this._headers={}),this._headers[a]=b,this._object.setRequestHeader(a,b)},b.prototype.addEventListener=function(a,b,c){for(var d,e=0;d=this._listeners[e];e++)if(d[0]==a&&d[1]==b&&d[2]==c)return;this._listeners.push([a,b,c])},b.prototype.removeEventListener=function(a,b,c){for(var d,e=0;(d=this._listeners[e])&&(d[0]!=a||d[1]!=b||d[2]!=c);e++);d&&this._listeners.splice(e,1)},b.prototype.dispatchEvent=function(a){var b={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==b.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[b]);for(var c,d=0;c=this._listeners[d];d++)c[0]!=b.type||c[2]||(c[1].handleEvent||c[1]).apply(this,[b])},b.prototype.toString=function(){return"[object XMLHttpRequest]"},b.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]),a.__func=this,a.__func(b[0],b[1],b[2],b[3],b[4]),delete a.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=b}(),OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.projCode=a,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(a))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var b=a,c=!1;if(b)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),"object"==typeof Proj4js&&this.proj.defData&&b.proj.defData)c=this.proj.defData.replace(this.titleRegEx,"")==b.proj.defData.replace(this.titleRegEx,"");else if(b.getCode){var d=this.getCode(),e=b.getCode();c=d==e||!!OpenLayers.Projection.transforms[d]&&OpenLayers.Projection.transforms[d][e]===OpenLayers.Projection.nullTransform}return c},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],worldExtent:[-180,-89,180,89]}},OpenLayers.Projection.addTransform=function(a,b,c){if(c===OpenLayers.Projection.nullTransform){var d=OpenLayers.Projection.defaults[a];d&&!OpenLayers.Projection.defaults[b]&&(OpenLayers.Projection.defaults[b]=d)}OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]={}),OpenLayers.Projection.transforms[a][b]=c},OpenLayers.Projection.transform=function(a,b,c){if(b&&c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else{var d=b.getCode(),e=c.getCode(),f=OpenLayers.Projection.transforms;f[d]&&f[d][e]&&f[d][e](a)}return a},OpenLayers.Projection.nullTransform=function(a){return a},function(){function a(a){return a.x=180*a.x/e,a.y=180/Math.PI*(2*Math.atan(Math.exp(a.y/e*Math.PI))-Math.PI/2),a}function b(a){a.x=a.x*e/180;var b=Math.log(Math.tan((90+a.y)*Math.PI/360))/Math.PI*e;return a.y=Math.max(-20037508.34,Math.min(b,20037508.34)),a}function c(c,d){var e,f,g,h,i,j=OpenLayers.Projection.addTransform,k=OpenLayers.Projection.nullTransform;for(e=0,f=d.length;f>e;++e)for(g=d[e],j(c,g,b),j(g,c,a),i=e+1;f>i;++i)h=d[i],j(g,h,k),j(h,g,k)}var d,e=20037508.34,f=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],g=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(d=f.length-1;d>=0;--d)c(f[d],g);for(d=g.length-1;d>=0;--d)c(g[d],f)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:22,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,maxZoom:null,minZoom:null,mousePosition:null,originCenter:null,isZooming:!1,initialize:function(a,b){1===arguments.length&&"object"==typeof a&&(b=a,a=b&&b.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(70,15,190,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},b),OpenLayers.Util.extend(this,b);var c=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[c]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),this.restrictedExtent=!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds?this.maxExtent:new OpenLayers.Bounds(this.restrictedExtent),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(a),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var d=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(d,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),d=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(d),this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var e=!0,f=document.getElementsByTagName("link"),g=0,h=f.length;h>g;++g)if(OpenLayers.Util.isEquivalentUrl(f.item(g).href,this.theme)){e=!1;break}if(e){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(i)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var g=0,h=this.controls.length;h>g;g++)this.addControlToMap(this.controls[g]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),b&&b.layers&&(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(a){this.div=OpenLayers.Util.getElement(a),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var a=this.controls.length-1;a>=0;--a)this.controls[a].destroy();this.controls=null}if(null!=this.layers){for(var a=this.layers.length-1;a>=0;--a)this.layers[a].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a),b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},registerMousePosition:function(){this.events.register("mousemove",this,function(a){this.mousePosition=this.getLonLatFromPixel(a.xy)})},getMousePosition:function(){return this.mousePosition},getBy:function(a,b,c){var d="function"==typeof c.test,e=OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])});return e},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){var b=OpenLayers.Array.filter(this.layers,function(b){return b.name==a});return b},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;d>c;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+5*b)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;b>a;a++){var c=this.layers[a];!c.isBaseLayer&&(c instanceof OpenLayers.Layer.TDTLayer||c instanceof OpenLayers.Layer.Baidu)?c.setZIndex(parseInt(this.baseLayer.getZIndex())+1):this.setLayerZIndex(c,a)}},addLayer:function(a){for(var b=0,c=this.layers.length;c>b;b++)if(this.layers[b]==a)return!1;return this.events.triggerEvent("preaddlayer",{layer:a})===!1?!1:(this.allOverlays&&(a.isBaseLayer=!1),a.div.className="olLayerDiv",a.div.style.overflow="",this.setLayerZIndex(a,this.layers.length),a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div),this.layers.push(a),a.setMap(this),a.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw(),this.events.triggerEvent("addlayer",{layer:a}),a.events.triggerEvent("added",{map:this,layer:a}),a.afterAdd(),!0)},addLayers:function(a){for(var b=0,c=a.length;c>b;b++)this.addLayer(a[b])},removeLayer:function(a,b){if(this.events.triggerEvent("preremovelayer",{layer:a})!==!1){if(null==b&&(b=!0),a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.layers,a),a.removeMap(this),a.map=null,this.baseLayer==a&&(this.baseLayer=null,b))for(var c=0,d=this.layers.length;d>c;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:a}),a.events.triggerEvent("removed",{map:this,layer:a})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);if(0>b?b=0:b>this.layers.length&&(b=this.layers.length),c!=b){this.layers.splice(c,1),this.layers.splice(b,0,a);for(var d=0,e=this.layers.length;e>d;d++)this.setLayerZIndex(this.layers[d],d);this.events.triggerEvent("changelayer",{layer:a,property:"order"}),this.allOverlays&&(0===b?this.setBaseLayer(a):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){if(a!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,a)){var b=this.getCachedCenter(),c=this.getResolution(),d=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=a,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=b){var e=this.getZoomForResolution(d||this.resolution,!0);this.setCenter(b,e,!1,c!=d)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a),this.addControlToMap(a,b),this.events.triggerEvent("addcontrol")},addControls:function(a,b){for(var c=1===arguments.length?[]:b,d=0,e=a.length;e>d;d++){var f=a[d],g=c[d]?c[d]:null;this.addControl(f,g)}},addControlToMap:function(a,b){a.outsideViewport=null!=a.div,this.displayProjection&&!a.displayProjection&&(a.displayProjection=this.displayProjection),a.setMap(this);var c=a.draw(b);c&&(a.outsideViewport||(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c))),a.autoActivate&&a.activate()},getControl:function(a){for(var b=null,c=0,d=this.controls.length;d>c;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){a&&a==this.getControl(a.id)&&(a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,a),this.events.triggerEvent("removecontrol"))},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;c>=0;--c)this.removePopup(this.popups[c]);a.map=this,this.popups.push(a);var d=a.draw();d&&(d.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(d))},removePopup:function(a){if(OpenLayers.Util.removeItem(this.popups,a),a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(b){}a.map=null},getSize:function(){var a=null;return null!=this.size&&(a=this.size.clone()),a},updateSize:function(){var a=this.getCurrentSize();if(a&&!isNaN(a.h)&&!isNaN(a.w)){this.events.clearMouseCache();var b=this.getSize();if(null==b&&(this.size=b=a),!a.equals(b)){this.size=a;for(var c=0,d=this.layers.length;d>c;c++)this.layers[c].onMapResize();var e=this.getCachedCenter();if(null!=this.baseLayer&&null!=e){var f=this.getZoom();this.zoom=null,this.setCenter(e,f)}}}if(this.popups)for(var c=0;c<this.popups.length;c++)this.popups[c].updatePosition();this.events.triggerEvent("updatesize")},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=this.div.offsetWidth,a.h=this.div.offsetHeight),(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height)),a},calculateBounds:function(a,b){var c=null;if(null==a&&(a=this.getCachedCenter()),null==b&&(b=this.getResolution()),null!=a&&null!=b){var d=this.size.w*b/2,e=this.size.h*b/2;c=new OpenLayers.Bounds(a.lon-d,a.lat-e,a.lon+d,a.lat+e)}return c},getCenter:function(){var a=null,b=this.getCachedCenter();return b&&(a=b.clone()),a},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(a,b,c){if(c=OpenLayers.Util.applyDefaults(c,{animate:!0,dragging:!1}),this.panTween&&this.panTween.stop(),c.dragging)(0!=a||0!=b)&&this.moveByPx(a,b);else{var d=this.getViewPortPxFromLonLat(this.getCachedCenter()),e=d.add(a,b);if(this.dragging||!e.equals(d)){var f=this.getLonLatFromViewPortPx(e);c.animate?this.panTo(f):(this.moveTo(f),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(a){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(a)){var b=this.getCachedCenter();if(a.equals(b))return;var c=this.getPixelFromLonLat(b),d=this.getPixelFromLonLat(a),e={x:d.x-c.x,y:d.y-c.y},f={x:0,y:0};this.panTween.start({x:0,y:0},e,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(a){var b=a.x-f.x,c=a.y-f.y;this.moveByPx(b,c),f.x=Math.round(a.x),f.y=Math.round(a.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(a),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(a)},setCenter:function(a,b,c,d){this.panTween&&this.panTween.stop(),this.zoomTween&&b!=this.zoom&&this.zoomTween.stop(),this.moveTo(a,b,{dragging:c,forceZoomChange:d})},moveByPx:function(a,b){var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer.wrapDateLine,h=0,i=0;if(this.restrictedExtent&&(h=c,i=d,g=!1),a=g||e<=this.maxPx.x-h&&e>=this.minPx.x+h?Math.round(a):0,b=f<=this.maxPx.y-i&&f>=this.minPx.y+i?Math.round(b):0,a||b){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,a&&(this.layerContainerOriginPx.x-=a,this.minPx.x-=a,this.maxPx.x-=a),b&&(this.layerContainerOriginPx.y-=b,this.minPx.y-=b,this.maxPx.y-=b),this.applyTransform();var j,k,l;for(k=0,l=this.layers.length;l>k;++k)j=this.layers[k],j.visibility&&(j===this.baseLayer||j.inRange)&&(j.moveByPx(a,b),j.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(a){if(this.baseLayer&&this.baseLayer.wrapDateLine){var b=this.baseLayer.resolutions,c=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(a)>c)if(this.fractionalZoom)a=this.getZoomForResolution(c);else for(var d=0|a,e=b.length;e>d;++d)if(b[d]<=c){a=d;break}}return a},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(a,b,c){var d=this.getZoom(),e=!0;e=(b||0==b)&&b!=d?!1:!0,null==a||a instanceof OpenLayers.LonLat||(a=new OpenLayers.LonLat(a)),c||(c={}),null!=b&&(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b)));var f=b;b=this.adjustZoom(b),b!==f&&(a=this.getCenter());var g=c.dragging||this.dragging,h=c.forceZoomChange||this.isZooming;if(this.getCachedCenter()||this.isValidLonLat(a)||(a=this.maxExtent.getCenterLonLat(),this.center=a.clone()),null==b&&(b=this.getZoom()),null!=this.restrictedExtent){null==a&&(a=this.center);var i=this.getResolutionForZoom(b),j=this.calculateBounds(a,i);if(!this.restrictedExtent.containsBounds(j)){var k=this.restrictedExtent.getCenterLonLat();j.getWidth()>this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(k.lon,a.lat):j.left<this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-j.left,0):j.right>this.restrictedExtent.right&&(a=a.add(this.restrictedExtent.right-j.right,0)),j.getHeight()>this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,k.lat):j.bottom<this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-j.bottom):j.top>this.restrictedExtent.top&&(a=a.add(0,this.restrictedExtent.top-j.top))}}var l=h||this.isValidZoomLevel(b)&&b!=this.getZoom(),m=this.isValidLonLat(a)&&!a.equals(this.center);if(l||m||g){m&&(!l&&this.center&&this.centerLayerContainer(a),this.center=a.clone());var n=l?this.getResolutionForZoom(b):this.getResolution();if(l||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var o=this.getMaxExtent({restricted:!0}),p=o.getCenterLonLat(),q=this.center.lon-p.lon,r=p.lat-this.center.lat,s=Math.round(o.getWidth()/n),t=Math.round(o.getHeight()/n);this.minPx={x:(this.size.w-s)/2-q/n,y:(this.size.h-t)/2-r/n},this.maxPx={x:this.minPx.x+Math.round(o.getWidth()/n),y:this.minPx.y+Math.round(o.getHeight()/n)}}l&&(this.zoom=b,this.resolution=n),g||this.events.triggerEvent("movestart",{zoomChanged:l});var u=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(u,l,c.dragging),c.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:l})),u=this.baseLayer.getExtent();for(var v=this.layers.length-1;v>=0;--v){var w=this.layers[v];if(w!==this.baseLayer&&!w.isBaseLayer){var x=w.calculateInRange();w.inRange!=x&&(w.inRange=x,x||w.display(!1),this.events.triggerEvent("changelayer",{layer:w,property:"visibility"})),x&&w.visibility&&(w.moveTo(u,l,c.dragging),c.dragging||w.events.triggerEvent("moveend",{zoomChanged:l}))}}this.events.triggerEvent("move"),g||this.events.triggerEvent("moveend"),l&&((!e||c.zoomChanged)&&window.setTimeout(this._showpopups.bind(this),10),this.isZooming=!1,this.events.triggerEvent("zoomend"))}},_showpopups:function(){for(var a=0,b=this.popups.length;b>a;a++)this.popups[a].hideStates===!1&&this.popups[a].updatePosition(),this.popups[a].mapHide&&this.popups[a].show()},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&&null!=c){var d=this.layerContainerOriginPx.x,e=this.layerContainerOriginPx.y,f=Math.round(b.x-c.x),g=Math.round(b.y-c.y);this.applyTransform(this.layerContainerOriginPx.x=f,this.layerContainerOriginPx.y=g);var h=d-f,i=e-g;this.minPx.x-=h,this.maxPx.x-=h,this.minPx.y-=i,this.maxPx.y-=i}},isValidZoomLevel:function(a){var b=null!=a&&a>=0&&a<this.getNumZoomLevels();return b&&this.minZoom&&this.maxZoom?a>=this.minZoom&&this.maxZoom>=a:b},isValidLonLat:function(a){var b=!1;try{if(null!=a){var c=this.getMaxExtent(),d=this.baseLayer.wrapDateLine&&c;b=c.containsLonLat(a,{worldBounds:d})}}catch(e){}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.projection),a},getMaxResolution:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.maxResolution),a},getMaxExtent:function(a){var b=null;return a&&a.restricted&&this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&&(b=this.baseLayer.maxExtent),b},getNumZoomLevels:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.numZoomLevels),a},getExtent:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.getExtent()),a},getResolution:function(){var a=null;return null!=this.baseLayer?a=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(a=this.layers[0].getResolution()),a},getUnits:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.units),a},getScale:function(){var a=null;if(null!=this.baseLayer){var b=this.getResolution(),c=this.baseLayer.units;a=OpenLayers.Util.getScaleFromResolution(b,c)}return a},getZoomForExtent:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForExtent(a,b)),parseInt(c)},getResolutionForZoom:function(a){var b=null;return this.baseLayer&&(b=this.baseLayer.getResolutionForZoom(a)),b},getZoomForResolution:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForResolution(a,b)),Math.round(c)},zoomTo:function(a,b,c,d){a=Math.round(a);var e=this;if(e.isValidZoomLevel(a)){this.isZooming=!0,e.baseLayer.wrapDateLine&&(a=e.adjustZoom(a));var f=b?e.getZoomTargetCenter(b,e.getResolutionForZoom(a)):e.getCenter();if(f=d||f,f&&a!=this.getZoom()){for(var g=0,h=this.popups.length;h>g;g++)this.popups[g].visible()&&this.popups[g].hide(!0);e.events.triggerEvent("zoomstart",{center:f,zoom:a,xy:b,zoomType:c})}if(e.zoomTween){var i=e.getResolution(),j=e.getResolutionForZoom(a),k={scale:1},l={scale:i/j},m=-1;if(a>e.getZoom()&&(m=1),e.zoomTween.playing&&e.zoomTween.isZoomIn==m&&e.zoomTween.duration<3*e.zoomDuration)e.zoomTween.finish={scale:e.zoomTween.finish.scale*l.scale};else{if(e.zoomTween.isZoomIn=m,!b){var n=e.getSize();b={x:n.w/2,y:n.h/2}}a==e.minZoom||a==e.maxZoom?4==Math.abs(e.getZoom()-a)?e.zoomDuration=6:3==Math.abs(e.getZoom()-a)?e.zoomDuration=5:2==Math.abs(e.getZoom()-a)?e.zoomDuration=4:1==Math.abs(e.getZoom()-a)&&(e.zoomDuration=2):e.zoomDuration=20,e.zoomTween.start(k,l,e.zoomDuration,{minFrameRate:45,callbacks:{eachStep:function(a){var c=e.layerContainerOriginPx,d=a.scale,f=(d-1)*(c.x-b.x)|0,g=(d-1)*(c.y-b.y)|0;e.applyTransform(c.x+f,c.y+g,d)},done:function(a){e.applyTransform();var c=e.getResolution()/a.scale,d=e.getZoomForResolution(c,!0);d>e.maxZoom&&(d=e.maxZoom),d<e.minZoom&&(d=e.minZoom),c=e.getResolutionForZoom(d),e.moveTo(e.getZoomTargetCenter(b,c),d,{zoomChanged:!0})}}})}}else{var f=b?e.getZoomTargetCenter(b,e.getResolutionForZoom(a)):null;e.setCenter(f,a)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){var d=this.getMaxExtent();for(a=a.clone();a.right<a.left;)a.right+=d.getWidth();c=a.getCenterLonLat().wrapDateLine(d)}this.setCenter(c,this.getZoomForExtent(a,b))},zoomToMaxExtent:function(a){var b=a?a.restricted:!0,c=this.getMaxExtent({restricted:b});this.zoomToExtent(c)},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,e=this.size.h*c/2,f=this.getCachedCenter(),g=new OpenLayers.Bounds(f.lon-d,f.lat-e,f.lon+d,f.lat+e);this.zoomToExtent(g,b)},getLonLatFromViewPortPx:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getLonLatFromViewPortPx(a)),b},getViewPortPxFromLonLat:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getViewPortPxFromLonLat(a)),b},getZoomTargetCenter:function(a,b){var c=null,d=this.getSize(),e=d.w/2-a.x,f=a.y-d.h/2,g=this.getLonLatFromPixel(a);return g&&(c=new OpenLayers.LonLat(g.lon+e*b,g.lat+f*b)),c},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){var b=this.getViewPortPxFromLonLat(a);return b.x=Math.round(b.x),b.y=Math.round(b.y),b},getGeodesicPixelSize:function(a){var b=a?this.getLonLatFromPixel(a):this.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution(),d=b.add(-c/2,0),e=b.add(c/2,0),f=b.add(0,-c/2),g=b.add(0,c/2),h=new OpenLayers.Projection("EPSG:4326"),i=this.getProjectionObject()||h;return i.equals(h)||(d.transform(i,h),e.transform(i,h),f.transform(i,h),g.transform(i,h)),new OpenLayers.Size(OpenLayers.Util.distVincenty(d,e),OpenLayers.Util.distVincenty(f,g))},getViewPortPxFromLayerPx:function(a){var b=null;if(null!=a){var c=this.layerContainerOriginPx.x,d=this.layerContainerOriginPx.y;b=a.add(c,d)}return b},getLayerPxFromViewPortPx:function(a){var b=null;if(null!=a){var c=-this.layerContainerOriginPx.x,d=-this.layerContainerOriginPx.y;b=a.add(c,d),(isNaN(b.x)||isNaN(b.y))&&(b=null)}return b},getLonLatFromLayerPx:function(a){return a=this.getViewPortPxFromLayerPx(a),this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){var b=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(b)},applyTransform:function(a,b,c){c=c||1;var d=this.layerContainerOriginPx,e=1!==c;a=a||d.x,b=b||d.y;var f=this.layerContainerDiv.style,g=this.applyTransform.transform,h=this.applyTransform.template;if(void 0===g&&(g=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=g,g)){var i=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));i&&"none"===i||(h=["translate3d(",",0) ","scale3d(",",1)"],f[g]=[h[0],"0,0",h[1]].join("")),h&&~f[g].indexOf(h[0])||(h=["translate(",") ","scale(",")"]),this.applyTransform.template=h}null===g||"translate3d("!==h[0]&&e!==!0?(f.left=a+"px",f.top=b+"px",null!==g&&(f[g]="")):(e===!0&&"translate("===h[0]&&(a-=d.x,b-=d.y,f.left=d.x+"px",f.top=d.y+"px"),f[g]=[h[0],a,"px,",b,"px",h[1],h[2],c,",",c,h[3]].join(""))},getSortLayers:function(){var a=this.layers.slice();return a.sort(function(a,b){return parseInt(a.getZIndex())-parseInt(b.getZIndex())})},getFeatures:function(a){for(var b,c,d,e=(a.offsetX,a.offsetY,[]),f=[],g=this.getSortLayers(),h=this.viewPortDiv.getElementsByTagName("canvas"),i=[],d=0;d<h.length;d++)h[d].parentElement==this.viewPortDiv?(i.push(h[d]),h[d].style.display="none"):"olScrollable"===h[d].parentElement.className&&"none"!==h[d].parentElement.style.display&&(i.push(h[d]),h[d].parentElement.style.display="none");for(d=g.length-1;d>=0;--d)if(b=g[d],"none"!==b.div.style.display)if(b.renderer instanceof OpenLayers.Renderer.Elements){if(b instanceof OpenLayers.Layer.Vector){if(c=b.getFeatureFromEvent(a)){e.push(c);break}f.push(b),b.div.style.display="none"}}else b.renderer instanceof OpenLayers.Renderer.Canvas&&(c=b.getFeatureFromEvent(a),c&&(e.push(c),f.push(b)));for(d=f.length-1;d>=0;--d)f[d].div.style.display="block";for(var d=0;d<i.length;d++)i[d].parentElement==this.viewPortDiv?i[d].style.display="block":"olScrollable"===i[d].parentElement.className&&(i[d].parentElement.style.display="block");return e},setMapStyle:function(a){switch(a){case"灰色":this.mapStyle="grayscale";break;case"经典黑":this.mapStyle="classicblack";break;case"浅绿":this.mapStyle="green";break;case"天蓝":this.mapStyle="blue";break;case"粉色":this.mapStyle="pinkcolour";break;default:this.mapStyle=null}},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b){this.metadata={},b=OpenLayers.Util.extend({},b),null!=this.alwaysInRange&&(b.alwaysInRange=this.alwaysInRange),this.addOptions(b),this.name=a,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))
},destroy:function(a){null==a&&(a=!0),null!=this.map&&this.map.removeLayer(this,a),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(a){return null==a&&(a=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(a,this),a.map=null,a},getOptions:function(){var a={};for(var b in this.options)a[b]=this[b];return a},setName:function(a){a!=this.name&&(this.name=a,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(a,b){if(null==this.options&&(this.options={}),a&&("string"==typeof a.projection&&(a.projection=new OpenLayers.Projection(a.projection)),a.projection&&OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),!a.maxExtent||a.maxExtent instanceof OpenLayers.Bounds||(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds||(a.minExtent=new OpenLayers.Bounds(a.minExtent))),OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var c=this.map.getResolution(),d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var e in a)if(a.hasOwnProperty(e)&&OpenLayers.Util.indexOf(d,e)>=0){this.initResolutions(),b&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();if(b&&this.inRange&&this.visibility){var c=!0;this.moveTo(b,c,!1),this.events.triggerEvent("moveend",{zoomChanged:c}),a=!0}}return a},moveTo:function(){var a=this.visibility;this.isBaseLayer||(a=a&&this.inRange),this.display(a)},moveByPx:function(){},setMap:function(a){if(null==this.map){if(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection&&this.projection.getUnits()?this.projection.getUnits():this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var b=this.visibility&&this.inRange;this.div.style.display=b?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(a){var b=a?a:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=b,this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,this.display(a),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(a){a!=("none"!=this.div.style.display)&&(this.div.style.display=a&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var a=!1;if(this.alwaysInRange)a=!0;else if(this.map){var b=this.map.getResolution();a=b>=this.minResolution&&b<=this.maxResolution}return a},setIsBaseLayer:function(a){a!=this.isBaseLayer&&(this.isBaseLayer=a,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var a,b,c,d={},e=!0;for(a=0,b=this.RESOLUTION_PROPERTIES.length;b>a;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&&this.options[c]&&(e=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=e),null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d)),null==d.resolutions){for(a=0,b=this.RESOLUTION_PROPERTIES.length;b>a;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d))}var f;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(f=this.options.maxResolution),this.options.minScale&&(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(g=this.options.minResolution),this.options.maxScale&&(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),d.resolutions&&(d.resolutions.sort(function(a,b){return b-a}),f||(f=d.resolutions[0]),!g)){var h=d.resolutions.length-1;g=d.resolutions[h]}if(this.resolutions=d.resolutions,this.resolutions){for(b=this.resolutions.length,this.scales=new Array(b),a=0;b>a;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b}this.minResolution=g,g&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(g,this.units)),this.maxResolution=f,f&&(this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units))},resolutionsFromScales:function(a){if(null!=a){var b,c,d;for(d=a.length,b=new Array(d),c=0;d>c;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b}},calculateResolutions:function(a){var b,c,d,e=a.maxResolution;null!=a.minScale?e=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):"auto"==e&&null!=this.maxExtent&&(b=this.map.getSize(),c=this.maxExtent.getWidth()/b.w,d=this.maxExtent.getHeight()/b.h,e=Math.max(c,d));var f=a.minResolution;if(null!=a.maxScale?f=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):"auto"==a.minResolution&&null!=this.minExtent&&(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,d=this.minExtent.getHeight()/b.h,f=Math.max(c,d)),"number"!=typeof e&&"number"!=typeof f&&null!=this.maxExtent){var g=this.map.getTileSize();e=Math.max(this.maxExtent.getWidth()/g.w,this.maxExtent.getHeight()/g.h)}var h=a.maxZoomLevel,i=a.numZoomLevels;if("number"==typeof f&&"number"==typeof e&&void 0===i){var j=e/f;i=Math.floor(Math.log(j)/Math.log(2))+1}else void 0===i&&null!=h&&(i=h+1);if(!("number"!=typeof i||0>=i||"number"!=typeof e&&"number"!=typeof f)){var k=new Array(i),l=2;"number"==typeof f&&"number"==typeof e&&(l=Math.pow(e/f,1/(i-1)));var m;if("number"==typeof e)for(m=0;i>m;m++)k[m]=e/Math.pow(l,m);else for(m=0;i>m;m++)k[i-1-m]=f*Math.pow(l,m);return k}},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize(),d=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(d,b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var c=Math.floor(a),d=Math.ceil(a);b=this.resolutions[c]-(a-c)*(this.resolutions[c]-this.resolutions[d])}else b=this.resolutions[Math.round(a)];return b},getZoomForResolution:function(a,b){var c,d,e;if(this.map.fractionalZoom){var f,g=0,h=this.resolutions.length-1,i=this.resolutions[g],j=this.resolutions[h];for(d=0,e=this.resolutions.length;e>d;++d)if(f=this.resolutions[d],f>=a&&(i=f,g=d),a>=f){j=f,h=d;break}var k=i-j;c=k>0?g+(i-a)/k:g}else{var l,m=Number.POSITIVE_INFINITY;for(d=0,e=this.resolutions.length;e>d;d++)if(b){if(l=Math.abs(this.resolutions[d]-a),l>m)break;m=l}else if(this.resolutions[d]<a)break;c=Math.max(0,d-1)}return c},getLonLatFromViewPortPx:function(a){var b=null,c=this.map;if(null!=a&&c.minPx){var d=c.getResolution(),e=c.getMaxExtent({restricted:!0}),f=(a.x-c.minPx.x)*d+e.left,g=(c.minPx.y-a.y)*d+e.top;b=new OpenLayers.LonLat(f,g),this.wrapDateLine&&(b=b.wrapDateLine(this.maxExtent))}return b},getViewPortPxFromLonLat:function(a,b){var c=null;if(null!=a){b=b||this.map.getResolution();var d=this.map.calculateBounds(null,b);c=new OpenLayers.Pixel(1/b*(a.lon-d.left),1/b*(d.top-a.lat))}return c},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;d>c;++c){var e=b[c].firstChild||b[c],f=b[c].lastChild;f&&"iframe"===f.nodeName.toLowerCase()&&(e=f.parentNode),OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};a=a.wrapDateLine(this.maxExtent,c)}return a},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a,this.size=b||{w:20,h:20},this.offset=c||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=d;var e=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){null!=a&&(this.size=a),this.draw()},setUrl:function(a){null!=a&&(this.url=a),this.draw()},draw:function(a){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(a),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){null!=a&&(this.px=a),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(a){this.imageDiv.style.display=a?"":"none"},isDrawn:function(){var a=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return a},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,isAdaptation:!1,prevPositon:null,mapHide:!0,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(a,b,c,d,e,f,g){null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=a,this.lonlat=b,this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=d&&(this.contentHTML=d),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.style.overflow="visible",this.div.style.cursor="default",this.div.className=this.displayClass;var h=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(h,null,null,null,"relative",null,"hidden");var a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),g&&(this.titleDiv=OpenLayers.Util.createDiv(a+"_dialog",null,new OpenLayers.Size(this.contentSize.w,20),null,"relative"),this.titleDiv.innerHTML='<span id="ui-id-1" class="ui-dialog-title">Basic dialog</span>'),this.div.appendChild(this.groupDiv),e&&this.addCloseBox(f),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(a){return null==a&&null!=this.lonlat&&null!=this.map&&(a=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null),b=a.getPropertyValue("overflow");"hidden"!=b&&(this.contentDiv._oldOverflow=b,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var a=this.contentDiv._oldOverflow;a&&(this.contentDiv.style.overflow=a,this.contentDiv._oldOverflow=null)})),this.moveTo(a),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.isAdaptation&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){if(null!=a&&null!=this.div){var b=0;this.positionBlocks&&this.positionBlocks.tr.blocks.length>0&&(b=this.positionBlocks.tr.blocks[0].size.h),a.y=a.y-b,this.div.style.left=a.x+"px",this.div.style.top=a.y+"px",this.prevPositon={left:this.div.style.left,top:this.div.style.top}}},visible:function(){return"-1000000px"!=this.div.style.left&&"-1e+06px"!=this.div.style.left&&"-1000000px"!=this.div.style.top&&"-1e+06px"!=this.div.style.top},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.prevPositon&&(this.div.style.left=this.prevPositon.left,this.div.style.top=this.prevPositon.top),this.panMapIfOutOfView&&this.isAdaptation&&this.panIntoView(),this.hideStates=!1,this.mapHide=!1},hide:function(a){this.prevPositon={left:this.div.style.left,top:this.div.style.top},this.div.style.left="-1000000px",this.div.style.top="-1000000px",this.hideStates=!0,this.mapHide=a},setSize:function(a){if(this.size=a.clone(),"OpenLayers.Popup.Anchored"!=this.CLASS_NAME){var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;if(this.fixPadding(),c+=this.padding.left+this.padding.right,d+=this.padding.top+this.padding.bottom,this.closeDiv){var e=parseInt(this.closeDiv.style.width);c+=e+b.right}this.size.w+=c,this.size.h+=d,this.imageSize&&(this.size.h-=this.imageSize.h),"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top)}null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=a.w+"px",this.contentDiv.style.height=a.h+"px")},getContentDivStyle:function(){return this.contentDiv?this.contentDiv.style:void 0},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,null,{displayClass:this.displayClass,containerElement:b}),d=this.getSafeContentSize(c),e=null;if(d.equals(c))e=c;else{var f={w:d.w<c.w?d.w:null,h:d.h<c.h?d.h:null};if(f.w&&f.h)e=d;else{var g=OpenLayers.Util.getRenderedDimensions(a,f,{displayClass:this.contentDisplayClass,containerElement:b}),h=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=h&&g.equals(d)){var i=OpenLayers.Util.getScrollbarWidth();f.w?g.h+=i:g.w+=i}e=this.getSafeContentSize(g)}}this.setSize(e)},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=a),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(a){void 0!=a&&(this.opacity=a),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(a){void 0!=a&&(this.border=a),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(a){null!=a&&(this.contentHTML=a),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize())),this.prevPositon={left:this.div.style.left,top:this.div.style.top}},registerImageListeners:function(){for(var a=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;d>c;c++){var e=b[c];if(0==e.width||0==e.height){var f={popup:this,img:e};e._onImgLoad=OpenLayers.Function.bind(a,f),OpenLayers.Event.observe(e,"load",e._onImgLoad)}}},getSafeContentSize:function(a){return a},getContentDivPadding:function(){var a=this._contentDivPadding;return a||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=a,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px",this.closeDiv.style.top=b.top+"px",this.groupDiv.appendChild(this.closeDiv);var c=a||function(a){this.hide(),OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(c,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(c,this))},panIntoView:function(){if(null!=this.map){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x<this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w>a.w-this.map.paddingForPopups.right&&(c.x=a.w-this.map.paddingForPopups.right-this.size.w),b.y<this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h>a.h-this.map.paddingForPopups.bottom&&(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h);var d=b.x-c.x,e=b.y-c.y;this.map.pan(d,e)}},registerEvents:function(){function a(a){OpenLayers.Event.stop(a,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:a,scope:this})},onmousedown:function(a){this.mousedown=!0,OpenLayers.Event.stop(a,!0)},onmousemove:function(a){this.mousedown&&OpenLayers.Event.stop(a,!0)},onmouseup:function(a){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(a,!0))},onclick:function(a){OpenLayers.Event.stop(a,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},setContentDom:function(a){if(this.contentHTML=a.innerHTML,null!=this.contentDiv){for(;this.contentDiv.childNodes.length>0;)this.contentDiv.removeChild(this.contentDiv.firstChild);this.contentDiv.appendChild(a),this.autoSize&&(this.registerImageListeners(),this.updateSize())}this.hideStates||(this.prevPositon={left:this.div.style.left,top:this.div.style.top})},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Menu=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"contextmenu",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,menuList:[],initialize:function(a,b){null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=a,this.menuList=b,this.backgroundColor=OpenLayers.Menu.COLOR,this.opacity=OpenLayers.Menu.OPACITY,this.border=OpenLayers.Menu.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,""),this.div.className=this.displayClass,this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(a){return null==a&&(this.lonlat=this.map.getMousePosition(),null!=this.lonlat&&null!=this.map&&(a=this.map.getLayerPxFromLonLat(this.lonlat))),this.closeOnMove,this.moveTo(a),!this.autoSize&&!this.size,this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(pixel,f){this.div.style.display="",this.div.innerHTML="",f&&(this.div.style.left=pixel.x+"px",this.div.style.top=pixel.y+"px");for(var mHeight=20,mWidth=100,g_menu=this.menuList,i=0;i<g_menu.length;i++){var pDiv=document.createElement("div");this.div.appendChild(pDiv);var pObj=g_menu[i];if(null!=pObj){pDiv.style.width=mWidth+"px",pDiv.innerHTML=pObj.name,pDiv.className="menuitem",pDiv.func=pObj.func,pDiv.onmouseover=function(){this.className="menuitem selectedmenuitem"},pDiv.onmouseout=function(){this.className="menuitem"};var that=this;pDiv.onclick=function(){f?this.func(NPMapLib.T.getPoint(that.map,that.map.mousePosition)):eval(this.func)}}else pDiv.className="divider"}var e=window.event?window.event:f;e&&(e.returnValue=!1),this.div.style.display="",this.div.style.backgroundColor="rgb(240, 240, 240)"},hide:function(){this.div&&(this.div.style.display="none",this.destroy())},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;if(this.fixPadding(),c+=this.padding.left+this.padding.right,d+=this.padding.top+this.padding.bottom,this.closeDiv){var e=parseInt(this.closeDiv.style.width);c+=e+b.right}this.size.w+=c,this.size.h+=d,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=a.w+"px",this.contentDiv.style.height=a.h+"px")},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,null,{displayClass:this.displayClass,containerElement:b}),d=this.getSafeContentSize(c),e=null;if(d.equals(c))e=c;else{var f={w:d.w<c.w?d.w:null,h:d.h<c.h?d.h:null};if(f.w&&f.h)e=d;else{var g=OpenLayers.Util.getRenderedDimensions(a,f,{displayClass:this.contentDisplayClass,containerElement:b}),h=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=h&&g.equals(d)){var i=OpenLayers.Util.getScrollbarWidth();f.w?g.h+=i:g.w+=i}e=this.getSafeContentSize(g)}}this.setSize(e)},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=a),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(a){void 0!=a&&(this.opacity=a),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(a){void 0!=a&&(this.border=a),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(a){null!=a&&(this.contentHTML=a),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var a=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;d>c;c++){var e=b[c];if(0==e.width||0==e.height){var f={popup:this,img:e};e._onImgLoad=OpenLayers.Function.bind(a,f),OpenLayers.Event.observe(e,"load",e._onImgLoad)}}},getSafeContentSize:function(a){var b=a.clone(),c=this.getContentDivPadding(),d=c.left+c.right,e=c.top+c.bottom;if(this.fixPadding(),d+=this.padding.left+this.padding.right,e+=this.padding.top+this.padding.bottom,this.closeDiv){var f=parseInt(this.closeDiv.style.width);d+=f+c.right}if(this.minSize&&(b.w=Math.max(b.w,this.minSize.w-d),b.h=Math.max(b.h,this.minSize.h-e)),this.maxSize&&(b.w=Math.min(b.w,this.maxSize.w-d),b.h=Math.min(b.h,this.maxSize.h-e)),this.map&&this.map.size){var g=0,h=0;if(this.keepInMap&&!this.panMapIfOutOfView){var i=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":g=i.x,h=this.map.size.h-i.y;break;case"tl":g=this.map.size.w-i.x,h=this.map.size.h-i.y;break;case"bl":g=this.map.size.w-i.x,h=i.y;break;case"br":g=i.x,h=i.y;break;default:g=i.x,h=this.map.size.h-i.y}}var j=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-e-h,k=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-d-g;b.w=Math.min(b.w,k),b.h=Math.min(b.h,j)}return b},getContentDivPadding:function(){var a=this._contentDivPadding;return a||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=a,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px",this.closeDiv.style.top=b.top+"px",this.groupDiv.appendChild(this.closeDiv);var c=a||function(a){this.hide(),OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(c,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(c,this))},panIntoView:function(){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x<this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w>a.w-this.map.paddingForPopups.right&&(c.x=a.w-this.map.paddingForPopups.right-this.size.w),b.y<this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h>a.h-this.map.paddingForPopups.bottom&&(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h);var d=b.x-c.x,e=b.y-c.y;this.map.pan(d,e)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({scope:this})},onmousedown:function(a){this.mousedown=!0,this.div.style.display="none",OpenLayers.Event.stop(a,!0)},onmousemove:function(a){this.mousedown&&OpenLayers.Event.stop(a,!0)},onmouseup:function(a){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(a,!0))},onclick:function(a){OpenLayers.Event.stop(a,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},setContentDom:function(a){if(this.contentHTML=a.innerHTML,null!=this.contentDiv){for(;this.contentDiv.childNodes.length>0;)this.contentDiv.removeChild(this.contentDiv.firstChild);this.contentDiv.appendChild(a),this.autoSize&&(this.registerImageListeners(),this.updateSize())}},CLASS_NAME:"OpenLayers.Menu"}),OpenLayers.Menu.WIDTH=200,OpenLayers.Menu.HEIGHT=200,OpenLayers.Menu.COLOR="white",OpenLayers.Menu.OPACITY=1,OpenLayers.Menu.BORDER="0px",OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f){this.layer=a,this.position=b.clone(),this.setBounds(c),this.url=d,e&&(this.size=e.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,f),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(a){a||this.clear();var b=this.shouldDraw();return b&&!a&&this.events.triggerEvent("beforedraw")===!1&&(b=null),b},shouldDraw:function(){var a=!1,b=this.layer.maxExtent;if(b){var c=this.layer.map,d=c.baseLayer.wrapDateLine&&c.getMaxExtent();this.bounds.intersectsBounds(b,{inclusive:!1,worldBounds:d})&&(a=!0)}return a||this.layer.displayOutsideMaxExtent},setBounds:function(a){if(a=a.clone(),this.layer.map.baseLayer.wrapDateLine){var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution();a=a.wrapDateLine(b,{leftTolerance:c,rightTolerance:c})}this.bounds=a},moveTo:function(a,b,c){null==c&&(c=!0),this.setBounds(a),this.position=b.clone(),c&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=d,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)
},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);return a?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):a===!1&&this.unload(),a},renderTile:function(){if(this.layer.async){var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b){a==this.asyncRequestId&&(this.url=b,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds),c=1;this.layer instanceof OpenLayers.Layer.Grid&&(c=this.layer.getServerResolution()/this.layer.map.getResolution()),a.left=this.position.x+"px",a.top=this.position.y+"px",a.width=Math.round(c*b.w)+"px",a.height=Math.round(c*b.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a){var b=this.getTile();b.parentNode===this.layer.div&&this.layer.div.removeChild(b),this.setImgSrc(),this.layerAlphaHack===!0&&(a.style.filter=""),OpenLayers.Element.removeClass(a,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var a=this.imgDiv.style;if(this.frame){var b=0,c=0;this.layer.gutter&&(b=this.layer.gutter/this.layer.tileSize.w*100,c=this.layer.gutter/this.layer.tileSize.h*100),a.left=-b+"%",a.top=-c+"%",a.width=2*b+100+"%",a.height=2*c+100+"%"}a.visibility="hidden",a.opacity=0,this.layer.opacity<1&&(a.filter="alpha(opacity="+100*this.layer.opacity+")"),a.position="absolute",this.layerAlphaHack&&(a.paddingTop=a.height,a.height="0",a.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(a){this.imgDiv=a},initImage:function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var a=this.getImage(),b=a.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(b,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&a.removeAttribute("crossorigin"),OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(a){var b=this.imgDiv;a?(b.style.visibility="hidden",b.style.opacity=0,this.crossOriginKeyword&&("data:"!==a.substr(0,5)?b.setAttribute("crossorigin",this.crossOriginKeyword):b.removeAttribute("crossorigin")),b.src=a):(this.stopLoading(),this.imgDiv=null,b.parentNode&&b.parentNode.removeChild(b))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var a;return this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv,this.imgDiv=null,a}},onImageLoad:function(){var a=this.imgDiv;this.stopLoading(),a.style.visibility="inherit",a.style.opacity=this.layer.opacity,a.style.webkitFilter=this.getImageStyleFilter(),this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),a.style.filter=a.style.webkitFilter,this.layerAlphaHack===!0&&(a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')")},getImageStyleFilter:function(){var a="";switch(this.layer.map.mapStyle){case"grayscale":a="grayscale(1)";break;case"classicblack":a="invert()";break;case"green":a="hue-rotate(60deg)";break;case"blue":a="hue-rotate(120deg)";break;case"pinkcolour":a="hue-rotate(300deg)"}return a},onImageError:function(){var a=this.imgDiv;null!=a.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var a=document.createElement("canvas");a.width=this.size.w,a.height=this.size.h,this.canvasContext=a.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var a=new Image;return a.className="olTileImage",a.galleryImg="no",a}(),OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){var a=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(a){var b=this.layer.getURL(this.bounds),c=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&b.length>this.maxGetUrlLength;var d=c&&!this.useIFrame,e=!c&&this.useIFrame;(d||e)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,d&&this.frame.removeChild(this.frame.firstChild))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var a=document.createElement("div"),b=a.style;b.position="absolute",b.width="100%",b.height="100%",b.zIndex=1,b.backgroundImage="url("+this.blankImageUrl+")",this.frame.appendChild(a)}var c,d=this.id+"_iFrame";return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(c=document.createElement('<iframe name="'+d+'">'),c.style.backgroundColor="#FFFFFF",c.style.filter="chroma(color=#FFFFFF)"):(c=document.createElement("iframe"),c.style.backgroundColor="transparent",c.name=d),c.scrolling="no",c.marginWidth="0px",c.marginHeight="0px",c.frameBorder="0",c.style.position="absolute",c.style.width="100%",c.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(c),this.imgDiv=c,c}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var a=document.createElement("form");a.method="POST";var b=this.layer.params._OLSALT;b=(b?b+"_":"")+this.bounds.toBBOX(),a.action=OpenLayers.Util.urlAppend(this.layer.url,b),a.target=this.id+"_iFrame";var c,d=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var e in d)c=document.createElement("input"),c.type="hidden",c.name=e,c.value=d[e],a.appendChild(c);return a},setImgSrc:function(a){if(this.useIFrame===!0)if(a){var b=this.createRequestForm();this.frame.appendChild(b),b.submit(),this.frame.removeChild(b)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var a;return this.useIFrame===!1&&(a=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),a}},OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(a)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var b=new OpenLayers.Protocol.Script({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=a.data},scope:this});b.read(),this.request=b}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),200===a.status&&this.parseData(a.responseText)},scope:this});else this.unload();return a},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(a,b){var c=null;if(this.json){var d=this.getFeatureId(a,b);null!==d&&(c={id:d,data:this.json.data[d]})}return c},getFeatureId:function(a,b){var c=null;if(this.json){var d=this.utfgridResolution,e=Math.floor(b/d),f=Math.floor(a/d),g=this.json.grid[e].charCodeAt(f),h=this.indexFromCharCode(g),i=this.json.keys;!isNaN(h)&&h in i&&(c=i[h])}return c},indexFromCharCode:function(a){return a>=93&&a--,a>=35&&a--,a-32},parseData:function(a){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(a)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b,this.extent=c,this.maxExtent=c,this.size=d,OpenLayers.Layer.prototype.initialize.apply(this,[a,e]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setMap:function(){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var c=null==this.tile;if(b||c){this.setTileSize();var d=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});c?(this.tile=new OpenLayers.Tile.Image(this,d,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=d.clone()),this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")},a.events.register("loadstart",this,a.onLoadStart),a.onLoadEnd=function(){this.events.triggerEvent("loadend")},a.events.register("loadend",this,a.onLoadEnd),a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a,this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d){OpenLayers.Layer.prototype.initialize.apply(this,[a,d]),this.url=b,this.params||(this.params=OpenLayers.Util.extend({},c))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);var b=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),b},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;e>d;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,c-=Math.floor(c);return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d)g.toUpperCase()in f&&delete d[g];return e=OpenLayers.Util.getParameterString(d),OpenLayers.Util.urlAppend(c,e)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,isChina:!0,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(a){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;b>a;a++)for(var c=this.grid[a],d=0,e=c.length;e>d;d++){var f=c[d];this.destroyTile(f)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(a){var b=void 0!==a.singleTile&&a.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&b&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a.gridResolution=null,a.backBuffer=null,a.backBufferTimerId=null,a.loading=!1,a.numLoadingTiles=0,a},moveTo:function(a,b,c){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),a=a||this.map.getExtent(),null!=a){{var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution();this.getServerResolution(f)}this.singleTile?(d||!c&&!e.containsBounds(a))&&(b&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),b&&"resize"!==this.transitionEffect||this.applyBackBuffer(f),this.initSingleTile(a)):(d=d||!e.intersectsBounds(a,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),d?(!b||"resize"!==this.transitionEffect&&this.gridResolution!==f||this.applyBackBuffer(f),this.initGriddedTiles(a)):this.moveGriddedTiles())}},getTileData:function(a){var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&&e){var f=this.map.getResolution(),g=this.tileSize.w,h=this.tileSize.h,i=this.grid[0][0].bounds,j=i.left,k=i.top;if(j>c&&this.map.baseLayer.wrapDateLine){var l=this.map.getMaxExtent().getWidth(),m=Math.ceil((j-c)/l);c+=l*m}var n=(c-j)/(f*g),o=(k-d)/(f*h),p=Math.floor(n),q=Math.floor(o);if(q>=0&&e>q){var r=this.grid[q][p];r&&(b={tile:r,i:Math.floor((n-p)*g),j:Math.floor((o-q)*h)})}}return b},destroyTile:function(a){this.removeTileMonitoringHooks(a),a.destroy()},getServerResolution:function(a){var b=Number.POSITIVE_INFINITY;if(a=a||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,a)){var c,d,e,f;for(c=this.serverResolutions.length-1;c>=0&&(e=this.serverResolutions[c],d=Math.abs(e-a),!(d>b));c--)b=d,f=e;a=f}return a},getServerZoom:function(){var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)},applyBackBuffer:function(a){null!==this.backBufferTimerId&&this.removeBackBuffer();var b=this.backBuffer;if(!b){if(b=this.createBackBuffer(),!b)return;a===this.gridResolution?this.div.insertBefore(b,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(b,this.map.baseLayer.div),this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat={lon:c.left,lat:c.top},this.backBufferResolution=this.gridResolution}for(var d,e=this.backBufferResolution/a,f=b.childNodes,g=f.length-1;g>=0;--g)d=f[g],d.style.top=(e*d._i*d._h|0)+"px",d.style.left=(e*d._j*d._w|0)+"px",d.style.width=Math.round(e*d._w)+"px",d.style.height=Math.round(e*d._h)+"px";var h=this.getViewPortPxFromLonLat(this.backBufferLonLat,a),i=this.map.layerContainerOriginPx.x,j=this.map.layerContainerOriginPx.y,k=Math.round(h.x-i)+"px";b.style.left="NaNpx"==k?"":k;var l=Math.round(h.y-j)+"px";b.style.top="NaNpx"==l?"":l},createBackBuffer:function(){var a;if(this.grid.length>0){a=document.createElement("div"),a.id=this.div.id+"_bb",a.className="olBackBuffer",a.style.position="absolute";var b=this.map;a.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:b.Z_INDEX_BASE.BaseLayer-(b.getNumLayers()-b.getLayerIndex(this));for(var c=0,d=this.grid.length;d>c;c++)for(var e=0,f=this.grid[c].length;f>e;e++){var g=this.grid[c][e],h=this.grid[c][e].createBackBuffer();h&&(h._i=c,h._j=e,h._w=g.size.w,h._h=g.size.h,h.id=g.id+"_bb",a.appendChild(h))}}return a},removeBackBuffer:function(){if(this._transitionElement){for(var a=this.transitionendEvents.length-1;a>=0;--a)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[a],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(a){this.singleTile&&(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio,10),a.w=parseInt(a.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getTilesBounds:function(){var a=null,b=this.grid.length;if(b){var c=this.grid[b-1][0].bounds,d=this.grid[0].length*c.getWidth(),e=this.grid.length*c.getHeight();a=new OpenLayers.Bounds(c.left,c.bottom,c.left+d,c.bottom+e)}return a},initSingleTile:function(a){this.events.triggerEvent("retile");var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio,e=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2),f=this.map.getLayerPxFromLonLat({lon:e.left,lat:e.top});this.grid.length||(this.grid[0]=[]);var g=this.grid[0][0];g?g.moveTo(e,f):(g=this.addTile(e,f),this.addTileMonitoringHooks(g),g.draw(),this.grid[0][0]=g),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,e=c*this.tileSize.h,f=a.left-b.lon,g=Math.floor(f/d)-this.buffer,h=this.rowSign,i=h*(b.lat-a.top+e),j=Math[~h?"floor":"ceil"](i/e)-this.buffer*h;return{tilelon:d,tilelat:e,startcol:g,startrow:j}},getTileOrigin:function(){var a=this.tileOrigin;if(!a){var b=this.getMaxExtent(),c={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];a=new OpenLayers.LonLat(b[c[0]],b[c[1]])}return a},getTileBoundsForGridIndex:function(a,b){var c=this.getTileOrigin(),d=this.gridLayout,e=d.tilelon,f=d.tilelat,g=d.startcol,h=d.startrow,i=this.rowSign;return new OpenLayers.Bounds(c.lon+(g+b)*e,c.lat-(h+a*i)*f*i,c.lon+(g+b+1)*e,c.lat-(h+(a-1)*i)*f*i)},initGriddedTiles:function(a){this.events.triggerEvent("retile");var b=this.map.getSize(),c=this.getTileOrigin(),d=this.map.getResolution(),e=this.getServerResolution(),f=d/e,g={w:this.tileSize.w/f,h:this.tileSize.h/f},h=Math.ceil(b.h/g.h)+2*this.buffer+1,i=Math.ceil(b.w/g.w)+2*this.buffer+1,j=this.calculateGridLayout(a,c,e);this.gridLayout=j;var k=j.tilelon,l=j.tilelat,m=this.map.layerContainerOriginPx.x,n=this.map.layerContainerOriginPx.y,o=this.getTileBoundsForGridIndex(0,0),p=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(o.left,o.top));p.x=Math.round(p.x)-m,p.y=Math.round(p.y)-n;var q=[],r=this.map.getCenter(),s=0;do{var t=this.grid[s];t||(t=[],this.grid.push(t));var u=0;do{o=this.getTileBoundsForGridIndex(s,u);var v=p.clone();v.x=v.x+u*Math.round(g.w),v.y=v.y+s*Math.round(g.h);var w=t[u];w?w.moveTo(o,v,!1):(w=this.addTile(o,v),this.addTileMonitoringHooks(w),t.push(w));var x=o.getCenterLonLat();q.push({tile:w,distance:Math.pow(x.lon-r.lon,2)+Math.pow(x.lat-r.lat,2)}),u+=1}while(o.right<=a.right+k*this.buffer||i>u);s+=1}while(o.bottom>=a.bottom-l*this.buffer||h>s);this.removeExcessTiles(s,u);var d=this.getServerResolution();this.gridResolution=d,q.sort(function(a,b){return a.distance-b.distance});for(var y=0,z=q.length;z>y;++y)q[y].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(a,b){var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:c}),c},addTileMonitoringHooks:function(a){var b="olTileReplacing";a.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:a}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(a.getTile(),b)},a.onLoadEnd=function(c){this.numLoadingTiles--;var d="unload"===c.type;if(this.events.triggerEvent("tileloaded",{tile:a,aborted:d}),!this.singleTile&&!d&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var e=a.getTile();if("none"===OpenLayers.Element.getStyle(e,"display")){var f=document.getElementById(a.id+"_bb");f&&f.parentNode.removeChild(f)}OpenLayers.Element.removeClass(e,b)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=d?this.div.lastChild:a.imgDiv;for(var g=this.transitionendEvents,h=g.length-1;h>=0;--h)OpenLayers.Event.observe(this._transitionElement,g[h],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},a.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:a})},a.events.on({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},moveGriddedTiles:function(){for(var a=this.buffer+1;;){var b=this.grid[0][0],c={x:b.position.x+this.map.layerContainerOriginPx.x,y:b.position.y+this.map.layerContainerOriginPx.y},d=this.getServerResolution()/this.map.getResolution(),e={w:Math.round(this.tileSize.w*d),h:Math.round(this.tileSize.h*d)};if(c.x>-e.w*(a-1))this.shiftColumn(!0,e);else if(c.x<-e.w*a)this.shiftColumn(!1,e);else if(c.y>-e.h*(a-1))this.shiftRow(!0,e);else{if(!(c.y<-e.h*a))break;this.shiftRow(!1,e)}}},shiftRow:function(a,b){var c=this.grid,d=a?0:c.length-1,e=a?-1:1,f=this.rowSign,g=this.gridLayout;g.startrow+=e*f;for(var h=c[d],i=c[a?"pop":"shift"](),j=0,k=i.length;k>j;j++){var l=i[j],m=h[j].position.clone();m.y+=b.h*e,l.moveTo(this.getTileBoundsForGridIndex(d,j),m)}c[a?"unshift":"push"](i)},shiftColumn:function(a,b){var c=this.grid,d=a?0:c[0].length-1,e=a?-1:1,f=this.gridLayout;f.startcol+=e;for(var g=0,h=c.length;h>g;g++){var i=c[g],j=i[d].position.clone(),k=i[a?"pop":"shift"]();j.x+=b.w*e,k.moveTo(this.getTileBoundsForGridIndex(g,d),j),i[a?"unshift":"push"](k)}},removeExcessTiles:function(a,b){for(var c,d;this.grid.length>a;){var e=this.grid.pop();for(c=0,d=e.length;d>c;c++){var f=e[c];this.destroyTile(f)}}for(c=0,d=this.grid.length;d>c;c++)for(;this.grid[c].length>b;){var e=this.grid[c],f=e.pop();this.destroyTile(f)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,e=c*this.tileSize.h,f=this.getLonLatFromViewPortPx(a),g=b.left+d*Math.floor((f.lon-b.left)/d),h=b.bottom+e*Math.floor((f.lat-b.bottom)/e);return new OpenLayers.Bounds(g,h,g+d,h+e)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Layer.TMS_PGIS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"0.3",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,yOffset:!0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TMS_PGIS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.map.getZoom(),c=this.getResolution(),d=this.tileOrigin.lon+c*this.tileSize.w/2,e=this.tileOrigin.lat-c*this.tileSize.h/2,f=a.getCenterLonLat(),g=({x:f.lon,y:f.lat},Math.round(Math.abs((f.lon-d)/(c*this.tileSize.w)))),h=Math.round(Math.abs((e-f.lat)/(c*this.tileSize.h)));return 0==g||0==h?null:(this.yOffset&&(h-=1),NPMapLib.IsDebug?OpenLayers.Util.getImageLocation("256.png"):-1!=this.url.indexOf("$")?OpenLayers.String.format(this.url,{x:g,y:h,z:b}):this.url+"/EzMap?Service=getImage&Type=RGB&ZoomOffset="+this.zoomOffset+"&V="+this.serviceVersion+"&Col="+g+"&Row="+h+"&Zoom="+(b-this.zoomOffset))},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS_PGIS"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c),parseFloat(c.VERSION)>=1.3&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE"),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},reverseAxisOrder:function(){var a=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[a]||OpenLayers.Projection.defaults[a]&&OpenLayers.Projection.defaults[a].yx)},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d),c.WIDTH=b.w,c.HEIGHT=b.h;var e=this.getFullRequestString(c);return NPMapLib.IsDebug?OpenLayers.Util.getImageLocation("256.png"):e},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a),c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},getFullRequestString:function(a){var b=this.map.getProjectionObject(),c=this.projection&&this.projection.equals(b)?this.projection.getCode():b.getCode(),d="none"==c?null:c;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=d:this.params.SRS=d,"boolean"==typeof this.params.TRANSPARENT&&(a.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.Heatmap=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,heatmap:null,mapLayer:null,tmpData:{},initialize:function(a,b,c,d,e){var f,g=document.createElement("div");OpenLayers.Layer.prototype.initialize.apply(this,[a,e]),g.style.cssText="position:absolute;width:"+b.size.w+"px;height:"+b.size.h+"px;",this.div.appendChild(g),d.element=g,this.mapLayer=c,this.map=b,this.mapLayer||(this.mapLayer=this.map.baseLayer),this.heatmap=h337.create(d),f=function(){this.tmpData.max&&this.updateLayer()},b.events.register("zoomend",this,f),b.events.register("moveend",this,f)},updateLayer:function(){var a=this.getPixelOffset(),b=this.heatmap.get("element");b.style.top=(a.y>0?"-"+a.y:Math.abs(a.y))+"px",b.style.left=(a.x>0?"-"+a.x:Math.abs(a.x))+"px",this.setDataSet(this.tmpData)},getPixelOffset:function(){var a=this.mapLayer.map.layerContainerOrigin,b=new OpenLayers.LonLat(a.lon,a.lat),c=this.mapLayer.getViewPortPxFromLonLat(b),d=this.mapLayer.map.center,e=new OpenLayers.LonLat(d.lon,d.lat),f=this.mapLayer.getViewPortPxFromLonLat(e);return{x:c.x-f.x,y:c.y-f.y}},setDataSet:function(a){var b,c,d,e={},f=a.data,g=f.length;for(e.max=a.max,e.data=[];g--;)b=f[g],c=NPMap.T.setPoint(this.map,b.lonlat),d=this.roundPixels(this.getViewPortPxFromLonLat(c)),d&&e.data.push({x:d.x,y:d.y,count:b.count});this.tmpData=a,this.heatmap.store.setDataSet(e)},roundPixels:function(a){return a.x<0||a.y<0?!1:(a.x=a.x>>0,a.y=a.y>>0,a)},addDataPoint:function(a){a=NPMap.T.setPoint(this.map,a);var b,c=this.roundPixels(this.mapLayer.getViewPortPxFromLonLat(a)),d={lonlat:a};2==arguments.length&&(d.count=arguments[1]),this.tmpData.data.push(d),c&&(b=[c.x,c.y],2==arguments.length&&b.push(arguments[1]),this.heatmap.store.addDataPoint.apply(this.heatmap.store,b))},toggle:function(){this.heatmap.toggleDisplay()},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,a!=("none"!=this.div.style.display)&&(this.div.style.display=a?"block":"none"),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},CLASS_NAME:"OpenLayers.Layer.Heatmap"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(a){var b={url:!0,layer:!0,style:!0,matrixSet:!0};for(var c in b)if(!(c in a))throw new Error("Missing property '"+c+"' in layer configuration.");a.params=OpenLayers.Util.upperCaseObject(a.params);var d=[a.name,a.url,a.params,a];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,d),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var e=this.matrixIds.length;if(e&&"string"==typeof this.matrixIds[0]){var f=this.matrixIds;this.matrixIds=new Array(e);for(var g=0;e>g;++g)this.matrixIds[g]={identifier:f[g]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))
},moveTo:function(a,b){return(b||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMTS(this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var a;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var b,c=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,d=Number.POSITIVE_INFINITY,e=0,f=this.matrixIds.length;f>e;++e)b=Math.abs(1-this.matrixIds[e].scaleDenominator/c),d>b&&(d=b,a=this.matrixIds[e]);else a=this.matrixIds[this.getIdentifier()];else a={identifier:this.getIdentifier()};return a},getTileInfo:function(a){var b=this.getServerResolution(),c=(a.lon-this.tileOrigin.lon)/(b*this.tileSize.w),d=(this.tileOrigin.lat-a.lat)/(b*this.tileSize.h),e=Math.floor(c),f=Math.floor(d);return{col:e,row:f,i:Math.floor((c-e)*this.tileSize.w),j:Math.floor((d-f)*this.tileSize.h)}},getURL:function(a){a=this.adjustBounds(a);var b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a)){var c,d=a.getCenterLonLat(),e=this.getTileInfo(d),f=(this.matrix.identifier,this.dimensions);if(b=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,e.row,e.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(c=this.params,-1!==b.indexOf("{")){var g=b.replace(/\{/g,"${"),h={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:e.row,TileCol:e.col};if(f){var i,j;for(j=f.length-1;j>=0;--j)i=f[j],h[i]=c[i.toUpperCase()]}b=OpenLayers.String.format(g,h)}else{var k=this.version+"/"+this.layer+"/"+this.style+"/";if(f)for(var j=0;j<f.length;j++)c[f[j]]&&(k=k+c[f[j]]+"/");k=k+this.matrixSet+"/"+this.matrix.identifier+"/"+e.row+"/"+e.col+"."+this.formatSuffix,b.match(/\/$/)||(b+="/"),b+=k}else"KVP"===this.requestEncoding.toUpperCase()&&(c={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:e.row,TILECOL:e.col,FORMAT:this.format},b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[c]))}return b},mergeNewParams:function(a){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Layer.TDTLayer=OpenLayers.Class(OpenLayers.Layer.Grid,{mapType:null,mirrorUrls:null,topLevel:null,bottomLevel:null,topLevelIndex:0,bottomLevelIndex:20,topTileFromX:-180,topTileFromY:90,topTileToX:180,topTileToY:-270,isLocalMap:!1,type:"png",initialize:function(a,b,c){c.topLevel=c.topLevel?c.topLevel:this.topLevelIndex,c.bottomLevel=c.bottomLevel?c.bottomLevel:this.bottomLevelIndex,c.maxResolution=this.getResolutionForLevel(c.topLevel),c.minResolution=this.getResolutionForLevel(c.bottomLevel);var d=[a,b,{},c];OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.isBaseLayer||this.setZIndex(parseInt(this.map.baseLayer.getZIndex())+1)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TDTLayer(this.name,this.url,this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var f=Math.pow(2,e);c=(c%f+f)%f}return{x:c,y:d,z:e}},getURL:function(a){var b=this.getLevelForResolution(this.map.getResolution()),c=360/Math.pow(2,b),d=Math.round(this.topTileFromX<this.topTileToX?(a.left-this.topTileFromX)/c:(this.topTileFromX-a.right)/c),e=Math.round(this.topTileFromY<this.topTileToY?(a.bottom-this.topTileFromY)/c:(this.topTileFromY-a.top)/c),f=this.mapType;"EMap"==f&&(b>=1&&10>=b?f="vec_c":11==b||12==b?f="vec_c":b>=13&&18>=b&&(f="vec_c")),"ESatellite"==f&&(b>=1&&10>=b?f="cva_c":11==b||12==b||13==b?f="cva_c":14==b?f="cva_c":b>=15&&18>=b&&(f="cva_c")),"EDEM"==f&&(f="J07098"),"EAddress"==f&&(f="wfs"),"ciac"===f&&(f="cia_c"),"imgc"===f&&(f="img_c");var g=this.url;if(OpenLayers.Util.isArray(this.url)&&(g=this.selectUrl(d,this.url)),null!=this.mirrorUrls&&(g=this.selectUrl(d,this.mirrorUrls)),g.indexOf("EzMap")>0){var h=OpenLayers.String.format(g,{x:d,y:e,z:b});return h}if(this.isLocalMap){if(g.indexOf(f)<0)return g+"/"+f+"/"+b+"/"+e+"/"+d+this.type;var h=""+b+"/"+e+"/"+d+"."+this.type;return g+h}return this.getFullRequestString({T:f,X:d,Y:e,L:b},g)},selectUrl:function(a,b){return b[a%b.length]},getLevelForResolution:function(a){var b=this.getMaxResolution()/a;if(1>b)return 0;for(var c=0;b/2>=1;)c++,b/=2;return c},getResolutionForLevel:function(a){return 1.40625/Math.pow(2,a)},getMaxResolution:function(){return this.getResolutionForLevel(this.topLevelIndex)},getMinResolution:function(){return this.getResolutionForLevel(this.bottomLevelIndex)},addTile:function(a,b){var c=this.getURL(a);return new OpenLayers.Tile.Image(this,b,a,c,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.TDTLayer"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){(c&&c.sphericalMercator||this.sphericalMercator)&&(c=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},c)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,{},c])},clone:function(a){return null==a&&(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.getXYZ(a),c=this.url;if(OpenLayers.Util.isArray(c)){var d=""+b.x+b.y+b.z;c=this.selectUrl(d,c)}return OpenLayers.String.format(c,b)},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var f=Math.pow(2,e);c=(c%f+f)%f}return{x:c,y:d,z:e}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({},this.options&&this.options.tileOptions)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h)),e=this.getServerZoom(),f=this.serviceVersion+"/"+this.layername+"/"+e+"/"+c+"/"+d+"."+this.type,g=this.url;return OpenLayers.Util.isArray(g)&&(g=this.selectUrl(f,g)),g+f},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(a,b,c,d){this.layername=c,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.getServerResolution(),c=this.maxExtent,d=this.tileSize,e=Math.round((a.left-c.left)/(b*d.w)),f=Math.round((a.bottom-c.bottom)/(b*d.h)),g=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom(),h=[this.layername,OpenLayers.Number.zeroPad(g,2),OpenLayers.Number.zeroPad(parseInt(e/1e6),3),OpenLayers.Number.zeroPad(parseInt(e/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(e)%1e3,3),OpenLayers.Number.zeroPad(parseInt(f/1e6),3),OpenLayers.Number.zeroPad(parseInt(f/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(f)%1e3,3)+"."+this.extension],i=h.join("/"),j=this.url;return OpenLayers.Util.isArray(j)&&(j=this.selectUrl(i,j)),j="/"==j.charAt(j.length-1)?j:j+"/",j+i},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent||(this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]))),this.layerInfo){var a=this.layerInfo,b=new OpenLayers.Bounds(a.fullExtent.xmin,a.fullExtent.ymin,a.fullExtent.xmax,a.fullExtent.ymax);if(this.projection="EPSG:"+a.spatialReference.wkid,this.sphericalMercator=102100===a.spatialReference.wkid,this.units="esriFeet"===a.units?"ft":"m",a.tileInfo){this.tileSize=new OpenLayers.Size(a.tileInfo.width||a.tileInfo.cols,a.tileInfo.height||a.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(a.tileInfo.origin.x,a.tileInfo.origin.y);var c=new OpenLayers.Geometry.Point(b.left,b.top),d=new OpenLayers.Geometry.Point(b.right,b.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var e in a.tileInfo.lods)if(a.tileInfo.lods.hasOwnProperty(e)){var f=a.tileInfo.lods[e];this.useScales?this.scales.push(f.scale):this.resolutions.push(f.resolution);var g=this.getContainingTileCoords(c,f.resolution);f.startTileCol=g.x,f.startTileRow=g.y;var h=this.getContainingTileCoords(d,f.resolution);f.endTileCol=h.x,f.endTileRow=h.y,this.lods.push(f)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&a.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=a.tileInfo.dpi)}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(a){var b=a.endTileCol-a.startTileCol+1,c=a.endTileRow-a.startTileRow+1,d=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,e=d+b*this.tileSize.w*a.resolution,f=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution,g=f-c*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(d,g,e,f)},calculateMaxExtentWithExtent:function(a,b){var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),e=this.getContainingTileCoords(c,b),f=this.getContainingTileCoords(d,b),g={resolution:b,startTileCol:e.x,startTileRow:e.y,endTileCol:f.x,endTileRow:f.y};return this.calculateMaxExtentWithLOD(g)},getUpperLeftTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(b,a)},getLowerRightTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(b,a)},getMaxExtentForResolution:function(a){var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=c.x-b.x+1,e=c.y-b.y+1,f=this.tileOrigin.lon+b.x*this.tileSize.w*a,g=f+d*this.tileSize.w*a,h=this.tileOrigin.lat-b.y*this.tileSize.h*a,i=h-e*this.tileSize.h*a;return new OpenLayers.Bounds(f,i,g,h)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},initGriddedTiles:function(){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)},getTileOrigin:function(){if(!this._tileOrigin){var a=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(a.left,a.bottom)}return this._tileOrigin},getURL:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2,e=a.getCenterLonLat(),f=Math.round(Math.abs((e.lon-c)/(b*this.tileSize.w))),g=Math.round(Math.abs((d-e.lat)/(b*this.tileSize.h))),h=this.map.getZoom();if(this.lods){var i=this.lods[this.map.getZoom()];if(f<i.startTileCol||f>i.endTileCol||g<i.startTileRow||g>i.endTileRow)return null}var j=this.url,k=""+f+g+h;return OpenLayers.Util.isArray(j)&&(j=this.selectUrl(k,j)),this.useArcGISServer?(j+="/tile/${z}/${y}/${x}",j=OpenLayers.String.format(j,{x:f,y:g,z:h}),OpenLayers.Util.urlAppend(j,OpenLayers.Util.getParameterString(this.params))):j+"/L"+h.toString().padLeft("0",2)+"/R"+g.toString(16).padLeft("0",8)+"/C"+f.toString(16).padLeft("0",8)+"."+this.type},getZXY:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2,e=a.getCenterLonLat(),f=Math.round(Math.abs((e.lon-c)/(b*this.tileSize.w))),g=Math.round(Math.abs((d-e.lat)/(b*this.tileSize.h))),h=this.map.getZoom();if(this.lods){var i=this.lods[this.map.getZoom()];if(f<i.startTileCol||f>i.endTileCol||g<i.startTileRow||g>i.endTileRow)return null}else{var j=this.getUpperLeftTileCoord(b),k=this.getLowerRightTileCoord(b);if(f<j.x||f>=k.x||g<j.y||g>=k.y)return null}return{x:f,y:g,z:h}},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"zh-cn",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(a){a=OpenLayers.Util.applyDefaults({sphericalMercator:!0},a);var b=a.name||"Bing "+(a.type||this.type),c=[b,null,a];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,c),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"Anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),b=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(a),c=document.createElement("script");c.type="text/javascript",c.src=b,c.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace("{quadkey}","${quadkey}");b=b.replace("{culture}",this.culture),b=b.replace(this.protocolRegex,this.protocol),this.url=[];for(var c=0;c<a.imageUrlSubdomains.length;++c)this.url.push(b.replace("{subdomain}",a.imageUrlSubdomains[c]));this.addOptions({maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(a){if(this.url){for(var b=this.getXYZ(a),c=b.x,d=b.y,e=b.z,f=[],g=e;g>0;--g){var h="0",i=1<<g-1;0!==(c&i)&&h++,0!==(d&i)&&(h++,h++),f.push(h)}var j=f.join(""),k=this.selectUrl(""+e+d+c,this.url);return k="http:"+k,OpenLayers.String.format(k,{quadkey:j})}},updateAttribution:function(){var a=this.metadata;if(a.resourceSets&&this.map&&this.map.center){var b,c,d,e,f,g,h,i=a.resourceSets[0].resources[0],j=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),k=i.imageryProviders||[],l=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),m="";for(c=0,d=k.length;d>c;++c)for(b=k[c],e=0,f=b.coverageAreas.length;f>e;++e)h=b.coverageAreas[e],g=OpenLayers.Bounds.fromArray(h.bbox,!0),j.intersectsBounds(g)&&l<=h.zoomMax&&l>=h.zoomMin&&(m+=b.attribution+" ");var n=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:n,copyrights:m}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Bing(this.options)),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(a){this.metadata=a,this.initLayer();var b=document.getElementById(this._callbackId);b.parentNode.removeChild(b),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Layer.QQMap=OpenLayers.Class(OpenLayers.Layer.TileCache,{sateTiles:!1,initialize:function(a,b,c){var d=OpenLayers.Util.extend({format:"image/png",isBaseLayer:!0},c);OpenLayers.Layer.TileCache.prototype.initialize.apply(this,[a,b,{},d]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension,this.transitionEffect="resize",this.buffer=0},getURL:function(a){var b=this.map.getResolution(),c=this.map.getMaxExtent().top,d=this.map.getMaxExtent().left,e=Math.round((a.left-d)/(b*this.tileSize.w)),f=Math.round((c-a.top)/(b*this.tileSize.h)),g=this.map.getZoom();f=Math.pow(2,g)-1-f;var h=Math.abs((e+f)%this.url.length);return OpenLayers.String.format(this.url[h],{x:e,y:f,z:g})},clone:function(a){return null==a&&(a=new OpenLayers.Layer.QQMap(this.name,this.url,this.options)),a=OpenLayers.Layer.TileCache.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.QQMap"}),OpenLayers.Layer.Baidu=OpenLayers.Class(OpenLayers.Layer.TileCache,{initialize:function(a,b,c){var d=OpenLayers.Util.extend({format:"image/png",isBaseLayer:!0},c);OpenLayers.Layer.TileCache.prototype.initialize.apply(this,[a,b,{},d]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"===this.extension?"jpeg":this.extension,this.transitionEffect="resize",this.buffer=0,OpenLayers.Util.isArray(this.url)||(this.url=[this.url])},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.isBaseLayer||this.setZIndex(parseInt(this.map.baseLayer.getZIndex())+1)},getURL:function(a){var b=this.map.zoom-1,c=this.map.getResolution(),d=this.tileSize,e=Math.round((a.left-this.tileOrigin.lon)/(c*d.w)),f=Math.round((a.bottom-this.tileOrigin.lat)/(c*d.h));b+=1;var g=e.toString().replace("-","M"),h=f.toString().replace("-","M"),i=Math.abs((e+f)%this.url.length);return OpenLayers.String.format(this.url[i],{x:g,y:h,z:b})},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Baidu(this.name,this.url,this.options)),a=OpenLayers.Layer.TileCache.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.Baidu"}),OpenLayers.Layer.SuperMap=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.SuperMap(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),e=this.getServerZoom(),f="x="+c+"&y="+d+"&z="+e,g=this.url instanceof Array?this.url[(c+d+e)%this.url.length]:this.url;return g+f},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,86.3+this.map.maxExtent.top))},CLASS_NAME:"OpenLayers.Layer.SuperMap"}),OpenLayers.Layer.gaode=OpenLayers.Class(OpenLayers.Layer.TMS,{itileOriginCorner:"tl",type:"png",wrapDateLine:!0,isLocalMap:!1,resolutions:[156543.0339,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135],tileOrigin:new OpenLayers.LonLat(-20037508.3427892,20037508.3427892),initialize:function(a,b,c){OpenLayers.Layer.TMS.prototype.initialize.apply(this,[a,b,c])},getURL:function(a){var b=this.map.getResolution(),c=parseInt((a.getCenterLonLat().lon-this.tileOrigin.lon)/(256*b)),d=parseInt((this.tileOrigin.lat-a.getCenterLonLat().lat)/(256*b)),e=this.map.getZoom();if(Math.abs(this.resolutions[e]-b)>1e-19)for(var f=0;f<this.resolutions.length;f++)if(Math.abs(this.resolutions[f]-b)<=1e-19){e=f;break}if(this.isLocalMap)return this.url+"/"+e+"/"+c+"/"+d+"."+this.type;if(OpenLayers.Util.isArray(this.url)){var g=(c+d)%this.url.length;return this.url[g]+"&L="+e+"&Z="+e+"&Y="+d+"&X="+c}return this.url+"&Z="+e+"&L="+e+"&Y="+d+"&X="+c},clone:function(a){return null==a&&(a=new OpenLayers.Layer.gaode(this.name,this.url,this.options)),OpenLayers.Layer.TMS.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.gaode"}),OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(a,b,c,d,e,f,g){var h=[a,b,c,d,f,g];OpenLayers.Popup.prototype.initialize.apply(this,h),this.anchor=null!=e?e:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),this.prevPositon={left:this.div.style.left,top:this.div.style.top},OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(a){OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(a))},setSize:function(){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a)}},calculateRelativePosition:function(a){var b=this.map.getLonLatFromLayerPx(a),c=this.map.getExtent(),d=c.determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(d)},updateRelativePosition:function(){},calculateNewPx:function(a){var b=a.offset(this.anchor.offset),c=this.size||this.contentSize;if(this.relativePosition){var d="t"==this.relativePosition.charAt(0);b.y+=d?-c.h:this.anchor.size.h;var e="l"==this.relativePosition.charAt(1);b.x+=e?-c.w:this.anchor.size.w}return b},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(a,b,c,d,e,f){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,f&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%",this.groupDiv.style.overflow="visible"},destroy:function(){this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];b.image&&b.div.removeChild(b.image),b.image=null,b.div&&this.groupDiv.removeChild(b.div),b.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},moveTo:function(a){this.relativePosition;this.relativePosition=this.calculateRelativePosition(a),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(a)),this.updateRelativePosition()},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px",this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(){var a=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return a=a.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var a=null;for(var b in this.positionBlocks){a=b;break}for(var c=this.positionBlocks[a],d=0;d<c.blocks.length;d++){var e={};this.blocks.push(e);var f=this.id+"_FrameDecorationDiv_"+d;e.div=OpenLayers.Util.createDiv(f,null,null,null,"absolute",null,"hidden",null);var g=this.id+"_FrameDecorationImg_"+d,h=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;e.image=h(g,null,this.imageSize,this.imageSrc,"absolute",null,null,null),e.div.appendChild(e.image),this.groupDiv.appendChild(e.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var a=this.positionBlocks[this.relativePosition],b=0;b<a.blocks.length;b++){var c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,i=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,j=isNaN(c.size.h)?this.size.h-(f+h):c.size.h;f-=j,d.div.style.width=(0>i?0:i)+"px",d.div.style.height=(0>j?0:j)+"px",d.div.style.left=null!=e?e+"px":"",d.div.style.bottom=null!=f?f+"px":"",d.div.style.right=null!=g?g+"px":"",d.div.style.top=null!=h?h+"px":"",d.image.style.left=c.position.x+"px",d.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(60,40),isAlphaImage:!1,fixedRelativePosition:!0,relativePosition:"tr",positionBlocks:{tr:{offset:new OpenLayers.Pixel(-60,0),padding:new OpenLayers.Bounds(0,42,0,0),blocks:[{size:new OpenLayers.Size(60,40),anchor:new OpenLayers.Bounds(60,3,null,null),position:new OpenLayers.Pixel(0,0)}]}},minSize:new OpenLayers.Size(150,60),maxSize:new OpenLayers.Size(1200,660),setSize:function(a){var b=2,c=2;a&&(a.w-=b,a.h-=c),OpenLayers.Popup.Framed.prototype.setSize.call(this,a)},createBlocks:function(){this.blocks=[];var a=null;for(var b in this.positionBlocks){a=b;break}for(var c=this.positionBlocks[a],d=0;d<c.blocks.length;d++){var e={};this.blocks.push(e);var f=this.id+"_FrameDecorationDiv_"+d;e.div=OpenLayers.Util.createDiv(f,null,null,null,"absolute",null,"hidden",null),e.div.style.zIndex=1e4;var g=this.id+"_FrameDecorationImg_"+d,h=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;e.image=h(g,null,this.imageSize,this.imageSrc,"absolute",null,null,null),e.div.appendChild(e.image),this.groupDiv.appendChild(e.div)}},initialize:function(a,b,c,d,e,f,g,h){this.imageSrc=OpenLayers.Util.getImageLocation("iw_tail.png"),this.positionBlocks={tr:{offset:new OpenLayers.Pixel(-60,0),padding:new OpenLayers.Bounds(0,42,0,0),blocks:[{size:new OpenLayers.Size(60,40),anchor:new OpenLayers.Bounds(60,3,null,null),position:new OpenLayers.Pixel(0,0)}]}},h&&(h.offset&&(this.positionBlocks.tr.offset=h.offset),h.padding&&(this.positionBlocks.tr.padding=h.padding),h.blocks&&(this.positionBlocks.tr.blocks=h.blocks),h.imageSize&&(this.imageSize=h.imageSize),h.imageSrc&&(this.imageSrc=h.imageSrc)),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass,this.div.style.padding="1px"},setContentDom:function(a){if(this.contentHTML=a.innerHTML,null!=this.contentDiv){for(;this.contentDiv.childNodes.length>0;)this.contentDiv.removeChild(this.contentDiv.firstChild);this.contentDiv.appendChild(a),this.autoSize&&(this.registerImageListeners(),this.updateSize()),this.prevPositon={left:this.div.style.left,top:this.div.style.top},this.show()}},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c){this.layer=a,this.lonlat=b,this.data=null!=c?c:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var a=!1;if(null!=this.layer&&null!=this.layer.map){var b=this.layer.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){if(null!=this.lonlat){if(!this.popup){var b=this.marker?this.marker.icon:null,c=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new c(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,b,a)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",flashTimes:0,_m_iSeq:0,flashCount:6,modified:null,initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]),this.lonlat=null,this.geometry=a?a:null,this.state=null,this.attributes={},b&&(this.attributes=b),this.style=c?c:null
},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=!1;if(this.layer&&this.layer.map){var c=this.layer.map.getExtent();if(a){var d=this.geometry.getBounds();b=c.intersectsBounds(d)}else{var e=c.toGeometry();b=e.intersects(this.geometry)}}return b},getVisibility:function(){return!(this.style&&"none"===this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"===this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=!1;return this.geometry&&(d=this.geometry.atPoint(a,b,c)),d},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move)return void 0;var b;b="OpenLayers.LonLat"===a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a;var c=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),d=this.layer.map.getResolution();return this.geometry.move(d*(b.x-c.x),d*(c.y-b.y)),this.layer.drawFeature(this),c},toState:function(a){if(a===OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(a===OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a}else if(a===OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a}else a===OpenLayers.State.UNKNOWN&&(this.state=a)},show:function(){this.getVisibility()||this.layer&&(this.style.display="",this.layer.drawFeature(this))},hide:function(){this.getVisibility()&&this.layer&&(this.style.display="none",this.layer.drawFeature(this))},flash:function(a){this.flashTimes=0,this.flashCount=a?a:6,this._flashInterval(a)},flashStop:function(){this.flashTimeOut&&(window.clearTimeout(this.flashTimeOut),this.show())},_flashInterval:function(){return this.flashTimes<this.flashCount?(this.flashTimes++,this.getVisibility()?this.hide():this.show(),void(this.flashTimeOut=this.setTimeout("this._flashInterval()",400))):void this.show()},setTimeout:function(ie,Bi){var ke="tempVar"+this._m_iSeq+"_"+this.id;if(this._m_iSeq++,this._m_iSeq===Number.MAX_VALUE-1&&(this._m_iSeq=0),eval(ke+" = this;"),"function"!=typeof ie.replace)return window.setTimeout(";",Bi);var Rh=ie.replace(/\\/g,"\\\\").replace(/\"/g,'\\"');return window.setTimeout(ke+'._setTimeoutDispatcher("'+Rh+'");',Bi)},_setTimeoutDispatcher:function(ie){eval(ie)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(a,b,c){OpenLayers.Util.extend(this,c),this.control=a,this.callbacks=b;var d=this.map||a.map;d&&this.setMap(d),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(null==this.keyMask)return!0;var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0)|(a.metaKey?OpenLayers.Handler.MOD_META:0);return b==this.keyMask},activate:function(){if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;c>b;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;c>b;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var a=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],b=0,c=a.length;c>b;b++)this[a[b]]&&this.unregister(a[b],this[a[b]])}},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,b){this.map.events.registerPriority(a,this,b),this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b),this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){return this.evt=a,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:50,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){return this.startTouch(),this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},touchmove:function(a){return this.last=this.getEventInfo(a),!0},touchend:function(a){return this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),this.down=null),!0},mousedown:function(a){return this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},mouseup:function(a){var b=!0;return this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)&&(b=this.rightclick(a)),b},rightclick:function(a){if(this.passesTolerance(a)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[a]),!this.stopDouble;var b=this["double"]?OpenLayers.Util.extend({},a):this.callback("rightclick",[a]),c=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(c,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null,a&&this.callback("rightclick",[a])},click:function(a){this.last||(this.last=this.getEventInfo(a));var b=this.getFeatures(a);return b&&0!=b.length?this.featureClickFun&&this.featureClickFun(a):this.handleSingle(a),!this.stopSingle},getFeatures:function(a){return this.map.getFeatures(a)},dblclick:function(a){return this.handleDouble(a),!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this["double"]&&this.callback("dblclick",[a]),this.clearTimer())},handleSingle:function(a){if(this.passesTolerance(a))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(a),this.handleDouble(a)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(a);var b=this.single?OpenLayers.Util.extend({},a):null;this.queuePotentialClick(b)}},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy),b&&this.touch&&this.down.touches.length===this.last.touches.length))for(var c=0,d=this.down.touches.length;d>c;++c)if(this.getTouchDistance(this.down.touches[c],this.last.touches[c])>this.pixelTolerance){b=!1;break}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))},passesDblclickTolerance:function(){var a=!0;return this.down&&this.first&&(a=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),a},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=null,a&&this.callback("click",[a])},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=new Array(c);for(var d,e=0;c>e;e++)d=a.touches[e],b[e]={clientX:d.olClientX,clientY:d.olClientY}}return{xy:a.xy,touches:b}},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,a=!0),a},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a){return this.passesTolerance(a.xy)&&(this.clearTimer(),this.callback("move",[a]),this.px=a.xy,a=OpenLayers.Util.extend({},a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)),!this.stopMove},mouseout:function(a){return OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[a])),!0},passesTolerance:function(a){var b=!0;if(this.pixelTolerance&&this.px){var c=Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2));c<this.pixelTolerance&&(b=!1)}return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),a=!0),a},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),!0},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0):!1},destroyFeature:function(a){!this.layer||!a&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>1&&this.layer.features[0].destroy()},finalize:function(a){var b=a?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(b,[this.geometryClone()]),this.destroyFeature(a)},cancel:function(){this.finalize(!0)},click:function(a){return OpenLayers.Event.stop(a),!1},dblclick:function(a){return OpenLayers.Event.stop(a),!1},modifyFeature:function(a){this.point||this.createFeature(a);var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon,this.point.geometry.y=b.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPoint([a])),a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){return this.startTouch(),this.lastTouchPx=a.xy,this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){return this.lastTouchPx=a.xy,this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){return a.xy=this.lastTouchPx,this.up(a)},down:function(a){return this.mouseDown=!0,this.lastDown=a.xy,this.touch||this.modifyFeature(a.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(a){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy),!0},up:function(a){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(a)?this.lastUp&&this.lastUp.equals(a.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;if(null!=c&&a&&b){var e=a.distanceTo(b);e>c&&(d=!1)}return d},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a),this.line=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.layer.getLonLatFromViewPortPx(a);if(this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),!this.freehand){var c=this.point.clone();c.style=this.style,this.layer.addFeatures([c])}this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(a,b){var c=this.getCurrentPointIndex()-1,d=this.line.geometry.components[c];!d||isNaN(d.x)||isNaN(d.y)||this.insertXY(d.x+a,d.y+b)},insertDirectionLength:function(a,b){a*=Math.PI/180;var c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)},insertDeflectionLength:function(a,b){var c=this.getCurrentPointIndex()-1;if(c>0){var d=this.line.geometry.components[c],e=this.line.geometry.components[c-1],f=Math.atan2(d.y-e.y,d.x-e.x);this.insertDirectionLength(180*f/Math.PI+a,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,d=b[c],e=a.removeComponent(d);if(e){if(this.touch&&c>0){b=a.components;var f=b[c-1],g=this.getCurrentPointIndex(),h=b[g];h.x=f.x,h.y=f.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature()}return e},redo:function(){var a=this.redoStack&&this.redoStack.pop();return a&&(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature()),!!a},freehandMode:function(a){return this.freehandToggle&&a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a,b){this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon,this.point.geometry.y=c.lat,this.callback("modify",[this.point.geometry,this.getSketch(),b]),this.callback("measuremoving",[this.point.geometry,this.getGeometry()]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiLineString([a])),a},touchstart:function(a){return this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,a))},down:function(a){var b=this.stopDown;return this.freehandMode(a)&&(b=!0,this.touch&&(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||this.modifyFeature(a.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=a.xy,this.stoppedDown=b,!b},move:function(a){return this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy,!!this.lastUp),!0)},up:function(a){return!this.mouseDown||this.lastUp&&this.lastUp.equals(a.xy)||(this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var a=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},dblclick:function(a){return this.freehandMode(a)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var a,b,c=this.point.geometry,d=this.control.layer.features,e=d.length-1;e>=0;--e)if(a=d[e].geometry,(a instanceof OpenLayers.Geometry.Polygon||a instanceof OpenLayers.Geometry.MultiPolygon)&&a.intersects(c)){b=d[e],this.control.layer.removeFeatures([b],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),b.geometry.addComponent(this.line.geometry),this.polygon=b,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(a){var b=a.vertex,c=this.line.geometry.components;if(!this.polygon.geometry.intersects(b)){var d=c[c.length-3];b.x=d.x,b.y=d.y}},finishGeometry:function(){var a=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var a=this.line.geometry,b=0!==a.getArea();if(b){for(var c=this.polygon.geometry.components,d=c.length-2;d>=0;--d)if(a.intersects(c[d])){b=!1;break}if(b){a:for(var d=c.length-2;d>0;--d)for(var e=c[d].components,f=0,g=e.length;g>f;++f)if(a.containsPoint(e[f])){b=!1;break a}}}return b?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,a||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPolygon([a])),a},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{contextmenu:{"in":"contextmenu",out:"contextmenuout"},click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]),this.layer=b},touchstart:function(a){return this.startTouch(),OpenLayers.Event.isMultiTouch(a)?!0:this.mousedown(a)},touchmove:function(a){OpenLayers.Event.preventDefault(a)},mousedown:function(a){return(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.down=a.xy),this.handle(a)?!this.stopDown:!0},mouseup:function(a){return this.up=a.xy,this.handle(a)?!this.stopUp:!0},click:function(a){return this.handle(a)?!this.stopClick:!0},contextmenu:function(a){return this.handle(a)?!this.stopClick:!0},mousemove:function(a){return this.callbacks.over||this.callbacks.out?(this.handle(a),!0):!0},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){this.feature&&!this.feature.layer&&(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e="click"==b||"dblclick"==b||"touchstart"==b||"contextmenu"==b||"mouseup"==b||"mousedown"==b;if(this.feature=this.layer.getFeatureFromEvent(a),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===b&&OpenLayers.Event.preventDefault(a);var f=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(d&&f?(this.lastFeature&&this.triggerCallback(b,"out",[this.lastFeature]),this.triggerCallback(b,"in",[this.feature,b])):(!d||e)&&this.triggerCallback(b,"in",[this.feature,b]),this.lastFeature=this.feature,c=!0):(this.lastFeature&&(d&&f||e)&&this.triggerCallback(b,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(d||e)&&this.triggerCallback(b,"out",[this.lastFeature]);return c},triggerCallback:function(a,b,c){var d=this.EVENTMAP[a][b];if(d)if("click"==a&&"out"==b&&this.up&&this.down){var e=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));e<=this.clickTolerance&&this.callback(d,c),this.up=this.down=null}else this.callback(d,c)},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},handleMapEvents:function(a){("removelayer"==a.type||"order"==a.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var a=this;this._docMove=function(b){a.mousemove({xy:{x:b.clientX,y:b.clientY},element:document})},this._docUp=function(b){a.mouseup({xy:{x:b.clientX,y:b.clientY}})}}},dragstart:function(a){var b=!0;return this.dragging=!1,this.checkModifiers(a)&&(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.start=a.xy,this.last=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(a),this.callback("down",[a.xy]),OpenLayers.Event.preventDefault(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):OpenLayers.Event.isRightClick(a)&&this.dragend(a),b},dragmove:function(a){return this.lastMoveEvt=a,!this.started||this.timeoutId||a.xy.x==this.last.x&&a.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback("move",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy),!0},dragend:function(a){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(a),this.removeDocumentEvents());{this.start!=this.last}this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(a),this.callback("up",[a.xy]),this.callback("done",[a.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){return this.startTouch(),this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(a){return this.dragend(a)},touchend:function(a){return a.xy=this.last,this.dragend(a)},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(a),this.callback("out",[a.xy]),b&&this.callback("done",[a.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}else if(this.started&&this.map.div.contains(a.toElement)){var c=this.map.getControlsByClass("OpenLayers.Control.LTOverviewMap");if(c&&c[0]&&(a.toElement==c[0].div||c[0].div.contains(a.toElement))){var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(a),this.callback("out",[a.xy]),b&&this.callback("done",[a.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}}return!0},click:function(){return this.start==this.last},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0],a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(a){var b=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(a))this.started=!0,this.last=this.start={distance:this.getDistance(a.touches),delta:0,scale:1},this.callback("start",[a,this.start]),b=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(a),b},touchmove:function(a){if(this.started&&OpenLayers.Event.isMultiTouch(a)){this.pinching=!0;var b=this.getPinchData(a);this.callback("move",[a,b]),this.last=b,OpenLayers.Event.stop(a)}else if(this.started)return!1;return!0},touchend:function(a){return this.started&&!OpenLayers.Event.isMultiTouch(a)?(this.started=!1,this.pinching=!1,this.callback("done",[a,this.start,this.last]),this.start=null,this.last=null,!1):!0},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,a=!0),a},getDistance:function(a){var b=a[0],c=a[1];return Math.sqrt(Math.pow(b.olClientX-c.olClientX,2)+Math.pow(b.olClientY-c.olClientY,2))
},getPinchData:function(a){var b=this.getDistance(a.touches),c=b/this.start.distance;return{distance:b,delta:this.last.distance-b,scale:c}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[a,b,c]),this.options=c?c:{}},setOptions:function(a){OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a)},activate:function(){var a=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b),this.map.addLayer(this.layer),a=!0}return a},deactivate:function(){var a=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,a=!0),a},down:function(a){this.fixedRadius=!!this.radius;var b=this.layer.getLonLatFromViewPortPx(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat),(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.layer.getLonLatFromViewPortPx(a.xy),c=new OpenLayers.Geometry.Point(b.lon,b.lat);if(this.irregular){var d=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,d)}else this.fixedRadius?this.origin=c:(this.calculateAngle(c,a),this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var e,f=c.x-this.origin.x,g=c.y-this.origin.y;e=0==g?f/(this.radius*Math.sqrt(2)):f/g,this.feature.geometry.resize(1,this.origin,e),this.feature.geometry.move(f/2,g/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize(),this.start==this.last&&this.callback("done",[a.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&&(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d<this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.origin.x+this.radius*Math.cos(a),b.y=this.origin.y+this.radius*Math.sin(a),b.clearBounds()},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else this.angle=c},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(a){this.callbacks[a]&&this.feature&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=a&&"cancel"!=a||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Handler.RegularPolygonExtend=OpenLayers.Class(OpenLayers.Handler.RegularPolygon,{feature_line:null,newOrigin:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.RegularPolygon.prototype.initialize.apply(this,[a,b,c]),this.options=c?c:{}},down:function(a){this.fixedRadius=!!this.radius;var b=this.layer.getLonLatFromViewPortPx(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat),this.newOrigin=this.origin,(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style),this.feature_line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.origin,this.origin])),this.layer.addFeatures([this.feature_line],{silent:!0})},move:function(a){var b=this.layer.getLonLatFromViewPortPx(a.xy),c=new OpenLayers.Geometry.Point(b.lon,b.lat);if(this.irregular){var d=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,d)}else this.fixedRadius?this.origin=c:(this.calculateAngle(c,a),this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin))/2,this.newOrigin=new OpenLayers.Geometry.Point((c.x+this.origin.x)/2,(c.y+this.origin.y)/2));if(this.modifyGeometry(),this.feature_line.geometry.components[1]=c,this.irregular){var e,f=c.x-this.origin.x,g=c.y-this.origin.y;e=0==g?f/(this.radius*Math.sqrt(2)):f/g,this.feature.geometry.resize(1,this.origin,e),this.feature.geometry.move(f/2,g/2)}this.layer.drawFeature(this.feature,this.style),this.layer.drawFeature(this.feature_line,this.style)},up:function(a){this.finalize(),this.start==this.last&&this.callback("done",[a.xy])},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&&(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d<this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.newOrigin.x+this.radius*Math.cos(a),b.y=this.newOrigin.y+this.radius*Math.sin(a),b.clearBounds()},finalize:function(){this.newOrigin=null,this.feature_line=null,OpenLayers.Handler.RegularPolygon.prototype.finalize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Handler.RegularPolygonExtend"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.outBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(){this.zoomBox&&this.map.viewPortDiv.removeChild(this.zoomBox),this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},outBox:function(a){var b,c=this.dragHandler.start;if(c){var d=Math.min(c.y,a.y),e=Math.max(c.y,a.y),f=Math.min(c.x,a.x),g=Math.max(c.x,a.x);b=new OpenLayers.Bounds(f,e,g,d)}this.removeBox(),b&&this.callback("done",[b])},moveBox:function(a){var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px",this.zoomBox.style.height=e+f.height+1+"px",this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+"px",this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+"px"},endBox:function(a){var b;if(Math.abs(this.dragHandler.start.x-a.x)>5||Math.abs(this.dragHandler.start.y-a.y)>5){var c=this.dragHandler.start,d=Math.min(c.y,a.y),e=Math.max(c.y,a.y),f=Math.min(c.x,a.x),g=Math.max(c.x,a.x);b=new OpenLayers.Bounds(f,e,g,d)}else b=this.dragHandler.start.clone();this.removeBox(),b&&this.callback("done",[b])},removeBox:function(){this.zoomBox&&this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var a=document.createElement("div");a.style.position="absolute",a.style.border="1px solid black",a.style.width="3px",document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),f=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:c,right:d,top:e,bottom:f,width:b===!1?c+d:0,height:b===!1?e+f:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&&!d&&!b;){if(!b)try{var f;if(e.currentStyle)f=e.currentStyle.overflow;else{var g=document.defaultView.getComputedStyle(e,null);f=g.getPropertyValue("overflow")}b=f&&"auto"==f||"scroll"==f}catch(h){}if(!c&&(c=OpenLayers.Element.hasClass(e,"olScrollable"),!c))for(var i=0,j=this.map.layers.length;j>i;i++){var k=this.map.layers[i];if(e==k.div||e==k.pane){c=!0;break}}d=e==this.map.div,e=e.parentNode}if(!b&&d){if(c){var l=0;if(a.wheelDelta?(l=a.wheelDelta,l%160===0&&(l=.75*l),l/=120):a.detail&&(l=-(a.detail/Math.abs(a.detail))),this.delta+=l,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var m=OpenLayers.Util.extend({},a);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(m)},this),this.interval)}else this.wheelZoom(a)}OpenLayers.Event.stop(a)}}},wheelZoom:function(a){var b=this.delta;this.delta=0,b&&(a.xy=this.map.events.getMousePosition(a),0>b?this.callback("down",[a,this.cumulative?Math.max(-this.maxDelta,b):-1]):this.callback("up",[a,this.cumulative?Math.min(this.maxDelta,b):1]))},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var a=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",a),OpenLayers.Event.observe(window,"mousewheel",a),OpenLayers.Event.observe(document,"mousewheel",a),!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var a=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",a),OpenLayers.Event.stopObserving(window,"mousewheel",a),OpenLayers.Event.stopObserving(document,"mousewheel",a),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;b>a;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0}return!1},deactivate:function(){var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,c=this.KEY_EVENTS.length;c>b;b++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[b],this.eventListener);a=!0}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&this.callback(a.type,[a])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,className:null,initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&"function"==typeof this.handlers[a].destroy&&this.handlers[a].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(a){this.map=a,this.handler&&this.handler.setMap(a)},draw:function(a){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.className&&(this.div.className+=" "+this.className),this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!==this.title&&(this.div.title=this.title)),null!=a&&(this.position=a.clone()),this.moveTo(this.position),this.div},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(a){a=a||window.location.href;var b=OpenLayers.Util.getParameters(a),c=a.indexOf("#");return c>0&&(a="?"+a.substring(c+1,a.length),OpenLayers.Util.extend(b,OpenLayers.Util.getParameters(a))),b},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,b=this.map.controls.length;b>a;a++){var c=this.map.controls[a];if(c!==this&&"OpenLayers.Control.ArgParser"===c.CLASS_NAME){c.displayProjection!==this.displayProjection&&(this.displayProjection=c.displayProjection);break}}if(a===this.map.controls.length){var d=this.getParameters();d.layers&&(this.layers=d.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),d.lat&&d.lon&&(this.center=new OpenLayers.LonLat(parseFloat(d.lon),parseFloat(d.lat)),d.zoom&&(this.zoom=parseFloat(d.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length===this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,b=this.layers.length;b>a;a++){var c=this.map.layers[a],d=this.layers.charAt(a);"B"===d?this.map.setBaseLayer(c):("T"===d||"F"===d)&&c.setVisibility("T"===d)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var a,b=[];if(this.map&&this.map.layers){for(var c=0,d=this.map.layers.length;d>c;c++){var e=this.map.layers[c];e.attribution&&e.getVisibility()&&(a="object"==typeof e.attribution?OpenLayers.String.format(this.layerTemplate,e.attribution):e.attribution,-1===OpenLayers.Util.indexOf(b,a)&&b.push(a))}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:b.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ClickControl=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!0,pixelTolerance:0,stopSingle:!1,stopDouble:!1},handleRightClicks:!0,initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,this.eventMethods,this.handlerOptions)},setFeaturesClick:function(a){this.handler.featureClickFun=a},CLASS_NAME:"OpenLayers.Control.ClickControl"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(this.handler.removeBox(),a instanceof OpenLayers.Bounds){var b,c=a.getCenterPixel();if(this.out){var d=a.right-a.left,e=a.bottom-a.top,f=Math.min(this.map.size.h/e,this.map.size.w/d),g=this.map.getExtent(),h=this.map.getLonLatFromPixel(c),i=h.lon-g.getWidth()/2*f,j=h.lon+g.getWidth()/2*f,k=h.lat-g.getHeight()/2*f,l=h.lat+g.getHeight()/2*f;b=new OpenLayers.Bounds(i,k,j,l)}else{var m=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),n=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(m.lon,m.lat,n.lon,n.lat)}var o=this.map.getZoom(),p=this.map.getSize(),q={x:p.w/2,y:p.h/2},r=this.map.getZoomForExtent(b);if(this.out||r!==o||(r+=1),this.map.baseLayer instanceof OpenLayers.Layer.TMS_PGIS){var s=0;6===Math.abs(r-o)?s=4:5===Math.abs(r-o)?s=3:4===Math.abs(r-o)&3===Math.abs(r-o)&&(s=2),r=this.out?r+s:r-s}var t=this.map.getResolution(),u=this.map.getResolutionForZoom(r);if(t===u)this.map.setCenter(this.map.getLonLatFromPixel(c));else{var v={x:(t*c.x-u*q.x)/(t-u),y:(t*c.y-u*q.y)/(t-u)};this.map.zoomTo(r,v)}o===this.map.getZoom()&&this.alwaysZoom===!0&&this.map.zoomTo(o+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,a):this.map.zoomTo(this.map.getZoom()+1,a))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,startFun:null,endFun:null,movingFun:null,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var a={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(a=OpenLayers.Util.extend(a,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin(),this.startFun&&this.startFun.apply(this),this.isDragStart=!1,this.moving=!1},panMap:function(a){this.kinetic&&this.kinetic.update(a),this.isDragStart||(this.isDragStart=!0,this.dragStartFun&&this.dragStartFun.apply(this,arguments)),this.panned=!0,this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!0,animate:!1}),this.movingFun&&this.movingFun.apply(this,arguments),this.moving=!0},panMapDone:function(a){if(this.panned){var b=null;if(this.kinetic&&(b=this.kinetic.end(a)),this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!!b,animate:!1}),b){var c=this;this.kinetic.move(b,function(a,b,d){c.map.pan(a,b,{dragging:!d,animate:!1})})}this.panned=!1}this.endFun&&this.endFun.apply(this),this.moving&&this.dragEndFun&&this.dragEndFun.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,isDrag:!1,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var a={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},b={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,a,b),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));var c=this;this.dragPan.movingFun=function(a){c.map.events.triggerEvent("dragging",{xy:a})},this.dragPan.dragStartFun=function(a){c.isDrag=!0,c.map.events.triggerEvent("dragstart",{xy:a})},this.dragPan.dragEndFun=function(a){c.map.events.triggerEvent("dragend",{xy:a}),c.isDrag=!1},this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var d=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(d,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(a){a.lastTouches&&2===a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){0===this.getFeatures(a).length&&this.map.zoomTo(this.map.zoom+1,a.xy)},getFeatures:function(a){return this.map.getFeatures(a)},defaultDblRightClick:function(a){this.map.zoomTo(this.map.zoom-1,a.xy)},wheelChange:function(a,b){this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d=c+b;d=Math.max(d,0),d=Math.min(d,this.map.getNumZoomLevels()),d!==c&&this.map.zoomTo(d,a.xy,"wheelChange")},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:'<span style="font-size: 11px">',separator:", ",suffix:"</span>",numDigits:7,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div.id="MousePosition",this.div.style.bottom="0px",this.div.style.right="25px",document.getElementById("OpenLayers_Control_minimizeDiv")&&""===document.getElementById("OpenLayers_Control_minimizeDiv").style.display&&(this.div.style.right="200px"),this.div},redraw:function(a){var b;if(null==a)return void this.reset();if(null==this.lastXy||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=a.xy);if(b=this.map.getLonLatFromPixel(a.xy)){this.displayProjection&&b.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=a.xy;var c=this.formatOutput(b);c!==this.element.innerHTML&&(this.element.innerHTML=c)}},reset:function(){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(a){var b=parseInt(this.numDigits);a=NPMap.T.getPoint(this.map,a);var c=this.prefix+a.lon.toFixed(b)+this.separator+a.lat.toFixed(b)+this.suffix;return c},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Control.MouseContext=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,context:null,offset:{x:0,y:0},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(id=this.id+"OpenLayers_MouseContext",this.element=OpenLayers.Util.createDiv(id,null,null,null,"absolute"),this.element.style.zIndex=9999,this.element.style.left="2000px",this.element.filter="alpha(opacity=50)",this.element.style.width="130px",this.element.style.height="40px",this.element.style.border="1px solid red",this.element.style.background="#fff",this.div.appendChild(this.element),this.context||(this.context="<span style='font-size: 11px'>按住鼠标左键拖选区域,<br>释放完成绘制。</span>"),this.element.innerHTML=this.context),this.div},setContext:function(a){this.context="<span style='font-size: 11px'>"+a+"</span>",this.element&&(this.element.innerHTML=this.context)},setContextSize:function(a,b){this.element&&(this.element.style.width=a+"px",this.element.style.height=b+"px")},setContextStyle:function(a){if(a&&this.element)for(var b in a)this.element.style[b]=a[b]},getContextStyle:function(){return this.element?this.element.style:void 0},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.updateLocation),this.map.events.register("mouseout",this,this.hideControl),!0):!1},getElement:function(){return this.element},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.updateLocation),this.map.events.unregister("mouseout",this,this.hideControl),this.element.style.left="2000px",this.element.innerHTML="",!0):!1},hideControl:function(){this.element.style.visibility="hidden"},updateLocation:function(a){if(null!=a&&this.element){this.element.style.visibility="visible";var b=a.xy.x+5,c=a.xy.y+3;this.element.style.top=c+this.offset.y+5+"px",this.element.style.left=b+this.offset.x+"px"}},CLASS_NAME:"OpenLayers.Control.MouseContext"}),OpenLayers.Control.JWMousePosition=OpenLayers.Class(OpenLayers.Control.MousePosition,{redraw:function(a){var b;if(null==a)return void this.reset();if(null==this.lastXy||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=a.xy);if(b=this.map.getLonLatFromPixel(a.xy)){b.transform(this.map.getProjectionObject(),"EPSG:4326"),this.lastXy=a.xy;var c=this.formatOutput(b);c!==this.element.innerHTML&&(this.element.innerHTML=c)}},formatOutput:function(a){var b=parseInt(this.numDigits),c=this.angleConver(a.lon.toFixed(b)),d=this.angleConver(a.lat.toFixed(b)),e=this.prefix+(a.lon>0?"东经：":"西经：")+c+this.separator+(a.lat>0?"北纬：":"南纬: ")+d+this.suffix;return e},angleConver:function(a){var b=a%1;if(0===b)return a+"度";var c=parseInt(60*b),d=parseInt(60*b%1*60);return Math.abs(parseInt(a))+"°"+c+"'"+d+"  ''"},CLASS_NAME:"OpenLayers.Control.JWMousePosition"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(a){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.active=!1},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},close:function(){document.getElementById("copyright")&&(document.getElementById("copyright").style.right="5px"),document.getElementById("scale")&&(document.getElementById("scale").style.right="5px"),document.getElementById("MousePosition")&&(document.getElementById("MousePosition").style.right="5px")},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var a=this.map.baseLayer.clone();this.layers=[a]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";
else{this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,b,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv),b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png"),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,b,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(0!==b||0!==c){var d=this.rectPxBounds.top,e=this.rectPxBounds.left,f=Math.abs(this.rectPxBounds.getHeight()),g=this.rectPxBounds.getWidth(),h=Math.max(0,d-c);h=Math.min(h,this.ovmap.size.h-this.hComp-f);var i=Math.max(0,e-b);i=Math.min(i,this.ovmap.size.w-this.wComp-g),this.setRectPxBounds(new OpenLayers.Bounds(i,h+f,i+g,h))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left,g=Math.abs(this.rectPxBounds.getHeight()),h=this.rectPxBounds.getWidth(),i=Math.max(0,e+d);i=Math.min(i,this.ovmap.size.h-g);var j=Math.max(0,f+c);j=Math.min(j,this.ovmap.size.w-h),this.setRectPxBounds(new OpenLayers.Bounds(j,i+g,j+h,i)),this.updateMapToRect()},onButtonClick:function(a){a.buttonElement===this.minimizeDiv?this.minimizeControl():a.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(a){this.element.style.display="",document.getElementById("copyright")&&(document.getElementById("copyright").style.right="200px"),document.getElementById("scale")&&(document.getElementById("scale").style.right="200px"),document.getElementById("MousePosition")&&(document.getElementById("MousePosition").style.right="200px"),this.showToggle(!1),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.element.style.display="none",document.getElementById("copyright")&&(document.getElementById("copyright").style.right="25px"),document.getElementById("scale")&&(document.getElementById("scale").style.right="25px"),document.getElementById("MousePosition")&&(document.getElementById("MousePosition").style.right="25px"),this.showToggle(!0),null!=a&&OpenLayers.Event.stop(a),this.active=!1},showToggle:function(a){this.maximizeDiv&&(this.maximizeDiv.style.display=a?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=a?"none":"")},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent(),b=this.map.getMaxExtent(),c=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));this.ovmap.getProjection()!==this.map.getProjection()&&(c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var d=this.ovmap.getResolution()/this.map.getResolution();return d>this.minRatio&&d<=this.maxRatio&&this.ovmap.getExtent().containsBounds(c)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a);var d;this.ovmap.getProjection()!==this.map.getProjection()?(d=this.map.center.clone(),d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):d=this.map.center;var e=this.ovmap.getZoomForResolution(b*this.resolutionFactor);this.map.isValidZoomLevel(e)||(e="number"==typeof this.map.minZoom?this.map.minZoom:this.map.getZoom()),this.ovmap.setCenter(d,e),this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,a);var b=new OpenLayers.Control.Navigation;b.zoomWheelEnabled=!1,this.ovmap.addControl(b),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);var c=this;if(this.rectEvents.register("mouseover",this,function(){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate(),c.active=!0}),this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate(),c.active=!1}),this.ovmap.getProjection()!==this.map.getProjection()){var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,e=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=d&&e?OpenLayers.INCHES_PER_UNIT[d]/OpenLayers.INCHES_PER_UNIT[e]:1}this.ovmap.events.register("mouseover",this.ovmap,function(){c.active=!0}),this.ovmap.events.register("mouseout",this.ovmap,function(){c.active=!1}),this.ovmap.events.register("moveend",this.ovmap,function(a){if(c.active){var b=a.object,d=b.getCenter(),e=c.map.getCenter();(d.lon.toFixed(6)!==e.lon.toFixed(6)||d.lat.toFixed(6)!==e.lat.toFixed(6))&&c.map.setCenter(d)}})},updateRectToMap:function(){var a;a=this.ovmap.getProjection()!==this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var b=this.getRectBoundsFromMapBounds(a);b&&this.setRectPxBounds(b)},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!==this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp),e=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp),f=Math.max(e-c,0),g=Math.max(d-b,0);if(this.extentRectangle.style.display="",f<this.minRectSize||g<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var h=c+f/2-this.minRectSize/2,i=b+g/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(i)+"px",this.extentRectangle.style.left=Math.round(h)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else(g>=this.size.h||f+2>=this.size.w)&&(g=this.size.h/4,f=this.size.w/4,b=this.size.h/3,c=this.size.w/3,this.extentRectangle.style.display="none"),this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+"px",this.extentRectangle.style.height=Math.round(g)+"px",this.extentRectangle.style.width=Math.round(f)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(e),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=this.getOverviewPxFromLonLat({lon:a.left,lat:a.bottom}),c=this.getOverviewPxFromLonLat({lon:a.right,lat:a.top}),d=null;return b&&c&&(d=new OpenLayers.Bounds(b.x,b.y,c.x,c.y)),d},getMapBoundsFromRectBounds:function(a){var b=this.getLonLatFromOverviewPx({x:a.left,y:a.bottom}),c=this.getLonLatFromOverviewPx({x:a.right,y:a.top});return new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat(),e=a.x-b.w/2,f=a.y-b.h/2;return{lon:d.lon+e*c,lat:d.lat-f*c}},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent();return c?{x:Math.round(1/b*(a.lon-c.left)),y:Math.round(1/b*(c.top-a.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Control.LTOverviewMap=OpenLayers.Class(OpenLayers.Control.OverviewMap,{initialize:function(a){a.size=new OpenLayers.Size(180,120),OpenLayers.Control.OverviewMap.prototype.initialize.apply(this,[a]),this.mapOptions=a},setOvMapCenter:function(){this.ovmap&&this.ovmap.setCenter(this.map.getExtent().getCenterLonLat())},updateMapToRect:function(){this.ovmap&&(OpenLayers.Control.OverviewMap.prototype.updateMapToRect.apply(this,arguments),this.ovmap.setCenter(this.map.getCenter()))},createMap:function(){OpenLayers.Control.OverviewMap.prototype.createMap.apply(this,arguments),this.ovmap.events.register("moveend",this,this.updateRectToMap),this.ovmap.events.register("zoomend",this,this.updateRectToMap)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!(this.layers.length>0)){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var a=this.map.baseLayer.clone();this.layers=[a]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.mapDiv.appendChild(this.extentRectangle),this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImagesLocation(),c=b+"overup1.png",d=b+"overup2.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(14,14),c,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton",this.maximizeDiv.title="CN"===NPMap.CULTURE?"打开鹰眼":"Open Overview Map",OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this)),OpenLayers.Event.observe(this.maximizeDiv,"mouseover",function(a){a.srcElement.src=d}),OpenLayers.Event.observe(this.maximizeDiv,"mouseout",function(a){a.srcElement.src=c}),this.div.appendChild(this.maximizeDiv);var e=b+"overdown1.png",f=b+"overdown2.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(14,14),e,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton",this.minimizeDiv.title="CN"===NPMap.CULTURE?"关闭鹰眼":"Close Overview Map",OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this)),OpenLayers.Event.observe(this.minimizeDiv,"mouseover",function(a){a.srcElement.src=f}),OpenLayers.Event.observe(this.minimizeDiv,"mouseout",function(a){a.srcElement.src=e}),this.div.appendChild(this.minimizeDiv);for(var g=["dblclick","mousedown"],h=0,i=g.length;i>h;h++)OpenLayers.Event.observe(this.maximizeDiv,g[h],OpenLayers.Event.stop),OpenLayers.Event.observe(this.minimizeDiv,g[h],OpenLayers.Event.stop);this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.register("moveend",this,this.update),this.map.events.register("zoomend",this,this.update),this.map.events.register("dragend",this,this.update),this.map.events.register("moveend",this,this.setOvMapCenter),this.map.events.register("zoomend",this,this.setOvMapCenter),this.map.events.register("dragend",this,this.setOvMapCenter),this.maximized&&this.maximizeControl(),this.div},CLASS_NAME:"OpenLayers.Control.LTOverviewMap"}),OpenLayers.Control.CopyRightControl=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,copyright:"东方网力",initialize:function(a,b){a&&(this.copyright=a),OpenLayers.Control.prototype.initialize.apply(this,[b])},destroy:function(){this.element&&this.element.parentNode===this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,b=this.map.controls.length;b>a;a++){var c=this.map.controls[a];if("OpenLayers.Control.ArgParser"===c.CLASS_NAME){c.displayProjection!==this.displayProjection&&(this.displayProjection=c.displayProjection);break}}a===this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("span"),this.element.innerHTML=OpenLayers.i18n(this.copyright),this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div.style.bottom="0px",this.div.style.left="9px",document.getElementById("OpenLayers_Control_minimizeDiv")&&""===document.getElementById("OpenLayers_Control_minimizeDiv").style.display&&(this.div.style.right="200px"),this.div.id="copyright",this.div.unselectable="on",this.element.innerHTML=OpenLayers.i18n(this.copyright),this.div},updateLink:function(){},createParams:function(a,b,c){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(a){d.zoom=b||this.map.getZoom();var e=a.lat,f=a.lon;if(this.displayProjection){var g=OpenLayers.Projection.transform({x:f,y:e},this.map.getProjectionObject(),this.displayProjection);f=g.x,e=g.y}d.lat=Math.round(1e5*e)/1e5,d.lon=Math.round(1e5*f)/1e5,c=c||this.map.layers,d.layers="";for(var h=0,i=c.length;i>h;h++){var j=c[h];d.layers+=j.isBaseLayer?j===this.map.baseLayer?"B":"0":j.getVisibility()?"T":"F"}}return d},CLASS_NAME:"OpenLayers.Control.CopyRightControl"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var a=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:a})},defaultKeyPress:function(a){var b,c=!0,d=OpenLayers.Event.element(a);if(!d||"INPUT"!==d.tagName&&"TEXTAREA"!==d.tagName&&"SELECT"!==d.tagName){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:b=this.map.getSize(),this.map.pan(0,-.75*b.h);break;case 34:b=this.map.getSize(),this.map.pan(0,.75*b.h);break;case 35:b=this.map.getSize(),this.map.pan(.75*b.w,0);break;case 36:b=this.map.getSize(),this.map.pan(-.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:c=!1}c&&OpenLayers.Event.stop(a)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),OpenLayers.Control.NorthControl=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,copyright:"东方网力",initialize:function(a,b){a&&(this.copyright=a),OpenLayers.Control.prototype.initialize.apply(this,[b])},destroy:function(){this.element&&this.element.parentNode===this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,b=this.map.controls.length;b>a;a++){var c=this.map.controls[a];if("OpenLayers.Control.ArgParser"===c.CLASS_NAME){c.displayProjection!==this.displayProjection&&(this.displayProjection=c.displayProjection);break}}a===this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("img"),this.element.src=OpenLayers._getScriptLocation()+"img/north.png",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div.style.position="absolute",this.div.style.zIndex=1004,this.div.style.left="60px",this.div.style.top="15px",this.div},updateLink:function(){},createParams:function(a,b,c){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(a){d.zoom=b||this.map.getZoom();var e=a.lat,f=a.lon;if(this.displayProjection){var g=OpenLayers.Projection.transform({x:f,y:e},this.map.getProjectionObject(),this.displayProjection);f=g.x,e=g.y}d.lat=Math.round(1e5*e)/1e5,d.lon=Math.round(1e5*f)/1e5,c=c||this.map.layers,d.layers="";for(var h=0,i=c.length;i>h;h++){var j=c[h];d.layers+=j.isBaseLayer?j===this.map.baseLayer?"B":"0":j.getVisibility()?"T":"F"}}return d},CLASS_NAME:"OpenLayers.Control.NorthControl"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){a&&a.xy&&(OpenLayers.Control.PanZoom.X=a.xy.x,OpenLayers.Control.PanZoom.Y=a.xy.y),this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position,this.buttons=[];var b={w:18,h:18},c=new OpenLayers.Pixel(a.x+b.w/2,a.y);return this._addButton("panup","north-mini.png",c,b,"向上平移"),a.y=c.y+b.h,this._addButton("panleft","west-mini.png",a,b,"向左平移"),this._addButton("panright","east-mini.png",a.add(b.w,0),b,"向右平移"),this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b,"向下平移"),this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b,"放大一级"),this._addButton("zoomworld","zoom-world-mini.png",c.add(0,4*b.h+5),b,"全图"),this._addButton("zoomout","zoom-minus-mini.png",c.add(0,5*b.h+5),b,"缩小一级"),this.div},_addButton:function(a,b,c,d,e){var f=OpenLayers.Util.getImageLocation(b),g=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,d,f,"absolute");return g.style.cursor="pointer",this.div.appendChild(g),g.action=a,g.className="olButton",e&&(g.title=e),this.buttons.push(g),g},_removeButton:function(a){this.div.removeChild(a),OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a)this._removeButton(this.buttons[a])},onButtonClick:function(a){var b=a.buttonElement;switch(b.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":if(this.map.originCenter){var c=this.map.originCenter,d=new OpenLayers.LonLat(c[0],c[1]),e=void 0!==this.map.minZoom?this.map.minZoom:this.map.getZoom();this.map.setCenter(d),this.map.zoomTo(e)}else this.map.zoomToMaxExtent()}},getSlideFactor:function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,backZoombar:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!0,panIcons:!0,forceFixedZoomLevel:!0,mouseDragStart:null,deltaY:null,zoomStart:null,slideRatio:.5,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position.clone(),this.buttons=[];var b={w:18,h:18};if(this.panIcons){var c=b.w,d=new OpenLayers.Pixel(a.x+b.w,a.y),e={w:44,h:44};if(this._addButton("panground","panGround.png",d.add(-14,0),e),this._addButton("panup","north-mini-1.png",d.add(-1,0),b,"向上平移"),a.y=d.y+b.h,this._addButton("panleft","west-mini-1.png",a.add(c-14,-4),b,"向左平移"),this.zoomWorldIcon){var f={w:12,h:12};this._addButton("zoomworld","zoomworld.png",a.add(f.w+8,-2),f,"全图")}c*=2,this._addButton("panright","east-mini-1.png",a.add(c-6,-5),b,"向右平移"),this._addButton("pandown","south-mini-1.png",d.add(-1,2*b.h-10),b,"向下平移"),this._addButton("zoomin","zoom-plus-mini.png",d.add(-2,3*b.h-9),b,"放大一级"),d=this._addZoomBar(d.add(0,4*b.h-9)),this._addButton("zoomout","zoom-minus-mini.png",d.add(-2,9),b,"缩小一级")}else this._addButton("zoomin","zoom-plus-mini.png",a,b),d=this._addZoomBar(a.add(0,b.h)),this._addButton("zoomout","zoom-minus-mini.png",d,b),this.zoomWorldIcon&&(d=d.add(0,b.h+3),this._addButton("zoomworld","zoom-world-mini.png",d,b));return this.moveZoomBar(),this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImageLocation("slider.png"),c=this.id+"_"+this.map.id,d=this.map.minZoom,e=this.map.maxZoom-d,f=e*this.zoomStopHeight;"safari"===OpenLayers.BROWSER_NAME&&(f-=4);var g=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,f),{w:20,h:9},b,"absolute"),h=OpenLayers.Util.getImageLocation("openhand.cur");g.style.cursor="url("+h+"), default",g.style.fontFamily="宋体",this.slider=g,this.sliderEvents=new OpenLayers.Events(this,g,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var i={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.maxZoom+1-d)};b=OpenLayers.Util.getImageLocation("zoombar.png");var j;return OpenLayers.Util.alphaHack()?(c=this.id+"_"+this.map.id,j=OpenLayers.Util.createAlphaImageDiv(c,a,{w:i.w,h:this.zoomStopHeight},b,"absolute",null,"crop"),j.style.height=i.h+"px"):j=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,i,b),j.style.cursor="pointer",j.className="olButton",j.title="放置到此级别",this.zoombarDiv=j,this.div.appendChild(j),this.startTop=a.y,this.div.appendChild(g),this.map.events.register("zoomend",this,this.moveZoomBar),a=a.add(0,this.zoomStopHeight*(this.map.maxZoom-d))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),a.buttonElement===this.zoombarDiv){var b=a.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(b=Math.floor(b));var c=this.map.maxZoom-b;c=Math.min(Math.max(c,0),this.map.maxZoom),this.map.zoomTo(c)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},mapMouseout:function(a){if(!this.map.div.contains(a.toElement)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.maxZoom)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0)),this.map.zoomTo(b>this.map.maxZoom?this.map.maxZoom:b<this.map.minZoom?this.map.minZoom:b),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(a)}},zoomBarDown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,mouseout:this.mapMouseout,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone();var b=OpenLayers.Util.getImageLocation("closedhand.cur");this.slider.style.cursor="url("+b+"), move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a)}},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);if(a.clientY-c[1]>0&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2){var d=parseInt(this.slider.style.top)-b;d<this.startTop&&(d=this.startTop);var e=this.map.maxZoom;this.map.minZoom&&(e-=this.map.minZoom);var f=this.startTop+e*this.zoomStopHeight;d>f&&(d=f),this.slider.style.top=d+"px",this.mouseDragStart=a.xy.clone()}this.deltaY=this.zoomStart.y-a.xy.y,OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&&this.mouseDragStart){var b=OpenLayers.Util.getImageLocation("openhand.cur");this.slider.style.cursor="url("+b+"), default",this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var c=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(c+=this.deltaY/this.zoomStopHeight,c=Math.min(Math.max(c,0),this.map.maxZoom)):(c+=this.deltaY/this.zoomStopHeight,c=Math.max(Math.round(c),0)),this.map.zoomTo(c>this.map.maxZoom?this.map.maxZoom:c<this.map.minZoom?this.map.minZoom:c),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=(this.map.maxZoom-this.map.getZoom())*this.zoomStopHeight+this.startTop;this.map.maxZoom===this.map.getZoom()&&(a=this.startTop),this.slider.style.top=a+"px",this.slider.title="当前"+this.map.getZoom()+"级"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Control.NPanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,backZoombar:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!0,panIcons:!0,forceFixedZoomLevel:!0,mouseDragStart:null,deltaY:null,zoomStart:null,slideRatio:.5,zoombar_1_div:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position.clone(),this.buttons=[];var b={w:16,h:16};if(this.panIcons){var c=b.w,d=new OpenLayers.Pixel(a.x+b.w,a.y),e={w:48,h:48};this._addButton("panground","navigator/panGround.png",d.add(-17,-4),e);var f=this._addButton("panup","navigator/north-mini.png",d.add(-1,-1),b,"CN"===NPMap.CULTURE?"向上平移":"Move Up"),g=new OpenLayers.Events(f,f,null,!0,{includeXY:!0});g.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/north-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/north-mini.png")}}),a.y=d.y+b.h;var h=this._addButton("panleft","navigator/west-mini.png",a.add(c-14,-4),b,"CN"===NPMap.CULTURE?"向左平移":"Move Left");if(this.zoomWorldIcon){var i={w:12,h:12},j=this._addButton("zoomworld","navigator/zoomworld.png",a.add(i.w+5,-2),i,"CN"===NPMap.CULTURE?"全图":"View All");"msie"===OpenLayers.BROWSER_NAME;var k=new OpenLayers.Events(j,j,null,!0,{includeXY:!0});k.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoomworld-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoomworld.png")}})}var l=new OpenLayers.Events(h,h,null,!0,{includeXY:!0});l.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/west-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/west-mini.png")}}),c*=2;var m=this._addButton("panright","navigator/east-mini.png",a.add(c-5,-4),b,"CN"===NPMap.CULTURE?"向右平移":"Move Right"),n=new OpenLayers.Events(m,m,null,!0,{includeXY:!0});n.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/east-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/east-mini.png")}});var o=this._addButton("pandown","navigator/south-mini.png",d.add(-1,2*b.h-8),b,"CN"===NPMap.CULTURE?"向下平移":"Move Down"),p=new OpenLayers.Events(o,o,null,!0,{includeXY:!0});p.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/south-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/south-mini.png")}});var q=this._addButton("zoomin","navigator/zoom-plus-mini.png",d.add(-6,3*b.h),{h:24,w:24},"CN"===NPMap.CULTURE?"放大一级":"Move Out"),r=new OpenLayers.Events(q,q,null,!0,{includeXY:!0});r.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-plus-mini-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-plus-mini.png")}}),d=this._addZoomBar(d.add(0,4*b.h+7));var s=this._addButton("zoomout","navigator/zoom-minus-mini.png",d.add(-6,5),{h:24,w:24},"CN"===NPMap.CULTURE?"缩小一级":"Zoom In"),t=new OpenLayers.Events(s,s,null,!0,{includeXY:!0});t.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-minus-mini-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-minus-mini.png")}})}else this._addButton("zoomin","navigator/zoom-plus-mini.png",a,b),d=this._addZoomBar(a.add(0,b.h)),this._addButton("zoomout","navigator/zoom-minus-mini.png",d,b),this.zoomWorldIcon&&(d=d.add(0,b.h+3),this._addButton("zoomworld","navigator/zoom-world-mini.png",d,b));
return this.moveZoomBar(),this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImageLocation("navigator/slider.png"),c=this.id+"_"+this.map.id,d=this.map.minZoom,e=this.map.maxZoom-d,f=e*this.zoomStopHeight;"safari"===OpenLayers.BROWSER_NAME&&(f-=4);var g=OpenLayers.Util.createAlphaImageDiv(c,a.add(-6,f),{w:24,h:12},b,"absolute"),h=OpenLayers.Util.getImageLocation("openhand.cur");g.style.cursor="url("+h+"), default",g.style.fontFamily="宋体",this.slider=g,this.sliderEvents=new OpenLayers.Events(this,g,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,mouseout:function(){this.slider.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/slider.png")},mouseover:function(){this.slider.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/slider-hover.png")}});var i={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.maxZoom+1-d)};b=OpenLayers.Util.getImageLocation("navigator/zoombar.png");var j,k=OpenLayers.Util.getImageLocation("navigator/zoombar-1.png");return this.zoombar_1_div=null,OpenLayers.Util.alphaHack()?(c=this.id+"_"+this.map.id,j=OpenLayers.Util.createAlphaImageDiv(c,a.add(0,16),{w:i.w,h:this.zoomStopHeight},b,"absolute",null,"crop"),j.style.height=i.h+"px"):(j=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a.add(-3,0),i,b),this.zoombar_1_div=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar_1"+this.map.id,a.add(-3,0),{w:i.w,h:i.h-2},k)),j.style.cursor="pointer",j.className="olButton",j.title="CN"===NPMap.CULTURE?"放置到此级别":"Adjust to this level",this.zoombar_1_div.style.overflow="hidden",this.zoombarDiv=j,this.div.appendChild(j),this.div.appendChild(this.zoombar_1_div),this.startTop=a.y-2,this.div.appendChild(g),this.map.events.register("zoomend",this,this.moveZoomBar),a=a.add(0,this.zoomStopHeight*(this.map.maxZoom-d))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),a.buttonElement===this.zoombarDiv){var b=a.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(b=Math.floor(b));var c=this.map.maxZoom-b;c=Math.min(Math.max(c,0),this.map.maxZoom),this.map.zoomTo(c)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},mapMouseout:function(a){if(!this.map.div.contains(a.toElement)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.maxZoom)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0)),this.map.zoomTo(b>this.map.maxZoom?this.map.maxZoom:b<this.map.minZoom?this.map.minZoom:b),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(a)}},zoomBarDown:function(a){if(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,mouseout:this.mapMouseout,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone();var b=OpenLayers.Util.getImageLocation("closedhand.cur");this.slider.style.cursor="url("+b+"), move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a)}},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);if(a.clientY-c[1]>0&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2){var d=parseInt(this.slider.style.top)-b;d<this.startTop&&(d=this.startTop);var e=this.map.maxZoom;this.map.minZoom&&(e-=this.map.minZoom);var f=this.startTop+e*this.zoomStopHeight;d>f&&(d=f),this.slider.style.top=d+"px",this.mouseDragStart=a.xy.clone()}this.deltaY=this.zoomStart.y-a.xy.y,OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&&this.mouseDragStart){var b=OpenLayers.Util.getImageLocation("openhand.cur");this.slider.style.cursor="url("+b+"), default",this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var c=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(c+=this.deltaY/this.zoomStopHeight,c=Math.min(Math.max(c,0),this.map.maxZoom)):(c+=this.deltaY/this.zoomStopHeight,c=Math.max(Math.round(c),0)),this.map.zoomTo(c>this.map.maxZoom?this.map.maxZoom:c<this.map.minZoom?this.map.minZoom:c),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=(this.map.maxZoom-this.map.getZoom())*this.zoomStopHeight+this.startTop;this.map.maxZoom===this.map.getZoom()&&(a=this.startTop),this.slider.style.top=a+"px",this.zoombar_1_div.style.top=a+"px";var b=this.map.maxZoom-this.map.minZoom,c=77+OpenLayers.Control.PanZoom.Y,d=this.zoomStopHeight*b+c-a;d=d>0?d:0,this.zoombar_1_div.style.height=d+"px",this.slider.title="CN"===NPMap.CULTURE?"当前"+this.map.getZoom()+"级":"Current Level:"+this.map.getZoom()},CLASS_NAME:"OpenLayers.Control.NPanZoomBar"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.element=OpenLayers.Util.getElement(a)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div.id="scale",this.div.style.bottom="42px",this.div.style.right="5px",document.getElementById("OpenLayers_Control_minimizeDiv")&&""===document.getElementById("OpenLayers_Control_minimizeDiv").style.display&&(this.div.style.right="200px"),this.div},updateScale:function(){var a;if(this.geodesic===!0){var b=this.map.getUnits();if(!b)return;var c=OpenLayers.INCHES_PER_UNIT;a=(this.map.getGeodesicPixelSize().w||1e-6)*c.km*OpenLayers.DOTS_PER_INCH}else a=this.map.getScale();a&&(a=a>=9500&&95e4>=a?Math.round(a/1e3)+"K":a>=95e4?Math.round(a/1e6)+"M":Math.round(a),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:a}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""===this.topOutUnits||""===this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""===this.bottomOutUnits||""===this.bottomInUnits?"hidden":"visible"),this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(a){var b,c=parseInt(Math.log(a)/Math.log(10)),d=Math.pow(10,c),e=parseInt(a/d);return b=e>5?5:e>2?2:1,b*d},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e=1;if(this.geodesic===!0){var f=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,g=d/c.km;e=f/g,d*=e}var h,i;d>1e5?(h=this.topOutUnits,i=this.bottomOutUnits):(h=this.topInUnits,i=this.bottomInUnits);var j=d/c[h],k=d/c[i],l=this.getBarLen(j),m=this.getBarLen(k);j=l/c[b]*c[h],k=m/c[b]*c[i];var n=j/a/e,o=k/a/e;if("visible"===this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(o)+"px",this.eBottom.innerHTML=m+" "+i),"visible"===this.eTop.style.visibility){this.eTop.style.width=Math.round(n)+"px";var p=h;"CN"===NPMap.CULTURE&&"km"===p&&(p="公里"),"CN"===NPMap.CULTURE&&"m"===p&&(p="米"),this.eTop.innerHTML=l+" "+p}}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Control.SelectFeatureClick=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,mousedown:function(){},mouseup:function(){},dblclick:function(){},mousemove:function(){},onRightSelect:function(){},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),null===this.scope&&(this.scope=this),this.initLayer(a);var c={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature),c.mousedown=this.mousedown,c.mouseup=this.mouseup,c.dblclick=this.dblclick,c.mousemove=this.mousemove,c.contextmenu=this.onRightSelect,this.callbacks=OpenLayers.Util.extend(c,this.callbacks);var d=new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes});d.EVENTMAP.mouseup["in"]="mouseup",d.EVENTMAP.mousedown["in"]="mousedown",this.handlers={feature:d},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeatureClick"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b,c,d,e,f=this.layers||[this.layer];for(d=0;d<f.length;++d)if(b=f[d],e=0,null!=b.selectedFeatures)for(;b.selectedFeatures.length>e;)c=b.selectedFeatures[e],a&&a.except===c?++e:this.unselect(c)},clickFeature:function(a,b){if(!this.hover){var c=OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1;c?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a,b))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=a.layer;this.hover&&(this.highlightOnly?this.highlight(a):-1===OpenLayers.Util.indexOf(b.selectedFeatures,a)&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter===this.id)if(a._prevHighlighter&&a._prevHighlighter!==this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer,c=this.events.triggerEvent("beforefeaturehighlighted",{feature:a});if(c!==!1){a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id;var d=this.selectStyle||this.renderIntent;b.drawFeature(a,d),this.events.triggerEvent("featurehighlighted",{feature:a})}},unhighlight:function(a){var b=a.layer;void 0===a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter===this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a,b){var c=this.onBeforeSelect.call(this.scope,a),d=a.layer;if(c!==!1&&(c=d.events.triggerEvent("beforefeatureselected",{feature:a}),c!==!1))switch(d.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=d.selectedFeatures[0]),d.events.triggerEvent("featureselected",{feature:a}),b){case"contextmenu":this.onRightSelect.call(this.scope,a);break;case"click":default:this.onSelect.call(this.scope,a)}},unselect:function(a){var b=a.layer;this.unhighlight(a),OpenLayers.Util.removeItem(b.selectedFeatures,a),b.events.triggerEvent("featureunselected",{feature:a}),this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),c=this.map.getLonLatFromPixel({x:a.right,y:a.top}),d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);this.multipleSelect()||this.unselectAll();var e=this.multiple;this.multiple=!0;var f=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:f});for(var g,h=0;h<f.length;++h){g=f[h];for(var i=0,j=g.features.length;j>i;++i){var k=g.features[i];k.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,k.geometry.CLASS_NAME)>-1)&&d.toGeometry().intersects(k.geometry)&&-1===OpenLayers.Util.indexOf(g.selectedFeatures,k)&&this.select(k)}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:f})}},setMap:function(a){this.handlers.feature.setMap(a),this.box&&this.handlers.box.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(a),this.handlers.feature.layer=this.layer,b&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeatureClick"}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.options=a||{},this.options.layer&&this.setLayer(this.options.layer);var b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(a){this.active?(this.deactivate(),this.layer=a,this.activate()):this.layer=a},setTargets:function(a){if(this.targets=[],a&&a.length)for(var b,c=0,d=a.length;d>c;++c)b=a[c],b instanceof OpenLayers.Layer.Vector?this.addTargetLayer(b):this.addTarget(b)},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults),a.nodeTolerance=a.nodeTolerance||a.tolerance,a.vertexTolerance=a.vertexTolerance||a.tolerance,a.edgeTolerance=a.edgeTolerance||a.tolerance,this.targets.push(a)},removeTargetLayer:function(a){for(var b,c=this.targets.length-1;c>=0;--c)b=this.targets[c],b.layer===a&&this.removeTarget(b)},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,a},onSketchModified:function(a){this.feature=a.feature,this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(a,b){for(var c,d,e={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},f=!1,g=0,h=this.targets.length;h>g;++g)if(d=this.targets[g],c=this.testTarget(d,b)){if(this.greedy){e=c,e.target=d,f=!0;break}(c.rank<e.rank||c.rank===e.rank&&c.dist<e.dist)&&(e=c,e.target=d,f=!0)}if(f){var i=this.events.triggerEvent("beforesnap",{point:a,x:e.x,y:e.y,distance:e.dist,layer:e.target.layer,snapType:this.precedence[e.rank]});i!==!1?(a.x=e.x,a.y=e.y,this.point=a,this.events.triggerEvent("snap",{point:a,snapType:this.precedence[e.rank],layer:e.target.layer,distance:e.dist})):f=!1}this.point&&!f&&(a.x=b.x,a.y=b.y,this.point=null,this.events.triggerEvent("unsnap",{point:a}))},testTarget:function(a,b){var c=this.layer.map.getResolution();if("minResolution"in a&&c<a.minResolution)return null;if("maxResolution"in a&&c>=a.maxResolution)return null;for(var d,e,f,g,h,i,j,k={node:this.getGeoTolerance(a.nodeTolerance,c),vertex:this.getGeoTolerance(a.vertexTolerance,c),edge:this.getGeoTolerance(a.edgeTolerance,c)},l=Math.max(k.node,k.vertex,k.edge),m={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},n=!1,o=a.layer.features,p=this.precedence.length,q=new OpenLayers.LonLat(b.x,b.y),r=0,s=o.length;s>r;++r)if(d=o[r],d!==this.feature&&!d._sketch&&d.state!==OpenLayers.State.DELETE&&(!a.filter||a.filter.evaluate(d))&&d.atPoint(q,l,l))for(var t=0,u=Math.min(m.rank+1,p);u>t;++t)if(e=this.precedence[t],a[e])if("edge"===e){if(h=d.geometry.distanceTo(b,{details:!0}),i=h.distance,i<=k[e]&&i<m.dist){m={rank:t,dist:i,x:h.x0,y:h.y0},n=!0;break}}else{f=d.geometry.getVertices("node"===e),j=!1;for(var v=0,w=f.length;w>v;++v)g=f[v],i=g.distanceTo(b),i<=k[e]&&(t<m.rank||t===m.rank&&i<m.dist)&&(m={rank:t,dist:i,x:g.x,y:g.y},n=!0,j=!0);if(j)break}return n?m:null},getGeoTolerance:function(a,b){b!==this.resolution&&(this.resolution=b,this.geoToleranceCache={});var c=this.geoToleranceCache[a];return void 0===c&&(c=a*b,this.geoToleranceCache[a]=c),c},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b})}},this.callbacks),this.layer=a,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:a.renderers,rendererOptions:a.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var d=this.layer.styleMap&&this.layer.styleMap.styles.temporary;d&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":d})})),this.handler=new b(this,this.callbacks,this.handlerOptions)},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a),c=this.layer.events.triggerEvent("sketchcomplete",{feature:b});c!==!1&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertXY(a,b)},insertDeltaXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeltaXY(a,b)},insertDirectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDirectionLength(a,b)},insertDeflectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(a,b)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(a){this.handlers.feature.touch&&!this.over&&this.overFeature(a)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(a){this.handlers.feature.touch&&this.over&&(this.outFeature(a),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){var b=!1;return this.handlers.drag.dragging?this.over=this.feature.id===a.id?!0:!1:(this.feature=a,this.handlers.drag.activate(),b=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(a)),b},downFeature:function(a){this.lastPixel=a,this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y)),this.layer.drawFeature(this.feature),this.lastPixel=a,this.onDrag(this.feature,a)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){this.handlers.drag.dragging?this.feature.id===a.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(a),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(a){this.handlers.drag.setMap(a),this.handlers.feature.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,controlActivate:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},defaultStyle:null,initialize:function(a,b){b=b||{},this.layer=a,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent)),this.defaultStyle=this.layer.styleMap.styles["default"].defaultStyle,this.defaultStyle.fillColor="red",this.defaultStyle.fillOpacity=.9,this.virtualStyle.fillOpacity=.7,this.virtualStyle.strokeOpacity=.3,this.virtualStyle.graphicZIndex=1e6,this.virtualStyle.fillColor="red",this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c={down:function(){this.vertex=null;var a=this.layer.getFeatureFromEvent(this.handlers.drag.evt);a?this.dragStart(a):this.clickout&&(this._unselect=this.feature)},move:function(a){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,a)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(){this.vertex&&this.dragComplete(this.vertex)}},d={documentDrag:this.documentDrag,stopDown:!1},e={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,e),drag:new OpenLayers.Handler.Drag(this,c,d)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.controlActivate||(this.moveLayerToTop(),this.controlActivate=!0),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var a=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.controlActivate&&(this.moveLayerBack(),this.controlActivate=!1),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var b=this.feature;b&&b.geometry&&b.layer&&this.unselectFeature(b),a=!0}return a},beforeSelectFeature:function(a){return!a.data||a.data.isEnableEdit?this.layer.events.triggerEvent("beforefeaturemodified",{feature:a}):!1},selectFeature:function(a){if(!(this.feature===a||this.geometryTypes&&-1===OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME))){this.beforeSelectFeature(a)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);var b=!0;a.data&&(a.data._apiObj&&null==a.data._apiObj.layer||null==a.data._apiObj)&&(b=!1),b&&this.layer.drawFeature(a,"select"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,a),this.onModificationEnd(a),this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified}),this.modified=!1},dragStart:function(a){if(!a.data||"boolean"!=typeof a.data.isEnableEdit||a.data.isEnableEdit){var b="OpenLayers.Geometry.Point"===a.geometry.CLASS_NAME;this.standalone||(a._sketch||!b)&&a._sketch||(this.toggle&&this.feature===a&&(this._unselect=a),this.selectFeature(a)),(a._sketch||b)&&(this.vertex=a,this.handlers.drag.stopDown=!0)}},changeRectangleVectexs:function(a){for(var b=this.vertices.length-1;b>=0;b--)this.vertices[b].geometry.clearBounds();switch(a._recIndex){case 1:this.vertices[1].geometry.x=a.geometry.x,this.vertices[3].geometry.y=a.geometry.y,this.layer.drawFeature(this.vertices[1]),this.layer.drawFeature(this.vertices[3]);break;case 2:this.vertices[0].geometry.x=a.geometry.x,this.vertices[2].geometry.y=a.geometry.y,this.layer.drawFeature(this.vertices[0]),this.layer.drawFeature(this.vertices[2]);break;case 3:this.vertices[3].geometry.x=a.geometry.x,this.vertices[1].geometry.y=a.geometry.y,this.layer.drawFeature(this.vertices[3]),this.layer.drawFeature(this.vertices[1]);break;case 4:this.vertices[2].geometry.x=a.geometry.x,this.vertices[0].geometry.y=a.geometry.y,this.layer.drawFeature(this.vertices[2]),this.layer.drawFeature(this.vertices[0])}if(this.dragHandle){var c=this.feature.geometry,d=c.getBounds().getCenterLonLat();this.dragHandle.geometry.x=d.lon,this.dragHandle.geometry.y=d.lat,this.layer.drawFeature(this.dragHandle)}},changeRectangleBounds:function(a){for(var b=this.vertices.length-1;b>=0;b--)this.vertices[b].geometry.clearBounds();for(var c=this.virtualVertices.length-1;c>=0;c--)this.virtualVertices[c].geometry.clearBounds();var d=a._recBoundindex-1,e=a._recBoundindex;4===e&&(e=0);var f=a._recBoundindex-2;-1===f?f=3:-2===f&&(f=2);var g=e;a._recBoundindex%2===1?(this.vertices[d].geometry.x=a.geometry.x,this.vertices[e].geometry.x=a.geometry.x):(this.vertices[d].geometry.y=a.geometry.y,this.vertices[e].geometry.y=a.geometry.y),this.layer.drawFeature(this.vertices[d]),this.layer.drawFeature(this.vertices[e]);var h=this.feature.geometry,i=h.getBounds().getCenterLonLat();this.dragHandle&&(this.dragHandle.geometry.x=i.lon,this.dragHandle.geometry.y=i.lat,this.layer.drawFeature(this.dragHandle)),a._recBoundindex%2===1?(this.virtualVertices[f].geometry.x=i.lon,this.virtualVertices[g].geometry.x=i.lon):(this.virtualVertices[f].geometry.y=i.lat,this.virtualVertices[g].geometry.y=i.lat),this.layer.drawFeature(this.virtualVertices[f]),this.layer.drawFeature(this.virtualVertices[g])},dragVertex:function(a,b){var c=this.map.getLonLatFromViewPortPx(b),d=a.geometry;a._recBoundindex?a._recBoundindex%2===1?d.move(c.lon-d.x,0):d.move(0,c.lat-d.y):d.move(c.lon-d.x,c.lat-d.y),a._recIndex&&this.changeRectangleVectexs(a),this.modified=!0,"OpenLayers.Geometry.Point"===this.feature.geometry.CLASS_NAME?(this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}),this.layer.events.triggerEvent("draging",{vertex:a,position:c})):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a===this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):a._recBoundindex?this.changeRectangleBounds(a):a!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}),!a._recBoundindex&&this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(a)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature&&this.feature.state&&this.feature.state!==OpenLayers.State.INSERT&&this.feature.state!==OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry}),delete this._originalGeometry
}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!==this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&this.feature.data&&"NPMapLib.Geometry.Circle"!==this.feature.data.CLASS_NAME&&"NPMapLib.Geometry.CircleSector"!==this.feature.data.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&-1!==OpenLayers.Util.indexOf(this.deleteCodes,b)){var c=this.layer.getFeatureFromEvent(this.handlers.drag.evt);c&&-1!==OpenLayers.Util.indexOf(this.vertices,c)&&!this.handlers.drag.dragging&&c.geometry.parent&&(c.geometry.parent.removeComponent(c.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:c.geometry,feature:this.feature,pixel:a.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function a(c){var d,e,f,g;if("OpenLayers.Geometry.Point"===c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e);else{"OpenLayers.Geometry.Polygon"===c.CLASS_NAME&&(c=c.components[0]);var h=c.components.length;"OpenLayers.Geometry.LinearRing"===c.CLASS_NAME&&(h-=1);var i=!1;if("OpenLayers.Geometry.LinearRing"===c.CLASS_NAME&&5===c.components.length){var j=1e-6;"EPSG:900913"===this.map.getProjection()&&(j=2),Math.abs(c.components[0].x-c.components[1].x)<j&&Math.abs(c.components[2].x-c.components[3].x)<j&&Math.abs(c.components[0].y-c.components[3].y)<j&&Math.abs(c.components[1].y-c.components[2].y)<j&&(i=!0)}for(d=0;h>d;++d)f=c.components[d],"OpenLayers.Geometry.Point"===f.CLASS_NAME?(e=new OpenLayers.Feature.Vector(f,null,b.virtualStyle),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,i&&(e._recIndex=d+1),b.vertices.push(e)):a(f);if(b.createVertices&&"OpenLayers.Geometry.MultiPoint"!==c.CLASS_NAME)for(d=0,g=c.components.length;g-1>d;++d){var k=c.components[d],l=c.components[d+1];if("OpenLayers.Geometry.Point"===k.CLASS_NAME&&"OpenLayers.Geometry.Point"===l.CLASS_NAME){var m=(k.x+l.x)/2,n=(k.y+l.y)/2,o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(m,n),null,b.virtualStyle);o.geometry.parent=c,i?o._recBoundindex=d+1:o._index=d+1,o._sketch=!0,b.virtualVertices.push(o)}}}}this.vertices=[],this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),c=new OpenLayers.Geometry.Point(b.lon,b.lat),d=new OpenLayers.Feature.Vector(c);c.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c),a.move(b,c)},d._sketch=!0,this.dragHandle=d,this.dragHandle.style=this.defaultStyle,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),e=new OpenLayers.Geometry.Point(b.right,b.bottom),f=new OpenLayers.Feature.Vector(e),g=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,h=!1,i=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;e.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var e=this.x-d.x,f=this.y-d.y,j=e-b,k=f-c;if(i){var l=Math.atan2(k,j),m=Math.atan2(f,e),n=m-l;n*=180/Math.PI,a.rotate(n,d)}if(g){var o,p;if(h)o=f/k,p=e/j/o;else{var q=Math.sqrt(j*j+k*k),r=Math.sqrt(e*e+f*f);o=r/q}a.resize(o,d,p)}},f._sketch=!0,this.radiusHandle=f,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},collectCircleRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=this.map.getProjection(),e=new OpenLayers.Geometry.Point(c.lon,c.lat),f=new OpenLayers.Geometry.Point(b.right,c.lat),g=OpenLayers.Util.getImagesLocation(),h=g+"editCircle.png",i=new OpenLayers.Geometry.Point(b.right,c.lat),j=new OpenLayers.Geometry.LineString([e,i]),k=Math.round(j.getGeodesicLength(d)),l={label:k+"m",fontSize:10,fontFamily:"宋体",fontWeight:"normal",labelXOffset:34,labelYOffset:-4,fillColor:"#212122",labelAlign:"cb",graphicWidth:76,graphicHeight:24,graphicXOffset:-16,graphicYOffset:-12,externalGraphic:h},m=new OpenLayers.Feature.Vector(f,null,l),n=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,o=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE;f.data=m,f.move=function(b){OpenLayers.Geometry.Point.prototype.move.call(this,b,0);var c=this.x-e.x,f=c-b;if(n){var g,h;o?(g=c/f,h=c/f/g):g=c/f}a.resize(g,e,h);var i=new OpenLayers.Geometry.Point(this.x,this.y),j=new OpenLayers.Geometry.LineString([e,i]),k=Math.round(j.getGeodesicLength(d));this.data.style.label=Math.round(k)+"m"},m._sketch=!0,this.radiusHandle=m,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(a){this.handlers.drag.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(a){("removelayer"===a.type||"order"===a.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;b>=0;b--)a=this.controls[b],a.events&&a.events.un({activate:this.iconOn,deactivate:this.iconOff}),a.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;c>b;b++)a=this.controls[b],(a===this.defaultControl||this.saveState&&this.activeState[a.id])&&a.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;c>b;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var a=this.div.childNodes.length,b=a-1;b>=0;b--)this.div.removeChild(this.div.childNodes[b]);if(this.div.innerHTML="",this.active)for(var c=0,d=this.controls.length;d>c;c++)this.div.appendChild(this.controls[c].panel_div)},activateControl:function(a){if(!this.active)return!1;if(a.type===OpenLayers.Control.TYPE_BUTTON)return void a.trigger();if(a.type===OpenLayers.Control.TYPE_TOGGLE)return void(a.active?a.deactivate():a.activate());if(this.allowDepress&&a.active)a.deactivate();else{for(var b,c=0,d=this.controls.length;d>c;c++)b=this.controls[c],b===a||b.type!==OpenLayers.Control.TYPE_TOOL&&null!=b.type||b.deactivate();a.activate()}},addControls:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.controls=this.controls.concat(a);for(var b=0,c=a.length;c>b;b++){var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+"ItemInactive"),OpenLayers.Element.addClass(e,"olButton"),""==d.title||e.title||(e.title=d.title),d.panel_div=e}this.map&&(this.addControlsToMap(a),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(a){for(var b,c=0,d=a.length;d>c;c++)b=a[c],b.autoActivate===!0?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");a.className=a.className.replace(b,"$1Active")},iconOff:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Active\\b");a.className=a.className.replace(b,"$1Inactive")},onButtonClick:function(a){for(var b=this.controls,c=a.buttonElement,d=b.length-1;d>=0;--d)if(b[d].panel_div===c){this.activateControl(b[d]);break}},getControlsBy:function(a,b){var c="function"==typeof b.test,d=OpenLayers.Array.filter(this.controls,function(d){return d[a]===b||c&&b.test(d[a])});return d},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onRightSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),null===this.scope&&(this.scope=this),this.initLayer(a);var c={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b,c,d,e,f=this.layers||[this.layer];for(d=0;d<f.length;++d)if(b=f[d],e=0,null!=b.selectedFeatures)for(;b.selectedFeatures.length>e;)c=b.selectedFeatures[e],a&&a.except===c?++e:this.unselect(c)},clickFeature:function(a,b){if(!this.hover){var c=OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1;c?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a,b))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=a.layer;this.hover&&(this.highlightOnly?this.highlight(a):-1===OpenLayers.Util.indexOf(b.selectedFeatures,a)&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter===this.id)if(a._prevHighlighter&&a._prevHighlighter!==this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer,c=this.events.triggerEvent("beforefeaturehighlighted",{feature:a});if(c!==!1){a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id;var d=this.selectStyle||this.renderIntent;b.drawFeature(a,d),this.events.triggerEvent("featurehighlighted",{feature:a})}},unhighlight:function(a){var b=a.layer;void 0===a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter===this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a,b){var c=this.onBeforeSelect.call(this.scope,a),d=a.layer;if(c!==!1&&(c=d.events.triggerEvent("beforefeatureselected",{feature:a}),c!==!1))switch(d.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=d.selectedFeatures[0]),d.events.triggerEvent("featureselected",{feature:a}),b){case"contextmenu":this.onRightSelect.call(this.scope,a);break;case"click":default:this.onSelect.call(this.scope,a)}},unselect:function(a){var b=a.layer;this.unhighlight(a),OpenLayers.Util.removeItem(b.selectedFeatures,a),b.events.triggerEvent("featureunselected",{feature:a}),this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),c=this.map.getLonLatFromPixel({x:a.right,y:a.top}),d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);this.multipleSelect()||this.unselectAll();var e=this.multiple;this.multiple=!0;var f=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:f});for(var g,h=0;h<f.length;++h){g=f[h];for(var i=0,j=g.features.length;j>i;++i){var k=g.features[i];k.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,k.geometry.CLASS_NAME)>-1)&&d.toGeometry().intersects(k.geometry)&&-1===OpenLayers.Util.indexOf(g.selectedFeatures,k)&&this.select(k)}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:f})}},setMap:function(a){this.handlers.feature.setMap(a),this.box&&this.handlers.box.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(a),this.handlers.feature.layer=this.layer,b&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,imgPath:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);var c={done:this.measureComplete,point:this.measurePartial,measuremoving:this.measureMoving};this.immediate&&(c.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new a(this,this.callbacks,this.handlerOptions),this.imgPath=OpenLayers.Util.getImageLocation("dis_box_01.gif")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),"OpenLayers.Handler.Path"===this.handler.CLASS_NAME&&(this.context=new OpenLayers.Control.MouseContext,this.context.setContext("CN"===NPMap.CULTURE?"单击确定起点":"Click for origin"),this.map.addControl(this.context),this.context.setContextSize(90,25),this.context.activate()),!0)},deactivate:function(){return this.cancelDelay(),this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),this.cancelDelay(),this.handler.cancel()},setImmediate:function(a){this.immediate=a,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(a,b){var c=this.active;c&&(this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),this.deactivate()),this.handler=new a(this,this.callbacks,b),c&&this.activate()},measureComplete:function(a){this.cancelDelay(),this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),this.handler.layer.destroyFeatures(),this.measure(a,"measure")},measureMoving:function(a,b){if(b.CLASS_NAME.indexOf("LineString")>-1&&(stat=this.getBestLength(b),stat[0]>0&&this.context)){"CN"===NPMap.CULTURE?this.context.setContextSize(140,40):this.context.setContextSize(240,60);var c=stat[0].toFixed(2);this.context.setContext("<div>"+("CN"===NPMap.CULTURE?"总长度":"Total Distance")+"：<span style='font-size: 11px;color:red'>"+c+"</span>"+stat[1]+"</div><div>"+("CN"===NPMap.CULTURE?"单击确定位置，双击结束":"Click to confirm location,Double Click for End Location")+"</div>")}},measurePartial:function(a,b){b=b.clone(),a=a.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(b,"measurepartial",a):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(b,"measurepartial",a),this.measure(b,"measureProcess",a)},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(b.geometry,"measurepartial",a))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a,b,c){var d,e;a.CLASS_NAME.indexOf("LineString")>-1?(d=this.getBestLength(a),e=1):(d=this.getBestArea(a),e=2),this.events.triggerEvent(b,{measure:d[0],units:d[1],order:e,geometry:a,point:c})},getBestArea:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;f>e&&(b=d[e],c=this.getArea(a,b),!(c>1));++e);return[c,b]},getArea:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=Math.pow(f/e,2)}return c},getBestLength:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;f>e&&(b=d[e],c=this.getLength(a,b),!(c>1));++e);return[c,b]},getLength:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),d="m"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=f/e}return c},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"−",zoomOutId:"olZoomOutLink",draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this),b=this.getOrCreateLinks(a),c=b.zoomIn,d=b.zoomOut,e=this.map.events;return d.parentNode!==a&&(e=this.events,e.attachToElement(d.parentNode)),e.register("buttonclick",this,this.onZoomClick),this.zoomInLink=c,this.zoomOutLink=d,a},getOrCreateLinks:function(a){var b=document.getElementById(this.zoomInId),c=document.getElementById(this.zoomOutId);return b||(b=document.createElement("a"),b.href="#zoomIn",b.appendChild(document.createTextNode(this.zoomInText)),b.className="olControlZoomIn",a.appendChild(b)),OpenLayers.Element.addClass(b,"olButton"),c||(c=document.createElement("a"),c.href="#zoomOut",c.appendChild(document.createTextNode(this.zoomOutText)),c.className="olControlZoomOut",a.appendChild(c)),OpenLayers.Element.addClass(c,"olButton"),{zoomIn:b,zoomOut:c}},onZoomClick:function(a){var b=a.buttonElement;b===this.zoomInLink?this.map.zoomIn():b===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){a&&(this.bounds=a.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(a){var b=this.getBounds();b?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(a,b,c){var d=!1,e=this.getBounds();if(null!=e&&null!=a){var f=null!=b?b:0,g=null!=c?c:0,h=new OpenLayers.Bounds(this.bounds.left-f,this.bounds.bottom-g,this.bounds.right+f,this.bounds.top+g);d=h.containsLonLat(a)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var a;return a=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(a){var b;if(OpenLayers.Format&&OpenLayers.Format.WKT){var c=OpenLayers.Geometry.fromWKT.format;c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c);var d=c.read(a);if(d instanceof OpenLayers.Feature.Vector)b=d.geometry;else if(OpenLayers.Util.isArray(d)){for(var e=d.length,f=new Array(e),g=0;e>g;++g)f[g]=d[g].geometry;b=new OpenLayers.Geometry.Collection(f)}}return b},OpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point,e=c&&c.tolerance,f=!1,g=a.x1-b.x1,h=a.y1-b.y1,i=a.x2-a.x1,j=a.y2-a.y1,k=b.y2-b.y1,l=b.x2-b.x1,m=k*i-l*j,n=l*h-k*g,o=i*h-j*g;if(0==m)0==n&&0==o&&(f=!0);else{var p=n/m,q=o/m;if(p>=0&&1>=p&&q>=0&&1>=q)if(d){var r=a.x1+p*i,s=a.y1+p*j;f=new OpenLayers.Geometry.Point(r,s)}else f=!0}if(e){var t;if(f){if(d){var u,r,s,v=[a,b];a:for(var w=0;2>w;++w){u=v[w];for(var x=1;3>x;++x)if(r=u["x"+x],s=u["y"+x],t=Math.sqrt(Math.pow(r-f.x,2)+Math.pow(s-f.y,2)),e>t){f.x=r,f.y=s;break a}}}}else{var y,z,r,s,A,B,v=[a,b];a:for(var w=0;2>w;++w){y=v[w],z=v[(w+1)%2];for(var x=1;3>x;++x)if(A={x:y["x"+x],y:y["y"+x]},B=OpenLayers.Geometry.distanceToSegment(A,z),B.distance<e){f=d?new OpenLayers.Geometry.Point(A.x,A.y):!0;break a}}}}return f},OpenLayers.Geometry.distanceToSegment=function(a,b){var c=OpenLayers.Geometry.distanceSquaredToSegment(a,b);return c.distance=Math.sqrt(c.distance),c},OpenLayers.Geometry.distanceSquaredToSegment=function(a,b){var c,d,e=a.x,f=a.y,g=b.x1,h=b.y1,i=b.x2,j=b.y2,k=i-g,l=j-h,m=0==k&&0==l?0:(k*(e-g)+l*(f-h))/(Math.pow(k,2)+Math.pow(l,2));return 0>=m?(c=g,d=h):m>=1?(c=i,d=j):(c=g+m*k,d=h+m*l),{distance:Math.pow(c-e,2)+Math.pow(d-f,2),x:c,y:d,along:m}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=a&&this.addComponents(a)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var a=[],b=0,c=this.components.length;c>b;b++)a.push(this.components[b].toShortString());return a.join(",")},calculateBounds:function(){this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;d>c;c++)a.extend(b[c].getBounds());null!=a.left&&null!=a.bottom&&null!=a.right&&null!=a.top&&this.setBounds(a)},addComponents:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;c>b;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=!1;if(a&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME)>-1)){if(null!=b&&b<this.components.length){var d=this.components.slice(0,b),e=this.components.slice(b,this.components.length);d.push(a),this.components=d.concat(e)}else this.components.push(a);a.parent=this,this.clearBounds(),c=!0}return c},removeComponents:function(a){var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;c>=0;--c)b=this.removeComponent(a[c])||b;return b},removeComponent:function(a){return OpenLayers.Util.removeItem(this.components,a),this.clearBounds(),!0},getLength:function(){for(var a=0,b=0,c=this.components.length;c>b;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;c>b;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;d>c;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(a){if(!a)return this.components.length&&this.components[0].getCentroid();var b=this.components.length;if(!b)return!1;for(var c,d=[],e=[],f=0,g=Number.MAX_VALUE,h=0;b>h;++h){c=this.components[h];var i=c.getArea(),j=c.getCentroid(!0);isNaN(i)||isNaN(j.x)||isNaN(j.y)||(d.push(i),f+=i,g=g>i&&i>0?i:g,e.push(j))}if(b=d.length,0===f){for(var h=0;b>h;++h)d[h]=1;f=d.length}else{for(var h=0;b>h;++h)d[h]/=g;f/=g}for(var j,i,k=0,l=0,h=0;b>h;++h)j=e[h],i=d[h],k+=j.x*i,l+=j.y*i;return new OpenLayers.Geometry.Point(k/f,l/f)},getGeodesicLength:function(a){for(var b=0,c=0,d=this.components.length;d>c;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;d>c;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;d>c;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var c,d,e,f=!(b&&b.edge===!1),g=f&&b&&b.details,h=Number.POSITIVE_INFINITY,i=0,j=this.components.length;j>i&&(c=this.components[i].distanceTo(a,b),e=g?c.distance:c,!(h>e&&(h=e,d=c,0==h)));++i);return d},equals:function(a){var b=!0;if(a&&a.CLASS_NAME&&this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&&a.components.length==this.components.length){for(var c=0,d=this.components.length;d>c;++c)if(!this.components[c].equals(a.components[c])){b=!1;break}}else b=!1;else b=!1;return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;d>c;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},intersects:function(a){for(var b=!1,c=0,d=this.components.length;d>c&&!(b=a.intersects(this.components[c]));++c);return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;d>c;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(a),this.y=parseFloat(b)},clone:function(a){return null==a&&(a=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(a,this),a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var c,d,e,f,g,h,i=!(b&&b.edge===!1),j=i&&b&&b.details;return a instanceof OpenLayers.Geometry.Point?(d=this.x,e=this.y,f=a.x,g=a.y,c=Math.sqrt(Math.pow(d-f,2)+Math.pow(e-g,2)),h=j?{x0:d,y0:e,x1:f,y1:g,distance:c}:c):(h=a.distanceTo(this,b),j&&(h={x0:h.x1,y0:h.y1,x1:h.x0,y1:h.y0,distance:h.distance})),h},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x=this.x+a,this.y=this.y+b,this.clearBounds()},rotate:function(a,b){a*=Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d),this.y=b.y+c*Math.sin(d),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){return c=void 0==c?1:c,this.x=b.x+a*c*(this.x-b.x),this.y=b.y+a*(this.y-b.y),this.clearBounds(),this},intersects:function(a){var b=!1;return b="OpenLayers.Geometry.Point"==a.CLASS_NAME?this.equals(a):a.intersects(this)},transform:function(a,b){return a&&b&&(OpenLayers.Projection.transform(this,a,b),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var a=0;if(this.components&&this.components.length>1)for(var b=1,c=this.components.length;c>b;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:900913");c.equals(a)||(b=this.clone().transform(a,c))}return b.getLength()},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var a=this.components&&this.components.length>2;return a&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),a},intersects:function(a){var b=!1,c=a.CLASS_NAME;if("OpenLayers.Geometry.LineString"==c||"OpenLayers.Geometry.LinearRing"==c||"OpenLayers.Geometry.Point"==c){var d,e=this.getSortedSegments();d="OpenLayers.Geometry.Point"==c?[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments();var f,g,h,i,j,k,l,m;a:for(var n=0,o=e.length;o>n;++n){f=e[n],g=f.x1,h=f.x2,i=f.y1,j=f.y2;for(var p=0,q=d.length;q>p&&(k=d[p],!(k.x1>h));++p)if(!(k.x2<g||(l=k.y1,m=k.y2,Math.min(l,m)>Math.max(i,j)||Math.max(l,m)<Math.min(i,j)||!OpenLayers.Geometry.segmentsIntersect(f,k)))){b=!0;break a}}}else b=a.intersects(this);return b},getSortedSegments:function(){function a(a,b){return a.x1-b.x1}for(var b,c,d=this.components.length-1,e=new Array(d),f=0;d>f;++f)b=this.components[f],c=this.components[f+1],e[f]=b.x<c.x?{x1:b.x,y1:b.y,x2:c.x,y2:c.y}:{x1:c.x,y1:c.y,x2:b.x,y2:b.y};return e.sort(a)},splitWithSegment:function(a,b){for(var c,d,e,f,g,h=!(b&&b.edge===!1),i=b&&b.tolerance,j=[],k=this.getVertices(),l=[],m=[],n=!1,o={point:!0,tolerance:i},p=null,q=0,r=k.length-2;r>=q;++q)if(c=k[q],l.push(c.clone()),d=k[q+1],g={x1:c.x,y1:c.y,x2:d.x,y2:d.y},e=OpenLayers.Geometry.segmentsIntersect(a,g,o),e instanceof OpenLayers.Geometry.Point&&(f=e.x===a.x1&&e.y===a.y1||e.x===a.x2&&e.y===a.y2||e.equals(c)||e.equals(d)?!0:!1,f||h)){if(e.equals(m[m.length-1])||m.push(e.clone()),0===q&&e.equals(c))continue;
if(e.equals(d))continue;n=!0,e.equals(c)||l.push(e),j.push(new OpenLayers.Geometry.LineString(l)),l=[e.clone()]}if(n&&(l.push(d.clone()),j.push(new OpenLayers.Geometry.LineString(l))),m.length>0){var s=a.x1<a.x2?1:-1,t=a.y1<a.y2?1:-1;p={lines:j,points:m.sort(function(a,b){return s*a.x-s*b.x||t*a.y-t*b.y})}}return p},split:function(a,b){var c,d,e,f,g=null,h=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){var i,j,k,l,m,n,o=this.getVertices(),p=[];e=[];for(var q=0,r=o.length-2;r>=q;++q){i=o[q],j=o[q+1],k={x1:i.x,y1:i.y,x2:j.x,y2:j.y},f=f||[a],h&&p.push(i.clone());for(var s=0;s<f.length;++s)if(l=f[s].splitWithSegment(k,b),l&&(m=l.lines,m.length>0&&(m.unshift(s,1),Array.prototype.splice.apply(f,m),s+=m.length-2),h))for(var t=0,u=l.points.length;u>t;++t)n=l.points[t],n.equals(i)||(p.push(n),e.push(new OpenLayers.Geometry.LineString(p)),p=n.equals(j)?[]:[n.clone()])}h&&e.length>0&&p.length>0&&(p.push(j.clone()),e.push(new OpenLayers.Geometry.LineString(p)))}else g=a.splitWith(this,b);return f&&f.length>1?d=!0:f=[],e&&e.length>1?c=!0:e=[],(d||c)&&(g=h?[e,f]:f),g},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){var b;return b=a===!0?[this.components[0],this.components[this.components.length-1]]:a===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,b){var c,d=!(b&&b.edge===!1),e=d&&b&&b.details,f={},g=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){for(var h,i=this.getSortedSegments(),j=a.x,k=a.y,l=0,m=i.length;m>l;++l)if(h=i[l],c=OpenLayers.Geometry.distanceToSegment(a,h),c.distance<g){if(g=c.distance,f=c,0===g)break}else if(h.x2>j&&(k>h.y1&&k<h.y2||k<h.y1&&k>h.y2))break;f=e?{distance:f.distance,x0:f.x,y0:f.y,x1:j,y1:k}:f.distance}else if(a instanceof OpenLayers.Geometry.LineString){var n,o,p,q,r,s=this.getSortedSegments(),t=a.getSortedSegments(),u=t.length,v={point:!0};a:for(var l=0,m=s.length;m>l;++l){n=s[l],q=n.x1,r=n.y1;for(var w=0;u>w;++w){if(o=t[w],p=OpenLayers.Geometry.segmentsIntersect(n,o,v)){g=0,f={distance:0,x0:p.x,y0:p.y,x1:p.x,y1:p.y};break a}c=OpenLayers.Geometry.distanceToSegment({x:q,y:r},o),c.distance<g&&(g=c.distance,f={distance:g,x0:q,y0:r,x1:c.x,y1:c.y})}}if(e||(f=f.distance),0!==g&&n){c=a.distanceTo(new OpenLayers.Geometry.Point(n.x2,n.y2),b);var x=e?c.distance:c;g>x&&(f=e?{distance:g,x0:c.x1,y0:c.y1,x1:c.x0,y1:c.y0}:x)}}else f=a.distanceTo(this,b),e&&(f={distance:f.distance,x0:f.x1,y0:f.y1,x1:f.x0,y1:f.y0});return f},simplify:function(a){if(this&&null!==this){var b=this.getVertices();if(b.length<3)return this;var c=function(a,b){return a-b},d=function(a,b,c,f){for(var g,i=0,j=0,k=b;c>k;k++)g=e(a[b],a[c],a[k]),g>i&&(i=g,j=k);i>f&&j!=b&&(h.push(j),d(a,b,j,f),d(a,j,c,f))},e=function(a,b,c){var d=Math.abs(.5*(a.x*b.y+b.x*c.y+c.x*a.y-b.x*a.y-c.x*b.y-a.x*c.y)),e=Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)),f=d/e*2;return f},f=0,g=b.length-1,h=[];for(h.push(f),h.push(g);b[f].equals(b[g]);)g--,h.push(g);d(b,f,g,a);var i=[];h.sort(c);for(var j=0;j<h.length;j++)i.push(b[h[j]]);return new OpenLayers.Geometry.LineString(i)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(a,b){var c=!1,d=this.components.pop();null==b&&a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var e=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[e]),c},removeComponent:function(){var a=this.components&&this.components.length>3;if(a){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b])}return a},move:function(a,b){for(var c=0,d=this.components.length;d-1>c;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;d-1>c;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;e-1>d;++d)this.components[d].resize(a,b,c);return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;d-1>c;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},getCentroid:function(){if(this.components){var a=this.components.length;if(a>0&&2>=a)return this.components[0].clone();if(a>2){var b=0,c=0,d=this.components[0].x,e=this.components[0].y,f=-1*this.getArea();if(0!=f){for(var g=0;a-1>g;g++){var h=this.components[g],i=this.components[g+1];b+=(h.x+i.x-2*d)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e)),c+=(h.y+i.y-2*e)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e))}var j=d+b/(6*f),k=e+c/(6*f)}else{for(var g=0;a-1>g;g++)b+=this.components[g].x,c+=this.components[g].y;var j=b/(a-1),k=c/(a-1)}return new OpenLayers.Geometry.Point(j,k)}return null}},getArea:function(){var a=0;if(this.components&&this.components.length>2){for(var b=0,c=0,d=this.components.length;d-1>c;c++){var e=this.components[c],f=this.components[c+1];b+=(e.x+f.x)*(f.y-e.y)}a=-b/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}var d=0,e=b.components&&b.components.length;if(e>2){for(var f,g,h=0;e-1>h;h++)f=b.components[h],g=b.components[h+1],d+=OpenLayers.Util.rad(g.x-f.x)*(2+Math.sin(OpenLayers.Util.rad(f.y))+Math.sin(OpenLayers.Util.rad(g.y)));d=6378137*d*6378137/2}return d},containsPoint:function(a){function b(a,b,c,d,e){return(a-e)*((d-b)/(e-c))+d}for(var c,d,e,f,g,h,i,j=OpenLayers.Number.limitSigDigs,k=14,l=j(a.x,k),m=j(a.y,k),n=this.components.length-1,o=0,p=0;n>p;++p)if(c=this.components[p],e=j(c.x,k),f=j(c.y,k),d=this.components[p+1],g=j(d.x,k),h=j(d.y,k),f!=h){if(i=j(b(m,e,f,g,h),k),i==l&&(h>f&&m>=f&&h>=m||f>h&&f>=m&&m>=h)){o=-1;break}l>=i||e!=g&&(i<Math.min(e,g)||i>Math.max(e,g))||(h>f&&m>=f&&h>m||f>h&&f>m&&m>=h)&&++o}else if(m==f&&(g>=e&&l>=e&&g>=l||e>=g&&e>=l&&l>=g)){o=-1;break}var q=-1==o?1:!!(1&o);return q},intersects:function(a){var b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=a.intersects(this);else if("OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;d>c&&!(b=a.components[c].intersects(this));++c);return b},getVertices:function(a){return a===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var a=0;if(this.components&&this.components.length>0){a+=Math.abs(this.components[0].getArea());for(var b=1,c=this.components.length;c>b;b++)a-=Math.abs(this.components[b].getArea())}return a},getGeodesicArea:function(a){var b=0;if(this.components&&this.components.length>0){b+=Math.abs(this.components[0].getGeodesicArea(a));for(var c=1,d=this.components.length;d>c;c++)b-=Math.abs(this.components[c].getGeodesicArea(a))}return b},containsPoint:function(a){var b=this.components.length,c=!1;if(b>0&&(c=this.components[0].containsPoint(a),1!==c&&c&&b>1))for(var d,e=1;b>e;++e)if(d=this.components[e].containsPoint(a)){c=1===d?1:!1;break}return c},intersects:function(a){var b,c,d=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)d=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(b=0,c=this.components.length;c>b&&!(d=a.intersects(this.components[b]));++b);if(!d)for(b=0,c=a.components.length;c>b&&!(d=this.containsPoint(a.components[b]));++b);}else for(b=0,c=a.components.length;c>b&&!(d=this.intersects(a.components[b]));++b);if(!d&&"OpenLayers.Geometry.Polygon"==a.CLASS_NAME){var e=this.components[0];for(b=0,c=e.components.length;c>b&&!(d=a.containsPoint(e.components[b]));++b);}return d},distanceTo:function(a,b){var c,d=!(b&&b.edge===!1);return c=!d&&this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-.5);d&&(e+=d/180*Math.PI);for(var f,g,h,i=[],j=0;c>j;++j)f=e+2*j*Math.PI/c,g=a.x+b*Math.cos(f),h=a.y+b*Math.sin(f),i.push(new OpenLayers.Geometry.Point(g,h));var k=new OpenLayers.Geometry.LinearRing(i);return new OpenLayers.Geometry.Polygon([k])},OpenLayers.Geometry.Polygon.createEllipsePolygion=function(a,b,c,d,e){var f=this.createRegularPolygon(a,c,d),g=b/c;return f.resize(1,a,g),f.rotate(e,a),f},OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(a,b){for(var c,d,e,f,g,h=null,i=b&&b.mutual,j=[],k=[a],l=0,m=this.components.length;m>l;++l){d=this.components[l],f=!1;for(var n=0;n<k.length;++n)if(c=d.split(k[n],b)){if(i){e=c[0];for(var o=0,p=e.length;p>o;++o)0===o&&j.length?j[j.length-1].addComponent(e[o]):j.push(new OpenLayers.Geometry.MultiLineString([e[o]]));f=!0,c=c[1]}if(c.length){c.unshift(n,1),Array.prototype.splice.apply(k,c);break}}f||(j.length?j[j.length-1].addComponent(d.clone()):j=[new OpenLayers.Geometry.MultiLineString(d.clone())])}return j&&j.length>1?f=!0:j=[],k&&k.length>1?g=!0:k=[],(f||g)&&(h=i?[j,k]:k),h},splitWith:function(a,b){var c,d,e,f,g,h,i,j=null,k=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){i=[],h=[a];for(var l=0,m=this.components.length;m>l;++l){g=!1,d=this.components[l];for(var n=0;n<h.length;++n)if(c=h[n].split(d,b)){k&&(e=c[0],e.length&&(e.unshift(n,1),Array.prototype.splice.apply(h,e),n+=e.length-2),c=c[1],0===c.length&&(c=[d.clone()]));for(var o=0,p=c.length;p>o;++o)0===o&&i.length?i[i.length-1].addComponent(c[o]):i.push(new OpenLayers.Geometry.MultiLineString([c[o]]));g=!0}g||(i.length?i[i.length-1].addComponent(d.clone()):i=[new OpenLayers.Geometry.MultiLineString([d.clone()])])}}else j=a.split(this);return h&&h.length>1?f=!0:h=[],i&&i.length>1?g=!0:i=[],(f||g)&&(j=k?[h,i]:i),j},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a),OpenLayers.Util.extend(this,b)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(a,b){if(this.extent=a.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var c=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)}return b&&(this.resolution=null),!0},setSize:function(a){this.size=a.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(a,b){if(null==b&&(b=a.style),a.geometry){var c=a.geometry.getBounds();if(c){var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent()),c.intersectsBounds(this.extent,{worldBounds:d})?this.calculateFeatureDx(c,d):b={display:"none"};var e=this.drawGeometry(a.geometry,b,a.id);if("none"!=b.display&&b.label&&e!==!1){var f=a.geometry.getCentroid();if(b.labelXOffset||b.labelYOffset){var g=isNaN(b.labelXOffset)?0:b.labelXOffset,h=isNaN(b.labelYOffset)?0:b.labelYOffset,i=this.getResolution();f.move(g*i,h*i)}this.drawText(a.id,b,f,a.geometry.id)}else this.removeText(a.id);return e}}},calculateFeatureDx:function(a,b){if(this.featureDx=0,b){var c=b.getWidth(),d=(this.extent.left+this.extent.right)/2,e=(a.left+a.right)/2,f=Math.round((e-d)/c);this.featureDx=f*c}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;c>b;++b){var d=a[b];this.eraseGeometry(d.geometry,d.id),this.removeText(d.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(a){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return a.stroke===!1&&(delete b.strokeWidth,delete b.strokeColor),a.fill===!1&&delete b.fillColor,OpenLayers.Util.extend(b,a),b},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var c,d=-1,e=this.order.length;e-d>1;){c=parseInt((d+e)/2);var f=this.compare(this,a,OpenLayers.Util.getElement(this.order[c]));f>0?d=c:e=c}return this.order.splice(e,0,b),this.indices[b]=this.getZIndex(a),this.getNextElement(e)},remove:function(a){var b=a.id,c=OpenLayers.Util.indexOf(this.order,b);if(c>=0)if(this.order.splice(c,1),delete this.indices[b],this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(a){return null!=this.indices[a.id]},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;null==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b>this.maxZIndex&&(this.maxZIndex=b)},getNextElement:function(a){var b=a+1;if(b<this.order.length){var c=OpenLayers.Util.getElement(this.order[b]);return void 0==c&&(c=this.getNextElement(b)),c}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){var d=a.getZIndex(b),e=0;if(c){var f=a.getZIndex(c);e=d-f}return e},Z_ORDER_DRAWING_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);return c&&0==d&&(d=1),d},Z_ORDER_Y_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&0===d){var e=c._boundsBottom-b._boundsBottom;d=0===e?1:e}return d}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.vectorRoot,this.root.appendChild(this.vectorRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),b&&(b.zIndexing||b.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&&this.indexer.clear()},setExtent:function(a,b){var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var e,f=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/f),g=this.map.getMaxExtent();g.right>a.left&&g.right<a.right?e=!0:g.left>a.left&&g.left<a.right&&(e=!1),(e!==this.rightOfDateLine||b)&&(c=!1,this.xOffset=e===!0?g.getWidth()/d:0),this.rightOfDateLine=e}return c},getNodeType:function(){},drawGeometry:function(a,b,c){var d=a.CLASS_NAME,e=!0;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d){for(var f=0,g=a.components.length;g>f;f++)e=this.drawGeometry(a.components[f],b,c)&&e;return e}e=!1;var h=!1;if("none"!=b.display&&(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):h=!0,a instanceof OpenLayers.Geometry.Point&&(b.strokeDashstyle="solid"),e=this.redrawNode(a.id,a,b,c)),0==e){var i=document.getElementById(a.id);i&&(i._style.backgroundGraphic&&(h=!0),i.parentNode.removeChild(i))}if(h){var i=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX);i&&i.parentNode.removeChild(i)}return e},redrawNode:function(a,b,c,d){c=this.applyDefaultSymbolizer(c);var e=this.nodeFactory(a,this.getNodeType(b,c));e._featureId=d,e._boundsBottom=b.getBounds().bottom,e._geometryClass=b.CLASS_NAME,e._style=c;var f=this.drawGeometryNode(e,b,c);if(f===!1)return!1;if(e=f.node,this.indexer){var g=this.indexer.insert(e);g?this.vectorRoot.insertBefore(e,g):this.vectorRoot.appendChild(e)}else e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e);return this.postDraw(e),f.complete},redrawBackgroundNode:function(a,b,c){var d=OpenLayers.Util.extend({},c);return d.externalGraphic=d.backgroundGraphic,d.graphicXOffset=d.backgroundXOffset,d.graphicYOffset=d.backgroundYOffset,d.graphicZIndex=d.backgroundGraphicZIndex,d.graphicWidth=d.backgroundWidth||d.graphicWidth,d.graphicHeight=d.backgroundHeight||d.graphicHeight,d.backgroundGraphic=null,d.backgroundXOffset=null,d.backgroundYOffset=null,d.backgroundGraphicZIndex=null,this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,d,null)},drawGeometryNode:function(a,b,c){c=c||a._style;var d,e={isFilled:void 0===c.fill?!0:c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke};switch(b.CLASS_NAME){case"OpenLayers.Geometry.Point":c.graphic===!1&&(e.isFilled=!1,e.isStroked=!1),d=this.drawPoint(a,b);break;case"OpenLayers.Geometry.LineString":e.isFilled=!1,d=this.drawLineString(a,b);break;case"OpenLayers.Geometry.LinearRing":d=this.drawLinearRing(a,b);break;case"OpenLayers.Geometry.Polygon":d=this.drawPolygon(a,b);break;case"OpenLayers.Geometry.Rectangle":d=this.drawRectangle(a,b)}return a._options=e,0!=d?{node:this.setStyle(a,c,e,b),complete:d}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&&this.textRoot.removeChild(b);var c=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX);c&&this.textRoot.removeChild(c);var d=document.getElementById(a+this.LABEL_ID_SUFFIX+"_rect");d&&this.textRoot.removeChild(d)},getFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement,d=c?c:b||a.srcElement;return d?d._featureId:a.feature.geometry.id},eraseGeometry:function(a,b){if("OpenLayers.Geometry.MultiPoint"==a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==a.CLASS_NAME||"OpenLayers.Geometry.Collection"==a.CLASS_NAME)for(var c=0,d=a.components.length;d>c;c++)this.eraseGeometry(a.components[c],b);else{var e=OpenLayers.Util.getElement(a.id);if(e&&e.parentNode&&(e.geometry&&(e.geometry.destroy(),e.geometry=null),e.parentNode.removeChild(e),this.indexer&&this.indexer.remove(e),e._style.backgroundGraphic)){var f=a.id+this.BACKGROUND_ID_SUFFIX,g=OpenLayers.Util.getElement(f);g&&g.parentNode&&g.parentNode.removeChild(g)}}},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);return c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a),c},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(a){var b=this.root;a.root.parentNode==this.rendererRoot&&(b=a.root),b.parentNode.removeChild(b),a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return"circle"!=a&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e5,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1"))},inValidRange:function(a,b,c){var d=a+(c?0:this.translationParameters.x),e=b+(c?0:this.translationParameters.y);return d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,f=a.top/d;if(b){this.left=e,this.top=f;var g="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",g),this.translate(this.xOffset,0),!0}var h=this.translate(e-this.left+this.xOffset,f-this.top);return h||this.setExtent(a,!0),c&&h},translate:function(a,b){if(this.inValidRange(a,b,!0)){var c="";return(a||b)&&(c="translate("+a+","+b+")"),this.root.setAttributeNS(null,"transform",c),this.translationParameters={x:a,y:b},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":c="rect";break;case"OpenLayers.Geometry.LineString":c="polyline";break;case"OpenLayers.Geometry.LinearRing":c="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="path"}return c},setStyle:function(a,b,c){b=b||a._style,c=c||a._options;var d=b.title||b.graphicTitle;if(d){a.setAttributeNS(null,"title",d);var e=a.getElementsByTagName("title");if(e.length>0)e[0].firstChild.textContent=d;else{var f=this.nodeFactory(null,"title");f.textContent=d,a.appendChild(f)}}var g,h=parseFloat(a.getAttributeNS(null,"r")),i=1;if("OpenLayers.Geometry.Point"==a._geometryClass&&h){if(a.style.visibility="",b.graphic===!1)a.style.visibility="hidden";else if(b.externalGraphic){g=this.getPosition(a),b.graphicWidth&&b.graphicHeight&&a.setAttributeNS(null,"preserveAspectRatio","none");var j=b.graphicWidth||b.graphicHeight,k=b.graphicHeight||b.graphicWidth;j=j?j:2*b.pointRadius,k=k?k:2*b.pointRadius;var l=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*j),m=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*k),n=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(g.x+l).toFixed()),a.setAttributeNS(null,"y",(g.y+m).toFixed()),a.setAttributeNS(null,"width",j),a.setAttributeNS(null,"height",k),a.setAttributeNS(this.xlinkns,"xlink:href",b.externalGraphic),a.setAttributeNS(null,"style","opacity: "+n),a.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(b.graphicName)){var o=3*b.pointRadius,p=2*o,q=this.importSymbol(b.graphicName);g=this.getPosition(a),i=3*this.symbolMetrics[q.id][0]/p;var r=a.parentNode,s=a.nextSibling;r&&r.removeChild(a),a.firstChild&&a.removeChild(a.firstChild),a.appendChild(q.firstChild.cloneNode(!0)),a.setAttributeNS(null,"viewBox",q.getAttributeNS(null,"viewBox")),a.setAttributeNS(null,"width",p),a.setAttributeNS(null,"height",p),a.setAttributeNS(null,"x",g.x-o),a.setAttributeNS(null,"y",g.y-o),s?r.insertBefore(a,s):r&&r.appendChild(a)}else a.setAttributeNS(null,"r",b.pointRadius);var t=b.rotation;if((void 0!==t||void 0!==a._rotation)&&g)if(a._rotation=t,t|=0,"svg"!==a.nodeName)a.setAttributeNS(null,"transform","rotate("+t+" "+g.x+" "+g.y+")");else{var u=this.symbolMetrics[q.id];a.firstChild.setAttributeNS(null,"transform","rotate("+t+" "+u[1]+" "+u[2]+")")}}return c.isFilled?(a.setAttributeNS(null,"fill",b.fillColor),a.setAttributeNS(null,"fill-opacity",b.fillOpacity)):a.setAttributeNS(null,"fill","none"),c.isStroked?(a.setAttributeNS(null,"stroke",b.strokeColor),a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity),a.setAttributeNS(null,"stroke-width",b.strokeWidth*i),a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap||"round"),a.setAttributeNS(null,"stroke-linejoin","round"),b.strokeDashstyle&&a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,i))):a.setAttributeNS(null,"stroke","none"),b.pointerEvents&&a.setAttributeNS(null,"pointer-events",b.pointerEvents),null!=b.cursor&&a.setAttributeNS(null,"cursor",b.cursor),a},dashStyle:function(a,b){var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d){case"solid":return"none";case"dot":return[1,4*c].join();case"dash":return[4*c,4*c].join();case"dashdot":return[4*c,4*c,1,4*c].join();case"longdash":return[8*c,4*c].join();case"longdashdot":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,b){var c=document.createElementNS(this.xmlns,a);return b&&c.setAttributeNS(null,"id",b),c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+"_svgRoot","svg");return a.style.display="block",a},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(a),a},drawPoint:function(a,b){return this.MAX_PIXEL=15e3,this.drawCircle(a,b,1)},drawCircle:function(a,b,c){this.MAX_PIXEL=15e5;var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left,f=this.top-b.y/d;return this.inValidRange(e,f)?(a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",f),a.setAttributeNS(null,"r",c),a):!1},drawLineString:function(a,b){this.MAX_PIXEL=15e3;var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1},drawLinearRing:function(a,b){this.MAX_PIXEL=15e3;var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1},drawPolygon:function(a,b){this.MAX_PIXEL=15e5;for(var c,d,e="",f=!0,g=!0,h=0,i=b.components.length;i>h;h++)e+=" M",c=this.getComponentsString(b.components[h].components," "),d=c.path,d?(e+=" "+d,g=c.complete&&g):f=!1;return e+=" z",f?(a.setAttributeNS(null,"d",e),a.setAttributeNS(null,"fill-rule","evenodd"),g?a:null):!1},drawRectangle:function(a,b){this.MAX_PIXEL=15e5;var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return this.inValidRange(d,e)?(a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"width",b.width/c),a.setAttributeNS(null,"height",b.height/c),a):!1},drawText:function(a,b,c,d){this.MAX_PIXEL=15e3;var e=!!b.labelOutlineWidth;if(e){var f=OpenLayers.Util.extend({},b);f.fontColor=f.labelOutlineColor,f.fontStrokeColor=f.labelOutlineColor,f.fontStrokeWidth=b.labelOutlineWidth,b.labelOutlineOpacity&&(f.fontOpacity=b.labelOutlineOpacity),delete f.labelOutlineWidth,this.drawText(a,f,c)}var g=this.getResolution(),h=(c.x-this.featureDx)/g+this.left,i=c.y/g-this.top,j=e?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,k=this.nodeFactory(a+j,"text");k.setAttributeNS(null,"x",h),k.setAttributeNS(null,"y",-i),b.cursor&&k.setAttributeNS(null,"cursor",b.cursor),b.fontColor&&k.setAttributeNS(null,"fill",b.fontColor),b.fontStrokeColor&&k.setAttributeNS(null,"stroke",b.fontStrokeColor),b.fontStrokeWidth&&k.setAttributeNS(null,"stroke-width",b.fontStrokeWidth),b.fontOpacity&&k.setAttributeNS(null,"opacity",b.fontOpacity),b.fontFamily&&k.setAttributeNS(null,"font-family",b.fontFamily),b.fontSize&&k.setAttributeNS(null,"font-size",b.fontSize),b.fontWeight&&k.setAttributeNS(null,"font-weight",b.fontWeight),b.fontStyle&&k.setAttributeNS(null,"font-style",b.fontStyle),b.labelSelect===!0?(k.setAttributeNS(null,"pointer-events","visible"),k._featureId=a):k.setAttributeNS(null,"pointer-events","none");var l=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;k.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[l[0]]||"middle"),OpenLayers.IS_GECKO===!0&&k.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[l[1]]||"central");for(var m=b.label.split("\n"),n=m.length;k.childNodes.length>n;)k.removeChild(k.lastChild);for(var o=0;n>o;o++){var p=this.nodeFactory(a+j+"_tspan_"+o,"tspan");if(b.labelSelect===!0&&(p._featureId=a,p._geometry=c,p._geometryClass=c.CLASS_NAME),OpenLayers.IS_GECKO===!1&&p.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[l[1]]||"-35%"),p.setAttribute("x",h),0==o){var q=OpenLayers.Renderer.SVG.LABEL_VFACTOR[l[1]];null==q&&(q=-.5),p.setAttribute("dy",q*(n-1)+"em")}else p.setAttribute("dy","1em");p.textContent=""===m[o]?" ":m[o],k.appendChild(p)}if(this.textRoot.appendChild(k),d){var r=document.getElementById(d);k.parentNode&&document.getElementById(d)&&(k.parentNode.removeChild(k),this.insertAfter(k,r))}var s=k,t=s.getBBox(),u=this.nodeFactory(a+j+"_rect","rect"),v=document.getElementById(a+j+"_rect");v&&s.parentNode.removeChild(v),b.labelBackgroundColor&&(u.x.baseVal.value=t.x,u.y.baseVal.value=t.y,u.width.baseVal.value=t.width,u.height.baseVal.value=t.height,u.style.fill=b.labelBackgroundColor,s.parentNode.insertBefore(u,s))},insertAfter:function(a,b){var c=b.parentNode;c.lastChild==b?c.appendChild(a):c.insertBefore(a,b.nextSibling)},getComponentsString:function(a,b){for(var c,d,e=[],f=!0,g=a.length,h=[],i=0;g>i;i++)d=a[i],e.push(d),c=this.getShortString(d),c?h.push(c):(i>0&&this.getShortString(a[i-1])&&h.push(this.clipLine(a[i],a[i-1])),g-1>i&&this.getShortString(a[i+1])&&h.push(this.clipLine(a[i],a[i+1])),f=!1);return{path:h.join(b||","),complete:f}},clipLine:function(a,b){if(b.equals(a))return"";var c,d=this.getResolution(),e=this.MAX_PIXEL-this.translationParameters.x,f=this.MAX_PIXEL-this.translationParameters.y,g=(b.x-this.featureDx)/d+this.left,h=this.top-b.y/d,i=(a.x-this.featureDx)/d+this.left,j=this.top-a.y/d;return(-e>i||i>e)&&(c=(j-h)/(i-g),i=0>i?-e:e,j=h+(i-g)*c),(-f>j||j>f)&&(c=(i-g)/(j-h),j=0>j?-f:f,i=g+(j-h)*c),i+","+j},getShortString:function(a){var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left,d=this.top-a.y/b;return this.inValidRange(c,d)?c+","+d:!1},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){this.defs||(this.defs=this.createDefs());var b=this.container.id+"-"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");var e=this.nodeFactory(b,"symbol"),f=this.nodeFactory(null,"polygon");e.appendChild(f);for(var g,h,i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),j=[],k=0;k<d.length;k+=2)g=d[k],h=d[k+1],i.left=Math.min(i.left,g),i.bottom=Math.min(i.bottom,h),i.right=Math.max(i.right,g),i.top=Math.max(i.top,h),j.push(g,",",h);f.setAttributeNS(null,"points",j.join(" "));var l=i.getWidth(),m=i.getHeight(),n=[i.left-l,i.bottom-m,3*l,3*m];return e.setAttributeNS(null,"viewBox",n.join(" ")),this.symbolMetrics[b]=[Math.max(l,m),i.getCenterLonLat().lon,i.getCenterLonLat().lat],this.defs.appendChild(e),e},getFeatureIdFromEvent:function(a){var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);
if(!b){var c=a.target;b=c.parentNode&&c!=this.rendererRoot?c.parentNode._featureId:void 0}return b},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(a){OpenLayers.Event.preventDefault(a)},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(a,b){this.eraseFeatures(this.features[b][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(a){this.size=a.clone();var b=this.root;if(b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h,this.resolution=null,this.hitDetection){var c=this.hitCanvas;c.style.width=a.w+"px",c.style.height=a.h+"px",c.width=a.w,c.height=a.h}},drawFeature:function(a,b){var c;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style);var d,e=a.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent());var f=e&&e.intersectsBounds(this.extent,{worldBounds:d});c="none"!==b.display&&!!e&&f,c?this.features[a.id]=[a,b]:delete this.features[a.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),c},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=d&&"OpenLayers.Geometry.MultiPoint"!=d&&"OpenLayers.Geometry.MultiLineString"!=d&&"OpenLayers.Geometry.MultiPolygon"!=d)switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(a,b,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(a,b,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(a,b,c)}else for(var e=0;e<a.components.length;e++)this.drawGeometry(a.components[e],b,c)},drawExternalGraphic:function(a,b,c){var d=new Image,e=b.title||b.graphicTitle;e&&(d.title=e);var f=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth;f=f?f:2*b.pointRadius,g=g?g:2*b.pointRadius;var h=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*f),i=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*g),j=b.graphicOpacity||b.fillOpacity,k=function(){if(this.features[c]){var b=this.getLocalXY(a),e=b[0],k=b[1];if(!isNaN(e)&&!isNaN(k)){var l=e+h|0,m=k+i|0,n=this.canvas;n.globalAlpha=j;var o=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);n.drawImage(d,l*o,m*o,f*o,g*o),this.hitDetection&&(this.setHitContextStyle("fill",c),this.hitContext.fillRect(l,m,f,g))}}};d.onload=OpenLayers.Function.bind(k,this),d.src=b.externalGraphic},drawNamedSymbol:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=Math.PI/180,n=OpenLayers.Renderer.symbol[b.graphicName];if(!n)throw new Error(b.graphicName+" is not a valid symbol name");if(n.length&&!(n.length<2)){var o=this.getLocalXY(a),p=o[0],q=o[1];if(!isNaN(p)&&!isNaN(q)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),b.graphicName in this.cachedSymbolBounds)i=this.cachedSymbolBounds[b.graphicName];else{for(i=new OpenLayers.Bounds,h=0;h<n.length;h+=2)i.extend(new OpenLayers.LonLat(n[h],n[h+1]));this.cachedSymbolBounds[b.graphicName]=i}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(p,q),this.hitDetection&&this.hitContext.translate(p,q),k=m*b.rotation,isNaN(k)||(this.canvas.rotate(k),this.hitDetection&&this.hitContext.rotate(k)),j=2*b.pointRadius/Math.max(i.getWidth(),i.getHeight()),this.canvas.scale(j,j),this.hitDetection&&this.hitContext.scale(j,j),f=i.getCenterLonLat().lon,g=i.getCenterLonLat().lat,this.canvas.translate(-f,-g),this.hitDetection&&this.hitContext.translate(-f,-g),l=b.strokeWidth,b.strokeWidth=l/j,b.fill!==!1){for(this.setCanvasStyle("fill",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.fill()}}if(b.stroke!==!1){for(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",c,b,j),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.stroke()}}b.strokeWidth=l,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(a,b){"fill"===a?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):"stroke"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(a){var b=Number(a.split("_").pop())+1;b>=16777216&&(this.hitOverflow=b-16777215,b=b%16777216+1);var c="000000"+b.toString(16),d=c.length;return c="#"+c.substring(d-6,d)},setHitContextStyle:function(a,b,c,d){var e=this.featureIdToHex(b);"fill"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=e):"stroke"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=e,"undefined"==typeof d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(a,b,c){if(b.graphic!==!1)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&&"circle"!=b.graphicName)this.drawNamedSymbol(a,b,c);else{var d=this.getLocalXY(a),e=d[0],f=d[1];if(!isNaN(e)&&!isNaN(f)){var g=2*Math.PI,h=b.pointRadius;b.fill!==!1&&(this.setCanvasStyle("fill",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.fill())),b.stroke!==!1&&(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(a,b,c){b=OpenLayers.Util.applyDefaults({fill:!1},b),this.drawLinearRing(a,b,c)},drawLinearRing:function(a,b,c){b.fill!==!1&&(this.setCanvasStyle("fill",b),this.renderPath(this.canvas,a,b,c,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.renderPath(this.hitContext,a,b,c,"fill"))),b.stroke!==!1&&(this.setCanvasStyle("stroke",b),this.renderPath(this.canvas,a,b,c,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.renderPath(this.hitContext,a,b,c,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(a,b,c,d,e){var f=b.components,g=f.length;a.beginPath();var h=this.getLocalXY(f[0]),i=h[0],j=h[1];if(!isNaN(i)&&!isNaN(j)){a.moveTo(h[0],h[1]);for(var k=1;g>k;++k){var l=this.getLocalXY(f[k]);a.lineTo(l[0],l[1])}"fill"===e?a.fill():a.stroke()}},drawPolygon:function(a,b,c){var d=a.components,e=d.length;this.drawLinearRing(d[0],b,c);for(var f=1;e>f;++f)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},b),c),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({fill:!1},b),c)},drawText:function(a,b){var c=this.getLocalXY(a);this.setCanvasStyle("reset"),this.canvas.fillStyle=b.fontColor,this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" "),e=b.label.split("\n"),f=e.length;if(this.canvas.fillText){this.canvas.font=d,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;c[1]+=h*g*(f-1);for(var i=0;f>i;i++)b.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=b.labelOutlineOpacity||b.fontOpacity||1,this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[i],c[0],c[1]+h*i+1),this.canvas.restore()),this.canvas.fillText(e[i],c[0],c[1]+h*i)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var j=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];null==j&&(j=-.5);var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.mozMeasureText("xx");c[1]+=h*(1+g*f);for(var i=0;f>i;i++){var k=c[0]+j*this.canvas.mozMeasureText(e[i]),l=c[1]+i*h;this.canvas.translate(k,l),this.canvas.mozDrawText(e[i]),this.canvas.translate(-k,-l)}}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent,d=(a.x-this.featureDx)/b+-c.left/b,e=c.top/b-a.y/b;return[d,e]},clear:function(){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,b,a)},getFeatureIdFromEvent:function(a){var b,c;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var d=a.xy,e=0|d.x,f=0|d.y,g=this.hitContext.getImageData(e,f,1,1).data;if(255===g[3]){var h=g[2]+256*(g[1]+256*g[0]);if(h){b="OpenLayers_Feature_Vector_"+(h-1+this.hitOverflow);try{c=this.features[b][0]}catch(i){}}}}return c},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];this.redraw()},redraw:function(){if(!this.locked){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.hitDetection&&this.hitContext.clearRect(0,0,b,a);var c,d,e,f=[],g=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var h in this.features)this.features.hasOwnProperty(h)&&(c=this.features[h][0],d=c.geometry,this.calculateFeatureDx(d.getBounds(),g),e=this.features[h][1],this.drawGeometry(d,e,c.id),e.label&&f.push([c,e]));for(var i,j=0,k=f.length;k>j;++j)i=f[j],this.drawText(i[0].geometry.getCentroid(),i[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var a=document.createStyleSheet(),b=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],c=0,d=b.length;d>c;c++)a.addRule("olv\\:"+b[c],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,f=a.top/d-this.size.h|0;b||!this.offset?(this.offset={x:e,y:f},e=0,f=0):(e-=this.offset.x,f-=this.offset.y);var g=e-this.xOffset+" "+f;this.root.coordorigin=g;for(var h,i=[this.root,this.vectorRoot,this.textRoot],j=0,k=i.length;k>j;++j){h=i[j];var l=this.size.w+" "+this.size.h;h.coordsize=l}return this.root.style.flip="y",c},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var a,b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],c=this.size.w+"px",d=this.size.h+"px",e=0,f=b.length;f>e;++e)a=b[e],a.style.width=c,a.style.height=d},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":c="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="olv:shape"}return c},setStyle:function(a,b,c,d){b=b||a._style;for(var e in b)b[e]="undefined"!=b[e]?b[e]:null;c=c||a._options;var f=b.fillColor,g=b.title||b.graphicTitle;if(g&&(a.title=g),"OpenLayers.Geometry.Point"===a._geometryClass)if(b.externalGraphic){c.isFilled=!0;var h=b.graphicWidth||b.graphicHeight,i=b.graphicHeight||b.graphicWidth;h=h?h:2*b.pointRadius,i=i?i:2*b.pointRadius;var j=this.getResolution(),k=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*h),l=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*i);a.style.left=((d.x-this.featureDx)/j-this.offset.x+k|0)+"px",a.style.top=(d.y/j-this.offset.y-(l+i)|0)+"px",a.style.width=h+"px",a.style.height=i+"px",a.style.flip="y",f="none",c.isStroked=!1}else if(this.isComplexSymbol(b.graphicName)){var m=this.importSymbol(b.graphicName);a.path=m.path,a.coordorigin=m.left+","+m.bottom;var n=m.size;a.coordsize=n+","+n,this.drawCircle(a,d,b.pointRadius),a.style.flip="y"}else this.drawCircle(a,d,b.pointRadius);c.isFilled?a.fillcolor=f:a.filled="false";var o=a.getElementsByTagName("fill"),p=0==o.length?null:o[0];c.isFilled?(p||(p=this.createNode("olv:fill",a.id+"_fill")),p.opacity=b.fillOpacity,"OpenLayers.Geometry.Point"===a._geometryClass&&b.externalGraphic&&(b.graphicOpacity&&(p.opacity=b.graphicOpacity),p.src=b.externalGraphic,p.type="frame",b.graphicWidth&&b.graphicHeight||(p.aspect="atmost")),p.parentNode!=a&&a.appendChild(p)):p&&a.removeChild(p);var q=b.rotation;(void 0!==q||void 0!==a._rotation)&&(a._rotation=q,b.externalGraphic?(this.graphicRotate(a,k,l,b),p.opacity=0):"OpenLayers.Geometry.Point"===a._geometryClass&&(a.style.rotation=q||0));var r=a.getElementsByTagName("stroke"),s=0==r.length?null:r[0];return c.isStroked?(s||(s=this.createNode("olv:stroke",a.id+"_stroke"),a.appendChild(s)),s.on=!0,s.color=b.strokeColor,s.weight=b.strokeWidth+"px",s.opacity=b.strokeOpacity,s.endcap="butt"==b.strokeLinecap?"flat":b.strokeLinecap||"round",b.strokeDashstyle&&(s.dashstyle=this.dashStyle(b))):(a.stroked=!1,s&&(s.on=!1)),"inherit"!=b.cursor&&null!=b.cursor&&(a.style.cursor=b.cursor),a},graphicRotate:function(a,b,c,d){var e,f,d=d||a._style,g=d.rotation||0;if(!d.graphicWidth||!d.graphicHeight){var h=new Image;return h.onreadystatechange=OpenLayers.Function.bind(function(){("complete"==h.readyState||"interactive"==h.readyState)&&(e=h.width/h.height,f=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=e,d.graphicWidth=f*e,d.graphicHeight=f,this.graphicRotate(a,b,c,d))},this),void(h.src=d.externalGraphic)}f=Math.max(d.graphicWidth,d.graphicHeight),e=d.graphicWidth/d.graphicHeight;var i=Math.round(d.graphicWidth||f*e),j=Math.round(d.graphicHeight||f);a.style.width=i+"px",a.style.height=j+"px";var k=document.getElementById(a.id+"_image");k||(k=this.createNode("olv:imagedata",a.id+"_image"),a.appendChild(k)),k.style.width=i+"px",k.style.height=j+"px",k.src=d.externalGraphic,k.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var l=g*Math.PI/180,m=Math.sin(l),n=Math.cos(l),o="progid:DXImageTransform.Microsoft.Matrix(M11="+n+",M12="+-m+",M21="+m+",M22="+n+",SizingMethod='auto expand')\n",p=d.graphicOpacity||d.fillOpacity;p&&1!=p&&(o+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+p+")\n"),a.style.filter=o;var q=new OpenLayers.Geometry.Point(-b,-c),r=new OpenLayers.Bounds(0,0,i,j).toGeometry();d.rotation="undefined"!=d.rotation?d.rotation:0,r.rotate(d.rotation,q);var s=r.getBounds();a.style.left=Math.round(parseInt(a.style.left)+s.left)+"px",a.style.top=Math.round(parseInt(a.style.top)-s.bottom)+"px"},postDraw:function(a){a.style.visibility="visible";var b=a._style.fillColor,c=a._style.strokeColor;"none"==b&&a.fillcolor!=b&&(a.fillcolor=b),"none"==c&&a.strokecolor!=c&&(a.strokecolor=c)},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution(),e=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.width=e.getWidth()+"px",a.style.height=e.getHeight()+"px",a.coordorigin=e.left+" "+e.top,a.coordsize=e.getWidth()+" "+e.getHeight()}},dashStyle:function(a){var b=a.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:var c=b.split(/[ ,]/);return 2==c.length?1*c[0]>=2*c[1]?"longdash":1==c[0]||1==c[1]?"dot":"dash":4==c.length?1*c[0]>=2*c[1]?"longdashdot":"dashdot":"solid"}},createNode:function(a,b){var c=document.createElement(a);return b&&(c.id=b),c.unselectable="on",c.onselectstart=OpenLayers.Function.False,c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(":");-1!=d&&(c=c.substr(d+1));var e=a.nodeName;return d=e.indexOf(":"),-1!=d&&(e=e.substr(d+1)),c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+"px",a.style.top=(b.y/d-this.offset.y|0)-c+"px";var e=2*c;return a.style.width=e+"px",a.style.height=e+"px",a}return!1},drawLineString:function(a,b){return this.drawLine(a,b,!1)},drawLinearRing:function(a,b){return this.drawLine(a,b,!0)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var d,e,f,g=this.getResolution(),h=b.components.length,i=new Array(h),j=0;h>j;j++)d=b.components[j],e=(d.x-this.featureDx)/g-this.offset.x|0,f=d.y/g-this.offset.y|0,i[j]=" "+e+","+f+" l ";var k=c?" x e":" e";return a.path="m"+i.join("")+k,a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c,d,e,f,g,h,i,j,k,l,m,n,o=this.getResolution(),p=[];for(c=0,d=b.components.length;d>c;c++){for(p.push("m"),e=b.components[c].components,f=0===c,g=null,h=null,i=0,j=e.length;j>i;i++)k=e[i],m=(k.x-this.featureDx)/o-this.offset.x|0,n=k.y/o-this.offset.y|0,l=" "+m+","+n,p.push(l),0==i&&p.push(" l"),f||(g?g!=l&&(h?h!=l&&(f=!0):h=l):g=l);p.push(f?" x ":" ")}return p.push("e"),a.path=p.join(""),a},drawRectangle:function(a,b){var c=this.getResolution();return a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+"px",a.style.top=(b.y/c-this.offset.y|0)+"px",a.style.width=(b.width/c|0)+"px",a.style.height=(b.height/c|0)+"px",a},drawText:function(a,b,c){var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),f=this.getResolution();d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+"px",d.style.top=(c.y/f-this.offset.y|0)+"px",d.style.flip="y",e.innerText=b.label,"inherit"!=b.cursor&&null!=b.cursor&&(e.style.cursor=b.cursor),b.fontColor&&(e.style.color=b.fontColor),b.fontOpacity&&(e.style.filter="alpha(opacity="+100*b.fontOpacity+")"),b.fontFamily&&(e.style.fontFamily=b.fontFamily),b.fontSize&&"undefined"!=b.fontSize&&(e.style.fontSize=b.fontSize),b.fontWeight&&(e.style.fontWeight=b.fontWeight),b.fontStyle&&(e.style.fontStyle=b.fontStyle),b.labelSelect===!0&&(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME),e.style.whiteSpace="nowrap",b.labelBackgroundColor&&(e.style.backgroundColor=b.labelBackgroundColor),e.inset="1px,0px,0px,0px",d.appendChild(e),this.textRoot.appendChild(d),d.appendChild(e),this.textRoot.appendChild(d);var g=b.labelAlign||"cm";1==g.length&&(g+="m");var h=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)],i=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)];d.style.left=parseInt(d.style.left)-h-1+"px",d.style.top=parseInt(d.style.top)+i+"px"},moveRoot:function(a){var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&&(b=this.map.getLayer(this.container.id)),b&&b.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");for(var e=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),f=["m"],g=0;g<d.length;g+=2){var h=d[g],i=d[g+1];e.left=Math.min(e.left,h),e.bottom=Math.min(e.bottom,i),e.right=Math.max(e.right,h),e.top=Math.max(e.top,i),f.push(h),f.push(i),0==g&&f.push("l")}f.push("x e");var j=f.join(" "),k=(e.getWidth()-e.getHeight())/2;return k>0?(e.bottom=e.bottom-k,e.top=e.top+k):(e.left=e.left+k,e.right=e.right-k),c={path:j,size:e.getWidth(),left:e.left,bottom:e.bottom},this.symbolCache[b]=c,c},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,clicentData:{tempcluster:[]},showMarker:{},clusterVisable:!0,isClusterLayer:!1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var a=0,b=this.strategies.length;b>a;a++)this.strategies[a].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoDestroy&&a.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Vector(this.name,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a]);for(var b=this.features,c=b.length,d=new Array(c),e=0;c>e;++e)d[e]=b[e].clone();return a.features=d,a},refresh:function(a){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;b>a;a++){var c=this.renderers[a],d="function"==typeof c?c:OpenLayers.Renderer[c];if(d&&d.prototype.supported()){this.renderer=new d(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var a=this.map.getSize();a.w=a.w*this.ratio,a.h=a.h*this.ratio,this.renderer.setSize(a)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoActivate&&a.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoActivate&&a.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var a=this.map.getSize();a.w=a.w*this.ratio,a.h=a.h*this.ratio,this.renderer.setSize(a)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c){this.renderer.root.style.visibility="hidden";var e=this.map.getSize(),f=e.w,g=e.h,h=f/2*this.ratio-f/2,i=g/2*this.ratio-g/2;h+=this.map.layerContainerOriginPx.x,h=-Math.round(h),i+=this.map.layerContainerOriginPx.y,i=-Math.round(i),this.div.style.left=h+"px",this.div.style.top=i+"px";var j=this.map.getExtent().scale(this.ratio);if(d=this.renderer.setExtent(j,b),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!b&&d)for(var k in this.unrenderedFeatures){var l=this.unrenderedFeatures[k];this.drawFeature(l)}}if(!this.drawn||b||!d){this.drawn=!0;for(var l,k=0,m=this.features.length;m>k;k++)this.renderer.locked=k!==m-1,l=this.features[k],this.drawFeature(l)}},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var a=this.div.style.display;a!=this.renderer.root.style.display&&(this.renderer.root.style.display=a)},addFeatures:function(a,b){OpenLayers.Util.isArray(a)||(a=[a]);var c=!b||!b.silent;if(c){var d={features:a},e=this.events.triggerEvent("beforefeaturesadded",d);if(e===!1)return;a=d.features}for(var f=[],g=0,h=a.length;h>g;g++){this.renderer.locked=g!=a.length-1?!0:!1;var i=a[g];if(this.geometryType&&!(i.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(i.layer=this,!i.style&&this.style&&(i.style=OpenLayers.Util.extend({},this.style)),c){if(this.events.triggerEvent("beforefeatureadded",{feature:i})===!1)continue;this.preFeatureInsert(i)}f.push(i),this.features.push(i),this.drawFeature(i),c&&(this.events.triggerEvent("featureadded",{feature:i}),this.onFeatureInsert(i))}c&&this.events.triggerEvent("featuresadded",{features:f})},removeFeatures:function(a,b){if(a&&0!==a.length){if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]),a===this.selectedFeatures&&(a=a.slice());var c=!b||!b.silent;c&&this.events.triggerEvent("beforefeaturesremoved",{features:a});for(var d=a.length-1;d>=0;d--){this.renderer.locked=0!=d&&a[d-1].geometry?!0:!1;var e=a[d];if(delete this.unrenderedFeatures[e.id],c&&this.events.triggerEvent("beforefeatureremoved",{feature:e}),this.features=OpenLayers.Util.removeItem(this.features,e),e.layer=null,e.geometry&&this.renderer.eraseFeatures(e),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,e)&&OpenLayers.Util.removeItem(this.selectedFeatures,e),c&&this.events.triggerEvent("featureremoved",{feature:e}),"SVGExtended"===this.renderers[0]&&"NPMapLib.Symbols.Bubble"===e.attributes.CLASS_NAME){var f=e.data;f._stopAnimate()}}c&&this.events.triggerEvent("featuresremoved",{features:a})}},removeAllFeatures:function(a){var b=!a||!a.silent,c=this.features;b&&this.events.triggerEvent("beforefeaturesremoved",{features:c});for(var d,e=c.length-1;e>=0;e--)d=c[e],b&&this.events.triggerEvent("beforefeatureremoved",{feature:d}),d.layer=null,b&&this.events.triggerEvent("featureremoved",{feature:d});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],b&&this.events.triggerEvent("featuresremoved",{features:c})},destroyFeatures:function(a,b){var c=void 0==a;if(c&&(a=this.features),a){this.removeFeatures(a,b);for(var d=a.length-1;d>=0;d--)a[d].destroy()}},drawFeature:function(a,b){if(this.drawn){if("object"!=typeof b){b||a.state!==OpenLayers.State.DELETE||(b="delete");var c=b||a.renderIntent;b=a.style||this.style,b||(b=this.styleMap.createSymbolizer(a,c))}var d=this.renderer.drawFeature(a,b);a.style=b,d===!1||null===d?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id],this.openBubbleAnimate(a)}},openBubbleAnimate:function(a){if("SVGExtended"===this.renderers[0]&&"NPMapLib.Symbols.Bubble"===a.attributes.CLASS_NAME){var b=a.data,c=a.geometry.id;b._stopAnimate(),b._animate(c)}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var b=null,c=a.clientX,d=a.clientY;if(target=document.elementFromPoint(c,d),"circle"===target.nodeName||"path"===target.nodeName){var e,f;"circle"===target.nodeName&&(e=target.parentNode.parentNode.parentNode),"path"===target.nodeName&&(e=target.parentNode.parentNode),f=e.getAttributeNS(null,"type"),e&&f&&"bubble"===f&&(target=e)}var g=target?target._featureId:void 0;if(g&&(b="string"==typeof g?this.getFeatureById(g):g),NPMapLib.isAnimat)return b;if(!b&&a.xy){var h=a.xy.x-5,i=a.xy.y-5,j=a.xy.x+5,k=a.xy.y+5,l=new OpenLayers.Pixel(h,i),m=new OpenLayers.Pixel(j,k),n=this.map.getLonLatFromViewPortPx(l),o=this.map.getLonLatFromViewPortPx(m);if(!n||!o)return b;var p=new OpenLayers.Geometry.Point(n.lon,n.lat),q=new OpenLayers.Geometry.Point(n.lon,o.lat),r=new OpenLayers.Geometry.Point(o.lon,o.lat),s=new OpenLayers.Geometry.Point(o.lon,n.lat),t=[p,q,r,s],u=new OpenLayers.Geometry.LinearRing(t),v=new OpenLayers.Geometry.Polygon(u),w=this.getFeaturesByGeometry(v);w.length>0&&(b=w[w.length-1])}return b},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;e>d;++d)if(this.features[d][a]==b){c=this.features[d];break}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},getFeaturesByGeometry:function(a){var b,c,d=this.features.length,e=[];for(b=0;d>b;b++)c=this.features[b],c&&c.geometry&&"OpenLayers.Geometry.LineString"===c.geometry.CLASS_NAME&&c.geometry.intersects(a)&&e.push(c);return e},getFeaturesByAttribute:function(a,b){var c,d,e=this.features.length,f=[];for(c=0;e>c;c++)d=this.features[c],d&&d.attributes&&d.attributes[a]===b&&f.push(d);return f},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var a=null,b=this.features;if(b&&b.length>0)for(var c=null,d=0,e=b.length;e>d;d++)c=b[d].geometry,c&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(a){for(var b,c=this.layers,d=0;d<c.length;d++)if(b=c[d].getFeatureFromEvent(a))return b},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b)a=this.map.layers[b],-1!=OpenLayers.Util.indexOf(this.layers,a)&&a.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b)a=this.layers[b],this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)},handleChangeLayer:function(a){var b=a.layer;"order"==a.property&&-1!=OpenLayers.Util.indexOf(this.layers,b)&&(this.resetRoots(),this.collectRoots())
},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(a){this.layer=a},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,zoomstart:this.clearCluster,scope:this}),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,zoomstart:this.clearCluster,scope:this});{this.layer.map}}return a},cacheFeatures:function(a){var b=!0;return this.clustering||(this.clearCache(),this.features=a.features,this.cluster(),b=!1),b},clearCache:function(a){this.clustering||(this.features=null)},clearCluster:function(){this.layer.removeAllFeatures()},cluster:function(a){if((!a||a.zoomChanged)&&this.features){var b=this.layer.map.getResolution();if(b!=this.resolution||!this.clustersExist()){this.resolution=b;for(var c,d,e,f=[],g=this.layer.map.getExtent(),h=0;h<this.features.length;++h){c=this.features[h];var i=c.geometry.getBounds();if((!g||g.intersectsBounds(i))&&c.geometry){d=!1;for(var j=f.length-1;j>=0;--j)if(e=f[j],this.shouldCluster(e,c)){this.addToCluster(e,c),d=!0;break}d||f.push(this.createCluster(this.features[h]))}}if(this.clustering=!0,this.layer.removeAllFeatures(),this.clustering=!1,f.length>0){if(this.threshold>1){var k=f.slice();f=[];for(var l,h=0,m=k.length;m>h;++h)l=k[h],l.attributes.count<this.threshold?Array.prototype.push.apply(f,l.cluster):f.push(l)}this.clustering=!0,this.layer.addFeatures(f),this.clustering=!1}this.clusters=f}}},clustersExist:function(){var a=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){a=!0;for(var b=0;b<this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b]){a=!1;break}}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat(),e=Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution;return e<=this.distance},addToCluster:function(a,b){a.cluster.push(b),a.sx||(a.sx=0),a.sy||(a.sy=0),a.sx+=b.geometry.x,a.sy+=b.geometry.y,a.attributes.count+=1},createCluster:function(a){var b=a.geometry.getBounds().getCenterLonLat(),c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});return c.cluster=[a],c},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Strategy.AnimatedCluster=OpenLayers.Class(OpenLayers.Strategy.Cluster,{animationMethod:OpenLayers.Easing.Expo.easeOut,animationDuration:20,animationTween:null,previousResolution:null,previousClusters:null,animating:!1,zoomIn:!0,maxZoom:null,minZoom:null,_clusterDataStatus:null,currentZoom:0,clusterClickModel:null,index:0,isAsynchronous:!0,threshold:2,_xData:[],timer:null,oldClusters:[],statistics:[],filterFun:null,minClusterCount:0,callbackFun:null,initialize:function(a){OpenLayers.Strategy.Cluster.prototype.initialize.apply(this,arguments),a.animationMethod&&(this.animationMethod=a.animationMethod)},destroy:function(){this.animationTween&&(this.animationTween.stop(),this.animationTween=null),this._clusterDataStatus=null},binarySearch:function(a,b,c){for(var d=a.length-1,e=0,f=0;d>=e;){var g,h=Math.ceil((e+d)/2);if(g="x"===c?a[h].geometry.x:a[h].geometry.y,b>g){if(e+=1,0!==f&&1!==f)return h;f=1}else{if(!(g>b))return h;if(d-=1,0!==f&&-1!=f)return h;f=-1}}return"x"==c?b<a[0].geometry.x?0:a.length-1:b<a[0].geometry.y?0:a.length-1},cluster:function(a){var b=this.layer.map.getResolution(),c=a&&"moveend"===a.type&&!a.zoomChanged;if(!this.animating||b!==this.resolution){var d=!1;if(a&&"moveend"===a.type&&a.zoomChanged&&this.currentZoom!==this.layer.map.getZoom()){if(this.oldClusters=[],null==this.features)return;d=!0,this._clusterDataStatus=this.features.slice();for(var e=0;e<this._clusterDataStatus.length;e++)this._clusterDataStatus[e]._status=!1,this._clusterDataStatus[e].style=null;this.layer.clicentData.tempcluster=[],this.layer.removeAllFeatures()}if(this.layer.map.getZoom()<this.minZoom){window.clearTimeout(this.timer),this.layer.removeAllFeatures();for(var e=0;e<this.statistics.length;e++)if(this.statistics[e]&&this.statistics[e].x&&this.statistics[e].y&&this.statistics[e].label>0){var f=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(this.statistics[e].x,this.statistics[e].y),{count:this.statistics[e].label,isStatistics:!0});f.attributes.count=this.statistics[e].label,this.layer.addFeatures([f],{silent:!0})}}else{for(var g=this.layer.map.getExtent(),h=[],e=0,i=this.layer.features.length;i>e;e++)if(this.layer.features[e].cluster)for(var j=0;j<this.layer.features[e].cluster.length;j++){var k=this.layer.features[e].cluster[j].geometry;if(!g.contains(k.x,k.y,!0)){h.push(this.layer.features[e]);for(var l=0;l<this.layer.features[e].cluster.length;l++)this.layer.features[e].cluster[l]._status=!1;break}}else{var k=this.layer.features[e].geometry,m=g.contains(k.x,k.y,!0);m||(this.layer.features[e]._status=!1,this.layer.features[e].data._status=!1,this.layer.features[e].style=null,h.push(this.layer.features[e]))}this.layer.removeFeatures(h);for(var n=[],e=0;e<this.oldClusters.length;e++){var k=this.oldClusters[e].geometry;if(g.contains(k)){for(var o=(this.oldClusters[e],[]),j=0;j<this.oldClusters[e].cluster.length;j++){var p=this.oldClusters[e].cluster[j].geometry;g.contains(p)?(this.oldClusters[e].cluster[j]._status=!0,o.push(this.oldClusters[e].cluster[j])):this.oldClusters[e].cluster[j]._status=!1}this.oldClusters[e].cluster=o,this.oldClusters[e].attributes.count=o.length,n.push(this.oldClusters[e])}}if(this.oldClusters=n,this.currentZoom=this.layer.map.getZoom(),this._xData&&!(this._xData.length<=0)){for(var q=this.layer.map.getExtent(),r=q.left,s=q.right,t=q.bottom,u=q.top,v=this.binarySearch(this._xData,r,"x"),w=this.binarySearch(this._xData,s,"x"),x=this._xData.slice(v,w+1),y=[],j=0;j<x.length;j++)if(x[j].geometry.y>=t&&x[j].geometry.y<=u){var z=x[j].markType;this.layer.showMarker[z]&&(null==this.filterFun||this.filterFun(x[j]))&&y.push(x[j])}this._clusterDataStatus=y.slice();var A=[];if((!a||a.zoomChanged||c)&&this._clusterDataStatus){var B=this.layer.clicentData.tempcluster;if(B)for(var e=0;e<B.length;e++)B[e].data.style?B[e].style=B[e].data.style:d&&(B[e].style=null);if(b!==this.resolution||!this.clustersExist()||c){b!==this.resolution&&(this.zoomIn=!this.resolution||b<=this.resolution),this.previousResolution=this.resolution,this.previousClusters=this.clusters,this.resolution=b;for(var C,f,z,D=[],E=this.maxZoom&&this.layer.map.getZoom()>=this.maxZoom,e=0;e<this._clusterDataStatus.length;++e)if(C=this._clusterDataStatus[e],z=C.markType,this.layer.showMarker[z]&&C.getData()._visible&&!C._status)if(this.isAsynchronous||(C._status=!0),oldclustered=!1,newclustered=!1,A.push(C),!E&&C.geometry){for(var j=this.oldClusters.length-1;j>=0;--j)if(f=this.oldClusters[j],this.shouldCluster(f,C)){oldclustered=!0;break}if(!oldclustered)for(var j=D.length-1;j>=0;--j)if(f=D[j],this.shouldCluster(f,C)){newclustered=!0;break}oldclustered||newclustered||D.push(this.createCluster(this._clusterDataStatus[e]))}else if(C.cluster)Array.prototype.push.apply(D,C.cluster);else{var F=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(C.geometry.x,C.geometry.y),{count:0,markType:C.markType});F.data=C,C._apiObj=F,D.push(F)}if(this.clusters=D,this.layer.map.getZoom()<this.maxZoom){if(0===this.oldClusters.length){for(var e=0;e<this.clusters.length;e++)this.oldClusters.push(this.clusters[e]);for(var j=0;j<A.length;j++){var G=this.searchMinC(A[j],this.clusters);G>=0&&(this.clusters[G].cluster.push(A[j]),this.clusters[G].attributes.count++)}}else{for(var e=0;e<this.clusters.length;e++)this.oldClusters.push(this.clusters[e]);for(var H=[],j=0;j<A.length;j++){var I=!1,G=this.searchMinC(A[j],this.oldClusters);if(!(0>G)){for(var e=0;e<H.length;e++)if(H[e]==G){I=!0;break}I||(H.push(G),1===this.oldClusters[G].cluster.length&&(this.layer.removeFeatures(this.oldClusters[G].cluster[0]._apiObj),this.oldClusters[G].cluster[0]._apiObj.style=null)),this.oldClusters[G].cluster.push(A[j]),this.oldClusters[G].attributes.count++}}this.clusters=[];for(var e=0;e<H.length;e++){var J=H[e];this.oldClusters[J].layer&&(this.layer.removeFeatures([this.oldClusters[J]],{silent:!0}),this.oldClusters[J].style=null),this.clusters.push(this.oldClusters[J])}}for(var K,L=[],e=0,M=this.oldClusters.length;M>e;++e)if(K=this.oldClusters[e],K.attributes.count<this.threshold)for(var l=K.cluster.length-1;l>=0;l--){var N=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(K.cluster[l].geometry.x,K.cluster[l].geometry.y),{count:1,markType:K.cluster[l].markType});N.cluster=[],N.cluster.push(K.cluster[l]),N.data=K.cluster[l],K.cluster[l]._apiObj=N,L.push(N)}else L.push(K);this.oldClusters=L,this.clusters=[];for(var e=0;e<this.oldClusters.length;e++)this.oldClusters[e].layer||this.clusters.push(this.oldClusters[e]);if(d||!a){for(var O=0,e=this.clusters.length-1;e>=0;e--)O+=this.clusters[e].attributes.count||1;if(O<=this.minClusterCount){var L=this.clusters.slice();this.clusters=[];for(var K,e=0,M=L.length;M>e;++e)K=L[e],Array.prototype.push.apply(this.clusters,K.cluster||[K]);for(var e=0;e<this.clusters.length;e++)this.clusters[e]._status=!0,this.clusters[e].style=null;this.oldClusters=[]}}}this.getMeansC(this.clusters),this.clustering=!0,this.isAsynchronous?(this.index=0,this.timer=window.setTimeout(this.startAddFeatures.bind(this),15)):(this.layer.addFeatures(this.clusters,{silent:!0}),this.callbackFun&&(this.callbackFun(),this.callbackFun=null)),this.clustering=!1}}}}}},getMeansC:function(a){for(var b=0;b<a.length;b++)if(a[b].cluster&&a[b].cluster.length>0){for(var c=0,d=0,e=0;e<a[b].cluster.length;e++)c+=a[b].cluster[e].geometry.x,d+=a[b].cluster[e].geometry.y;for(var f=a[b].cluster.length,g=c/f,h=d/f,i=999999999999,j=null,e=0;e<a[b].cluster.length;e++){var k=a[b].cluster[e],l=(g-k.geometry.x)*(g-k.geometry.x)+(h-k.geometry.y)*(h-k.geometry.y);i>l&&(i=l,j=k.geometry)}a[b].geometry.x=j.x,a[b].geometry.y=j.y}},getE:function(a,b){for(var c=0,d=0;d<a.length;d++){var e=a[d];if(e.cluster)for(var f=0;f<e.cluster.length;f++){var g=e.cluster[f];c+=(g.geometry.x-b[d].geometry.x)*(g.geometry.x-b[d].geometry.x)+(g.geometry.y-b[d].geometry.y)*(g.geometry.y-b[d].geometry.y)}}return c},searchMinC:function(a,b){for(var c=-1,d=999999999999,e=0;e<b.length;e++)if(a.markType===b[e].data.markType){var f=(a.geometry.x-b[e].geometry.x)*(a.geometry.x-b[e].geometry.x)+(a.geometry.y-b[e].geometry.y)*(a.geometry.y-b[e].geometry.y);d>f&&(c=e,d=f)}return c},startAddFeatures:function(){if(this.clusters&&this.clusters[this.index]){var a=this.clusters[this.index];if(this.layer.showMarker[a.data.markType])if(this.layer.addFeatures([a],{silent:!0}),a.cluster)for(var b=0;b<a.cluster.length;b++)a.cluster[b]._status=!0;else a.data._status=!0;this.index++,this.timer=window.setTimeout(this.startAddFeatures.bind(this),10)}else this.callbackFun&&(this.callbackFun(),this.callbackFun=null)},cacheFeatures:function(a){var b=!0;return this.clustering||(this.clearCache(),this.features=a.features,this._clusterDataStatus=this.features.slice(),this._xData=this._clusterDataStatus.slice().sort(function(a,b){return a.geometry.x>b.geometry.x?1:-1}),this.cluster(),b=!1),b},clearCache:function(a){this.clustering||(this.features=null,this.oldClusters=[])},findFeaturesInClusters:function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++){var f=b[e];if(f.attributes.count)for(var g=b[e].cluster,h=0;h<g.length;h++)if(d.id===g[h].id)return f}return null},animate:function(a){for(var b=this.zoomIn?this.clusters:this.previousClusters,c=0;c<b.length;c++)if(b[c]._geometry){var d=(b[c]._geometry.destx-b[c]._geometry.origx)*a.x,e=(b[c]._geometry.desty-b[c]._geometry.origy)*a.y;b[c].geometry.x=b[c]._geometry.origx+d,b[c].geometry.y=b[c]._geometry.origy+e}this.layer.redraw()},shouldCluster:function(a,b,c){var d=a.data.markType,e=b.markType;if(d!==e)return!1;var f=c?this.previousResolution:this.resolution,g=a.geometry.getBounds().getCenterLonLat(),h=b.geometry,i=Math.sqrt(Math.pow(g.lon-h.x,2)+Math.pow(g.lat-h.y,2))/f;return i<=this.distance},createCluster:function(a){var b=a.geometry,c=a.markType,d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.x,b.y),{count:0,markType:c,feature:a});return d.cluster=[],d.sx=a.geometry.x,d.sy=a.geometry.y,d},afterhidenMarkers:function(){},setStatistics:function(a){if(this.statistics=a,this.layer.map.getZoom()<this.minZoom){this.layer.removeAllFeatures();for(var b=0;b<this.statistics.length;b++)if(this.statistics[b]&&this.statistics[b].x&&this.statistics[b].y&&this.statistics[b].label>0){var c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(this.statistics[b].x,this.statistics[b].y),{count:this.statistics[b].label,isStatistics:!0});this.layer.addFeatures([c],{silent:!0})}}},addClusterMarker:function(a){if(window.clearTimeout(this.timer),!(this.layer.map.getZoom()<this.minZoom)){for(var b=this.maxZoom&&this.layer.map.getZoom()>=this.maxZoom,c=[],d=!1,e=null,f=0;f<a.length;f++){var g=a[f].geometry;if(this.layer&&this.layer.map){var h=this.layer.map.getExtent();if(!h.contains(g.x,g.y,!0))continue}if(a[f]._status=!0,!b&&a[f].geometry){d=!1;for(var i=c.length-1;i>=0;--i)if(e=c[i],this.shouldCluster(e,a[f])){e.attributes.count++,e.cluster.push(a[f]),d=!0;break}d||c.push(this.createCluster(a[f]))}else{var j=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(g.x,g.y),{count:1,markType:a[f].markType});j.data=a[f],a[f]._apiObj=j,c.push(j)}}this.getMeansC(c);var k=c.slice();c=[];for(var l,f=0,m=k.length;m>f;++f)if(l=k[f],l.attributes.count<this.threshold&&l.cluster)for(var n=0;n<l.cluster.length;n++){var o=l.cluster[n].geometry,p=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(o.x,o.y),{count:1,markType:a[f].markType});p.data=l.cluster[n],l.cluster[n]._apiObj=p,c.push(p)}else c.push(l);this.layer.addFeatures(c,{silent:!0})}},createNewCluster:function(a){var b=a.geometry.getBounds().getCenterLonLat(),c=a.data.markType,d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1,markType:c});return d.cluster=[a],d.sx=a.geometry.x,d.sy=a.geometry.y,d},filterClusterMarks:function(a){if(this.layer.map.getZoom()<this.minZoom)return void(this.filterFun=a);var b=[];this.layer.removeFeatures(this.layer.features,{silent:!0});var c=this.layer.map.getExtent(),d=c.left,e=c.right,f=(c.bottom,c.top,this.binarySearch(this._xData,d,"x")),g=this.binarySearch(this._xData,e,"x"),h=this._xData.slice(f,g+1);this._clusterDataStatus=h.slice();for(var i=this._clusterDataStatus.length-1;i>=0;i--){var j=this._clusterDataStatus[i].data;a(j)&&b.push(j)}this._clusterDataStatus=[],this.addClusterMarker(b),this.filterFun=a},CLASS_NAME:"OpenLayers.Strategy.AnimatedCluster"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),a},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(a){if(!this.caching&&this.filter){var b=a.features;a.features=[];for(var c,d=0,e=b.length;e>d;++d)c=b[d],this.filter.evaluate(c)?a.features.push(c):this.cache.push(c)}},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(a){this.filter=a;var b=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),b.length>0){var c={features:b};this.handleAdd(c),c.features.length>0&&(this.caching=!0,this.layer.addFeatures(c.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),a},load:function(a){var b=this.layer;b.events.triggerEvent("loadstart",{filter:b.filter}),b.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:b.filter,scope:this},a)),b.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){var b=this.layer;b.destroyFeatures();var c=a.features;if(c&&c.length>0){var d=b.projection,e=b.map.getProjectionObject();if(!e.equals(d))for(var f,g=0,h=c.length;h>g;++g)f=c[g].geometry,f&&f.transform(d,e);b.addFeatures(c)}b.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),a},update:function(a){var b=this.getMapBounds();null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b))&&(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))},getMapBounds:function(){if(null===this.layer.map)return null;var a=this.layer.map.getExtent();return a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),a},invalidBounds:function(a){a||(a=this.getMapBounds());var b=!this.bounds||!this.bounds.containsBounds(a);if(!b&&this.resFactor){var c=this.resolution/this.layer.map.getResolution();b=c>=this.resFactor||c<=1/this.resFactor}return b},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2)},triggerRead:function(a){!this.response||a&&a.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var b={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",b),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:b.filter,callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})),a},merge:function(a){if(this.layer.destroyFeatures(),a.success()){var b=a.features;if(b&&b.length>0){var c=this.layer.projection,d=this.layer.map.getProjectionObject();if(!d.equals(c))for(var e,f=0,g=b.length;g>f;++f)e=b[f].geometry,e&&e.transform(c,d);this.layer.addFeatures(b)}}else this.bounds=null;this.response=null,this.layer.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){var a;return a=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(a){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;c>b;b++){var d=a.fid||a.id;if(d===this.fids[b])return!0}return!1},clone:function(){var a=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(a,this),a.fids=this.fids.slice(),a},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===a.matchCase&&(this.matchCase=null)},evaluate:function(a){a instanceof OpenLayers.Feature.Vector&&(a=a.attributes);var b,c=!1,d=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:b=this.value,c=this.matchCase||"string"!=typeof d||"string"!=typeof b?d===b:d.toUpperCase()===b.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:b=this.value,c=this.matchCase||"string"!=typeof d||"string"!=typeof b?d!==b:d.toUpperCase()!==b.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:c=d<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:c=d>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:c=d<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:c=d>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:c=d>=this.lowerBoundary&&d<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var e=new RegExp(this.value,"gi");c=e.test(d);break;case OpenLayers.Filter.Comparison.IS_NULL:c=null===d}return c},value2regex:function(a,b,c){if("."===a)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return a=a?a:"*",b=b?b:".",c=c?c:"!",this.value=this.value.replace(new RegExp("\\"+c+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+b,"g"),"."),this.value=this.value.replace(new RegExp("\\"+a,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+a),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b),this.value},regex2value:function(){var a=this.value;return a=a.replace(/!/g,"!!"),a=a.replace(/(\\)?\\\./g,function(a,b){return b?a:"!."}),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"!*"}),a=a.replace(/\\\\/g,"\\"),a=a.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a){var b=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;"OpenLayers.Bounds"===this.value.CLASS_NAME&&(c=this.value.toGeometry()),a.geometry.intersects(c)&&(b=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return b},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a){a=a||{},OpenLayers.Util.extend(this,a),this.options=a},mergeWithDefaultFilter:function(a){var b;return b=a&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]}):a||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(a){a=a||{},a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=a||{},a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a=OpenLayers.Util.applyDefaults(a,this.options),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response({requestType:"read"});if(b){var d=a.headers||{};d["Content-Type"]="application/x-www-form-urlencoded",c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:d})}else c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers});return c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"create"});return c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)}),c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"}),e=this.updateWithPOST?"POST":"PUT";return d.priv=OpenLayers.Request[e]({url:c,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(a)}),d},handleUpdate:function(a,b){this.handleResponse(a,b)},"delete":function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"}),e=this.deleteWithPOST?"POST":"DELETE",f={url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers};return this.deleteWithPOST&&(f.data=this.format.write(a)),d.priv=OpenLayers.Request[e](f),d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;b.callback&&(c.status>=200&&c.status<300?("delete"!=a.requestType&&(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},commit:function(a,b){function c(a){for(var b=a.features?a.features.length:0,c=new Array(b),e=0;b>e;++e)c[e]=a.features[e].fid;o.insertIds=c,d.apply(this,[a])}function d(a){this.callUserCallback(a,b),n=n&&a.success(),f++,f>=m&&b.callback&&(o.code=n?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[o]))}b=OpenLayers.Util.applyDefaults(b,this.options);var e=[],f=0,g={};g[OpenLayers.State.INSERT]=[],g[OpenLayers.State.UPDATE]=[],g[OpenLayers.State.DELETE]=[];for(var h,i,j=[],k=0,l=a.length;l>k;++k)h=a[k],i=g[h.state],i&&(i.push(h),j.push(h));var m=(g[OpenLayers.State.INSERT].length>0?1:0)+g[OpenLayers.State.UPDATE].length+g[OpenLayers.State.DELETE].length,n=!0,o=new OpenLayers.Protocol.Response({reqFeatures:j}),p=g[OpenLayers.State.INSERT];p.length>0&&e.push(this.create(p,OpenLayers.Util.applyDefaults({callback:c,scope:this},b.create))),p=g[OpenLayers.State.UPDATE];for(var k=p.length-1;k>=0;--k)e.push(this.update(p[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b.update)));p=g[OpenLayers.State.DELETE];for(var k=p.length-1;k>=0;--k)e.push(this["delete"](p[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b["delete"])));return e},abort:function(a){a&&a.priv.abort()},callUserCallback:function(a,b){var c=b[a.requestType];c&&c.callback&&c.callback.call(c.scope,a)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.rules=[],b&&b.rules&&this.addRules(b.rules),this.setDefaultStyle(a||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;b>a;a++)this.rules[a].destroy(),this.rules[a]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(a){for(var b,c=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a),d=this.rules,e=[],f=!1,g=0,h=d.length;h>g;g++){b=d[g];var i=b.evaluate(a);i&&(b instanceof OpenLayers.Rule&&b.elseFilter?e.push(b):(f=!0,this.applySymbolizer(b,c,a)))}if(0==f&&e.length>0){f=!0;for(var g=0,h=e.length;h>g;g++)this.applySymbolizer(e[g],c,a)}return d.length>0&&0==f&&(c.display="none"),null!=c.label&&"string"!=typeof c.label&&(c.label=String(c.label)),c},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],e=a.symbolizer[d]||a.symbolizer;if(this.defaultsPerSymbolizer===!0){var f=this.defaultStyle;OpenLayers.Util.applyDefaults(e,{pointRadius:f.pointRadius}),(e.stroke===!0||e.graphic===!0)&&OpenLayers.Util.applyDefaults(e,{strokeWidth:f.strokeWidth,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokeDashstyle:f.strokeDashstyle,strokeLinecap:f.strokeLinecap}),(e.fill===!0||e.graphic===!0)&&OpenLayers.Util.applyDefaults(e,{fillColor:f.fillColor,fillOpacity:f.fillOpacity}),e.graphic===!0&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})
}return this.createLiterals(OpenLayers.Util.extend(b,e),c)},createLiterals:function(a,b){var c=OpenLayers.Util.extend({},b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles){var e=OpenLayers.Style.createLiteral(a[d],c,b,d);a[d]="undefined"!=e?e:null}return a},findPropertyStyles:function(){var a={},b=this.defaultStyle;this.addPropertyStyles(a,b);for(var c,d,e=this.rules,f=0,g=e.length;g>f;f++){c=e[f].symbolizer;for(var h in c){if(d=c[h],"object"!=typeof d){this.addPropertyStyles(a,c);break}this.addPropertyStyles(a,d)}}return a},addPropertyStyles:function(a,b){var c;for(var d in b)c=b[d],"string"==typeof c&&c.match(/\$\{\w+\}/)&&(a[d]=!0);return a},addRules:function(a){Array.prototype.push.apply(this.rules,a),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;d>c;c++)if(-1!=a.CLASS_NAME.indexOf(b[c]))return b[c]},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;c>b;++b)a.rules.push(this.rules[b].clone())}a.context=this.context&&OpenLayers.Util.extend({},this.context);var d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,a)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(a,b,c,d){return"string"==typeof a&&-1!=a.indexOf("${")&&(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a)),a},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;b>a;a++)this.rules[a].destroy();delete this.rules},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;c>b;++b)a.rules.push(this.rules[b].clone())}return new OpenLayers.Style2(a)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(a,b){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},a instanceof OpenLayers.Style)this.styles["default"]=a,this.styles.select=a,this.styles.temporary=a,this.styles["delete"]=a;else if("object"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else{if("object"!=typeof a[c]){this.styles["default"]=new OpenLayers.Style(a),this.styles.select=new OpenLayers.Style(a),this.styles.temporary=new OpenLayers.Style(a),this.styles["delete"]=new OpenLayers.Style(a);break}this.styles[c]=new OpenLayers.Style(a[c])}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,b){a||(a=new OpenLayers.Feature.Vector),this.styles[b]||(b="default"),a.renderIntent=b;var c={};return this.extendDefault&&"default"!=b&&(c=this.styles["default"].createSymbolizer(a)),OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[];for(var f in c)e.push(new OpenLayers.Rule({symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f})}));this.styles[a].addRules(e)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={},OpenLayers.Util.extend(this,a),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(a){var b=this.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();return this.minScaleDenominator&&(c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)),c&&this.maxScaleDenominator&&(c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)),c&&this.filter&&(c=this.filter.evaluate("OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?a:b)),c},getContext:function(a){var b=this.context;return b||(b=a.attributes||a.data),"function"==typeof this.context&&(b=this.context(a)),b},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.symbolizers){var b=this.symbolizers.length;a.symbolizers=new Array(b);for(var c=0;b>c;++c)a.symbolizers[c]=this.symbolizers[c].clone()}else{a.symbolizer={};var d,e;for(var f in this.symbolizer)d=this.symbolizer[f],e=typeof d,"object"===e?a.symbolizer[f]=OpenLayers.Util.extend({},d):"string"===e&&(a.symbolizer[f]=d)}return a.filter=this.filter&&this.filter.clone(),a.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a},destroy:function(){},read:function(){throw new Error("Read not implemented.")},write:function(){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.QueryStringFilter=function(){function a(a){return a=a.replace(/%/g,"\\%"),a=a.replace(/\\\\\.(\*)?/g,function(a,b){return b?a:"\\\\_"}),a=a.replace(/\\\\\.\*/g,"\\\\%"),a=a.replace(/(\\)?\.(\*)?/g,function(a,b,c){return b||c?a:"_"}),a=a.replace(/(\\)?\.\*/g,function(a,b){return b?a:"%"}),a=a.replace(/\\\./g,"."),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"*"})}var b={};return b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",b[OpenLayers.Filter.Comparison.LESS_THAN]="lt",b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",b[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(c,d){d=d||{};var e=c.CLASS_NAME,f=e.substring(e.lastIndexOf(".")+1);switch(f){case"Spatial":switch(c.type){case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray(),this.srsInBBOX&&c.projection&&d.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x,d.lat=c.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+c.type)}break;case"Comparison":var g=b[c.type];if(void 0!==g){var h=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&&(h=a(h),this.wildcarded&&(h="%"+h+"%")),d[c.property+"__"+g]=h,d.queryable=d.queryable||[],d.queryable.push(c.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+c.type);break;case"Logical":if(c.type===OpenLayers.Filter.Logical.AND)for(var i=0,j=c.filters.length;j>i;i++)d=this.write(c.filters[i],d);else OpenLayers.Console.warn("Unsupported logical filter type "+c.type);break;default:OpenLayers.Console.warn("Unknown filter type "+f)}return d},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[a]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b,this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf("<");b>0&&(a=a.substring(b));var c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;return b=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,b.loadXML(a),b},this),function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;return b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1),b.overrideMimeType&&b.overrideMimeType("text/xml"),b.send(null),b.responseXML});return this.keepData&&(this.data=c),c},write:function(a){var b;if(this.xmldom)b=a.xml;else{var c=new XMLSerializer;if(1==a.nodeType){var d=document.implementation.createDocument("","",null);d.importNode&&(a=d.importNode(a,!0)),d.appendChild(a),b=c.serializeToString(d)}else b=c.serializeToString(a)}return b},createElementNS:function(a,b){var c;return c=this.xmldom?"string"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,""):document.createElementNS(a,b)},createDocumentFragment:function(){var a;return a=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(a){var b;return"string"!=typeof a&&(a=String(a)),b=this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else for(var e,f,g=a.getElementsByTagName("*"),h=0,i=g.length;i>h;++h)e=g[h],f=e.prefix?e.prefix+":"+c:c,("*"==c||f==e.nodeName)&&("*"==b||b==e.namespaceURI)&&d.push(e);return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else for(var e,f,g=a.attributes,h=0,i=g.length;i>h;++h)if(e=g[h],e.namespaceURI==b&&(f=e.prefix?e.prefix+":"+c:c,f==e.nodeName)){d=e;break}return d},getAttributeNS:function(a,b,c){var d="";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||"";else{var e=this.getAttributeNodeNS(a,b,c);e&&(d=e.nodeValue)}return d},getChildValue:function(a,b){var c=b||"";if(a)for(var d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},isSimpleContent:function(a){for(var b=!0,c=a.firstChild;c;c=c.nextSibling)if(1===c.nodeType){b=!1;break}return b},contentType:function(a){for(var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,e=a.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:c=!0;break;case 8:break;default:b=!0}if(c&&b)break}if(c&&b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},hasAttributeNS:function(a,b,c){var d=!1;return d=a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS)a.setAttributeNS(b,c,d);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(b){var e=a.ownerDocument.createNode(2,c,b);e.nodeValue=d,a.setAttributeNode(e)}else a.setAttribute(c,d)}},createElementNSPlus:function(a,b){b=b||{};var c=b.uri||this.namespaces[b.prefix];if(!c){var d=a.indexOf(":");c=this.namespaces[a.substring(0,d)]}c||(c=this.namespaces[this.defaultPrefix]);var e=this.createElementNS(c,a);b.attributes&&this.setAttributes(e,b.attributes);var f=b.value;return null!=f&&e.appendChild(this.createTextNode(f)),e},setAttributes:function(a,b){var c,d;for(var e in b)null!=b[e]&&b[e].toString&&(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(":"))]||null,this.setAttributeNS(a,d,e,c))},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c){var d=a.localName||a.nodeName.split(":").pop(),e=c[d]||c["*"];e&&e.apply(this,[a,b])}return b},readChildNodes:function(a,b){b||(b={});for(var c,d=a.childNodes,e=0,f=d.length;f>e;++e)c=d[e],1==c.nodeType&&this.readNode(c,b);return b},writeNode:function(a,b,c){var d,e,f=a.indexOf(":");f>0?(d=a.substring(0,f),e=a.substring(f+1)):(d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix,e=a);var g=this.writers[d][e].apply(this,[b]);return c&&c.appendChild(g),g},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,b,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){a:for(var d=a;d;d=d.nextSibling)switch(d.nodeType){case 1:if(!(b&&b!==(d.localName||d.nodeName.split(":").pop())||c&&c!==d.namespaceURI))break a;d=null;break a;case 3:if(/^\s*$/.test(d.nodeValue))break;case 4:case 6:case 12:case 10:case 11:d=null;break a}return d||null},lookupNamespaceURI:function(a,b){var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType){case 1:if(null!==a.namespaceURI&&a.prefix===b){c=a.namespaceURI;break a}var d=a.attributes.length;if(d)for(var e,f=0;d>f;++f){if(e=a.attributes[f],"xmlns"===e.prefix&&e.name==="xmlns:"+b){c=e.value||null;break a}if("xmlns"===e.name&&null===b){c=e.value||null;break a}}c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,b)}return c},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);var b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(a,b){var c;return a?(c=this.version,c||(c=a.getAttribute("version"),c||(c=this.defaultVersion))):c=b&&b.version||this.version||this.defaultVersion,c},getParser:function(a){a=a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!c&&(""!==b&&this.allowFallback&&(b="",c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")]),!c))throw"Can't find a "+this.name+" parser for version "+a+b;this.parser=new c(this.options)}return this.parser},write:function(a,b){var c=this.getVersion(null,b);this.parser=this.getParser(c);var d=this.parser.write(a,b);return this.stringifyOutput===!1?d:OpenLayers.Format.XML.prototype.write.apply(this,[d])},read:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement,d=this.getVersion(c);this.parser=this.getParser(d);var e=this.parser.read(a,b),f=this.parser.errorProperty||null;if(null!==f&&void 0===e[f]){var g=new OpenLayers.Format.OGCExceptionReport;e.error=g.read(a)}return e.version=d,e},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName),c=[],d=0;d<b.length;d++){var e=this.parseFeature(b[d]);e&&c.push(e)}return c},parseFeature:function(a){for(var b,c,d,e,f=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],g=0;g<f.length;++g)if(b=f[g],c=this.getElementsByTagNameNS(a,this.gmlns,b),c.length>0){if(e=this.parseGeometry[b.toLowerCase()],!e)throw new TypeError("Unsupported geometry type: "+b);d=e.apply(this,[c[0]]),this.internalProjection&&this.externalProjection&&d.transform(this.externalProjection,this.internalProjection);break}var h,i=this.getElementsByTagNameNS(a,this.gmlns,"Box");for(g=0;g<i.length;++g){var j=i[g],k=this.parseGeometry.box.apply(this,[j]),l=j.parentNode,m=l.localName||l.nodeName.split(":").pop();"boundedBy"===m?h=k:d=k.toGeometry()}var n;this.extractAttributes&&(n=this.parseAttributes(a));var o=new OpenLayers.Feature.Vector(d,n);o.bounds=h,o.gml={featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};for(var p,q=a.firstChild;q&&(1!==q.nodeType||!(p=q.getAttribute("fid")||q.getAttribute("id")));)q=q.nextSibling;return o.fid=p,o},parseGeometry:{point:function(a){var b,c,d=[];if(b=this.getElementsByTagNameNS(a,this.gmlns,"pos"),b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),d=c.split(this.regExes.splitSpace)),0===d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),d=c.split(","))),0===d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coord"),b.length>0)){var e=this.getElementsByTagNameNS(b[0],this.gmlns,"X"),f=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");e.length>0&&f.length>0&&(d=[e[0].firstChild.nodeValue,f[0].firstChild.nodeValue])}return 2===d.length&&(d[2]=null),this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2])},multipoint:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Point"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.point.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiPoint(c)},linestring:function(a,b){var c,d,e=[],f=[];if(c=this.getElementsByTagNameNS(a,this.gmlns,"posList"),c.length>0){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),e=d.split(this.regExes.splitSpace);for(var g,h,i,j,k=parseInt(c[0].getAttribute("dimension")),l=0;l<e.length/k;++l)g=l*k,h=e[g],i=e[g+1],j=2===k?null:e[g+2],f.push(this.xy?new OpenLayers.Geometry.Point(h,i,j):new OpenLayers.Geometry.Point(i,h,j))}if(0===e.length&&(c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),c.length>0)){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,",");for(var m=d.split(this.regExes.splitSpace),l=0;l<m.length;++l)e=m[l].split(","),2===e.length&&(e[2]=null),f.push(this.xy?new OpenLayers.Geometry.Point(e[0],e[1],e[2]):new OpenLayers.Geometry.Point(e[1],e[0],e[2]))}var n=null;return 0!==f.length&&(n=b?new OpenLayers.Geometry.LinearRing(f):new OpenLayers.Geometry.LineString(f)),n},multilinestring:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LineString"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.linestring.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.linestring.apply(this,[b[e],!0]),d&&c.push(d);return new OpenLayers.Geometry.Polygon(c)},multipolygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Polygon"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.polygon.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiPolygon(c)},envelope:function(a){var b,c,d=[],e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(e.length>0){var f=[];e.length>0&&(b=e[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),f=b.split(this.regExes.splitSpace)),2===f.length&&(f[2]=null);var g;g=this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2])}var h=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner");if(h.length>0){var f=[];h.length>0&&(b=h[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),f=b.split(this.regExes.splitSpace)),2===f.length&&(f[2]=null);var i;i=this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2])}if(g&&i){d.push(new OpenLayers.Geometry.Point(g.x,g.y)),d.push(new OpenLayers.Geometry.Point(i.x,g.y)),d.push(new OpenLayers.Geometry.Point(i.x,i.y)),d.push(new OpenLayers.Geometry.Point(g.x,i.y)),d.push(new OpenLayers.Geometry.Point(g.x,g.y));var j=new OpenLayers.Geometry.LinearRing(d);c=new OpenLayers.Geometry.Polygon([j])}return c},box:function(a){var b,c,d=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),e=null,f=null;return d.length>0&&(b=d[0].firstChild.nodeValue,c=b.split(" "),2===c.length&&(e=c[0].split(","),f=c[1].split(","))),null!==e&&null!==f?new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(f[0]),parseFloat(f[1])):void 0}},parseAttributes:function(a){for(var b,c,d,e,f,g,h,i={},j=a.firstChild;j;){if(1===j.nodeType){for(b=j.childNodes,c=0;c<b.length;++c)d=b[c],1===d.nodeType&&(e=d.childNodes,1===e.length?(f=e[0],(3===f.nodeType||4===f.nodeType)&&(g=d.prefix?d.nodeName.split(":")[1]:d.nodeName,h=f.nodeValue.replace(this.regExes.trimSpace,""),i[g]=h)):i[d.nodeName.split(":").pop()]=null);break}j=j.nextSibling}return i},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),c=0;c<a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=a.geometry,c=this.buildGeometryNode(b),d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);d.appendChild(c);var e=this.createElementNS(this.gmlns,"gml:"+this.featureName),f=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),g=a.fid||a.id;f.setAttribute("fid",g),f.appendChild(d);for(var h in a.attributes)if(a.attributes.hasOwnProperty(h)){var i=this.createTextNode(a.attributes[h]),j=h.substring(h.lastIndexOf(":")+1),k=this.createElementNS(this.featureNS,this.featurePrefix+":"+j);k.appendChild(i),f.appendChild(k)}return e.appendChild(f),e},buildGeometryNode:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME,c=b.substring(b.lastIndexOf(".")+1),d=this.buildGeometry[c.toLowerCase()];return d.apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,"gml:Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPoint"),e=a.components,f=0;f<e.length;f++)b=this.createElementNS(this.gmlns,"gml:pointMember"),c=this.buildGeometry.point.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},linestring:function(a){var b=this.createElementNS(this.gmlns,"gml:LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiLineString"),e=a.components,f=0;f<e.length;++f)b=this.createElementNS(this.gmlns,"gml:lineStringMember"),c=this.buildGeometry.linestring.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},linearring:function(a){var b=this.createElementNS(this.gmlns,"gml:LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var b,c,d,e=this.createElementNS(this.gmlns,"gml:Polygon"),f=a.components,g=0;g<f.length;++g)d=0===g?"outerBoundaryIs":"innerBoundaryIs",b=this.createElementNS(this.gmlns,"gml:"+d),c=this.buildGeometry.linearring.apply(this,[f[g]]),b.appendChild(c),e.appendChild(b);return e},multipolygon:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPolygon"),e=a.components,f=0;f<e.length;++f)b=this.createElementNS(this.gmlns,"gml:polygonMember"),c=this.buildGeometry.polygon.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");return b.appendChild(this.buildCoordinatesNode(a)),b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal","."),b.setAttribute("cs",","),b.setAttribute("ts"," ");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+","+a.bottom),c.push(a.right+","+a.top);else for(var d=a.components?a.components:[a],e=0;e<d.length;e++)c.push(d[e].x+","+d[e].y);var f=this.createTextNode(c.join(" "));return b.appendChild(f),b},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.setGeometryTypes(),a&&a.featureNS&&this.setNamespace("feature",a.featureNS),this.singleFeatureType=!a||"string"==typeof a.featureType},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9===a.nodeType&&(a=a.documentElement);var b=[];if(this.readNode(a,{features:b},!0),0===b.length){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length)for(var d=0,e=c.length;e>d;++d)this.readNode(c[d],{features:b},!0);else c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers"),c.length&&this.readNode(c[0],{features:b},!0)}return b},readNode:function(a,b,c){return c===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||a.prefix in this.namespaces||a.parentNode.namespaceURI!==this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName)||(this.featureType=a.nodeName.split(":").pop(),this.setNamespace("feature",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{_inherit:function(){},featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c),c.components&&c.components.length>0&&(b.bounds=c.components[0])},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(c.points[0])},coordinates:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");for(var d,e=c.split(this.regExes.splitSpace),f=e.length,g=[],h=0;f>h;++h)d=e[h].split(","),g.push(this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2]));b.points=g},coord:function(a,b){var c={};this.readChildNodes(a,c),b.points||(b.points=[]),b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.inner.unshift(c.outer),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(a,b){var c,d=a.localName||a.nodeName.split(":").pop();b.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,d)?d===this.featureType&&(c="_typeName"):c="_typeName":0===a.childNodes.length||1===a.childNodes.length&&3===a.firstChild.nodeType?this.extractAttributes&&(c="_attribute"):c="_geometry",c&&this.readers.feature[c].apply(this,[a,b])},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c),c.name&&(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(":").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces.gml,"id");e&&(d.fid=e),this.internalProjection&&this.externalProjection&&d.geometry&&d.geometry.transform(this.externalProjection,this.internalProjection),c.bounds&&(d.bounds=c.bounds),b.features.push(d)},_geometry:function(a,b){this.geometryName||(this.geometryName=a.nodeName.split(":").pop()),this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(":").pop(),d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",a,b),b},MultiPoint:function(a){for(var b=this.createElementNSPlus("gml:MultiPoint"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("pointMember",c[d],b);return b},pointMember:function(a){var b=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",a,b),b},MultiLineString:function(a){for(var b=this.createElementNSPlus("gml:MultiLineString"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("lineStringMember",c[d],b);return b},lineStringMember:function(a){var b=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",a,b),b},MultiPolygon:function(a){for(var b=this.createElementNSPlus("gml:MultiPolygon"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("polygonMember",c[d],b);return b},polygonMember:function(a){var b=this.createElementNSPlus("gml:polygonMember");
return this.writeNode("Polygon",a,b),b},GeometryCollection:function(a){for(var b=this.createElementNSPlus("gml:GeometryCollection"),c=0,d=a.components.length;d>c;++c)this.writeNode("geometryMember",a.components[c],b);return b},geometryMember:function(a){var b=this.createElementNSPlus("gml:geometryMember"),c=this.writeNode("feature:_geometry",a);return b.appendChild(c.firstChild),b}},feature:{_typeName:function(a){var b=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:a.fid}});a.geometry&&this.writeNode("feature:_geometry",a.geometry,b);for(var c in a.attributes)if(a.attributes.hasOwnProperty(c)){var d=a.attributes[c];null!=d&&this.writeNode("feature:_attribute",{name:c,value:d},b)}return b},_geometry:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus("feature:"+this.geometryName),c=this.geometryTypes[a.CLASS_NAME],d=this.writeNode("gml:"+c,a,b);return this.srsName&&d.setAttribute("srsName",this.srsName),b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){for(var b=this.createElementNSPlus("wfs:FeatureCollection"),c=0,d=a.length;d>c;++c)this.writeNode("gml:featureMember",a[c],b);return b}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},Box:function(a,b){var c={};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"wfs:FeatureCollection":"gml:featureMember";var c=this.writeNode(b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[a],b),b},coordinates:function(a){for(var b,c=a.length,d=new Array(c),e=0;c>e;++e)b=a[e],d[e]=this.xy?b.x+","+b.y:b.y+","+b.x,void 0!=b.z&&(d[e]+=","+b.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==c?d[0]:d.join(" ")})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",a.components,b),b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c<a.components.length;++c)this.writeNode("innerBoundaryIs",a.components[c],b);return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",a,b),b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",a.components,b),b},Box:function(a){var b=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b),this.srsName&&b.setAttribute("srsName",this.srsName),b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(a,b,c){var d=parseInt(a.getAttribute("srsDimension"),10)||c&&c.srsDimension;d&&(b.srsDimension=d)},featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c),c.points&&Array.prototype.push.apply(b.points,c.points)},pos:function(a,b){var c,d=this.getChildValue(a).replace(this.regExes.trimSpace,""),e=d.split(this.regExes.splitSpace);c=this.xy?new OpenLayers.Geometry.Point(e[0],e[1],e[2]):new OpenLayers.Geometry.Point(e[1],e[0],e[2]),b.points=[c]},posList:function(a,b){for(var c,d,e,f=this.getChildValue(a).replace(this.regExes.trimSpace,""),g=f.split(this.regExes.splitSpace),h=b.srsDimension||parseInt(a.getAttribute("srsDimension")||a.getAttribute("dimension"),10)||2,i=g.length/h,j=new Array(i),k=0,l=g.length;l>k;k+=h)c=g[k],d=g[k+1],e=2==h?void 0:g[k+2],j[k/h]=this.xy?new OpenLayers.Geometry.Point(c,d,e):new OpenLayers.Geometry.Point(d,c,e);b.points=j},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiLineString(c.components)])},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:new Array(2)};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){for(var b=this.createElementNSPlus("gml:featureMembers"),c=0,d=a.length;d>c;++c)this.writeNode("feature:_typeName",a[c],b);return b},Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("pos",a,b),b},pos:function(a){var b=this.xy?a.x+" "+a.y:a.y+" "+a.x;return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",a.components,b),b},Curve:function(a){var b=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",a,b),b},segments:function(a){var b=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",a,b),b},LineStringSegment:function(a){var b=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",a.components,b),b},posList:function(a){for(var b,c=a.length,d=new Array(c),e=0;c>e;++e)b=a[e],d[e]=this.xy?b.x+" "+b.y:b.y+" "+b.x;return this.createElementNSPlus("gml:posList",{value:d.join(" ")})},Surface:function(a){var b=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",a,b),b},patches:function(a){var b=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",a,b),b},PolygonPatch:function(a){var b=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;d>c;++c)this.writeNode("interior",a.components[c],b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;d>c;++c)this.writeNode("interior",a.components[c],b);return b},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",a,b),b},interior:function(a){var b=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",a.components,b),b},MultiCurve:function(a){for(var b=this.createElementNSPlus("gml:MultiCurve"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("curveMember",c[d],b);return b},curveMember:function(a){var b=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",a,b):this.writeNode("LineString",a,b),b},MultiSurface:function(a){for(var b=this.createElementNSPlus("gml:MultiSurface"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("surfaceMember",c[d],b);return b},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",a,b):this.writeNode("Polygon",a,b),b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",a,b),this.writeNode("upperCorner",a,b),this.srsName&&b.setAttribute("srsName",this.srsName),b},lowerCorner:function(a){var b=this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left;return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=this.xy?a.right+" "+a.top:a.top+" "+a.right;return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(a){var b=this.version;if(!b){var c=a.getAttribute("xmlns:ows");c&&"1.1"===c.substring(c.lastIndexOf("/")+1)&&(b="1.1.0"),b||(b=this.defaultVersion)}return b},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{ows:{Exception:function(a,b){var c={code:a.getAttribute("exceptionCode"),locator:a.getAttribute("locator"),texts:[]};b.exceptions.push(c),this.readChildNodes(a,c)},ExceptionText:function(a,b){var c=this.getChildValue(a);b.texts.push(c)},ServiceIdentification:function(a,b){b.serviceIdentification={},this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={},this.readChildNodes(a,b.keywords)},Keyword:function(a,b){b[this.getChildValue(a)]=!0},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={},this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={},this.readChildNodes(a,b.serviceContact)},IndividualName:function(a,b){b.individualName=this.getChildValue(a)},PositionName:function(a,b){b.positionName=this.getChildValue(a)},ContactInfo:function(a,b){b.contactInfo={},this.readChildNodes(a,b.contactInfo)},Phone:function(a,b){b.phone={},this.readChildNodes(a,b.phone)},Voice:function(a,b){b.voice=this.getChildValue(a)},Address:function(a,b){b.address={},this.readChildNodes(a,b.address)},DeliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},AdministrativeArea:function(a,b){b.administrativeArea=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ElectronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},Role:function(a,b){b.role=this.getChildValue(a)},OperationsMetadata:function(a,b){b.operationsMetadata={},this.readChildNodes(a,b.operationsMetadata)},Operation:function(a,b){var c=a.getAttribute("name");b[c]={},this.readChildNodes(a,b[c])},DCP:function(a,b){b.dcp={},this.readChildNodes(a,b.dcp)},HTTP:function(a,b){b.http={},this.readChildNodes(a,b.http)},Get:function(a,b){b.get||(b.get=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.get.push(c)},Post:function(a,b){b.post||(b.post=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.post.push(c)},Parameter:function(a,b){b.parameters||(b.parameters={});var c=a.getAttribute("name");b.parameters[c]={},this.readChildNodes(a,b.parameters[c])},Constraint:function(a,b){b.constraints||(b.constraints={});var c=a.getAttribute("name");b.constraints[c]={},this.readChildNodes(a,b.constraints[c])},Value:function(a,b){b[this.getChildValue(a)]=!0},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)}),this.readChildNodes(a,b)},WGS84BoundingBox:function(a,b){var c={};c.crs=a.getAttribute("crs"),b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b),this.readChildNodes(a,c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b])},LowerCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.left=d[0],b.bottom=d[1]},UpperCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.right=d[0],b.top=d[1],b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top),delete b.left,delete b.bottom,delete b.right,delete b.top},Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a,b){var c=this.createElementNSPlus(b||"ows:BoundingBox",{attributes:{crs:a.projection}});return this.writeNode("ows:LowerCorner",a,c),this.writeNode("ows:UpperCorner",a,c),c},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b},Identifier:function(a){var b=this.createElementNSPlus("ows:Identifier",{value:a});return b},Title:function(a){var b=this.createElementNSPlus("ows:Title",{value:a});return b},Abstract:function(a){var b=this.createElementNSPlus("ows:Abstract",{value:a});return b},OutputFormat:function(a){var b=this.createElementNSPlus("ows:OutputFormat",{value:a});return b}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=!1,b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={},this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=!0},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={},this.readChildNodes(a,b.range)},MinimumValue:function(a,b){b.minValue=this.getChildValue(a)},MaximumValue:function(a,b){b.maxValue=this.getChildValue(a)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(a){var b=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":a.closure}});return this.writeNode("ows:MinimumValue",a.minValue,b),this.writeNode("ows:MaximumValue",a.maxValue,b),b},MinimumValue:function(a){var b=this.createElementNSPlus("ows:MinimumValue",{value:a});return b},MaximumValue:function(a){var b=this.createElementNSPlus("ows:MaximumValue",{value:a});return b},Value:function(a){var b=this.createElementNSPlus("ows:Value",{value:a});return b}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c,d;a=a.replace(/[\n\r]/g," ");var e=this.regExes.typeStr.exec(a);if(e&&(c=e[1].toLowerCase(),d=e[2],this.parse[c]&&(b=this.parse[c].apply(this,[d])),this.internalProjection&&this.externalProjection))if(b&&"OpenLayers.Feature.Vector"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&&"geometrycollection"!=c&&"object"==typeof b)for(var f=0,g=b.length;g>f;f++){var h=b[f];h.geometry.transform(this.externalProjection,this.internalProjection)}return b},write:function(a){var b,c,d;a.constructor==Array?(b=a,d=!0):(b=[a],d=!1);var e=[];d&&e.push("GEOMETRYCOLLECTION(");for(var f=0,g=b.length;g>f;++f)d&&f>0&&e.push(","),c=b[f].geometry,e.push(this.extractGeometry(c));return d&&e.push(")"),e.join("")},extractGeometry:function(a){var b=a.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[b])return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var c="collection"==b?"GEOMETRYCOLLECTION":b.toUpperCase(),d=c+"("+this.extract[b].apply(this,[a])+")";return d},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.point.apply(this,[a.components[c]])+")");return b.join(",")},linestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},polygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")},collection:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(",")}},parse:{point:function(a){var b=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(a){for(var b,c=OpenLayers.String.trim(a).split(","),d=[],e=0,f=c.length;f>e;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.point.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(d))},linestring:function(a){for(var b=OpenLayers.String.trim(a).split(","),c=[],d=0,e=b.length;e>d;++d)c.push(this.parse.point.apply(this,[b[d]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(c))},multilinestring:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.parenComma),d=[],e=0,f=c.length;f>e;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.linestring.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(d))},polygon:function(a){for(var b,c,d,e=OpenLayers.String.trim(a).split(this.regExes.parenComma),f=[],g=0,h=e.length;h>g;++g)b=e[g].replace(this.regExes.trimParens,"$1"),c=this.parse.linestring.apply(this,[b]).geometry,d=new OpenLayers.Geometry.LinearRing(c.components),f.push(d);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(f))},multipolygon:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),d=[],e=0,f=c.length;f>e;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.polygon.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(d))},geometrycollection:function(a){a=a.replace(/,\s*([A-Za-z])/g,"|$1");for(var b=OpenLayers.String.trim(a).split("|"),c=[],d=0,e=b.length;e>d;++d)c.push(OpenLayers.Format.WKT.prototype.read.apply(this,[b[d]]));return c}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};return this.readers.ogc.Filter.apply(this,[a,b]),b.filter},readers:{ogc:{_expression:function(a){for(var b,c="",d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 1:b=this.readNode(d),b.property?c+="${"+b.property+"}":void 0!==b.value&&(c+=b.value);break;case 3:case 4:c+=d.nodeValue}return c},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c),c.fids.length>0?b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids}):c.filters.length>0&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute("fid");c&&b.fids.push(c)},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(a,c),b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c),b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c),b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a),!0)},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a)),b.distanceUnits=a.getAttribute("units")},Function:function(){},PropertyIsNull:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(a,c),b.filters.push(c)}}},readSpatial:function(a,b,c){var d=new OpenLayers.Filter.Spatial({type:c});this.readChildNodes(a,d),d.value=d.components[0],delete d.components,b.filters.push(d)},encodeLiteral:function(a){return a instanceof Date&&(a=OpenLayers.Date.toISOString(a)),a},writeOgcExpression:function(a,b){return a instanceof OpenLayers.Filter.Function?this.writeNode("Function",a,b):this.writeNode("Literal",a,b),b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(a),a,b),b},_featureIds:function(a){for(var b=this.createDocumentFragment(),c=0,d=a.fids.length;d>c;++c)this.writeNode("ogc:FeatureId",a.fids[c],b);return b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(a){for(var b,c=this.createElementNSPlus("ogc:And"),d=0,e=a.filters.length;e>d;++d)b=a.filters[d],this.writeNode(this.getFilterType(b),b,c);return c},Or:function(a){for(var b,c=this.createElementNSPlus("ogc:Or"),d=0,e=a.filters.length;e>d;++d)b=a.filters[d],this.writeNode(this.getFilterType(b),b,c);return c},Not:function(a){var b=this.createElementNSPlus("ogc:Not"),c=a.filters[0];return this.writeNode(this.getFilterType(c),c,b),b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",a,b),this.writeNode("LowerBoundary",a,b),this.writeNode("UpperBoundary",a,b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){var b=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:b(a)})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(a.lowerBoundary,b),b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",a.upperBoundary,b),b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");return this.writeNode("Distance",a,b),b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(a){for(var b=this.createElementNSPlus("ogc:Function",{attributes:{name:a.name}}),c=a.params,d=0,e=c.length;e>d;d++)this.writeOgcExpression(c[d],b);return b},PropertyIsNull:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",a,b),b}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b)throw"Filter writing not supported for rule type: "+a.type;return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escape");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");
return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);return a.projection&&c.setAttribute("srsName",a.projection),b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Box",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escapeChar");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",a.value);return a.projection&&c.setAttribute("srsName",a.projection),b.appendChild(c),b},SortBy:function(a){for(var b=this.createElementNSPlus("ogc:SortBy"),c=0,d=a.length;d>c;c++)this.writeNode("ogc:SortProperty",a[c],b);return b},SortProperty:function(a){var b=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",a,b),this.writeNode("ogc:SortOrder","DESC"===a.order?"DESC":"ASC",b),b},SortOrder:function(a){var b=this.createElementNSPlus("ogc:SortOrder",{value:a});return b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Envelope",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.WFST=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFST version: "+a.version;return new b(a)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;return c||(c=a&&a.layer?a.layer.projection.getCode():this.srsName),c},read:function(a,b){b=b||{},OpenLayers.Util.applyDefaults(b,{output:"features"}),"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var c={};return a&&this.readNode(a,c,!0),c.features&&"features"===b.output&&(c=c.features),c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[],this.readChildNodes(a,b)}}},write:function(a,b){var c=this.writeNode("wfs:Transaction",{features:a,options:b}),d=this.schemaLocationAttr();return d&&this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",d),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:a&&a.handle,outputFormat:a&&a.outputFormat,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});if("string"==typeof this.featureType)this.writeNode("Query",a,b);else for(var c=0,d=this.featureType.length;d>c;c++)a.featureType=this.featureType[c],this.writeNode("Query",a,b);return b},Transaction:function(a){a=a||{};var b,c,d=a.options||{},e=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:d.handle}}),f=a.features;if(f){d.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var g,h;for(b=0,c=f.length;c>b;++b)h=f[b],g=this.stateName[h.state],g&&this.writeNode(g,{feature:h,options:d},e);d.multi===!0&&this.setGeometryTypes()}if(d.nativeElements)for(b=0,c=d.nativeElements.length;c>b;++b)this.writeNode("wfs:Native",d.nativeElements[b],e);return e},Native:function(a){var b=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:a.vendorId,safeToIgnore:a.safeToIgnore},value:a.value});return b},Insert:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Insert",{attributes:{handle:c&&c.handle}});return this.srsName=this.getSrsName(b),this.writeNode("feature:_typeName",b,d),d},Update:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Update",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var e=b.modified;null===this.geometryName||e&&void 0===e.geometry||(this.srsName=this.getSrsName(b),this.writeNode("Property",{name:this.geometryName,value:b.geometry},d));for(var f in b.attributes)void 0===b.attributes[f]||e&&e.attributes&&(!e.attributes||void 0===e.attributes[f])||this.writeNode("Property",{name:f,value:b.attributes[f]},d);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d},Property:function(a){var b=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",a.name,b),null!==a.value&&this.writeNode("Value",a.value,b),b},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(a){var b;if(a instanceof OpenLayers.Geometry){b=this.createElementNSPlus("wfs:Value");var c=this.writeNode("feature:_geometry",a).firstChild;b.appendChild(c)}else b=this.createElementNSPlus("wfs:Value",{value:a});return b},Delete:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Delete",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var b=OpenLayers.Util.extend({},this.schemaLocations);a.schema&&(b[a.featurePrefix]=a.schema);var c,d=[];for(var e in b)c=this.namespaces[e],c&&d.push(c+" "+b[e]);var f=d.join(" ")||void 0;return f},setFilterProperty:function(a){if(a.filters)for(var b=0,c=a.filters.length;c>b;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&&!a.property&&(a.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},InsertResult:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds=b.insertIds.concat(c.fids)},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType}});if(a.srsNameInQuery&&a.srsName&&c.setAttribute("srsName",a.srsName),a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var d=0,e=a.propertyNames.length;e>d;d++)this.writeNode("ogc:PropertyName",{property:a.propertyNames[d]},c);return a.filter&&(this.setFilterProperty(a.filter),this.writeNode("ogc:Filter",a.filter,c)),c}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=!0},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return a&&this.setAttributes(b,{resultType:a.resultType,startIndex:a.startIndex,count:a.count}),b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var d=0,e=a.propertyNames.length;e>d;d++)this.writeNode("wfs:PropertyName",{property:a.propertyNames[d]},c);return a.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode("ogc:Filter",a.filter,c)),c},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(a,b){if(b&&"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(b[c]=walk(c,b[c]));return filter(a,b)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(a,b){this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try{c=!this.pretty&&this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}return c},writeIndent:function(){var a=[];if(this.pretty)for(var b=0;b<this.level;++b)a.push(this.indent);return a.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(a){if(null==a)return"null";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=["{"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&&(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,[a[c],this.pretty]),null!=d&&null!=e&&(f&&b.push(","),b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e),f=!0));return this.level-=1,b.push(this.writeNewline(),this.writeIndent(),"}"),b.join("")},array:function(a){var b,c=["["];this.level+=1;for(var d=0,e=a.length;e>d;++d)b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]),null!=b&&(d>0&&c.push(","),c.push(this.writeNewline(),this.writeIndent(),b));return this.level-=1,c.push(this.writeNewline(),this.writeIndent(),"]"),c.join("")},string:function(a){var b={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=b[c];return d?d:(d=c.charCodeAt(),"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16))})+'"':'"'+a+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(a){return 10>a?"0"+a:a}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(a,b,c){b=b?b:"FeatureCollection";var d=null,e=null;if(e="string"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a){if("string"!=typeof e.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+a);else if(this.isValidType(e,b))switch(b){case"Geometry":try{d=this.parseGeometry(e)}catch(f){OpenLayers.Console.error(f)}break;case"Feature":try{d=this.parseFeature(e),d.type="Feature"}catch(f){OpenLayers.Console.error(f)}break;case"FeatureCollection":switch(d=[],e.type){case"Feature":try{d.push(this.parseFeature(e))}catch(f){d=null,OpenLayers.Console.error(f)}break;case"FeatureCollection":for(var g=0,h=e.features.length;h>g;++g)try{d.push(this.parseFeature(e.features[g]))}catch(f){d=null,OpenLayers.Console.error(f)}break;default:try{var i=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(i))}catch(f){d=null,OpenLayers.Console.error(f)}}}}else OpenLayers.Console.error("Bad JSON: "+a);return d},isValidType:function(a,b){var c=!1;switch(b){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],a.type)?OpenLayers.Console.error("Unsupported geometry type: "+a.type):c=!0;break;case"FeatureCollection":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)}return c},parseFeature:function(a){var b,c,d,e;d=a.properties?a.properties:{},e=a.geometry&&a.geometry.bbox||a.bbox;try{c=this.parseGeometry(a.geometry)}catch(f){throw f}return b=new OpenLayers.Feature.Vector(c,d),e&&(b.bounds=OpenLayers.Bounds.fromArray(e)),a.id&&(b.fid=a.id),b},parseGeometry:function(a){if(null==a)return null;var b,c=!1;if("GeometryCollection"==a.type){if(!OpenLayers.Util.isArray(a.geometries))throw"GeometryCollection must have geometries array: "+a;for(var d=a.geometries.length,e=new Array(d),f=0;d>f;++f)e[f]=this.parseGeometry.apply(this,[a.geometries[f]]);b=new OpenLayers.Geometry.Collection(e),c=!0}else{if(!OpenLayers.Util.isArray(a.coordinates))throw"Geometry must have coordinates array: "+a;if(!this.parseCoords[a.type.toLowerCase()])throw"Unsupported geometry type: "+a.type;try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(g){throw g}}return this.internalProjection&&this.externalProjection&&!c&&b.transform(this.externalProjection,this.internalProjection),b},parseCoords:{point:function(a){if(0==this.ignoreExtraDims&&2!=a.length)throw"Only 2D points are supported: "+a;return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.linestring.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e){try{c=this.parseCoords.linestring.apply(this,[a[e]])}catch(g){throw g}b=new OpenLayers.Geometry.LinearRing(c.components),d.push(b)}return new OpenLayers.Geometry.Polygon(d)},multipolygon:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.polygon.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(2!=a.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(OpenLayers.Util.isArray(a)){c.type="FeatureCollection";var d=a.length;c.features=new Array(d);for(var e=0;d>e;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector){var g="FeatureCollection only supports collections of features: "+f;throw g}c.features[e]=this.extract.feature.apply(this,[f])}}else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(c=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,[c,b])},writeTojSON:function(a){var b={type:null};if(OpenLayers.Util.isArray(a)){b.type="FeatureCollection";var c=a.length;b.features=new Array(c);for(var d=0;c>d;++d){var e=a[d];if(!e instanceof OpenLayers.Feature.Vector){var f="FeatureCollection only supports collections of features: "+e;throw f}b.features[d]=this.extract.feature.apply(this,[e])}}else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?b=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(b=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(b.crs=this.createCRSObject(a)));return b},createCRSObject:function(a){var b=a.layer.projection.toString(),c={};if(b.match(/epsg:/i)){var d=parseInt(b.substring(b.indexOf(":")+1));c=4326==d?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+d}}}return c},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]),c={type:"Feature",properties:a.attributes,geometry:b};return null!=a.fid&&(c.id=a.fid),c},geometry:function(a){if(null==a)return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME.split(".")[2];if(a.components&&a.components.length>1&&"polygon"===b.toLowerCase()&&-1===b.indexOf("Multi")){b="Multi"+b,mpy=[];for(var c=a.components.length-1;c>=0;c--){var d=new OpenLayers.Geometry.Polygon(a.components[c]);mpy.push(d)}a=new OpenLayers.Geometry.MultiPolygon(mpy)}var e,f=this.extract[b.toLowerCase()].apply(this,[a]);return e="Collection"==b?{type:"GeometryCollection",geometries:f}:{type:b,coordinates:f}},point:function(a){return[a.x,a.y]},multipoint:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},linestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},polygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b},collection:function(a){for(var b=a.components.length,c=new Array(b),d=0;b>d;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(a){var b=this.writeNode("wcs:GetCoverage",a);return this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wcs:{GetCoverage:function(a){var b=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:a.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wcs:DomainSubset",a.domainSubset,b),this.writeNode("wcs:Output",a.output,b),b},DomainSubset:function(a){var b=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",a.boundingBox,b),a.temporalSubset&&this.writeNode("wcs:TemporalSubset",a.temporalSubset,b),b},TemporalSubset:function(a){for(var b=this.createElementNSPlus("wcs:TemporalSubset",{}),c=0,d=a.timePeriods.length;d>c;++c)this.writeNode("wcs:TimePeriod",a.timePeriods[c],b);return b},TimePeriod:function(a){var b=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",a.begin,b),this.writeNode("wcs:EndPosition",a.end,b),a.resolution&&this.writeNode("wcs:TimeResolution",a.resolution,b),b},BeginPosition:function(a){var b=this.createElementNSPlus("wcs:BeginPosition",{value:a});return b},EndPosition:function(a){var b=this.createElementNSPlus("wcs:EndPosition",{value:a});return b},TimeResolution:function(a){var b=this.createElementNSPlus("wcs:TimeResolution",{value:a});return b},Output:function(a){var b=this.createElementNSPlus("wcs:Output",{attributes:{format:a.format,store:a.store}});return a.gridCRS&&this.writeNode("wcs:GridCRS",a.gridCRS,b),b},GridCRS:function(a){var b=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",a.baseCRS,b),a.type&&this.writeNode("wcs:GridType",a.type,b),a.origin&&this.writeNode("wcs:GridOrigin",a.origin,b),this.writeNode("wcs:GridOffsets",a.offsets,b),a.CS&&this.writeNode("wcs:GridCS",a.CS,b),b},GridBaseCRS:function(a){return this.createElementNSPlus("wcs:GridBaseCRS",{value:a})},GridOrigin:function(a){return this.createElementNSPlus("wcs:GridOrigin",{value:a})},GridType:function(a){return this.createElementNSPlus("wcs:GridType",{value:a})},GridOffsets:function(a){return this.createElementNSPlus("wcs:GridOffsets",{value:a})},GridCS:function(a){return this.createElementNSPlus("wcs:GridCS",{value:a})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wps:{ProcessDescriptions:function(a,b){b.processDescriptions={},this.readChildNodes(a,b.processDescriptions)},ProcessDescription:function(a,b){var c=this.getAttributeNS(a,this.namespaces.wps,"processVersion"),d={processVersion:c,statusSupported:"true"===a.getAttribute("statusSupported"),storeSupported:"true"===a.getAttribute("storeSupported")};this.readChildNodes(a,d),b[d.identifier]=d},DataInputs:function(a,b){b.dataInputs=[],this.readChildNodes(a,b.dataInputs)},ProcessOutputs:function(a,b){b.processOutputs=[],this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},ComplexOutput:function(a,b){b.complexOutput={},this.readChildNodes(a,b.complexOutput)},LiteralOutput:function(a,b){b.literalOutput={},this.readChildNodes(a,b.literalOutput)},Input:function(a,b){var c={maxOccurs:parseInt(a.getAttribute("maxOccurs")),minOccurs:parseInt(a.getAttribute("minOccurs"))};this.readChildNodes(a,c),b.push(c)},BoundingBoxData:function(a,b){b.boundingBoxData={},this.readChildNodes(a,b.boundingBoxData)},CRS:function(a,b){b.CRSs||(b.CRSs={}),b.CRSs[this.getChildValue(a)]=!0},LiteralData:function(a,b){b.literalData={},this.readChildNodes(a,b.literalData)},ComplexData:function(a,b){b.complexData={},this.readChildNodes(a,b.complexData)},Default:function(a,b){b["default"]={},this.readChildNodes(a,b["default"])},Supported:function(a,b){b.supported={},this.readChildNodes(a,b.supported)},Format:function(a,b){var c={};this.readChildNodes(a,c),b.formats||(b.formats={}),b.formats[c.mimeType]=!0},MimeType:function(a,b){b.mimeType=this.getChildValue(a)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){return void 0},write:function(a){var b;window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=b):b=document.implementation.createDocument("","",null);var c=this.writeNode("wps:Execute",a,b);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},writers:{wps:{Execute:function(a){var b=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wps:DataInputs",a.dataInputs,b),this.writeNode("wps:ResponseForm",a.responseForm,b),b},ResponseForm:function(a){var b=this.createElementNSPlus("wps:ResponseForm",{});return a.rawDataOutput&&this.writeNode("wps:RawDataOutput",a.rawDataOutput,b),a.responseDocument&&this.writeNode("wps:ResponseDocument",a.responseDocument,b),b},ResponseDocument:function(a){var b=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:a.storeExecuteResponse,lineage:a.lineage,status:a.status}});if(a.outputs)for(var c=0,d=a.outputs.length;d>c;c++)this.writeNode("wps:Output",a.outputs[c],b);return b},Output:function(a){var b=this.createElementNSPlus("wps:Output",{attributes:{asReference:a.asReference,mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("ows:Title",a.title,b),this.writeNode("ows:Abstract",a["abstract"],b),b},RawDataOutput:function(a){var b=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});return this.writeNode("ows:Identifier",a.identifier,b),b
},DataInputs:function(a){for(var b=this.createElementNSPlus("wps:DataInputs",{}),c=0,d=a.length;d>c;++c)this.writeNode("wps:Input",a[c],b);return b},Input:function(a){var b=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",a.identifier,b),a.title&&this.writeNode("ows:Title",a.title,b),a.data&&this.writeNode("wps:Data",a.data,b),a.reference&&this.writeNode("wps:Reference",a.reference,b),a.boundingBoxData&&this.writeNode("wps:BoundingBoxData",a.boundingBoxData,b),b},Data:function(a){var b=this.createElementNSPlus("wps:Data",{});return a.literalData?this.writeNode("wps:LiteralData",a.literalData,b):a.complexData?this.writeNode("wps:ComplexData",a.complexData,b):a.boundingBoxData&&this.writeNode("ows:BoundingBox",a.boundingBoxData,b),b},LiteralData:function(a){var b=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:a.uom},value:a.value});return b},ComplexData:function(a){var b=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}}),c=a.value;return b.appendChild("string"==typeof c?this.getXMLDoc().createCDATASection(a.value):c),b},Reference:function(a){var b=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:a.mimeType,"xlink:href":a.href,method:a.method,encoding:a.encoding,schema:a.schema}});return a.body&&this.writeNode("wps:Body",a.body,b),b},BoundingBoxData:function(a,b){this.writers.ows.BoundingBox.apply(this,[a,b,"wps:BoundingBoxData"])},Body:function(a){var b=this.createElementNSPlus("wps:Body",{});return a.wcs?this.writeNode("wcs:GetCoverage",a.wcs,b):a.wfs?(this.featureType=a.wfs.featureType,this.version=a.wfs.version,this.writeNode("wfs:GetFeature",a.wfs,b)):this.writeNode("wps:Execute",a,b),b}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(a,b){b.executeResponse={lang:a.getAttribute("lang"),statusLocation:a.getAttribute("statusLocation"),serviceInstance:a.getAttribute("serviceInstance"),service:a.getAttribute("service")},this.readChildNodes(a,b.executeResponse)},Process:function(a,b){b.process={},this.readChildNodes(a,b.process)},Status:function(a,b){b.status={creationTime:a.getAttribute("creationTime")},this.readChildNodes(a,b.status)},ProcessSucceeded:function(a,b){b.processSucceeded=!0},ProcessOutputs:function(a,b){b.processOutputs=[],this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},Reference:function(a,b){b.reference={href:a.getAttribute("href"),mimeType:a.getAttribute("mimeType"),encoding:a.getAttribute("encoding"),schema:a.getAttribute("schema")}},Data:function(a,b){b.data={},this.readChildNodes(a,b)},LiteralData:function(a,b){b.literalData={dataType:a.getAttribute("dataType"),uom:a.getAttribute("uom"),value:this.getChildValue(a)}},ComplexData:function(a,b){if(b.complexData={mimeType:a.getAttribute("mimeType"),schema:a.getAttribute("schema"),encoding:a.getAttribute("encoding"),value:""},this.isSimpleContent(a)){var c;for(c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType){case 3:case 4:b.complexData.value+=c.nodeValue}}else for(c=a.firstChild;c;c=c.nextSibling)1==c.nodeType&&(b.complexData.value=c)},BoundingBox:function(a,b){b.boundingBoxData={dimensions:a.getAttribute("dimensions"),crs:a.getAttribute("crs")},this.readChildNodes(a,b.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(a){a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&this.handlers[a].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&this.handlers[a].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a),this.request(b,{single:this.single})},selectBox:function(a){var b;if(a instanceof OpenLayers.Bounds){var c=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),d=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}else{if(this.click)return;b=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(b)},selectHover:function(a){var b=this.pixelToBounds(a.xy);this.request(b,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(a,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:this.filterType,value:a});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var d=this.protocol.read({maxFeatures:b.single===!0?this.maxFeatures:void 0,filter:c,callback:function(c){c.success()&&(c.features.length?b.single===!0?this.selectBestFeature(c.features,a.getCenterLonLat(),b):this.select(c.features):b.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});b.hover===!0&&(this.hoverResponse=d)},selectBestFeature:function(a,b,c){if(c=c||{},a.length){for(var d,e,f,g=new OpenLayers.Geometry.Point(b.lon,b.lat),h=Number.MAX_VALUE,i=0;i<a.length&&(d=a[i],!(d.geometry&&(f=g.distanceTo(d.geometry,{edge:!1}),h>f&&(h=f,e=d,0===h))));++i);c.hover===!0?this.hoverSelect(e):this.select(e||a)}},setModifiers:function(a){this.modifiers={multiple:this.multiple||this.multipleKey&&a[this.multipleKey],toggle:this.toggle||this.toggleKey&&a[this.toggleKey]}},select:function(a){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(a)||(a=[a]);var b=this.events.triggerEvent("beforefeaturesselected",{features:a});if(b!==!1){for(var c,d=[],e=0,f=a.length;f>e;++e)c=a[e],this.features[c.fid||c.id]?this.modifiers.toggle&&this.unselect(this.features[c.fid||c.id]):(b=this.events.triggerEvent("beforefeatureselected",{feature:c}),b!==!1&&(this.features[c.fid||c.id]=c,d.push(c),this.events.triggerEvent("featureselected",{feature:c})));this.events.triggerEvent("featuresselected",{features:d})}},hoverSelect:function(a){var b=a?a.fid||a.id:null,c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;c&&c!==b&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),b&&b!==c&&(this.events.triggerEvent("hoverfeature",{feature:a}),this.hoverFeature=a)},unselect:function(a){delete this.features[a.fid||a.id],this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features)this.features.hasOwnProperty(a)&&this.unselect(this.features[a])},setMap:function(a){for(var b in this.handlers)this.handlers.hasOwnProperty(b)&&this.handlers[b].setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(a){var b=a.add(-this.clickTolerance/2,this.clickTolerance/2),c=a.add(this.clickTolerance/2,-this.clickTolerance/2),d=this.map.getLonLatFromPixel(b),e=this.map.getLonLatFromPixel(c);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),a},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);var a={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(a,b){this.direction=a,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){if(this.map){var a=OpenLayers.Function.bind(function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation),this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(a){var b=new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(b),this.events.triggerEvent("locationupdated",{position:a,point:new OpenLayers.Geometry.Point(b.lon,b.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(a){this.events.triggerEvent("locationfailed",{error:a})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(a){var b;a||(a="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var c=a.split("-");if(c[0]=c[0].toLowerCase(),"object"==typeof OpenLayers.Lang[c[0]]&&(b=c[0]),c[1]){var d=c[0]+"-"+c[1].toUpperCase();"object"==typeof OpenLayers.Lang[d]&&(b=d)}b||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language"),b=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()],d=c&&c[a];return d||(d=a),b&&(d=OpenLayers.String.format(d,b)),d}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layer",noFID:"Can't update a feature for which there is no FID.",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",end:""},OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(a,b,c){var d=c||OpenLayers.Spherical.DEFAULT_RADIUS,e=Math.sin(Math.PI*(b.lon-a.lon)/360),f=Math.sin(Math.PI*(b.lat-a.lat)/360),g=f*f+e*e*Math.cos(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180);return 2*d*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))},OpenLayers.Spherical.computeHeading=function(a,b){var c=Math.sin(Math.PI*(a.lon-b.lon)/180)*Math.cos(Math.PI*b.lat/180),d=Math.cos(Math.PI*a.lat/180)*Math.sin(Math.PI*b.lat/180)-Math.sin(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180)*Math.cos(Math.PI*(a.lon-b.lon)/180);return 180*Math.atan2(c,d)/Math.PI},OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(a),this.tileQueue[a.id]=[];for(var b=0,c=a.layers.length;c>b;++b)this.addLayer({layer:a.layers[b]});a.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[a.id]),a.layers)for(var b=0,c=a.layers.length;c>b;++b)this.removeLayer({layer:a.layers[b]});a.events&&a.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[a.id],delete this.tileQueueId[a.id],OpenLayers.Util.removeItem(this.maps,a)}},move:function(a){this.updateTimeout(a.object,this.moveDelay,!0)},zoomEnd:function(a){this.updateTimeout(a.object,this.zoomDelay)},changeLayer:function(a){("visibility"===a.property||"params"===a.property)&&this.updateTimeout(a.object,0)},addLayer:function(a){var b=a.layer;if(b instanceof OpenLayers.Layer.Grid){b.events.on({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this});var c,d,e;for(c=b.grid.length-1;c>=0;--c)for(d=b.grid[c].length-1;d>=0;--d)e=b.grid[c][d],this.addTile({tile:e}),e.url&&!e.imgDiv&&this.manageTileCache({object:e})}},removeLayer:function(a){var b=a.layer;if(b instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:b}),b.events&&b.events.un({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this}),b.grid)){var c,d,e;for(c=b.grid.length-1;c>=0;--c)for(d=b.grid[c].length-1;d>=0;--d)e=b.grid[c][d],this.unloadTile({object:e}),e.url&&this.manageTileCache({object:e})}},handleLayerRefresh:function(a){var b=a.object;if(b.grid){var c,d,e;for(c=b.grid.length-1;c>=0;--c)for(d=b.grid[c].length-1;d>=0;--d)e=b.grid[c][d],OpenLayers.Util.removeItem(this.tileCacheIndex,e.url),delete this.tileCache[e.url]}},updateTimeout:function(a,b,c){window.clearTimeout(this.tileQueueId[a.id]);var d=this.tileQueue[a.id];(!c||d.length)&&(this.tileQueueId[a.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(a),d.length&&this.updateTimeout(a,this.frameDelay)},this),b))},addTile:function(a){a.tile instanceof OpenLayers.Tile.Image?a.tile.layer.singleTile||a.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:a.tile.layer})},unloadTile:function(a){var b=a.object;b.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[b.layer.map.id],b)},queueTileDraw:function(a){var b=a.object,c=!1,d=b.layer,e=d.getURL(b.bounds),f=this.tileCache[e];return f&&"olTileImage"!==f.className&&(delete this.tileCache[e],OpenLayers.Util.removeItem(this.tileCacheIndex,e),f=null),!c},drawTilesFromQueue:function(a){for(var b=this.tileQueue[a.id],c=this.tilesPerFrame,d=a.zoomTween&&a.zoomTween.playing;!d&&b.length&&c;)b.shift().draw(!0),--c},manageTileCache:function(a){var b=a.object,c=this.tileCache[b.url];c&&(c.parentNode&&OpenLayers.Element.hasClass(c.parentNode,"olBackBuffer")&&(c.parentNode.removeChild(c),c.id=null),c.parentNode||(c.style.visibility="hidden",c.style.opacity=0,b.setImage(c),OpenLayers.Util.removeItem(this.tileCacheIndex,b.url),this.tileCacheIndex.push(b.url)))},addToCache:function(a){return},clearTileQueue:function(a){for(var b=a.object,c=this.tileQueue[b.map.id],d=c.length-1;d>=0;--d)c[d].layer===b&&c.splice(d,1)},destroy:function(){for(var a=this.maps.length-1;a>=0;--a)this.removeMap(this.maps[a]);this.maps=null,this.tileQueue=null,this.tileQueueId=null,this.tileCache=null,this.tileCacheIndex=null,this._destroyed=!0}}),OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.servers={};for(var b in a.servers)this.servers[b]="string"==typeof a.servers[b]?{url:a.servers[b],version:this.version,processDescription:{}}:a.servers[b]},execute:function(a){var b=this.getProcess(a.server,a.process);b.execute({inputs:a.inputs,success:a.success,scope:a.scope})},getProcess:function(a,b,c){var d=new OpenLayers.WPSProcess({client:this,server:a,identifier:b});return this.lazy||d.describe(c),d},describeProcess:function(a,b,c,d){var e=this.servers[a];e.processDescription[b]?window.setTimeout(function(){c.call(d,e.processDescription[b])},0):b in e.processDescription?this.events.register("describeprocess",this,function f(a){a.identifier===b&&(this.events.unregister("describeprocess",this,f),c.call(d,a.raw))}):(e.processDescription[b]=null,OpenLayers.Request.GET({url:e.url,params:{SERVICE:"WPS",VERSION:e.version,REQUEST:"DescribeProcess",IDENTIFIER:b},success:function(a){e.processDescription[b]=a.responseText,this.events.triggerEvent("describeprocess",{identifier:b,raw:a.responseText}),c.call(d,a.responseText)},scope:this}))},destroy:function(){this.events.destroy(),this.events=null,this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"}),OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.executeCallbacks=[],this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(a){if(a=a||{},this.description){if(a.callback){var b=this.description;window.setTimeout(function(){a.callback.call(a.scope,b)},0)}}else this.client.describeProcess(this.server,this.identifier,function(b){this.description||this.parseDescription(b),a.callback&&a.callback.call(a.scope,this.description)},this)},configure:function(a){return this.describe({callback:function(){var b,c,d,e=this.description,f=a.inputs;for(c=0,d=e.dataInputs.length;d>c;++c)b=e.dataInputs[c],this.setInputData(b,f[b.identifier]);a.callback&&a.callback.call(a.scope)},scope:this}),this},execute:function(a){this.configure({inputs:a.inputs,callback:function(){var b=this,c=this.getOutputIndex(b.description.processOutputs,a.output);b.setResponseForm({outputIndex:c}),function d(){return OpenLayers.Util.removeItem(b.executeCallbacks,d),0!==b.chained?void b.executeCallbacks.push(d):void OpenLayers.Request.POST({url:b.client.servers[b.server].url,data:(new OpenLayers.Format.WPSExecute).write(b.description),success:function(d){var e,f=b.description.processOutputs[c];if(f.literalOutput)e="boolean"===f.literalOutput.dataType?"true"===OpenLayers.String.trim(d.responseText).toLowerCase():"double"===f.literalOutput.dataType?parseFloat(d.responseText):d.responseText;else if(f.complexOutput){var g=b.findMimeType(f.complexOutput.supported.formats);e=b.formats[g].read(d.responseText),e instanceof OpenLayers.Feature.Vector&&(e=[e])}if(a.success){var h={};h[a.output||"result"]=e,a.success.call(a.scope,h)}},scope:b})}()},scope:this})},output:function(a){return new OpenLayers.WPSProcess.ChainLink({process:this,output:a})},parseDescription:function(){var a=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(a.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(a,b){if(delete a.data,delete a.reference,b instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,a.reference={method:"POST",href:b.process.server===this.server?this.localWPS:this.client.servers[b.process.server].url},b.process.describe({callback:function(){--this.chained,this.chainProcess(a,b)},scope:this});else{a.data={};var c=a.complexData;if(c){var d=this.findMimeType(c.supported.formats);a.data.complexData={mimeType:d,value:this.formats[d].write(this.toFeatures(b))}}else a.data.literalData={value:b}}},setResponseForm:function(a){a=a||{};var b,c=this.description.processOutputs[a.outputIndex||0];c.complexOutput&&(b=this.findMimeType(c.complexOutput.supported.formats,a.supportedFormats)),this.description.responseForm={rawDataOutput:{identifier:c.identifier,mimeType:b}}},getOutputIndex:function(a,b){var c;if(b){for(var d=a.length-1;d>=0;--d)if(a[d].identifier===b){c=d;break}}else c=0;return c},chainProcess:function(a,b){var c=this.getOutputIndex(b.process.description.processOutputs,b.output);a.reference.mimeType=this.findMimeType(a.complexData.supported.formats,b.process.description.processOutputs[c].complexOutput.supported.formats);var d={};for(d[a.reference.mimeType]=!0,b.process.setResponseForm({outputIndex:c,supportedFormats:d}),a.reference.body=b.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(a){var b=OpenLayers.Util.isArray(a);b||(a=[a]);for(var c,d=new Array(a.length),e=0,f=a.length;f>e;++e)c=a[e],d[e]=c instanceof OpenLayers.Feature.Vector?c:new OpenLayers.Feature.Vector(c);return b?d:d[0]},findMimeType:function(a,b){b=b||this.formats;for(var c in a)if(c in b)return c},CLASS_NAME:"OpenLayers.WPSProcess"}),OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(a){OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"}),OpenLayers.Renderer.SVGExtended=OpenLayers.Class(OpenLayers.Renderer.SVG,{eraseGeometry:function(a){return this.removeArrows(a),OpenLayers.Renderer.SVG.prototype.eraseGeometry.apply(this,arguments)},drawFeature:function(a){return a.geometry&&this.removeArrows(a.geometry),OpenLayers.Renderer.SVG.prototype.drawFeature.apply(this,arguments)},drawLineString:function(a,b){return this.drawArrows(b,a._style),OpenLayers.Renderer.SVG.prototype.drawLineString.apply(this,arguments)},getNodeType:function(a,b){var c;return c=b.bubble?"svg":OpenLayers.Renderer.SVG.prototype.getNodeType.apply(this,arguments)},setStyle:function(a,b){if(OpenLayers.Renderer.SVG.prototype.setStyle.apply(this,arguments),"OpenLayers.Geometry.Point"===a._geometryClass&&b.bubble){var c=(a.id,b.offset);pos=this.getPosition(a),a.setAttributeNS(null,"x",pos.x-(12-.4*c.width)),a.setAttributeNS(null,"y",pos.y-(63-.4*c.height));for(var d=b.color,e=a.childNodes[0],f=e.childNodes[0],g=0,h=f.childNodes.length;h>g;g++)f.childNodes[g].setAttributeNS(null,"fill",d);var i=e.childNodes[1];i.setAttributeNS(null,"fill",d),i.setAttributeNS(null,"fill-opacity","0.5");var j=e.childNodes[2];j.setAttributeNS(null,"fill",d);var k=e.childNodes[3];k.setAttributeNS(null,"stroke",d)}return a},drawPoint:function(a,b){var c=a._style.bubble;return this.MAX_PIXEL=15e3,"svg"===a.nodeName&&c?this.drawBubble(a,b):this.drawCircle(a,b,1)},drawBubble:function(a,b){this.MAX_PIXEL=15e5;var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return this.inValidRange(d,e)&&(a.setAttributeNS(null,"cx",d),a.setAttributeNS(null,"cy",e)),a.firstChild&&a.removeChild(a.firstChild),this.drawBubbleSVG(a,b),a},drawBubbleSVG:function(a){a.setAttributeNS(null,"type","bubble");var b=this.nodeFactory(null,"g");b.setAttributeNS(null,"transform","translate(2,19) scale(0.4)");var c=this.nodeFactory(null,"g"),d=this.nodeFactory(null,"circle"),e=this.nodeFactory(null,"circle"),f=this.nodeFactory(null,"circle");d.setAttributeNS(null,"cx","27"),d.setAttributeNS(null,"cy","30"),d.setAttributeNS(null,"r","3"),d.setAttributeNS(null,"stroke-width","0"),d.setAttributeNS(null,"opacity","0"),e.setAttributeNS(null,"cx","27"),e.setAttributeNS(null,"cy","40"),e.setAttributeNS(null,"r","4"),e.setAttributeNS(null,"stroke-width","0"),e.setAttributeNS(null,"opacity","0"),f.setAttributeNS(null,"cx","27"),f.setAttributeNS(null,"cy","50"),f.setAttributeNS(null,"r","6"),f.setAttributeNS(null,"stroke-width","0"),f.setAttributeNS(null,"opacity","0"),c.appendChild(d),c.appendChild(e),c.appendChild(f);var g=this.nodeFactory(null,"path"),h=this.nodeFactory(null,"path");g.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"stroke-width","1");var i=this.nodeFactory(null,"path");i.setAttributeNS(null,"d","M 0,30.832615 C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 c -1.062271,-39.9612311 -55.0572777,-35.5688568 -53.5570575,0 z"),i.setAttributeNS(null,"stroke-width","3"),i.setAttributeNS(null,"fill","none"),b.appendChild(c),b.appendChild(g),b.appendChild(h),b.appendChild(i),a.appendChild(b)}}),OpenLayers.Renderer.CanvasExtended=OpenLayers.Class(OpenLayers.Renderer.Canvas,{eraseGeometry:function(a){return this.removeArrows(a),OpenLayers.Renderer.Canvas.prototype.eraseGeometry.apply(this,arguments)},drawFeature:function(a){return a.geometry&&this.removeArrows(a.geometry),OpenLayers.Renderer.Canvas.prototype.drawFeature.apply(this,arguments)},drawLineString:function(a,b){return this.drawArrows(a,b),OpenLayers.Renderer.Canvas.prototype.drawLineString.apply(this,arguments)}}),OpenLayers.Renderer.VMLExtended=OpenLayers.Class(OpenLayers.Renderer.VML,{eraseGeometry:function(a){return this.removeArrows(a),OpenLayers.Renderer.VML.prototype.eraseGeometry.apply(this,arguments)},drawFeature:function(a){return a.geometry&&this.removeArrows(a.geometry),OpenLayers.Renderer.VML.prototype.drawFeature.apply(this,arguments)},drawLineString:function(a,b){return this.drawArrows(b,a._style),OpenLayers.Renderer.VML.prototype.drawLineString.apply(this,arguments)}}),OpenLayers.Renderer.prototype.removeArrows=function(a){var b,c=this.vectorRoot.childNodes,d=[];for(b=0;b<c.length;b++){var e=c[b];-1!=e.id.indexOf(a.id+"_arrow")&&d.push(e)}for(b=0;b<d.length;b++)this.vectorRoot.removeChild(d[b])},OpenLayers.Renderer.prototype.drawReverseArrows=function(a,b,c){var d=a[a.length-2],e=a[a.length-1],f=e;f.id=b.id+"_arrow_"+NPMapLib.LINE_ARROW_TYPE_REVERSE,c=OpenLayers.Util.extend({},c),c.graphicName="arrow",c.pointRadius=4,c.rotation=this.getOrientation(d,e),this.drawGeometry(f,c,f.id)},OpenLayers.Renderer.prototype.drawForwordArrows=function(a,b,c){var d=a[0],e=a[1],f=d;f.id=b.id+"_arrow_"+NPMapLib.LINE_ARROW_TYPE_FORWORD,c=OpenLayers.Util.extend({},c),c.graphicName="arrow",c.pointRadius=4,c.rotation=this.getOrientation(d,e)+180,c.rotation>=360&&(c.rotation=c.rotation-360),this.drawGeometry(f,c,f.id)},OpenLayers.Renderer.prototype.drawArrows=function(a,b){if(0!=b.arrowStyle){var c=a.components;switch(b.arrowStyle){case NPMapLib.LINE_ARROW_TYPE_REVERSE:this.drawReverseArrows(c,a,b);break;case NPMapLib.LINE_ARROW_TYPE_FORWORD:this.drawForwordArrows(c,a,b);break;case NPMapLib.LINE_ARROW_TYPE_BOTH:this.drawReverseArrows(c,a,b),this.drawForwordArrows(c,a,b)}}},OpenLayers.Renderer.prototype.getOrientation=function(a,b){if(!b||!a)return 0;var c=b.x-a.x,d=b.y-a.y,e=Math.acos(d/Math.sqrt(c*c+d*d)),f=c>0?1:-1;return Math.round(f*e*180/Math.PI)},OpenLayers.Renderer.symbol.arrow=[0,2,1,0,2,2,1,0,0,2],function(){NPMapLib.Geometry.Point=function(a,b){this.overlayType=NPMapLib.OVERLAY_TYPE_POINT,this.lon=parseFloat(a),this.lat=parseFloat(b),this.CLASS_NAME="NPMapLib.Geometry.Point"},NPMapLib.Geometry.Point.prototype.equals=function(a){return a instanceof NPMapLib.Geometry.Point?this.lon===a.lon&&this.lat===a.lat:!1},NPMapLib.Geometry.Point.prototype.clone=function(){return new NPMapLib.Geometry.Point(this.lon,this.lat)},NPMapLib.Geometry.Point.prototype.transform=function(a,b){var c=new OpenLayers.Geometry.Point(this.lon,this.lat),d=c.transform(a,b);return new NPMapLib.Geometry.Point(d.x,d.y)
},NPMapLib.Geometry.Point.prototype.toString=function(){return this.lon+","+this.lat},NPMapLib.Geometry.Point.prototype.toGeoJson=function(){return{type:"Point",coordinates:[this.lon,this.lat]}}}(),function(){NPMapLib.Geometry.Size=function(a,b){this.width=parseFloat(a),this.height=parseFloat(b),this.CLASS_NAME="NPMapLib.Geometry.Size"},NPMapLib.Geometry.Size.prototype.equals=function(a){return a instanceof NPMapLib.Geometry.Size?this.width===a.width&&this.height===a.height:!1}}(),NPMapLib.MAP_EVENT_CLICK="click",NPMapLib.MAP_EVENT_DBLCLICK="dblclick",NPMapLib.MAP_EVENT_RIGHT_CLICK="rightclick",NPMapLib.MAP_EVENT_MOUSE_MOVE="mousemove",NPMapLib.MAP_EVENT_MOUSE_OVER="mouseover",NPMapLib.MAP_EVENT_MOUSE_OUT="mouseout",NPMapLib.MAP_EVENT_ZOOM_START="zoomstart",NPMapLib.MAP_EVENT_ZOOM_END="zoomend",NPMapLib.MAP_EVENT_ADD_OVERLAY="addoverlay",NPMapLib.MAP_EVENT_REMOVE_OVERLAY="removeoverlay",NPMapLib.MAP_EVENT_CLEAR_OVERLAYS="clearoverlays",NPMapLib.MAP_EVENT_ADD_CONTROL="addcontrol",NPMapLib.MAP_EVENT_REMOVE_CONTROL="removecontrol",NPMapLib.MAP_EVENT_DRAG_START="dragstart",NPMapLib.MAP_EVENT_DRAG_END="dragend",NPMapLib.MAP_EVENT_DRAGGING="dragging",NPMapLib.MAP_EVENT_RESIZE="resize",NPMapLib.MAP_EVENT_ZOOMCHANGE="mapzoomchange",NPMapLib.MAP_EVENT_MOVE_END="moveend",NPMapLib.MAP_EVENT_MOVE_START="movestart",function(){NPMapLib.Map=function(a,b,c){if(this.CLASS_NAME="NPMapLib.Map",this.layers={},this.layerId=1,this._container=a,this._defaultLayer=new NPMapLib.Layers.OverlayLayer("featureLayer"),this._defaultLayer.id=this._getNextLayerId(),this.layers[this._defaultLayer.id]=this._defaultLayer,this.id="number"==typeof c&&c>0?c:NPMapLib.Managers.MapManager.getMaxId(),this._mapAdapter=NPMapLib.Adapter.AdapterFactory.createMapAdapter(a,b,this.id),this._mapAdapter.addDefaultLayer(this._defaultLayer),this._defaultLayer.mapId=this.id,null!==this._mapAdapter&&(NPMapLib.Managers.MapManager.addMap(this),b&&null!=b)){var d=b.zoomOffset;if(d||(d=0),NPMapLib.Utils.BaseUtils.isTypeRight(b.minZoom,"int")){var e=b.minZoom<d?d+b.minZoom:b.minZoom;this.setMinZoom(e)}if(NPMapLib.Utils.BaseUtils.isTypeRight(b.maxZoom,"int")){var f=b.minZoom<d?d+b.maxZoom:b.maxZoom;this.setMaxZoom(f)}this.destoryed=!1}},NPMapLib.Map.prototype._getNextLayerId=function(){return this.layerId++},NPMapLib.Map.prototype.getDefaultLayer=function(){return this._defaultLayer},NPMapLib.Map.prototype.getMapId=function(){return this.id},NPMapLib.Map.prototype.enableScrollWheelZoom=function(){this._mapAdapter&&this._mapAdapter.enableScrollWheelZoom()},NPMapLib.Map.prototype.disableScrollWheelZoom=function(){this._mapAdapter&&this._mapAdapter.disableScrollWheelZoom()},NPMapLib.Map.prototype.enableDoubleClickZoom=function(){this._mapAdapter&&this._mapAdapter.enableDoubleClickZoom()},NPMapLib.Map.prototype.disableDoubleClickZoom=function(){this._mapAdapter&&this._mapAdapter.disableDoubleClickZoom()},NPMapLib.Map.prototype.enableKeyboard=function(){this._mapAdapter&&this._mapAdapter.enableKeyboard()},NPMapLib.Map.prototype.disableKeyboard=function(){this._mapAdapter&&this._mapAdapter.disableKeyboard()},NPMapLib.Map.prototype.enableInertialDragging=function(){this._mapAdapter&&this._mapAdapter.enableInertialDragging()},NPMapLib.Map.prototype.disableInertialDragging=function(){this._mapAdapter&&this._mapAdapter.disableInertialDragging()},NPMapLib.Map.prototype.enableBoxSelect=function(a){this._mapAdapter&&this._mapAdapter.enableBoxSelect(a)},NPMapLib.Map.prototype.disableBoxSelect=function(){this._mapAdapter&&this._mapAdapter.disableBoxSelect()},NPMapLib.Map.prototype.enableEditing=function(a){this._mapAdapter&&this._mapAdapter.enableEditing(a)},NPMapLib.Map.prototype.disableEditing=function(){this._mapAdapter&&this._mapAdapter.disableEditing()},NPMapLib.Map.prototype.enableMapOperation=function(){this._mapAdapter&&this._mapAdapter.enableMapOperation()},NPMapLib.Map.prototype.disableMapOperation=function(){this._mapAdapter&&this._mapAdapter.disableMapOperation()},NPMapLib.Map.prototype.setCursor=function(a){this._mapAdapter&&this._mapAdapter.setCursor(a)},NPMapLib.Map.prototype.getCursor=function(){if(this._mapAdapter)var a=this._mapAdapter.getCursor();return a},NPMapLib.Map.prototype.setMinZoom=function(a){this._mapAdapter&&this._mapAdapter.setMinZoom(a)},NPMapLib.Map.prototype.setMaxZoom=function(a){this._mapAdapter&&this._mapAdapter.setMaxZoom(a)},NPMapLib.Map.prototype.enableLayerSwitcher=function(){this._mapAdapter&&this._mapAdapter.enableLayerSwitcher()},NPMapLib.Map.prototype.disableLayerSwitcher=function(){this._mapAdapter&&this._mapAdapter.disableLayerSwitcher()},NPMapLib.Map.prototype.getModifyFeature=function(){if(this._mapAdapter)var a=this._mapAdapter._modifyFeature;return a},NPMapLib.Map.prototype.getExtent=function(){if(this._mapAdapter){var a=this._mapAdapter.getExtent();return NPMapLib.T.getExtent(this,a)}},NPMapLib.Map.prototype.getCenter=function(){return this._mapAdapter?NPMapLib.T.getPoint(this,this._mapAdapter.getCenter()):void 0},NPMapLib.Map.prototype.getDistance=function(a,b){return this._mapAdapter?("EPSG:900913"==this.getProjection()&&(a=NPMap.T.setPoint(this,a),b=NPMap.T.setPoint(this,b)),this._mapAdapter.getDistance(a,b,this.getProjection())):void 0},NPMapLib.Map.prototype.getSize=function(){return this._mapAdapter?this._mapAdapter.getSize():void 0},NPMapLib.Map.prototype.getZoom=function(){return this._mapAdapter?this._mapAdapter.getZoom():void 0},NPMapLib.Map.prototype.getMaxZoom=function(){return this._mapAdapter?this._mapAdapter.getMaxZoom():void 0},NPMapLib.Map.prototype.getMinZoom=function(){return this._mapAdapter?this._mapAdapter.getMinZoom():void 0},NPMapLib.Map.prototype.getProjection=function(){return this._mapAdapter?this._mapAdapter.map.getProjection():void 0},NPMapLib.Map.prototype.centerAndZoom=function(a,b){this._mapAdapter&&this._mapAdapter.centerAndZoom(NPMapLib.T.setPoint(this,a),b)},NPMapLib.Map.prototype.pan=function(){this._mapAdapter&&this._mapAdapter.pan()},NPMapLib.Map.prototype.panTo=function(a){this._mapAdapter&&this._mapAdapter.panTo(NPMapLib.T.setPoint(this,a))},NPMapLib.Map.prototype.panByPixel=function(a,b){this._mapAdapter&&this._mapAdapter.panByPixel(a,b)},NPMapLib.Map.prototype.reset=function(){this._mapAdapter&&this._mapAdapter.reset()},NPMapLib.Map.prototype.setCenter=function(a,b){this._mapAdapter&&this._mapAdapter.setCenter(NPMapLib.T.setPoint(this,a),b)},NPMapLib.Map.prototype.switchLayer=function(a){this._mapAdapter&&this._mapAdapter.switchLayer(a)},NPMapLib.Map.prototype.switchLayerByName=function(a){this._mapAdapter&&this._mapAdapter.switchLayerByName(a)},NPMapLib.Map.prototype.setZoom=function(a){this._mapAdapter&&this._mapAdapter.setZoom(a)},NPMapLib.Map.prototype.fullExtent=function(a){this._mapAdapter&&this._mapAdapter.fullExtent(a)},NPMapLib.Map.prototype.zoomIn=function(){this._mapAdapter&&this._mapAdapter.zoomIn()},NPMapLib.Map.prototype.zoomOut=function(){this._mapAdapter&&this._mapAdapter.zoomOut()},NPMapLib.Map.prototype.zoomInOutStop=function(){this._mapAdapter&&this._mapAdapter.zoomInOutStop()},NPMapLib.Map.prototype.zoomInFixed=function(){this._mapAdapter&&this._mapAdapter.zoomInFixed()},NPMapLib.Map.prototype.zoomOutFixed=function(){this._mapAdapter&&this._mapAdapter.zoomOutFixed()},NPMapLib.Map.prototype.zoomToExtent=function(a){this._mapAdapter&&this._mapAdapter.zoomToExtent(NPMapLib.T.setExtent(this,a))},NPMapLib.Map.prototype.zoomTo=function(a,b){this._mapAdapter&&this._mapAdapter.zoomTo(NPMapLib.T.setPoint(this,a),b)},NPMapLib.Map.prototype.updateSize=function(){this._mapAdapter&&this._mapAdapter.updateSize()},NPMapLib.Map.prototype.centerAtMouse=function(){this._mapAdapter&&this._mapAdapter.centerAtMouse()},NPMapLib.Map.prototype.addControl=function(a){this._mapAdapter&&a&&a.id&&(NPMapLib.Managers.ControlManager.getControl(a.id)||(a.mapId=this.id,a.visible||a.show(),NPMapLib.Managers.ControlManager.addControl(a)))},NPMapLib.Map.prototype.removeControl=function(a){this._mapAdapter&&a&&a.id&&(a.hide(),a.mapId=-1,NPMapLib.Managers.ControlManager.removeControl(a.id))},NPMapLib.Map.prototype.addHandStyle=function(){this._mapAdapter&&this._mapAdapter.addHandStyleForMap()},NPMapLib.Map.prototype.removeHandStyle=function(){this._mapAdapter&&this._mapAdapter.deleteHandStyleForMap()},NPMapLib.Map.prototype.addJWMousePostion=function(){this._mapAdapter&&this._mapAdapter.addJWMousePosition()},NPMapLib.Map.prototype.removeJWMousePostion=function(){this._mapAdapter&&this._mapAdapter.removeJWMousePostion()},NPMapLib.Map.prototype.activateMouseContext=function(a,b){this._mapAdapter&&(a=a?a:"按住鼠标左键拖选区域<br>释放完成绘制",this._mapAdapter.activateMouseContext(a,b))},NPMapLib.Map.prototype.deactivateMouseContext=function(){this._mapAdapter&&this._mapAdapter.deactivateMouseContext()},NPMapLib.Map.prototype.getMouseContextStyle=function(){return this._mapAdapter?this._mapAdapter.getMouseContextStyle():void 0},NPMapLib.Map.prototype.getMouseContextElement=function(){return this._mapAdapter?this._mapAdapter.getMouseContextElement():void 0},NPMapLib.Map.prototype.setMouseContextStyle=function(a){this._mapAdapter&&this._mapAdapter.setMouseContextStyle(a)},NPMapLib.Map.prototype.getContainer=function(){return this._mapAdapter?this._container:void 0},NPMapLib.Map.prototype.addOverlay=function(a){if(this._mapAdapter&&a&&a instanceof NPMapLib.Overlay){if(this._defaultLayer.addOverlay(a),a.isEnableContextMenu&&a.MenuList){var b=this._mapAdapter;b.addEventListener(a,NPMapLib.MAP_EVENT_RIGHT_CLICK,function(){b.showMenu(a)})}return!0}},NPMapLib.Map.prototype.addOverlays=function(a){this._mapAdapter&&NPMapLib.Utils.BaseUtils.isTypeRight(a,"Array")&&this._defaultLayer.addOverlays(a)},NPMapLib.Map.prototype.removeOverlay=function(a){return this._mapAdapter&&a&&a instanceof NPMapLib.Overlay?"NPMapLib.Symbols.InfoWindow"===a.CLASS_NAME?void this._mapAdapter.removeOverlay(a):void this._defaultLayer.removeOverlay(a):void 0},NPMapLib.Map.prototype.removeOverlays=function(a){if(this._mapAdapter&&NPMapLib.Utils.BaseUtils.isTypeRight(a,"Array"))for(var b=0;b<a.length;b++)this.removeOverlay(a[b])},NPMapLib.Map.prototype.getOverlays=function(){return this._mapAdapter?this._mapAdapter.getOverlays():void 0},NPMapLib.Map.prototype.clearOverlays=function(){this._mapAdapter&&(this._mapAdapter.clearOverlays(),this._defaultLayer.removeAllOverlays())},NPMapLib.Map.prototype.getInfoWindows=function(){return this._mapAdapter?this._mapAdapter.getInfoWindow():void 0},NPMapLib.Map.prototype.closeAllInfoWindows=function(){var a=this.getInfoWindows();if(a)for(var b=a.length-1;b>=0;b--)a[b].close()},NPMapLib.Map.prototype.addContextMenu=function(a){var b=this;this.addEventListener("rightclick",function(c,d){var e=b.pointToPixel(c);b._mapAdapter.showMapMenu(e,a,d)})},NPMapLib.Map.prototype.removeContextMenu=function(a){var b=this;this.removeEventListener("rightclick",function(c,d){var e=b.pointToPixel(c);b._mapAdapter.showMapMenu(e,a,d)})},NPMapLib.Map.prototype.addLayer=function(a){if("NPMapLib.Layers.NPLayer"===a.CLASS_NAME){if(a.opts&&a.opts.layerInfo)this.initMapLayer(a.opts.layerInfo,a);else{var b=this._addNPLayer(a,this.initMapLayer);this.destroyRequest(b)}this.layers[a.id]||(a.id=a.id&&-1!==a.id?a.id:this._getNextLayerId(),this.layers[a.id]=a)}else{if(a instanceof NPMapLib.Layers.ArcgisTileLayer?EzServerClient.GlobeParams.MyMapType=NPMapLib.MAPTYPE_ARCGISTILE:a instanceof NPMapLib.Layers.EzMapTileLayer&&(EzServerClient.GlobeParams.MyMapType=NPMapLib.MAPTYPE_PGIS),!this._mapAdapter)return;if(this.layers[a.id]||(a.id=a.id&&-1!==a.id?a.id:this._getNextLayerId(),this.layers[a.id]=a),"NPMapLib.Layers.ArcgisTileLayer"===a.CLASS_NAME)if(a.opts&&a.opts.layerInfo)this.initArcgisLayer(a.opts.layerInfo,a);else if(a.opts&&a.opts.resolutions)this._mapAdapter.addLayer(a),a.mapId=this.id,a.setMap(this);else{var b=this._addNPLayer(a,this.initArcgisLayer);this.destroyRequest(b)}else this._mapAdapter.addLayer(a),a.mapId=this.id,a.setMap(this)}},NPMapLib.Map.prototype.initArcgisLayer=function(a,b){var c=a.tileInfo;if(c.lods)for(var d=0;d<c.lods.length;d++)b.resolutions.push(c.lods[d].resolution);c.rows&&(b.tilePixels=c.rows),c.origin&&(b.origin=[],b.origin.push(c.origin.x),b.origin.push(c.origin.y)),a.fullExtent&&(b.fullExtent.push(a.fullExtent.xmin),b.fullExtent.push(a.fullExtent.ymin),b.fullExtent.push(a.fullExtent.xmax),b.fullExtent.push(a.fullExtent.ymax)),c.spatialReference&&(b.projection="EPSG:"+c.spatialReference.wkid),c.format&&(b.type="jpg"),b._opts={isBaseLayer:b.isBaseLayer,resolutions:b.resolutions,tilePixels:b.tilePixels,origin:b.origin,fullExtent:b.fullExtent,projection:b.projection,zoomOffset:0},this._mapAdapter.addLayer(b),b.mapId=this.id,b.setMap(this)},NPMapLib.Map.prototype.initMapLayer=function(a,b){if(a.layerType&&(b.layerType=a.layerType),a.fullExtent)for(var c=0;c<a.fullExtent.length;c++)b.fullExtent.push(a.fullExtent[c]);a.type&&(b.type=a.type),a.centerPoint&&(b.centerPoint=a.centerPoint);var d=null,e=b.url+"/getTile?";switch(b.layerType){case"tiandi":case"NPMapLib.Layers.TDMapLayer":b._opts={mapType:b.type,centerPoint:b.centerPoint,fullExtent:b.fullExtent,topLevel:0,bottomLevel:18,isBaseLayer:b.isBaseLayer,zoomOffset:0},b._opts.fullExtent=[-180,-90,180,90],d=new NPMapLib.Layers.TDMapLayer(e,b.name,b._opts);break;case"gaode":case"NPMapLib.Layers.GaoDeLayer":b._opts={centerPoint:b.centerPoint,fullExtent:b.fullExtent,isBaseLayer:b.isBaseLayer},d=new NPMapLib.Layers.GaoDeLayer(e,b.name,b._opts);break;case"google":case"NPMapLib.Layers.GoogleOffLineLayer":b._opts={isOnline:!0,centerPoint:b.centerPoint,fullExtent:b.fullExtent,isBaseLayer:b.isBaseLayer},d=new NPMapLib.Layers.GoogleOffLineLayer(e,b.name,b._opts);break;case"baidu":case"NPMapLib.Layers.BaiduTileLayer":e+="X=${x}&Y=${y}&L=${z}",b._opts={centerPoint:b.centerPoint,fullExtent:b.fullExtent,isBaseLayer:b.isBaseLayer},d=new NPMapLib.Layers.BaiduTileLayer(e,b.name,b._opts);break;case"streetmap":case"NPMapLib.Layers.OSMLayer":e+="X=${x}&Y=${y}&L=${z}",d=new NPMapLib.Layers.OSMLayer(e,b.name,{isChian:!1,centerPoint:b.centerPoint,isBaseLayer:b.isBaseLayer});break;case"pgis":case"NPMapLib.Layers.EzMapTileLayer":e+="X=${x}&Y=${y}&L=${z}",d=new NPMapLib.Layers.EzMapTileLayer(e,"矢量影像地图",{centerPoint:b.centerPoint})}d&&(this._mapAdapter.addLayer(d),d.mapId=this.id,d.setMap(this),b._apiObj=d._apiObj,b.mapId=this.id,b.setMap(this))},NPMapLib.Map.prototype._addNPLayer=function(layer,callback){OpenLayers.Request.GET({url:layer.url+"?f=pjson",async:!1,scope:this,success:function(reply){var layerInfo=eval("("+reply.responseText+")");callback.call(this,layerInfo,layer)}})},NPMapLib.Map.prototype.destroyRequest=function(){},NPMapLib.Map.prototype.addLayers=function(a){if(this._mapAdapter)for(var b=0;b<a.length;b++)this.addLayer(a[b])},NPMapLib.Map.prototype.removeLayer=function(a){this._mapAdapter&&(a.clusterStrategy&&a.clusterStrategy.deactivate(),this._mapAdapter.removeLayer(a))},NPMapLib.Map.prototype.removeLayerByName=function(a){if(this._mapAdapter){var b=this.getLayerByName(a);b&&b.clusterStrategy&&b.clusterStrategy.clusterStrategy.deactivate(),this._mapAdapter.removeLayerByName(a)}},NPMapLib.Map.prototype.getLayer=function(a){return this._mapAdapter?this.layers[a]:void 0},NPMapLib.Map.prototype.getLayerByName=function(a){if(this._mapAdapter)for(var b in this.layers)if(this.layers[b]._apiObj.name===a)return this.layers[b]},NPMapLib.Map.prototype.getVisibleLayers=function(){if(this._mapAdapter){var a=[];for(var b in this.layers)this.layers[b]._apiObj.visibility&&a.push(this.layers[b]);return a}},NPMapLib.Map.prototype.setBaseLayer=function(a){this._mapAdapter&&this._mapAdapter.setBaseLayer(a)},NPMapLib.Map.prototype.setVisibilityDefalutLayer=function(a){this._mapAdapter&&this._mapAdapter.setVisibilityDefalutLayer(a)},NPMapLib.Map.prototype.containFeatures=function(a,b,c){return this.layer.containFeatures(a,b,c)},NPMapLib.Map.prototype.pixelToPoint=function(a){return this._mapAdapter?NPMapLib.T.getPoint(this,this._mapAdapter.pixelToPoint(a)):void 0},NPMapLib.Map.prototype.pointToPixel=function(a){return this._mapAdapter?this._mapAdapter.pointToPixel(NPMapLib.T.setPoint(this,a)):void 0},NPMapLib.Map.prototype.addEventListener=function(a,b){this._mapAdapter&&this._mapAdapter.addEventListener(this,a,b)},NPMapLib.Map.prototype.removeEventListener=function(a){this._mapAdapter&&this._mapAdapter.removeEventListener(this,a)},NPMapLib.Map.prototype.containsPoint=function(a,b){return this._mapAdapter.containsPoint(a,b)},NPMapLib.Map.prototype.getMapUnits=function(){return this._mapAdapter?this._mapAdapter.getMapUnits():void 0},NPMapLib.Map.prototype.setDefaultMapCursor=function(a){return this._mapAdapter?this._mapAdapter.setDefaultMapCursor(a):void 0},NPMapLib.Map.prototype.getAllLayers=function(){return this.layers},NPMapLib.Map.prototype.destroyMap=function(){if(!this.destoryed){for(var a in this.layers){var b=this.layers[a];b instanceof NPMapLib.Layers.OverlayLayer&&(b.removeAllOverlays(),this.layers[a]=null)}this.layers=null,NPMapLib.Adapter.AdapterFactory.getAdapters()[this._container.id]=null,this._mapAdapter.map.destroy(),this._mapAdapter=null,this.destoryed=!0}},NPMapLib.Map.prototype.getTitleSize=function(){if(this._mapAdapter){var a=this._mapAdapter.map.tileSize;return new NPMapLib.Geometry.Size(a.w,a.h)}},NPMapLib.Map.prototype.getVersion=function(){return NPMapLib.VERSION_NUMBER},NPMapLib.Map.prototype.setFallThrough=function(a){this._mapAdapter&&(this._mapAdapter.map.events.fallThrough=a)},NPMapLib.Map.prototype.getRestrictedExtent=function(){return NPMapLib.T.getExtent(this,this._mapAdapter.map.restrictedExtent)},NPMapLib.Map.prototype.setMapStyle=function(a){this._mapAdapter&&this._mapAdapter.setMapStyle(a)},NPMapLib.Map.prototype.getMapTileUrl=function(a){var b=this.pointToPixel(a),c=this.getTitleSize().width,d=b.x-c/3,e=b.y-c/3,f=b.x+c/3,g=b.y+c/3,h=NPMapLib.T.setPoint(this,this.pixelToPoint({x:d,y:e})),i=NPMapLib.T.setPoint(this,this.pixelToPoint({x:f,y:g})),j=new OpenLayers.Bounds(h.lon,i.lat,i.lon,h.lat);return this._mapAdapter.map.baseLayer.getURL(j)}}(),function(){var a=NPMapLib.Map,b=0;a.registry={},a.register=function(c){var d="c"+ ++b;return a.registry[d]=function(){c.apply(this,arguments)},d},a.unregister=function(b){delete a.registry[b]}}(),function(){NPMapLib.Events=function(a,b){this.CLASS_NAME="NPMapLib.Events",this.obj=a,this.listeners={},this.supportEvents=b||[],this.through=!0},NPMapLib.Events.prototype._internalEvent=["_register","_unregister"]}(),NPMapLib.Events.prototype={setSupportEvent:function(a){this.supportEvents=a||[]},supportEvent:function(a){var b=!1;return this.obj.suppertEvent&&(b=this.obj.suppertEvent(a)),b||this.supportEvents.indexOf(a)>=0||this._internalEvent.indexOf(a)>=0},register:function(a,b,c){if(this.supportEvent(a)){var d=this.listeners[a];d?d.push({f:b,s:c}):(this.triggerEvt("_register",{eventType:a}),this.listeners[a]=[{f:b,s:c}])}},unregister:function(a,b){var c=this.listeners[a];if(c){for(var d=-1,e=0,f=c.length;f>e;++e)if(c[e].f===b){d=e;break}d>=0&&c.pop(b),c.length<=0&&this.triggerEvt("_unregister",{eventType:a})}},triggerEvt:function(a,b){var c=this.listeners[a];if(c&&c.length>0){b=b||{},b.srcObject=this.obj,b.eventType||(b.eventType=a);for(var d=0,e=c.length;e>d&&(c[d].f.call(c[d].s,b)!==!1&&this.through);++d);}}},function(){NPMapLib.Layer=function(){this.CLASS_NAME="NPMapLib.Layer",this.isAddToMap=!0,this.id=-1,this.mapId=null,this.url,this.name="Not Set",this.visible=!0,this.minLevel=0,this.maxLevel=0,this.map=null},NPMapLib.Layer.prototype.getUrl=function(){return this.url},NPMapLib.Layer.prototype.setUrl=function(a){this.url=a},NPMapLib.Layer.prototype.isVisible=function(){return this.visible},NPMapLib.Layer.prototype.setName=function(a){this.name=a},NPMapLib.Layer.prototype.getName=function(){return this.name},NPMapLib.Layer.prototype.setMinLevel=function(a){this.minLevel=a},NPMapLib.Layer.prototype.getMinLevel=function(){return this.minLevel},NPMapLib.Layer.prototype.setMaxLevel=function(a){this.maxLevel=a},NPMapLib.Layer.prototype.getMaxLevel=function(){return this.maxLevel},NPMapLib.Layer.prototype.show=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showLayer(this)},NPMapLib.Layer.prototype.hide=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideLayer(this)},NPMapLib.Layer.prototype.clearTiles=function(){if(!(this instanceof NPMapLib.Layers.OverlayLayer)){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.clearTiles(this)}},NPMapLib.Layer.prototype.getZIndex=function(){return this._apiObj?parseInt(this._apiObj.getZIndex()):void 0},NPMapLib.Layer.prototype.setZIndex=function(a){this._apiObj&&this._apiObj.setZIndex(a)},NPMapLib.Layer.prototype.setMap=function(a){this.map=a},NPMapLib.Layer.prototype.getVisible=function(){return this._apiObj?this._apiObj.visibility:this.visible},NPMapLib.Layer.prototype.refresh=function(){if(this instanceof NPMapLib.Layers.OverlayLayer){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a&&this._apiObj)for(var b=this._apiObj.features,c=0;c<b.length;c++)b[c].style=a.getOverlayStyle(b[c].data),this._apiObj.drawFeature(b[c])}}}(),function(){NPMapLib.Layers.EzMapOffLineLayer=function(a,b,c){this._opts=c,this.url=a,this.name=b,this.CLASS_NAME="NPMapLib.Layers.EzMapOffLineLayer"},NPMapLib.Layers.EzMapOffLineLayer.prototype=new NPMapLib.Layer}(),function(){var a=NPMapLib.Layers.EzMapTileLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={units:"Lat-66",type:"png",tileOrigin:[0,0],isBaseLayer:!0},c){c.projection="EPSG:4326";for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}}this.CLASS_NAME="NPMapLib.Layers.EzMapTileLayer"};a.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.GoogleMapTileLayer=function(a,b,c){this.url=a,this.name=b,this._opts=c||{},this._opts.projection="EPSG:900913",this._opts.displayProjection="EPSG:4326",this.CLASS_NAME="NPMapLib.Layers.GoogleMapTileLayer",this._opts.fullExtent=[-20037508.34,-20037508.34,20037508.34,20037508.34],this._opts.numZoomLevels=22,NPMap.PROJECT="900913_CHINA"},NPMapLib.Layers.GoogleMapTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.GoogleOffLineLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={type:"png",fullExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],minLevel:0,maxLevel:6,zoomOffset:13,zoomLevelSequence:2,numZoomLevels:22},c)for(var d in c){if(c.hasOwnProperty(d))var e=c[d];void 0!==e&&(this._opts[d]=e)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.GoogleOffLineLayer"},NPMapLib.Layers.GoogleOffLineLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.ArcgisTileLayer=function(a,b,c){this.url=a,this.name=b,this.isBaseLayer=c&&"boolean"==typeof c.isBaseLayer?c.isBaseLayer:!0,this.opts=c,this.resolutions=[],this.tilePixels=512,this.origin=[-400,400],this.fullExtent=[],this.projection="EPSG:4326",this.type="jpg",this.CLASS_NAME="NPMapLib.Layers.ArcgisTileLayer"},NPMapLib.Layers.ArcgisTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.WMSLayer=function(a,b,c){if(this.name=b,this.url=a,this._opts={projection:"EPSG:4326",tiled:!0,format:"image/png",mapUnitPixels:256,buffer:2,reproject:!0},c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}this.CLASS_NAME="NPMapLib.Layers.WMSLayer"},NPMapLib.Layers.WMSLayer.prototype=new NPMapLib.Layer}(),function(){var a=NPMapLib.Layers.VectorGMLLayer=function(a,b,c){this.url=a,this.name=b,this._opts=c,this.CLASS_NAME="NPMapLib.Layers.VectorGMLLayer"};a.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.OverlayLayer=function(a,b,c){this.CLASS_NAME="NPMapLib.Layers.OverlayLayer",this.name=a,this._overlays={},this.clusterFeature=[],this.useCluster=b?b:!1,c=c?c:{},this.opts=c,this.onmouseover=c.mouseover?c.mouseover:function(){},this.onmouseout=c.mouseout?c.mouseout:function(){},this.onSelect=c.click?c.click:function(){},this.clusteronmouseover=c.clusteronmouseover?c.clusteronmouseover:function(){},this.maxZoom=null,this.distance=200,this.selectZoom=null,this.isAsynchronous=!0,this.labelYOffset=null,this.minZoom=null,this.statistics=[],this.groups={},this.minClusterCount=0,this.isCommonCluster=!0,this.customLabelOffset=null,this.useCluster&&(this.getUrl=c.getUrl?c.getUrl:function(){return"/images/Flag_Red.png"},this.getImageSize=c.getImageSize?c.getImageSize:function(){return{width:20,height:20}},this.getContent=c.getContent?c.getContent:function(){return""},this.getCustomLabelOffset=c.getCustomLabelOffset,this.getRotation=c.getRotation?c.getRotation:function(){},this.getBackGroundColor=c.getBackGroundColor?c.getBackGroundColor:function(){},this.clusterClickModel=c.clusterClickModel?c.clusterClickModel:"zoom",c.maxZoom&&(this.maxZoom=c.maxZoom),this.defaultStyle={fontColor:"white"},c.fontColor&&(this.defaultStyle.fontColor=c.fontColor),c.customLabelFontColor&&(this.defaultStyle.customLabelFontColor=c.customLabelFontColor),c.customFontSize&&(this.defaultStyle.customFontSize=c.customFontSize),c.fontSize&&(this.defaultStyle.fontSize=c.fontSize),c.distance&&(this.distance=c.distance),c.selectZoom&&(this.selectZoom=c.selectZoom),"boolean"==typeof c.isAsynchronous&&(this.isAsynchronous=c.isAsynchronous),c.labelYOffset&&(this.labelYOffset=c.labelYOffset),c.minZoom&&(this.minZoom=c.minZoom),c.statistics&&(this.statistics=c.statistics),c.minClusterCount&&(this.minClusterCount=c.minClusterCount),c.isCommonCluster===!1&&(this.isCommonCluster=c.isCommonCluster),c.customLabelOffset&&(this.customLabelOffset=c.customLabelOffset),c.labelBackgroundColor&&(this.defaultStyle.labelBackgroundColor=c.labelBackgroundColor),c.threshold&&(this.threshold=c.threshold),c.isHideContext&&(this.isHideContext=c.isHideContext),c.getTitle=c.getTitle||function(){})},NPMapLib.Layers.OverlayLayer.prototype=new NPMapLib.Layer,NPMapLib.Layers.OverlayLayer.prototype.addOverlay=function(a,b){if(NPMapLib.Utils.BaseUtils.isTypeRight(a,"NPMapLib.Overlay")){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&(this.useCluster&&(this.opts.success=b,a.opts=this.opts,this._overlays={}),c.addOverlay(a,this),a.mapId=this.mapId,a._layer=this,this._overlays[a.id]=a,a.isEnableContextMenu&&a.MenuList&&a.addEventListener("rightclick",function(){c.showMenu(a)}))}},NPMapLib.Layers.OverlayLayer.prototype.addOverlays=function(a){if(NPMapLib.Utils.BaseUtils.isTypeRight(a,"Array"))for(var b=0;b<a.length;b++)this.addOverlay(a[b])},NPMapLib.Layers.OverlayLayer.prototype.getOverlays=function(){return this._overlays},NPMapLib.Layers.OverlayLayer.prototype.getOverlaysArry=function(){var a=[];for(var b in this._overlays)this._overlays.hasOwnProperty(b)&&a.push(this._overlays[b]);return a},NPMapLib.Layers.OverlayLayer.prototype._findOverlaysByExtent=function(a,b){b=b?b:function(){return!0};var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),d=[];if(!c)return d;a=NPMapLib.T.setExtent(c,a);var e=new OpenLayers.Bounds([a.sw.lon,a.sw.lat,a.ne.lon,a.ne.lat]);for(var f in this._overlays)if(this._overlays.hasOwnProperty(f))if(this._overlays[f]instanceof NPMapLib.Symbols.ClusterPoints)for(var g=this._overlays[f].dataJson.length-1;g>=0;g--){var h=NPMapLib.T.setPoint(c,this._overlays[f].dataJson[g].location);e.contains(h.lon,h.lat)&&b(this._overlays[f].dataJson[g])&&d.push(this._overlays[f].dataJson[g])}else this._overlays[f]._apiObj&&e.intersectsBounds(this._overlays[f]._apiObj.geometry.bounds)&&b(this._overlays[f])&&d.push(this._overlays[f]);return d},NPMapLib.Layers.OverlayLayer.prototype._findOverlaysByGeometry=function(a,b){b=b?b:function(){return!0};var c=[],d=a._apiObj.geometry,e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(d&&e)for(var f in this._overlays)if(this._overlays.hasOwnProperty(f))if(this._overlays[f]instanceof NPMapLib.Symbols.ClusterPoints)for(var g=this._overlays[f].dataJson.length-1;g>=0;g--){var h=NPMapLib.T.setPoint(e,this._overlays[f].dataJson[g].location),i={x:h.lon,y:h.lat};d.containsPoint(i)&&b(this._overlays[f].dataJson[g])&&c.push(this._overlays[f].dataJson[g])}else this._overlays[f]._apiObj&&d.intersects(this._overlays[f]._apiObj.geometry)&&b(this._overlays[f])&&c.push(this._overlays[f]);return c},NPMapLib.Layers.OverlayLayer.prototype.containFeatures=function(a,b){return a instanceof NPMapLib.Geometry.Extent?this._findOverlaysByExtent(a,b):this._findOverlaysByGeometry(a,b)},NPMapLib.Layers.OverlayLayer.prototype.getOverlay=function(a){return this._overlays[a]},NPMapLib.Layers.OverlayLayer.prototype.getOverlaysByProperty=function(a,b){var c=[];for(var d in this._overlays)if(this._overlays[d]instanceof NPMapLib.Symbols.ClusterPoints)for(var e=0;e<this._overlays[d].dataJson.length;e++)this._overlays[d].dataJson[e].getData()[a]===b&&c.push(this._overlays[d].dataJson[e]);else this._overlays[d].getData()&&this._overlays[d].getData()[a]===b&&c.push(this._overlays[d]);return c},NPMapLib.Layers.OverlayLayer.prototype.removeOverlay=function(a){if(a)if(this._overlays[a]){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b.removeOverlay(this._overlays[a]),b.removeOverlayEvent(this._overlays[a]),this._overlays[a].mapId=null,this._overlays[a]._apiObj=null,delete this._overlays[a]}else{var c=a.id;this._overlays[c]&&this.removeOverlay(c)}},NPMapLib.Layers.OverlayLayer.prototype.removeAllOverlays=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){a.removerAllOverlaysByLayerName(this.name);for(var b in this._overlays){if(this.useCluster&&this._overlays[b]instanceof NPMapLib.Symbols.ClusterPoints)for(var c=this._overlays[b].dataJson,d=0;d<c.length;d++)c[d]._apiObj=null,c[d]=null,delete c[d];a.removeOverlayEvent(this._overlays[b]),"NPMapLib.Symbols.InfoWindow"!==this._overlays[b].CLASS_NAME?(this._overlays[b].mapId=null,this._overlays[b]._apiObj=null,this._overlays[b]=null,delete this._overlays[b]):(this._overlays[b].close(),this._overlays[b]=null,delete this._overlays[b])}this.clusterStrategy&&(this.clusterStrategy.features=null,this.clusterStrategy._clusterDataStatus=[],this.clusterStrategy.clusters=[],this.clusterStrategy.oldClusters=[],this.clusterStrategy.previousClusters=[],this.clusterStrategy._xData=[]),this._overlays={}}},NPMapLib.Layers.OverlayLayer.prototype.show=function(){this.visible=!0;var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showLayer(this)},NPMapLib.Layers.OverlayLayer.prototype.hide=function(){this.visible=!1;var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideLayer(this)},NPMapLib.Layers.OverlayLayer.prototype.refresh=function(){this.useCluster?this.clusterStrategy&&(this.clusterStrategy.currentZoom=-1,this.clusterStrategy.cluster({type:"moveend",zoomChanged:!0})):NPMapLib.Layer.prototype.refresh.apply(this)},NPMapLib.Layers.OverlayLayer.prototype.setMakrerTypeVisiable=function(a,b){if(this.useCluster){"string"==typeof b&&(b="True"==b);var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.setMakrerTypeVisiable(this,a,b)}},NPMapLib.Layers.OverlayLayer.prototype.addClusterPoints=function(a){if(this._apiObj.removeFeatures(this.clusterFeature,{silent:!0}),this.clusterFeature=[],this.useCluster&&a&&a.cluster&&a.cluster instanceof Array){for(var b=0;b<a.cluster.length;b++)a.cluster[b]._apiObj||(a.cluster[b]._apiObj=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.cluster[b].geometry.x,a.cluster[b].geometry.y),a.cluster[b])),a.cluster[b]._apiObj.style=a.cluster[b].style,this.clusterFeature.push(a.cluster[b]._apiObj);this._apiObj.addFeatures(this.clusterFeature,{silent:!0})}},NPMapLib.Layers.OverlayLayer.prototype.setClusterStatistics=function(a){if(this.statistics=a,this.clusterStrategy){for(var b=[],c=this.statistics,d=c.length-1;d>=0;d--){var e=NPMapLib.T.setPoint(that,{lon:c[d].x,lat:c[d].y});b.push({x:e.lon,y:e.lat,label:c[d].label})}this.clusterStrategy.setStatistics(b)}},NPMapLib.Layers.OverlayLayer.prototype.filterClusterMarks=function(a){if(this.useCluster){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&(null==a&&(a=function(){return!0
}),b.filterClusterMarks(this,a))}},NPMapLib.Layers.OverlayLayer.prototype.addGroup=function(a){return this.useCluster?null:""===a?null:(this.groups[a]||(this.groups[a]=new NPMapLib.Layers.LayerGroup(a,this)),this.groups[a])},NPMapLib.Layers.OverlayLayer.prototype.removeGroup=function(a){this.useCluster||(this.groups[a]&&this.groups[a].removeAllOverlays(),this.groups[a]=null)},NPMapLib.Layers.OverlayLayer.prototype.removeAllGroups=function(){if(!this.useCluster){for(var a in this.groups)this.groups.hasOwnProperty(a)&&(this.groups[a].removeAllOverlays(),this.groups[a]=null);this.groups={}}},NPMapLib.Layers.OverlayLayer.prototype.getAllGroups=function(){return this.useCluster?{}:this.groups},NPMapLib.Layers.OverlayLayer.prototype.getGroupByName=function(a){return this.groups[a]}}(),function(){NPMapLib.Layers.BaiduTileLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={isBaseLayer:!0,origin:[0,0],fullExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],sateTiles:!1,maxResolution:262144,maxZoomLevel:20},c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}NPMap.PROJECT="900913_BAIDU",this.CLASS_NAME="NPMapLib.Layers.BaiduTileLayer"},NPMapLib.Layers.BaiduTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.BingTileLayer=function(a,b,c){this.url=a,this.name=b,this._opts=c,this.CLASS_NAME="NPMapLib.Layers.BingTileLayer"},NPMap.PROJECT="900913_CHINA",NPMapLib.Layers.BingTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.ImageLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={isBaseLayer:!0,zoomOffset:0,minLevel:0,maxLevel:8},c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}this.CLASS_NAME="NPMapLib.Layers.ImageLayer"},NPMapLib.Layers.ImageLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.TDMapLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={isBaseLayer:!0,mapType:"EMap",fullExtent:[-180,-90,180,90],topLevel:0,bottomLevel:22,isLocalMap:!1},c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}this.CLASS_NAME="NPMapLib.Layers.TDMapLayer"},NPMapLib.Layers.TDMapLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.QQMapLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={fullExtent:[-180,-180,180,180],sateTiles:!1,isBaseLayer:!0},c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.QQMapLayer"},NPMapLib.Layers.QQMapLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.GaoDeLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={fullExtent:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],isBaseLayer:!0},c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.GaoDeLayer"},NPMapLib.Layers.GaoDeLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.SuperMapLayer=function(a,b,c){if(this.url=a,this.name=b,this._opts={fullExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],sateTiles:!1,maxResolution:156543.0339280408,isBaseLayer:!0},c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];void 0!==e&&(this._opts[d]=e)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.SuperMapLayer"},NPMapLib.Layers.SuperMapLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.HeatMapLayer=function(a,b){this.CLASS_NAME="NPMapLib.Layers.HeatMapLayer",this.name=a,this.visible=!0,this.radius=10,(b.visible===!0||b.visible===!1)&&(this.visible=b.visible),b.radius&&(this.radius=b.radius),b.projection&&(b.projection=new OpenLayers.Projection(b.projection)),this._opts=b},NPMapLib.Layers.HeatMapLayer.prototype=new NPMapLib.Layer,NPMapLib.Layers.HeatMapLayer.prototype.setDataset=function(a){if(a){for(var b={max:a.max,data:[]},c=a.data,d=c.length,e=[];d--;)e.push({lonlat:new OpenLayers.LonLat(c[d].lon,c[d].lat),count:c[d].count});b.data=e,this._apiObj&&this._apiObj.setDataSet(b)}},NPMapLib.Layers.HeatMapLayer.prototype.addDataPoint=function(a){if(a&&a instanceof NPMapLib.Geometry.Point){var b=new OpenLayers.LonLat(a.lon,a.lat);this._apiObj&&this._apiObj.addDataPoint(b)}},NPMapLib.Layers.HeatMapLayer.prototype.toggle=function(){this._apiObj&&this._apiObj.toggle()}}(),function(){NPMapLib.Layers.WMTSLayer=function(a,b,c){this.url=a,this.name=b,this._opts=c,this.CLASS_NAME="NPMapLib.Layers.WMTSLayer"},NPMapLib.Layers.WMTSLayer.prototype=new NPMapLib.Layer}(),function(){var a=NPMapLib.Layers.HotspotLayer=function(a,b,c){this.CLASS_NAME="NPMapLib.Layers.HotspotLayer",this.isAddToMap=!1,this.name=a,c=c?c:{},this.url=b,this.onmouseover=c.mouseover?c.mouseover:function(){},this.onmouseout=c.mouseout?c.mouseout:function(){},this.click=c.click?c.click:function(){},this.filter=c.filter?c.filter:function(){return!0},this.getImageSize=c.getImageSize?c.getImageSize:function(){return{width:20,height:20}},this.getImageUrl=c.getImageUrl?c.getImageUrl:function(){return OpenLayers.Util.getImageLocation("marker.png")},this.featureCursor=c.featureCursor?c.featureCursor:"pointer",this.showMinZoom=c.showMinZoom,this.showMaxZoom=c.showMaxZoom};a.prototype=new NPMapLib.Layer,a.prototype.show=function(){this.visible=!0;var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showLayer(this)},a.prototype.hide=function(){this.visible=!1;var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideLayer(this)},a.prototype.setfilter=function(a){if(this._apiObj&&"function"==typeof a){var b=this._apiObj.strategies[0];b.filter=a;for(var c in b.geometryFeatureMap)if(b.geometryFeatureMap.hasOwnProperty(c)){var d=b.geometryFeatureMap[c];a(d.data)?this._apiObj.addFeatures([d],{silent:!0}):this._apiObj.removeFeatures(d)}}},a.prototype.setMap=function(a){this.map=a,this.showMinZoom=this.showMinZoom?this.showMinZoom:this.map.getMinZoom(),this.showMaxZoom=this.showMaxZoom?this.showMaxZoom:this.map.getMaxZoom();var b=this.map.getTitleSize(),c=new OpenLayers.Format.GeoJSON,d=new OpenLayers.Strategy.Grid({tileSize:new OpenLayers.Size(b.width,b.height),getImageUrl:this.getImageUrl,getImageSize:this.getImageSize,mapId:this.mapId,filter:this.filter,showMinZoom:this.showMinZoom,showMaxZoom:this.showMaxZoom});protocol=new OpenLayers.Protocol.HTTP({url:this.url+"/${z}_${y}_${x}.json",format:c});var e=this,f={context:{getCount:function(){return""},getUrl:function(a){return e.getImageUrl(a.data)},getWidth:function(a){var b=document.createElement("img");if(b.src=e.getImageUrl(a.data),0===b.width){var c=e.getImageSize(a.data);return c.width}return b.width},getHeight:function(a){var b=document.createElement("img");if(b.src=e.getImageUrl(a.data),0===b.height){var c=e.getImageSize(a.data);return c.height}return b.height},getCursor:function(){return e.featureCursor}}},g=new OpenLayers.StyleMap({"default":new OpenLayers.Style({externalGraphic:"${getUrl}",graphicWidth:"${getWidth}",graphicHeight:"${getHeight}",graphicOpacity:1,cursor:"${getCursor}",label:"${getCount}",labelSelect:!0,fontColor:"red"},f)});vectors=new OpenLayers.Layer.Vector(this.name,{strategies:[d],protocol:protocol,styleMap:g}),this._apiObj=vectors,this.map._mapAdapter.map.addLayer(vectors)}}(),function(){NPMapLib.Layers.LayerGroup=function(a,b){this.CLASS_NAME="NPMapLib.Layers.LayerGroup",this.name=a,this.layer=b,this.data=[]},NPMapLib.Layers.LayerGroup.prototype.hide=function(){for(var a=0;a<this.data.length;a++)this.data[a].hide()},NPMapLib.Layers.LayerGroup.prototype.show=function(){for(var a=0;a<this.data.length;a++)this.data[a].show()},NPMapLib.Layers.LayerGroup.prototype.addOverlay=function(a){a.groupName=this.name,this.data.push(a),this.layer.addOverlay(a)},NPMapLib.Layers.LayerGroup.prototype.addOverlays=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.addOverlay(a[b])},NPMapLib.Layers.LayerGroup.prototype.removeOverlay=function(a){if(this.data.contains(a)){for(var b=this.data.indexOf(a),c=0,d=0;c<this.data.length;c++)this.data[c]!==this.data[b]&&(this.data[d++]=this.data[c]);this.data.length-=1,this.layer.removeOverlay(a)}},NPMapLib.Layers.LayerGroup.prototype.removeOverlays=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.removeOverlay(a[b])},NPMapLib.Layers.LayerGroup.prototype.removeAllOverlays=function(){for(var a=0;a<this.data.length;a++)this.layer.removeOverlay(this.data[a]);this.data=[]},NPMapLib.Layers.LayerGroup.prototype.getAllOverlayers=function(){return this.data},NPMapLib.Layers.LayerGroup.prototype.containFeatures=function(a,b){var c=this.layer.containFeatures(a,b),d=[];if(c instanceof Array)for(var e=0;e<c.length;e++)c[e].groupName===this.name&&d.push(c[e]);return d},NPMapLib.Layers.LayerGroup.prototype.getOverlaysByProperty=function(a,b){var c=this.layer.getOverlaysByProperty(a,b),d=[];if(c instanceof Array)for(var e=0;e<c.length;e++)c[e].groupName===this.name&&d.push(c[e]);return d},NPMapLib.Layers.LayerGroup.prototype.getOverlay=function(a){var b=this.layer.getOverlay(a);return b&&b.groupName===this.name?b:void 0},NPMapLib.Layers.LayerGroup.prototype.setZIndex=function(a){for(var b=this.getAllOverlayers(),c=0;c<b.length;c++)b[c].setZIndex(a)},NPMapLib.Layers.LayerGroup.prototype.getZIndex=function(){var a=this.getAllOverlayers();if(0!==a.length){var b=a[0].getZIndex();return b}}}(),function(){NPMapLib.Layers.NPLayer=function(a,b,c){this.url=a,this.isBaseLayer=c&&"boolean"==typeof c.isBaseLayer?c.isBaseLayer:!0,this.opts=c,this.name=b,this.layerType="tiandi",this.fullExtent=[],this.type="png",this.CLASS_NAME="NPMapLib.Layers.NPLayer"},NPMapLib.Layers.NPLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.OSMLayer=function(a,b,c){this.url=a,this.name=b,this.opts=c,this.isBaseLayer=c&&"boolean"==typeof c.isBaseLayer?c.isBaseLayer:!0,NPMap.PROJECT="900913",this.CLASS_NAME="NPMapLib.Layers.OSMLayer"},NPMapLib.Layers.OSMLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Overlay=function(){this.CLASS_NAME="NPMapLib.Overlay",this.id=-1,this.overlayType=NPMapLib.OVERLAY_TYPE_UNKNOWN,this.mapId=-1,this._visible=!0,this._apiObj=null,this._data={},this.isEnableEdit=!1,this.isEnableContextMenu=!1,this.MenuList="",this._graphicZIndex=0,this._rotation=null,this._layer},NPMapLib.Overlay.prototype.isVisible=function(){return this._visible},NPMapLib.Overlay.prototype.show=function(){if(!(this.mapId<=0||this._visible)){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&this._apiObj&&a.showOverlay(this),this._visible=!0}},NPMapLib.Overlay.prototype.hide=function(){if(!(this.mapId<=0)&&this._visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&this._apiObj&&a.hideOverlay(this),this._visible=!1}},NPMapLib.Overlay.prototype.flash=function(){if(!(this.mapId<=0)&&this._visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.falshOverlay(this)}},NPMapLib.Overlay.prototype.flash2=function(a){if(!(this.mapId<=0)&&this._visible){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.falshOverlay(this,a)}},NPMapLib.Overlay.prototype.flashStop=function(){if(!(this.mapId<=0)&&this._visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&this._apiObj&&this._apiObj.flashStop()}},NPMapLib.Overlay.prototype.getZIndex=function(){return this._graphicZIndex},NPMapLib.Overlay.prototype.setZIndex=function(a){this.mapId<=0||(this._graphicZIndex=a,this.refresh())},NPMapLib.Overlay.prototype.rotate=function(a){if(!(this.mapId<=0)){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&(this._rotation=a,b.rotateOverlay(this,a))}},NPMapLib.Overlay.prototype.resetIcon=function(a){if(!(this.mapId<=0)&&this._visible){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.resetIcon(this,a)}},NPMapLib.Overlay.prototype.setData=function(a){this._data=a},NPMapLib.Overlay.prototype.getData=function(){return this._data},NPMapLib.Overlay.prototype.refresh=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.refresh(this)},NPMapLib.Overlay.prototype.showMenu=function(){if(this.MenuList){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showMenu(this.MenuList)}},NPMapLib.Overlay.prototype.enableEditing=function(a,b){this.isEnableEdit=!0;var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.enableEditing(a,this,b)},NPMapLib.Overlay.prototype.disableEditing=function(){this.isEnableEdit=!1;var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.cancelEditing(this)},NPMapLib.Overlay.prototype.getTop=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return a?a.getTop(this):null},NPMapLib.Overlay.prototype.getId=function(){return this.id},NPMapLib.Overlay.prototype.getBounds=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a)return a.getBounds(this);if("NPMapLib.Geometry.Polygon"===this.CLASS_NAME){for(var b=this.getPath(),c=b[0].lon,d=b[0].lat,e=b[0].lon,f=b[0].lat,g=1;g<b.length;g++)b[g].lon<c&&(c=b[g].lon),b[g].lon>e&&(e=b[g].lon),b[g].lat<d&&(d=b[g].lat),b[g].lat<f&&(f=b[g].lat);return new NPMapLib.Geometry.Extent(c,d,e,f)}return null},NPMapLib.Overlay.prototype.getLayer=function(){return this._layer},NPMapLib.Overlay.prototype.getCentroid=function(){if(this._apiObj&&this._apiObj.geometry){var a=this._apiObj.geometry.getCentroid();return NPMapLib.T.getPoint(NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),{lon:a.x,lat:a.y})}},NPMapLib.Overlay.prototype.setZStyle=function(a){if(this._apiObj&&this._apiObj.geometry&&a){{this._apiObj.style}for(var b in a)this._apiObj.style[b]=a[b];this._apiObj.layer.drawFeature(this._apiObj)}},NPMapLib.Overlay.prototype.removeMenu=function(){this._menu&&(this._menu.destroy(),this._menu=null)}}(),NPMapLib.CsObjCaster=function(){var factory={};return factory._castArgs=function(p){var args=new Array;if(p)for(var i=2;i<p.length;i++){var temp=p[i];args.push("string"==typeof temp&&temp.indexOf(":")>0&&0!=temp.indexOf("http")?eval("("+temp+")"):temp)}return args},factory._castControl=function(a){var b=null;if(!a)return b;var c=a.ControlType;return c==NPMapLib.CONTROL_TYPE_UNKNOWN?b:(c==NPMapLib.CONTROL_TYPE_COPYRIGHT?b=new NPMapLib.Controls.CopyRightControl:c==NPMapLib.CONTROL_TYPE_NAVIGATION?b=new NPMapLib.Controls.NavigationControl:c==NPMapLib.CONTROL_TYPE_OVERVIEW?b=new NPMapLib.Controls.OverviewControl:c===NPMapLib.CONTROL_TYPE_SCALE?b=new NPMapLib.Controls.ScaleControl:c===NPMapLib.CONTROL_TYPE_NORTH?b=new NPMapLib.Controls.NorthControl:c==NPMapLib.CONTROL_TYPE_MOUSEPOSITION&&(b=new NPMapLib.Controls.MousePositionControl(a.PositionType)),b&&(b.id=a.id,b.mapId=a.mapId),b)},factory._castSize=function(a){return new NPMapLib.Geometry.Size(a.Width,a.Height)},factory._castOffset=function(a){return new NPMapLib.Geometry.Size(a.X,a.Y)},factory._castPoint=function(a){return new NPMapLib.Geometry.Point(a.Lon,a.Lat)},factory._castPoints=function(a){var b=new Array;if(!a)return b;if("object"==typeof a&&a.length)for(var c=0;c<a.length;c++){var d=new NPMapLib.Geometry.Point(a[c].Lon,a[c].Lat);b.push(d)}return b},factory._castPixel=function(a){return new NPMapLib.Geometry.Pixel(a.X,a.Y)},factory._castIcon=function(a){var b=NPMapLib.Managers.OtherManager._getIcon[a.id];if(b)return b;var c=this._castSize(a.imageSize),d={};a.anchor&&(d.anchor=this._castOffset(a.anchor));var e=new NPMapLib.Symbols.Icon(a.imageUrl,c,d);return e.id=a.id,NPMapLib.Managers.OtherManager._addIcon(e),a.Border&&(e.border=a.Border),e},factory._castInfoWin=function(a){var b=new NPMapLib.Symbols.InfoWindow(a.point,a.title,a.content,{width:a.width,height:a.height,offset:this._castOffset(a.offset),arrow:a.arrow,enableCloseOnClick:a.enableCloseOnClick});return b.id=a.id,b.mapId=a.mapId,b.autoSize=a.autoSize?!0:!1,b},factory._castAnimation=function(a){var b=this._castOverlay(a.overlay),c=new NPMapLib.Symbols.Animation(a.mapId,b,{speed:a.opt.Speed,isReturn:a.opt.IsReturn,isRepeat:a.opt.IsRepeat});return c.id=a.id,c},factory._castOverlay=function(a){if(!a)return null;var b=NPMapLib.Managers.OverlayManager.getOverlay(a.id);if(b)return b;var c;switch(a.OverlayType){case NPMapLib.OVERLAY_TYPE_POLYLINE:c=this._castPoints(a.points),b=new NPMapLib.Geometry.Polyline(c,{color:a.color,weight:a.weight,opacity:a.opacity,lineStyle:a.lineStyle,arrowStyle:a.arrowStyle,enableEditing:a.enableEditing});break;case NPMapLib.OVERLAY_TYPE_POLYGON:c=this._castPoints(a.points),b=new NPMapLib.Geometry.Polygon(c,{color:a.color,weight:a.weight,opacity:a.opacity,lineStyle:a.lineStyle,arrowStyle:a.arrowStyle,enableEditing:a.enableEditing,fillColor:a.fillcolor,fillOpacity:a.fillOpacity});break;case NPMapLib.OVERLAY_TYPE_CIRCLE:c=new NPMapLib.Geometry.Point(a.center.Lon,a.center.Lat),b=new NPMapLib.Geometry.Circle(c,a.radius,this._castCircleOption(a));break;case NPMapLib.OVERLAY_TYPE_LABEL:b=this._castLabel(a);break;case NPMapLib.OVERLAY_TYPE_CIRCLESECTOR:c=new NPMapLib.Geometry.Point(a.center.Lon,a.center.Lat),b=new NPMapLib.Geometry.CircleSector(c,a.radius,a.sides,a.antBearing,a.lobeAngle,this._castCircleSectorOption(a));break;case NPMapLib.OVERLAY_TYPE_MARKER:var d={icon:this._castIcon(a.Icon)};a.Offset&&(d.offset=new NPMapLib.Geometry.Size(a.Offset.X,a.Offset.Y)),b=new NPMapLib.Symbols.Marker(this._castPoint(a.Point),d),a.Label&&b.setLabel(this._castLabel(a.Label));break;case 9:for(var e=[],f=a.Markers.length-1;f>=0;f--){var g=a.Markers[f];e.push(new NPMapLib.Symbols.ClusterMarker({lon:g.Location.Lon,lat:g.Location.Lat,id:g.MarkerId,markType:g.MarkType},{markType:g.MarkType}))}b=new NPMapLib.Symbols.ClusterPoints(e)}return b.id=a.id,"boolean"==typeof a.IsEnableContextMenu&&(b.isEnableContextMenu=a.IsEnableContextMenu),"boolean"==typeof a.IsEnableEdit&&(b.isEnableEdit=a.IsEnableEdit),a.MenuList&&(b.MenuList=a.MenuList),b.mapId=a.mapId,NPMapLib.Managers.OverlayManager.addOverlay(b),b},factory._castCircleOption=function(a){var b={color:a.color,fillColor:a.fillColor,weight:a.weight,opacity:a.opacity,fillOpacity:a.fillOpacity,lineStyle:a.lineStyle,enableEditing:a.enableEditing};return b},factory._castCircleSectorOption=function(a){var b={color:a.color,fillColor:a.fillColor,weight:a.weight,opacity:a.opacity,fillOpacity:a.fillOpacity,lineStyle:a.lineStyle,enableEditing:a.enableEditing};return b},factory._castPolylineOption=function(){},factory._castPolygonOption=function(){},factory._castLabelStyle=function(a){var b={FontSize:a.FontSize,FontFamily:a.FontFamily,Color:a.Color,BgColor:a.BgColor,BordColor:a.BordColor,BorderSize:a.BorderSize,Align:a.Align,isBold:a.IsBold};return b},factory._castLabel=function(a){if(NPMapLib.Managers.OverlayManager.getOverlay[a.id])return NPMapLib.Managers.OverlayManager.getOverlay[a.id];var b=new NPMapLib.Symbols.Label(a.content,{offset:this._castOffset(a.offset),position:this._castPoint(a.position)});if(a.labelStyle){var c=this._castLabelStyle(a.labelStyle);b.setStyle(c)}return b.id=a.id,NPMapLib.Managers.OverlayManager.addOverlay(b),b},factory._castLayer=function(params){switch(params.layerType){case NPMapLib.MAP_LAYER_TYPE_ARCGIS_TILE:var opts={centerPoint:[params.CenterPoint.Lon,params.CenterPoint.Lat],fullExtent:[params.FullExtent.SW.Lon,params.FullExtent.NE.Lat,params.FullExtent.NE.Lon,params.FullExtent.SW.Lat],minLevel:params.minLevel,maxLevel:params.maxLevel,zoomOffset:params.ZoomOffset,zoomLevelSequence:params.ZoomLevelSequence,initResolution:params.InitResolution,origin:[params.Origin.Lon,params.Origin.Lat],resolutions:params.Resolutions},layer1=new NPMapLib.Layers.ArcgisTileLayer(params.url,params.name,opts);return layer1.id=params.id,layer1;case NPMapLib.MAP_LAYER_TYPE_OVERLAY:var layer=new NPMapLib.Layers.OverlayLayer(params.name);return layer.id=params.id,layer.mapId=params.MapId,layer;case NPMapLib.MAP_LAYER_TYPE_GOOGLE_OFFLINE:var opts={centerPoint:[params.CenterPoint.Lon,params.CenterPoint.Lat],minLevel:params.minLevel,maxLevel:params.maxLevel,zoomOffset:params.ZoomOffset,zoomLevelSequence:params.ZoomLevelSequence,type:params.Tiletype,fullExtent:[params.FullExtent.SW.Lon,params.FullExtent.NE.Lat,params.FullExtent.NE.Lon,params.FullExtent.SW.Lat],isBaseLayer:params.IsBaseLayer},layer1=new NPMapLib.Layers.GoogleOffLineLayer(params.url,params.name,opts);return layer1.id=params.id,layer1;case NPMapLib.MAP_LAYER_TYPE_TDMAP:var opts={centerPoint:[params.CenterPoint.Lon,params.CenterPoint.Lat],mapType:params.mapType,topLevel:1,bottomLevel:18,isBaseLayer:params.isBaseLayer,mirrorUrls:params.mirrorUrls,fullExtent:[params.FullExtent.SW.Lon,params.FullExtent.NE.Lat,params.FullExtent.NE.Lon,params.FullExtent.SW.Lat]},layer=new NPMapLib.Layers.TDMapLayer(params.url,params.name,opts);return layer.id=params.id,layer.mapId=params.mapId,layer;case 12:var opts=params.option||{};opts.getUrl=function(a,b){return b=b.feature||b,b.getData||(b=null),OnClusterEvent("getUrl",params.id,null==b?-9999:b.getData().id,a)},opts.getImageSize=function(counts,data){data=data.feature||data,data.getData||(data=null);var result=OnClusterEvent("getImageSize",params.id,null==data?-9999:data.getData().id,counts),msg=eval("("+result+")");return{width:msg.Width,height:msg.Height}},opts.mouseover=function(a){OnSingleClusterEvent("onmouseover",params.id,a.getData().id)},opts.mouseout=function(a){OnSingleClusterEvent("onmouseout",params.id,a.getData().id)},opts.click=function(a){OnSingleClusterEvent("onSelect",params.id,a.getData().id)},opts.getRotation=function(a,b){return b=b.feature||b,b.getData||(b=null),OnClusterEvent("getRotation",params.id,null==b?-9999:b.getData().id,a)};var layer=new NPMapLib.Layers.OverlayLayer(params.name,!0,opts);return layer.id=params.id,layer.mapId=params.MapId,layer}},factory._castMesaureTool=function(a){var b=new NPMapLib.Tools.MeasureTool(a.mapId);return b.id=a.id,b},factory._castDrawTool=function(a){var b=new NPMapLib.Tools.DrawingTool(a.mapId);return b.id=a.id,b},factory}(),NPMapLib.Managers.MapManager=function(){var factory={},_MAP_ID=0,_maps={};return factory.getMaxId=function(){return++_MAP_ID},factory.addMap=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,NPMapLib.Map)&&(_maps[a.id]||(a.id<=0&&(a.id=this.getMaxId()),_maps[a.id]=a))},factory.removeMap=function(a){_maps[a]&&delete _maps[a]},factory.removeAllMaps=function(){for(var a in _maps)delete _maps[a]},factory.getMap=function(a){return _maps[a]},factory.getAllMaps=function(){return _maps},factory.callFromCS=function(jsonModel,method){NPMapLib.Utils.BaseUtils.isTypeRight(jsonModel,"string")&&(jsonModel=eval("("+jsonModel+")"));var map,args=NPMapLib.CsObjCaster._castArgs(arguments);if(_maps[jsonModel.mapId])map=this.getMap(jsonModel.mapId);else{var mapContainer=document.getElementById("mapId");if(args.length<=0)return;var mapConfig=null;if("boolean"==typeof args[0].IsPointConvert&&(NPMap.ISPOINTCONVERT=args[0].IsPointConvert),11==args[0].layerType){mapConfig=args[0].MapConfig.replace(/_/g,'"'),mapConfig=eval("("+mapConfig+")"),map=new NPMapLib.Map(mapContainer,mapConfig.mapOpts,jsonModel.mapId),_maps[jsonModel.mapId]=map;var vectorBaseLayer=[],baseLayer=[],allLayers=mapConfig.vectorLayer;map._mapJson={vectorLayer:[],map:map,sattilateLayer:[]};for(var i=0,len=mapConfig.vectorLayer.length;len>i;i++)vectorLayerItem=mapConfig.vectorLayer[i],layerType=vectorLayerItem.layerType.split("."),baseLayerItem=new NPMapLib.Layers[layerType[layerType.length-1]](vectorLayerItem.layerOpt.url,vectorLayerItem.layerName,vectorLayerItem.layerOpt),baseLayerItem.id=args[0].LayerId,vectorBaseLayer.push(baseLayerItem),baseLayer.push(baseLayerItem),NPMapLib.Managers.LayerManager.addLayer(baseLayerItem),map._mapJson.vectorLayer.push(baseLayerItem);for(var i=0,len=mapConfig.sattilateLayer.length;len>i;i++)vectorLayerItem=mapConfig.sattilateLayer[i],layerType=vectorLayerItem.layerType.split("."),baseLayerItem=new NPMapLib.Layers[layerType[layerType.length-1]](vectorLayerItem.layerOpt.url,vectorLayerItem.layerName,vectorLayerItem.layerOpt),baseLayerItem.id=args[0].LayerId,vectorBaseLayer.push(baseLayerItem),baseLayer.push(baseLayerItem),NPMapLib.Managers.LayerManager.addLayer(baseLayerItem),map._mapJson.sattilateLayer.push(baseLayerItem);map.addLayers(baseLayer);for(var i=map._mapJson.sattilateLayer.length-1;i>=0;i--)map._mapJson.sattilateLayer[i].hide();return NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].LayerId,success:!0})}var opt={};opt.fullExtent=[args[0].FullExtent.SW.Lon,args[0].FullExtent.NE.Lat,args[0].FullExtent.NE.Lon,args[0].FullExtent.SW.Lat],"number"==typeof args[0].ZoomOffset&&(opt.zoomOffset=args[0].ZoomOffset),args[0].RestrictedExtent&&(opt.restrictedExtent=args[0].RestrictedExtent),args[0].Projection&&(opt.projection=args[0].Projection),opt.zoomOffset||(opt.zoomOffset=0),opt.minZoom=args[0].minLevel+opt.zoomOffset,opt.maxZoom=args[0].maxLevel+opt.zoomOffset,map=new NPMapLib.Map(mapContainer,opt,jsonModel.mapId),_maps[jsonModel.mapId]=map}switch(method){case"addLayer":if(args.length<=0)return;var isAdd=!1,l=NPMapLib.Managers.LayerManager.getLayer(args[0].LayerId);return l||(l=NPMapLib.CsObjCaster._castLayer(args[0])),l&&(map.addLayer(l),NPMapLib.Managers.LayerManager.addLayer(l),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].LayerId,success:isAdd});case"addLayers":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;count>i;++i){var isAdd=!1,l=NPMapLib.Managers.LayerManager.getLayer(args[0][i].LayerId);if(l)try{isAdd=map.addLayer(l),NPMapLib.Managers.LayerManager.addLayer(l)}catch(ex){isAdd=!1}resultList.push({id:l.id,success:isAdd})}return NPMapLib.Utils.BaseUtils.JsonToStr(resultList);case"removeLayer":if(!args||args.length<=0)return;var isAdd=!1,layerId=parseInt(""+args[0]),l=NPMapLib.Managers.LayerManager.getLayer(layerId);return l&&(map.removeLayer(l),NPMapLib.Managers.LayerManager.removeLayer(layerId),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:layerId,success:isAdd});case"addControl":if(args.length<=0)return;var cs_control=args[0];if(!cs_control)return;var isAdd=!1;cs_control.ControlType==NPMapLib.CONTROL_TYPE_MOUSEPOSITION;var c=NPMapLib.Managers.ControlManager.getControl(args[0].id);return c||(c=NPMapLib.CsObjCaster._castControl(args[0])),c&&(map.addControl(c),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:c.id,success:isAdd});case"removeControl":if(args.length<=0)return;var cs_control=args[0];if(!cs_control)return;var isAdd=!1;if(cs_control.ControlType==NPMapLib.CONTROL_TYPE_MOUSEPOSITION)return void map.removeJWMousePostion();var c=NPMapLib.Managers.ControlManager.getControl(args[0].id);return c&&(map.removeControl(c),isAdd=!1),NPMapLib.Utils.BaseUtils.JsonToStr({id:c.id,success:isAdd});case"addOverlay":var isAdd=!1;if(args.length<=0)return;var o=NPMapLib.Managers.OverlayManager.getOverlay(args[0].id);return o||(o=NPMapLib.CsObjCaster._castOverlay(args[0])),o&&(isAdd=map.addOverlay(o)),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:isAdd});case"addOverlays":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;count>i;++i){var isAdd=!1,o=NPMapLib.Managers.OverlayManager.getOverlay(args[0][i].id);if(o)try{isAdd=map.addOverlay(o)}catch(ex){}resultList.push({id:args[0][i].id,success:isAdd})}return NPMapLib.Utils.BaseUtils.JsonToStr(resultList);case"removeOverlay":if(args.length<=0)return;var o=NPMapLib.Managers.OverlayManager.getOverlay(args[0].id);return o&&map.removeOverlay(o),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:!0});case"removeOverlays":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;count>i;++i){var isAdd=!1,o=NPMapLib.Managers.OverlayManager.getOverlay(args[0][i].id);if(o)try{map.removeOverlay(o),isAdd=!0}catch(ex){isAdd=!1}resultList.push({id:args[0][i].id,success:isAdd})}return NPMapLib.Utils.BaseUtils.JsonToStr(resultList);case"addEventListener":var evt=args[0],cbf=args[1];return void map.addEventListener(evt,function(a){"click"===evt?OnMapClickCallBack(a.lon,a.lat,1):"dblclick"===evt?OnMapDbClickCallBack(a.lon,a.lat,1):"mapzoomchange"==evt?OnMapZoomChanged(a):"rightclick"==evt&&OnMapRightClickCallBack()});case"pointToPixel":if(args.length<=0)return;var t=map.pointToPixel(new NPMapLib.Geometry.Point(args[0].Lon,args[0].Lat));return NPMapLib.Utils.BaseUtils.JsonToStr(t);case"pixelToPoint":if(args.length<=0)return;var t=map.pixelToPoint(NPMapLib.CsObjCaster._castPixel(args[0]));return NPMapLib.Utils.BaseUtils.JsonToStr(t);case"setCenter":var p=new NPMapLib.Geometry.Point(args[0].Lon,args[0].Lat);return void map.setCenter(p);case"route":var service=new MapPlatForm.Base.MapService(map)}if(method&&"function"==typeof map[method]){var t=map[method].apply(map,args);return"number"==typeof t||"string"==typeof t?t:NPMapLib.Utils.BaseUtils.JsonToStr(t)}},factory}(),NPMapLib.Managers.OverlayManager=function(){var factory={},_OVERLAY_ID=0,_overlays={};return factory._getMaxId=function(){return++_OVERLAY_ID},factory.addOverlay=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,NPMapLib.Overlay)&&(_overlays[a.id]||(a.id<=0&&(a.id=this._getMaxId()),_overlays[a.id]=a))},factory.removeOverlay=function(a){_overlays[a]&&delete _overlays[a]},factory.removeAllOverlays=function(){for(var a in _overlays)delete _overlays[a]},factory.getOverlay=function(a){return _overlays[a]},factory.getAllOverlays=function(){return _overlays},factory.callFromCS=function(obj,method,params){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(obj,"string")&&(obj=eval("("+obj+")")),!_overlays[obj.id]){var o=NPMapLib.CsObjCaster._castOverlay(obj);_overlays[obj.id]=o}var overlay=_overlays[obj.id],args=NPMapLib.CsObjCaster._castArgs(arguments);switch(method){case"addEventListener":var evt=args[0],cbf=args[1];return void("dragend"==evt?overlay.addEventListener(evt,function(a){if(a.getPosition){var b=a.getPosition();OnOverlayDragend(obj.id,NPMapLib.Utils.BaseUtils.JsonToStr(b)),window.event.cancelBubble=!0}else{var b=new NPMapLib.Geometry.Point(0,0);OnOverlayDragend(obj.id,NPMapLib.Utils.BaseUtils.JsonToStr(b)),window.event.cancelBubble=!0}}):overlay.addEventListener(evt,function(a){OnOverlayMouseEvent(obj.id,evt,a.lon,a.lat,0),window.event.cancelBubble=!0}));case"setOffset":var s=new NPMapLib.Geometry.Size(args[0].X,args[0].Y);return void overlay.setOffset(s);case"setPosition":var p=new NPMapLib.Geometry.Point(args[0].Lon,args[0].Lat);return void overlay.setPosition(p);case"buffer":var map=NPMap.Managers.MapManager.getMap(obj.mapId),gs=WKT.read(args[0],map);return map.addOverlay(gs),void(overlay.buffer=gs);case"removeBuffer":return void(overlay.buffer&&(NPMap.Managers.MapManager.getMap(obj.mapId).removeOverlay(overlay.buffer),overlay.buffer=null));default:if(method&&overlay&&"function"==typeof overlay[method]){var t=overlay[method].apply(overlay,args);return"number"==typeof t||"string"==typeof t?t:NPMapLib.Utils.BaseUtils.JsonToStr(t)}return}}catch(e){alert("overlay method err_:"+e.message+"method")}},factory}(),NPMapLib.Managers.LayerManager=function(){var factory={},_LAYER_ID=0,_layers={};return factory._getMaxId=function(){return++_LAYER_ID},factory.addLayer=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,NPMapLib.Layer)&&(_layers[a.id]||(a.id<=0&&(a.id=this._getMaxId()),_layers[a.id]=a))},factory.getAllLayerIds=function(){var a=[];for(var b in _layers)a.push(b);return a},factory.removeLayer=function(a){_layers[a]&&delete _layers[a]},factory.removeAllLayers=function(){for(var a in _layers)delete _layers[a]},factory.getLayer=function(a){return _layers[a]},factory.getAllLayers=function(){return _layers},factory.callFromCS=function(jsonModel,method,params){if(NPMapLib.Utils.BaseUtils.isTypeRight(jsonModel,"string")&&(jsonModel=eval("("+jsonModel+")")),!_layers[jsonModel.id]){var temp=NPMapLib.CsObjCaster._castLayer(jsonModel);if(null==temp)return;_layers[jsonModel.id]=temp}var layer=_layers[jsonModel.id],args=NPMapLib.CsObjCaster._castArgs(arguments);switch(method){case"addOverlay":if(args.length<=0)return;var isAdd=!1,o=NPMapLib.CsObjCaster._castOverlay(args[0]);return o&&(layer.addOverlay(o),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:isAdd});
case"removeOverlay":if(args.length<=0)return;var isAdd=!1,o=NPMapLib.CsObjCaster._castOverlay(args[0]);return o&&(layer.removeOverlay(o.id),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:isAdd});case"addOverlays":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;count>i;++i){var isAdd=!1,o=NPMapLib.CsObjCaster._castOverlay(args[0][i]);if(o)try{isAdd=map.addOverlay(o)}catch(ex){}resultList.push({id:args[0][i].id,success:isAdd})}return NPMapLib.Utils.BaseUtils.JsonToStr(resultList);case"setMarkerLocation":if(args.length<=0)return;var o=_layers[jsonModel.id];if(o)for(var data=o.getOverlaysArry()[0].dataJson,marker=eval("("+params+")"),i=data.length-1;i>=0;i--){var p=data[i];if(p.getData().id===marker.MarkerId){p.setPosition(new NPMapLib.Geometry.Point(marker.Location.Lon,marker.Location.Lat));break}}return;default:if(layer&&method&&"function"==typeof layer[method]){var t=layer[method].apply(layer,args);if(t)return"number"==typeof t||"string"==typeof t?t:NPMapLib.Utils.BaseUtils.JsonToStr(t)}return}},factory}(),NPMapLib.Managers.ControlManager=function(){var factory={},_CONTROL_ID=0,_controls={};return factory._getMaxId=function(){return++_CONTROL_ID},factory.addControl=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,NPMapLib.Control)&&(_controls[a.id]||(a.id<=0&&(a.id=this._getMaxId()),_controls[a.id]=a))},factory.removeControl=function(a){_controls[a]&&delete _controls[a]},factory.removeAllControls=function(){for(var a in _controls)delete _controls[a]},factory.getControl=function(a){return _controls[a]},factory.getAllControls=function(){return _controls},factory.callFromCS=function(jsonModel,method,params){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(jsonModel,"string")&&(jsonModel=eval("("+jsonModel+")")),!_controls[jsonModel.id]){var c=NPMapLib.CsObjCaster._castControl(jsonModel);if(!control)return;_controls[jsonModel.id]=c}var control=_controls[jsonModel.id];"function"==typeof control[method]&&control[method].call(control,params)}catch(e){alert("ctl method err"+e.toString())}},factory}(),NPMapLib.Managers.ContextMenuManager=function(){var a={},b=0,c={};return a._getMaxId=function(){return++b},a.addContextMenu=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,NPMapLib.ContextMenu)&&(c[a.id]||(a.id<=0&&(a.id=this._getMaxId()),c[a.id]=layer))},a.removeContextMenu=function(a){_layers[a]&&delete _layers[a]},a.removeAllContextMenus=function(){for(var a in c)delete c[a]},a.getContextMenu=function(a){return c[a]},a.getAllContextMenus=function(){return c},a.callFromCS=function(){},a}(),NPMapLib.Managers.OtherManager=function(){var factory={},drawObjs={};factory.drawCallFromCS=function(_json,method,param){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),NPMapLib.Utils.BaseUtils.isTypeRight(param,"string")&&(param=eval("("+param+")")),!drawObjs[_json.id]){var o=NPMapLib.CsObjCaster._castDrawTool(_json);drawObjs[_json.id]=o}var tool=drawObjs[_json.id];if("setMode"===method){var cbf=function(){};arguments.length>=4;var style=arguments[3]?eval("("+arguments[3]+")"):null;return void tool.setMode(param,function(a,b,c){tool.cancel(),NPMapLib.USING_ADAPTER===NPMapLib.ADAPTER_TYPE_OPENLAYERS?OnDrawComlpeted("drawComplete",_json.id,c):OnDrawComlpeted("drawComplete",_json.id,a)},style)}if(method&&tool&&"function"==typeof tool[method])return tool[method].call(tool,param);"delete"===method&&drawObjs[_json.id]&&delete drawObjs[_json.id]}catch(e){alert("draw method err_:"+e.message)}};var measureObjs={};factory.measureCallFromCS=function(_json,method,params){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),NPMapLib.Utils.BaseUtils.isTypeRight(params,"string")&&(params=eval("("+params+")")),!measureObjs[_json.id]){var o=NPMapLib.CsObjCaster._castMesaureTool(_json);measureObjs[_json.id]=o}var tool=measureObjs[_json.id];if(method&&tool&&"function"==typeof tool[method])return tool[method].call(tool,params);"delete"===method&&measureObjs[_json.id]&&delete measureObjs[_json.id]}catch(e){alert("measure method err_:"+e.message)}};var infoWinObjs={};factory.infoWinCallFromCS=function(_json,method){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),"close"===method)return void(infoWinObjs[_json.id]&&(infoWinObjs[_json.id].close(),delete infoWinObjs[_json.id]));var args=NPMapLib.CsObjCaster._castArgs(arguments),point=new NPMapLib.Geometry.Point(args[0],args[1]);if(_json.point=point,!infoWinObjs[_json.id]){var o=NPMapLib.CsObjCaster._castInfoWin(_json);infoWinObjs[_json.id]=o}var win=infoWinObjs[_json.id],map=NPMapLib.Managers.MapManager.getMap(_json.mapId);if(map&&map.addOverlay(win),method&&win&&"function"==typeof win[method])return win[method].apply(win,args)}catch(e){alert("infowin method err_:"+e.message)}};var _icons={};factory._getIcon=function(a){return _icons[a]},factory._addIcon=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,NPMapLib.Symbols.Icon)&&(_icons[a.id]||(_icons[a.id]=a))},factory.iconCallFromCS=function(_json,method,p){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),!_icons[_json.id]){var icon=NPMapLib.CsObjCaster._castIcon(_json);_icons[_json.id]=icon}var a=_icons[_json.id],arg;"setImageSize"===method?(NPMapLib.Utils.BaseUtils.isTypeRight(p,"string")&&(p=eval("("+p+")")),arg=NPMapLib.CsObjCaster._castSize(p),a.setImageSize(arg)):"setAnchor"===method?(arg=NPMapLib.CsObjCaster._castOffset(p),a.setAnchor(arg)):"setImageUrl"===method?(arg=p,a.setImageUrl(arg)):arg=p}catch(e){alert("icon method err_:"+e.message)}};var _animations={};factory._getAnimation=function(a){return _animations[a]?_animations[a]:void 0},factory._addAnimation=function(a){_animations.id=a},factory.animationCallFromCS=function(_json,method){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),!_animations[_json.id]){var o=NPMapLib.CsObjCaster._castAnimation(_json);_animations[_json.id]=o}var a=_animations[_json.id],args=NPMapLib.CsObjCaster._castArgs(arguments);if("setPath"===method&&args.length>0){var p=NPMapLib.Managers.OverlayManager.getOverlay(args[0].id);return p||(p=NPMapLib.CsObjCaster._castOverlay(args[0]),NPMapLib.Managers.OverlayManager.addOverlay(p)),void a.setPath(p)}if(method&&a&&"function"==typeof a[method])return a[method].apply(a,args)}catch(e){alert("animation method err_:"+e.message)}};var _labels={};return factory._getLabel=function(a){return _labels[a]},factory._addLabel=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,NPMapLib.Symbols.Label)&&(_labels[a.id]||(_labels[a.id]=a))},factory.labelCallFromCS=function(_json,method,p){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),!_labels[_json.id]){var o=NPMapLib.CsObjCaster._castLabel(_json);_labels[_json.id]=o}var a=_labels[_json.id],args=NPMapLib.CsObjCaster._castArgs(arguments);if(method&&a&&"function"==typeof a[method])return a[method].apply(a,args)}catch(e){alert("label method err_:"+e.message)}},factory}(),NPMapLib.CIRCLE_EVENT_CLICK="click",NPMapLib.CIRCLE_EVENT_DBLCLICK="dblclick",NPMapLib.CIRCLE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.CIRCLE_EVENT_MOUSE_DOWN="mousedown",NPMapLib.CIRCLE_EVENT_MOUSE_UP="mouseup",NPMapLib.CIRCLE_EVENT_MOUSE_OVER="mouseover",NPMapLib.CIRCLE_EVENT_MOUSE_OUT="mouseout",NPMapLib.CIRCLE_EVENT_LINE_UPDATE="lineupdate",NPMapLib.CIRCLE_EVENT_MODIFIED="dragend",NPMapLib.CIRCLE_EVENT_DRAG_START="dragstart",NPMapLib.CIRCLE_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.Circle=function(a,b,c){this.overlayType=NPMapLib.OVERLAY_TYPE_CIRCLE,this._center=a,this._radius=b,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._enableClicking=!0,this.CLASS_NAME="NPMapLib.Geometry.Circle",this.text="",c&&(c.color&&(this._color=c.color),c.fillColor&&(this._fillColor=c.fillColor),c.weight&&(this._weight=c.weight),c.opacity&&(this._opacity=c.opacity),c.fillOpacity&&(this._fillOpacity=c.fillOpacity),c.lineStyle&&(this._lineStyle=c.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(c.enableEditing,"boolean")&&(this._enableEditing=c.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(c.enableClicking,"boolean")&&(this._enableClicking=c.enableClicking),c.text&&(this.text=c.text),c.strokeColor&&(this._color=c.strokeColor),c.strokeOpacity&&(this._opacity=c.strokeOpacity),c.strokeWidth&&(this._weight=c.strokeWidth))},NPMapLib.Geometry.Circle.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Circle.prototype.setCenter=function(a){if(NPMapLib.Utils.BaseUtils.isTypeRight(a,"NPMapLib.Geometry.Point")){this._center=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setOverlayPosition(this,NPMapLib.T.setPoint(b,a))}},NPMapLib.Geometry.Circle.prototype.getCenter=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getOverlayCenter(this);this._center=b?b:this._center}return this._center},NPMapLib.Geometry.Circle.prototype.setRadius=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"number")&&(this._radius=a,this.refresh())},NPMapLib.Geometry.Circle.prototype.getRadius=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getRadius(this);this._radius=b?b:this._radius}return this._radius},NPMapLib.Geometry.Circle.prototype.getArea=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return b?b.getArea(this,a?a:"km"):void 0},NPMapLib.Geometry.Circle.prototype.setColor=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"string")&&(this._color=a)},NPMapLib.Geometry.Circle.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Circle.prototype.setFillColor=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"string")&&(this._fillColor=a)},NPMapLib.Geometry.Circle.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.Circle.prototype.setOpacity=function(a){!NPMapLib.Utils.BaseUtils.isTypeRight(a,"number")||0>a||a>1||(this._opacity=a)},NPMapLib.Geometry.Circle.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Circle.prototype.setFillOpacity=function(a){this._fillOpacity=a},NPMapLib.Geometry.Circle.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.Circle.prototype.setWeight=function(a){a&&this._weight!==a&&(this._weight=a)},NPMapLib.Geometry.Circle.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Circle.prototype.setLineStyle=function(a){this._lineStyle=a},NPMapLib.Geometry.Circle.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Circle.prototype.setStyle=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a.color,"string")&&(this._color=a.color),NPMapLib.Utils.BaseUtils.isTypeRight(a.fillColor,"string")&&(this._fillColor=a.fillColor),NPMapLib.Utils.BaseUtils.isTypeRight(a.weight,"number")&&(this._weight=a.weight),NPMapLib.Utils.BaseUtils.isTypeRight(a.opacity,"number")&&a.opacity>=0&&a.opacity<=1&&(this._opacity=a.opacity),NPMapLib.Utils.BaseUtils.isTypeRight(a.fillOpacity,"number")&&a.fillOpacity>=0&&a.fillOpacity<=1&&(this._fillOpacity=a.fillOpacity),NPMapLib.Utils.BaseUtils.isTypeRight(a.lineStyle,"int")&&(this._lineStyle=a.lineStyle),a.text&&(this.text=text),this.refresh()},NPMapLib.Geometry.Circle.prototype.getExtent=function(){var a=new NPMapLib.Geometry.Extent(0,0,0,0),b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return b&&(a=NPMapLib.T.getExtent(b,b.getOverlayExtent(this))),a},NPMapLib.Geometry.Circle.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},NPMapLib.Geometry.Circle.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)},NPMapLib.Geometry.Circle.prototype.setFillText=function(a,b){this.text=a;var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.setFillText(this,a,b)},NPMapLib.Geometry.Circle.prototype.getPoints=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return a?NPMapLib.T.getPoints(a,a.getCirclePoints(this)):void 0}}(),NPMapLib.ELLIPSE_EVENT_CLICK="click",NPMapLib.ELLIPSE_EVENT_DBLCLICK="dblclick",NPMapLib.ELLIPSE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.ELLIPSE_EVENT_MOUSE_DOWN="mousedown",NPMapLib.ELLIPSE_EVENT_MOUSE_UP="mouseup",NPMapLib.ELLIPSE_EVENT_MOUSE_OVER="mouseover",NPMapLib.ELLIPSE_EVENT_MOUSE_OUT="mouseout",NPMapLib.ELLIPSE_EVENT_LINE_UPDATE="lineupdate",NPMapLib.ELLIPSE_EVENT_MODIFIED="dragend",NPMapLib.ELLIPSE_EVENT_DRAG_START="dragstart",NPMapLib.ELLIPSE_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.Ellipse=function(a,b,c,d){this.overlayType=NPMapLib.OVERLAY_TYPE_ELLIPSE,this._firstPoint=a,this._secondPoint=b,this._distance=c,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._enableClicking=!0,this.CLASS_NAME="NPMapLib.Geometry.ellipse",this.text="",d&&(d.color&&(this._color=d.color),d.fillColor&&(this._fillColor=d.fillColor),d.weight&&(this._weight=d.weight),d.opacity&&(this._opacity=d.opacity),d.fillOpacity&&(this._fillOpacity=d.fillOpacity),d.lineStyle&&(this._lineStyle=d.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(d.enableEditing,"boolean")&&(this._enableEditing=d.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(d.enableClicking,"boolean")&&(this._enableClicking=d.enableClicking),d.text&&(this.text=d.text),d.strokeColor&&(this._color=d.strokeColor),d.strokeOpacity&&(this._opacity=d.strokeOpacity),d.strokeWidth&&(this._weight=d.strokeWidth))},NPMapLib.Geometry.Ellipse.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Ellipse.prototype.setCenter=function(a){if(NPMapLib.Utils.BaseUtils.isTypeRight(a,"NPMapLib.Geometry.Point")){this._center=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setOverlayPosition(this,NPMapLib.T.setPoint(b,a))}},NPMapLib.Geometry.Ellipse.prototype.getCenter=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getOverlayCenter(this);this._center=b?b:this._center}return this._center},NPMapLib.Geometry.Ellipse.prototype.getArea=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return b?b.getArea(this,a?a:"km"):void 0},NPMapLib.Geometry.Ellipse.prototype.setColor=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"string")&&(this._color=a)},NPMapLib.Geometry.Ellipse.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Ellipse.prototype.setFillColor=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"string")&&(this._fillColor=a)},NPMapLib.Geometry.Ellipse.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.Ellipse.prototype.setOpacity=function(a){!NPMapLib.Utils.BaseUtils.isTypeRight(a,"number")||0>a||a>1||(this._opacity=a)},NPMapLib.Geometry.Ellipse.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Ellipse.prototype.setFillOpacity=function(a){this._fillOpacity=a},NPMapLib.Geometry.Ellipse.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.Ellipse.prototype.setWeight=function(a){a&&this._weight!==a&&(this._weight=a)},NPMapLib.Geometry.Ellipse.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Ellipse.prototype.setLineStyle=function(a){this._lineStyle=a},NPMapLib.Geometry.Ellipse.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Ellipse.prototype.setStyle=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a.color,"string")&&(this._color=a.color),NPMapLib.Utils.BaseUtils.isTypeRight(a.fillColor,"string")&&(this._fillColor=a.fillColor),NPMapLib.Utils.BaseUtils.isTypeRight(a.weight,"number")&&(this._weight=a.weight),NPMapLib.Utils.BaseUtils.isTypeRight(a.opacity,"number")&&a.opacity>=0&&a.opacity<=1&&(this._opacity=a.opacity),NPMapLib.Utils.BaseUtils.isTypeRight(a.fillOpacity,"number")&&a.fillOpacity>=0&&a.fillOpacity<=1&&(this._fillOpacity=a.fillOpacity),NPMapLib.Utils.BaseUtils.isTypeRight(a.lineStyle,"int")&&(this._lineStyle=a.lineStyle),a.text&&(this.text=text),this.refresh()},NPMapLib.Geometry.Ellipse.prototype.getExtent=function(){var a=new NPMapLib.Geometry.Extent(0,0,0,0),b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return b&&(a=NPMapLib.T.getExtent(b,b.getOverlayExtent(this))),a},NPMapLib.Geometry.Ellipse.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},NPMapLib.Geometry.Ellipse.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)},NPMapLib.Geometry.Ellipse.prototype.setFillText=function(a,b){this.text=a;var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.setFillText(this,a,b)},NPMapLib.Geometry.Ellipse.prototype.getPoints=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return a?NPMapLib.T.getPoints(a,a.getCirclePoints(this)):void 0}}(),NPMapLib.CIRCLESECTOR_EVENT_CLICK="click",NPMapLib.CIRCLESECTOR_EVENT_DBLCLICK="dblclick",NPMapLib.CIRCLESECTOR_EVENT_RIGHT_CLICK="rightclick",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_DOWN="mousedown",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_UP="mouseup",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_OVER="mouseover",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_OUT="mouseout",NPMapLib.CIRCLESECTOR_EVENT_LINE_UPDATE="lineupdate",NPMapLib.CIRCLESECTOR_EVENT_MODIFIED="dragend",NPMapLib.CIRCLESECTOR_EVENT_DRAG_START="dragstart",NPMapLib.CIRCLESECTOR_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.CircleSector=function(a,b,c,d,e,f){this.overlayType=NPMapLib.OVERLAY_TYPE_CIRCLESECTOR,this._center=a,this._radius=b,this._sides=c,this._antBearing=d,this._lobeAngle=e,this._color="blue",this._fillColor="red",this._opacity=1,this._fillOpacity=.5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._weight=2,this._enableClicking=!0,this.CLASS_NAME="NPMapLib.Geometry.CircleSector",f&&(NPMapLib.Utils.BaseUtils.isTypeRight(f.color,"string")&&(this._color=f.color),NPMapLib.Utils.BaseUtils.isTypeRight(f.fillColor,"string")&&(this._fillColor=f.fillColor),NPMapLib.Utils.BaseUtils.isTypeRight(f.weight,"number")&&(this._weight=f.weight),NPMapLib.Utils.BaseUtils.isTypeRight(f.opacity,"number")&&f.opacity>=0&&f.opacity<=1&&(this._opacity=f.opacity),NPMapLib.Utils.BaseUtils.isTypeRight(f.fillOpacity,"number")&&f.fillOpacity>=0&&f.fillOpacity<=1&&(this._fillOpacity=f.fillOpacity),NPMapLib.Utils.BaseUtils.isTypeRight(f.lineStyle,"int")&&(this._lineStyle=f.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(f.enableEditing,"boolean")&&(this._enableEditing=f.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(f.enableClicking,"boolean")&&(this._enableClicking=f.enableClicking))},NPMapLib.Geometry.CircleSector.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.CircleSector.prototype.setCenter=function(a){if(NPMapLib.Utils.BaseUtils.isTypeRight(a,"NPMapLib.Geometry.Point")){this._center=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setOverlayPosition(this,a)}},NPMapLib.Geometry.CircleSector.prototype.getCenter=function(){return this._center},NPMapLib.Geometry.CircleSector.prototype.setRadius=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"number")&&(this._radius=a)},NPMapLib.Geometry.CircleSector.prototype.getRadius=function(){return this._radius},NPMapLib.Geometry.CircleSector.prototype.setColor=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"string")&&(this._color=a)},NPMapLib.Geometry.CircleSector.prototype.setSides=function(a){this._sides=a},NPMapLib.Geometry.CircleSector.prototype.getSides=function(){return this._sides},NPMapLib.Geometry.CircleSector.prototype.setAntBearing=function(a){this._antBearing=a},NPMapLib.Geometry.CircleSector.prototype.getAntBearing=function(){return this._antBearing},NPMapLib.Geometry.CircleSector.prototype.getLobeAngle=function(){return this._lobeAngle},NPMapLib.Geometry.CircleSector.prototype.getColor=function(){return this._color},NPMapLib.Geometry.CircleSector.prototype.setFillColor=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"string")&&(this._fillColor=a)},NPMapLib.Geometry.CircleSector.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.CircleSector.prototype.setOpacity=function(a){!NPMapLib.Utils.BaseUtils.isTypeRight(a,"number")||0>a||a>1||(this._opacity=a)},NPMapLib.Geometry.CircleSector.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.CircleSector.prototype.setFillOpacity=function(a){this._fillOpacity=a},NPMapLib.Geometry.CircleSector.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.CircleSector.prototype.setWeight=function(a){a&&this._weight!==a&&(this._weight=a)},NPMapLib.Geometry.CircleSector.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.CircleSector.prototype.setLineStyle=function(a){this._lineStyle=a},NPMapLib.Geometry.CircleSector.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.CircleSector.prototype.getExtent=function(){var a=new NPMapLib.Geometry.Extent(0,0,0,0),b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return b&&(a=Netposa.T.getExtent(b,b.getOverlayExtent(this))),a},NPMapLib.Geometry.CircleSector.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},NPMapLib.Geometry.CircleSector.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)}}(),function(){NPMapLib.Geometry.Extent=function(a,b,c,d){if(this.sw,this.ne,this.top,this.left,this.bottom,this.right,2===arguments.length){if(!(a instanceof NPMapLib.Geometry.Point&&b instanceof NPMapLib.Geometry.Point))return NPMapLib.Utils.BaseUtils("Argument exception");this.sw=a,this.ne=b}else 4===arguments.length&&(this.sw=new NPMapLib.Geometry.Point(a,b),this.ne=new NPMapLib.Geometry.Point(c,d));this.sw&&(this.left=this.sw.lon,this.bottom=this.sw.lat),this.ne&&(this.right=this.ne.lon,this.top=this.ne.lat),this.CLASS_NAME="NPMapLib.Geometry.Extent"},NPMapLib.Geometry.Extent.prototype.equals=function(a){return a instanceof NPMapLib.Geometry.Extent?this.sw.lon===a.sw.lon&&this.sw.lat===a.sw.lat&&this.ne.lon===a.ne.lon&&this.ne.lat===a.ne.lat:!1},NPMapLib.Geometry.Extent.prototype.containsPoint=function(a){return this.sw.lon<=a.lon&&this.ne.lon>=a.lon&&this.sw.lat<=a.lat&&this.ne.lat>=a.lat},NPMapLib.Geometry.Extent.prototype.containsExtent=function(a){return this.left<=a.left&&this.bottom<=a.bottom&&this.right>=a.right&&this.top>=a.top},NPMapLib.Geometry.Extent.prototype.intersects=function(a,b){if("boolean"==typeof b&&(b={inclusive:b}),b=b||{},b.worldBounds){var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)}else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left===a.right||c.right===a.left||c.top===a.bottom||c.bottom===a.top;if(b.inclusive||!e){var f=a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=a.bottom&&c.bottom<=a.top,g=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,h=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,i=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right;d=(f||g)&&(h||i)}if(b.worldBounds&&!d){var j=b.worldBounds,k=j.getWidth(),l=!j.containsBounds(c),m=!j.containsBounds(a);l&&!m?(a=a.add(-k,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):m&&!l&&(c=c.add(-k,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},NPMapLib.Geometry.Extent.prototype.extend=function(){},NPMapLib.Geometry.Extent.prototype.getCenter=function(){var a=(this.sw.lat+this.ne.lat)/2,b=(this.sw.lon+this.ne.lon)/2;return new NPMapLib.Geometry.Point(b,a)},NPMapLib.Geometry.Extent.prototype.isEmpty=function(){return!1},NPMapLib.Geometry.Extent.prototype.getSouthWest=function(){return this.sw},NPMapLib.Geometry.Extent.prototype.getNorthEast=function(){return this.ne},NPMapLib.Geometry.Extent.prototype.toString=function(){return[this.left,this.bottom,this.right,this.top].join(",")}}(),function(){NPMapLib.Geometry.Pixel=function(a,b){this.x=a,this.y=b,this.CLASS_NAME="NPMapLib.Geometry.Pixel"},NPMapLib.Geometry.Pixel.prototype.equals=function(a){return a instanceof NPMapLib.Geometry.Pixel?this.x===a.x&&this.y===a.y:!1},NPMapLib.Geometry.Pixel.prototype.toString=function(){return this.x+","+this.y}}(),NPMapLib.POLYGON_EVENT_CLICK="click",NPMapLib.POLYGON_EVENT_DBLCLICK="dblclick",NPMapLib.POLYGON_EVENT_RIGHT_CLICK="rightclick",NPMapLib.POLYGON_EVENT_MOUSE_DOWN="mousedown",NPMapLib.POLYGON_EVENT_MOUSE_UP="mouseup",NPMapLib.POLYGON_EVENT_MOUSE_OVER="mouseover",NPMapLib.POLYGON_EVENT_MOUSE_OUT="mouseout",NPMapLib.POLYGON_EVENT_LINE_UPDATE="lineupdate",NPMapLib.POLYGON_EVENT_MODIFIED="dragend",NPMapLib.POLYGON_EVENT_DRAG_START="dragstart",NPMapLib.POLYGON_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.Polygon=function(a,b){this.CLASS_NAME="NPMapLib.Geometry.Polygon",this.overlayType=NPMapLib.OVERLAY_TYPE_POLYGON,this._points=a,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._pointRadius=5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._enableEditing=!1,this._enableClicking=!0,this.text="",this.fontSize=12,this._graphicZIndex=-1,b&&(b.color&&(this._color=b.color),b.fillColor&&(this._fillColor=b.fillColor),b.weight&&(this._weight=b.weight),b.opacity&&(this._opacity=b.opacity),b.fillOpacity&&(this._fillOpacity=b.fillOpacity),b.lineStyle&&(this._lineStyle=b.lineStyle),b.enableEditing&&(this._enableEditing=b.enableEditing),b.enableClicking&&(this._enableClicking=b.enableClicking),b.text&&(this.text=b.text),b.pointRadius&&(this._pointRadius=b.pointRadius),b.strokeColor&&(this._color=b.strokeColor),b.strokeOpacity&&(this._opacity=b.strokeOpacity),b.strokeWidth&&(this._weight=b.strokeWidth))},NPMapLib.Geometry.Polygon.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Polygon.prototype.setPath=function(a){this._points=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a[0].lon)a=NPMapLib.T.setPoints(b,a);else for(var c=0;c<a.length;c++)a[c]=NPMapLib.T.setPoints(b,a[c]);if(this._apiObj){if(a[0].lon){this._apiObj.geometry.components[0].components=[];for(var c=0;c<a.length-1;c++){var d=new OpenLayers.Geometry.Point(a[c].lon,a[c].lat);this._apiObj.geometry.components[0].components.push(d),d.parent=this._apiObj.geometry.components[0]}this._apiObj.geometry.components[0].components.push(this._apiObj.geometry.components[0].components[0]),this._apiObj.geometry.components[0].clearBounds()}else for(var e=0;e<a.length;e++){this._apiObj.geometry.components[e].components=[];for(var c=0;c<a[e].length-1;c++){var d=new OpenLayers.Geometry.Point(a[e][c].lon,a[e][c].lat);this._apiObj.geometry.components[e].components.push(d),d.parent=this._apiObj.geometry.components[e]}this._apiObj.geometry.components[e].components.push(this._apiObj.geometry.components[e].components[0]),this._apiObj.geometry.components[e].clearBounds()}this.refresh(),b&&b.resetEditVertices()}},NPMapLib.Geometry.Polygon.prototype.getPath=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getOverlayPosition(this);b&&(b=NPMapLib.T.getPoints(a,b),this._points=b)}return this._points},NPMapLib.Geometry.Polygon.prototype.setColor=function(a){this._color=a},NPMapLib.Geometry.Polygon.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Polygon.prototype.setFillColor=function(a){this._fillColor=a},NPMapLib.Geometry.Polygon.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.Polygon.prototype.setOpacity=function(a){this._opacity=a},NPMapLib.Geometry.Polygon.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Polygon.prototype.setFillOpacity=function(a){this._fillOpacity=a},NPMapLib.Geometry.Polygon.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.Polygon.prototype.setWeight=function(a){this._weight=a},NPMapLib.Geometry.Polygon.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Polygon.prototype.setLineStyle=function(a){this._lineStyle=a},NPMapLib.Geometry.Polygon.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Polygon.prototype.getPointRadius=function(){return this._pointRadius},NPMapLib.Geometry.Polygon.prototype.setStyle=function(a){a.color&&(this._color=a.color),a.fillColor&&(this._fillColor=a.fillColor),a.weight&&(this._weight=a.weight),a.opacity&&(this._opacity=a.opacity),a.fillOpacity&&(this._fillOpacity=a.fillOpacity),a.lineStyle&&(this._lineStyle=a.lineStyle),a.text&&(this.text=a.text),this.refresh&&this.refresh()},NPMapLib.Geometry.Polygon.prototype.getExtent=function(){var a=new NPMapLib.Geometry.Extent(0,0,0,0),b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return b&&(a=NPMapLib.T.getExtent(b,b.getOverlayExtent(this))),a},NPMapLib.Geometry.Polygon.prototype.setPositionAt=function(a,b){!this._points||a>this._points.length-1||0>a||this._points.splice(a,0,b)},NPMapLib.Geometry.Polygon.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},NPMapLib.Geometry.Polygon.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)},NPMapLib.Geometry.Polygon.prototype.setFillText=function(a,b){this.text=a;var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.setFillText(this,a,b)},NPMapLib.Geometry.Polygon.prototype.getArea=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return b?b.getArea(this,a?a:"km"):void 0}}(),NPMapLib.POLYLINE_EVENT_CLICK="click",NPMapLib.POLYLINE_EVENT_DBLCLICK="dblclick",NPMapLib.POLYLINE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.POLYLINE_EVENT_MOUSE_DOWN="mousedown",NPMapLib.POLYLINE_EVENT_MOUSE_UP="mouseup",NPMapLib.POLYLINE_EVENT_MOUSE_OVER="mouseover",NPMapLib.POLYLINE_EVENT_MOUSE_OUT="mouseout",NPMapLib.POLYLINE_EVENT_LINE_UPDATE="lineupdate",NPMapLib.POLYLINE_EVENT_LINE_MODIFIED="dragend",NPMapLib.POLYLINE_EVENT_DRAG_START="dragstart",NPMapLib.POLYLINE_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.Polyline=function(a,b){this.CLASS_NAME="NPMapLib.Geometry.Polyline",this.overlayType=NPMapLib.OVERLAY_TYPE_POLYLINE,this._points=a,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._pointRadius=5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._arrowStyle=NPMapLib.LINE_ARROW_TYPE_NULL,this._enableEditing=!1,this._enableClicking=!0,b&&(b.arrowStyle&&(this._arrowStyle=b.arrowStyle),b.color&&(this._color=b.color),b.fillColor&&(this._fillColor=b.fillColor),b.weight&&(this._weight=b.weight),b.opacity&&(this._opacity=b.opacity),b.fillOpacity&&(this._fillOpacity=b.fillOpacity),b.lineStyle&&(this._lineStyle=b.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(b.enableEditing,"boolean")&&(this._enableEditing=b.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(b.enableClicking,"boolean")&&(this._enableClicking=b.enableClicking),b.text&&(this.text=b.text),b.pointRadius&&(this._pointRadius=b.pointRadius),b.strokeColor&&(this._color=b.strokeColor),b.strokeOpacity&&(this._opacity=b.strokeOpacity),b.strokeWidth&&(this._weight=b.strokeWidth))},NPMapLib.Geometry.Polyline.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Polyline.prototype.setPath=function(a){if(this._points=a,this._apiObj){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a=NPMapLib.T.setPoints(b,a),this._apiObj.geometry.components=[];for(var c=0;c<a.length;c++){var d=new OpenLayers.Geometry.Point(a[c].lon,a[c].lat);this._apiObj.geometry.components.push(d),d.parent=this._apiObj.geometry}this._apiObj.geometry.clearBounds(),this.refresh(),b&&b.resetEditVertices()}},NPMapLib.Geometry.Polyline.prototype.addPoint=function(a){if(this._points.push(a),this._apiObj){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);
a=NPMapLib.T.setPoint(b,a);var c=new OpenLayers.Geometry.Point(a.lon,a.lat);this._apiObj.geometry.components.push(c),c.parent=this._apiObj.geometry,this._apiObj.geometry.clearBounds(),this.refresh()}},NPMapLib.Geometry.Polyline.prototype.getPath=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getOverlayPosition(this);b&&(b=NPMapLib.T.getPoints(a,b),this._points=b)}return this._points},NPMapLib.Geometry.Polyline.prototype.setStyle=function(a){a instanceof Object&&(a.color&&(this._color=a.color),a.opacity&&(this._opacity=a.opacity),a.weight&&(this._weight=a.weight),a.lineStyle&&(this._lineStyle=a.lineStyle),a.arrowStyle&&(this._arrowStyle=a.arrowStyle))},NPMapLib.Geometry.Polyline.prototype.setColor=function(a){this._color=a},NPMapLib.Geometry.Polyline.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Polyline.prototype.setOpacity=function(a){0>a||a>1||(this._opacity=a)},NPMapLib.Geometry.Polyline.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Polyline.prototype.setWeight=function(a){1>a||(this._weight=a)},NPMapLib.Geometry.Polyline.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Polyline.prototype.setLineStyle=function(a){this._lineStyle=a},NPMapLib.Geometry.Polyline.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Polyline.prototype.setArrowStyle=function(a){this._arrowStyle=a},NPMapLib.Geometry.Polyline.prototype.getArrowStyle=function(){return this._arrowStyle},NPMapLib.Geometry.Polyline.prototype.getExtent=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a)return NPMapLib.T.getExtent(a,a.getOverlayExtent(this));for(var b=this._points[0].lon,c=this._points[0].lat,d=this._points[0].lon,e=this._points[0].lat,f=this._points.length-1;f>=1;f--)this._points[f].lon<b&&(b=this._points[f].lon),this._points[f].lon>d&&(d=this._points[f].lon),this._points[f].lat<c&&(c=this._points[f].lat),this._points[f].lat>e&&(e=this._points[f].lat);return new NPMapLib.Geometry.Extent(b,c,d,e)},NPMapLib.Geometry.Polyline.prototype.getStartPoint=function(){return this.getPath()[0]},NPMapLib.Geometry.Polyline.prototype.getEndPoint=function(){var a=this.getPath(),b=a.length;return a[b-1]},NPMapLib.Geometry.Polyline.prototype.setPositionAt=function(a,b){!this._points||a>this._points.length-1||0>a||this._points.splice(a,0,b)},NPMapLib.Geometry.Polyline.prototype.getLength=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),b=0;if(a)for(var c=1;c<this._points.length;c++)b+=a.getDistance(this._points[c],this._points[c-1]);return b},NPMapLib.Geometry.Polyline.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},NPMapLib.Geometry.Polyline.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)}}(),NPMapLib.ANIMATION_EVENT_START="start",NPMapLib.ANIMATION_EVENT_PAUSE="pause",NPMapLib.ANIMATION_EVENT_STOP="stop",NPMapLib.ANIMATION_EVENT_MOVING="moving",NPMapLib.ANIMATION_EVENT_MOVED="moved",function(){NPMapLib.Symbols.Animation=function(a,b,c){this.id=-1,this.CLASS_NAME="NPMapLib.Symbols.Animation",this._points=new Array,NPMapLib.Utils.BaseUtils.isTypeRight(b,"NPMapLib.Overlay")&&(this._overlay=b),this._listeners={},this._initialize(),this.mapAdapter=NPMapLib.Adapter.AdapterFactory.getMapAdapter(a),c&&(NPMapLib.Utils.BaseUtils.isTypeRight(c.speed,"number")&&(this._speed=c.speed),NPMapLib.Utils.BaseUtils.isTypeRight(c.isReturn,"boolean")&&(this._isReturn=c.isReturn),NPMapLib.Utils.BaseUtils.isTypeRight(c.isRepeat,"boolean")&&(this._isRepeat=c.isRepeat))},NPMapLib.Symbols.Animation.prototype.setPath=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"NPMapLib.Geometry.Polyline")&&(this._path=a,this._points=a.getPath())},NPMapLib.Symbols.Animation.prototype.getPath=function(){return this._path},NPMapLib.Symbols.Animation.prototype.getOverlay=function(){return this._overlay},NPMapLib.Symbols.Animation.prototype.setRepeat=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"boolean")&&(this._isRepeat=a)},NPMapLib.Symbols.Animation.prototype.setReturn=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"boolean")&&(this._isReturn=a)},NPMapLib.Symbols.Animation.prototype.setSpeed=function(a){NPMapLib.Utils.BaseUtils.isTypeRight(a,"number")&&(this._speed=a)},NPMapLib.Symbols.Animation.prototype.start=function(){if(this.stop(),NPMapLib.Utils.BaseUtils.isTypeRight(this._overlay,"NPMapLib.Overlay")&&NPMapLib.Utils.BaseUtils.isTypeRight(this._points,"Array")&&!(this._points.length<=1)){this._interval=100,this._isPause=!1,this._curPointIndex=0,this._overlay.setPosition(this._points[0]);var a=this._getAngle(this._points[0],this._points[1]);this._changeAngle(a),this._calculateSegment(this._points[0],this._points[1]),this._triggerEvent(NPMapLib.ANIMATION_EVENT_START,this._points[0]),this._startTimer()}},NPMapLib.Symbols.Animation.prototype.pause=function(){this._isPause=!this._isPause,this._triggerEvent(NPMapLib.ANIMATION_EVENT_PAUSE,this._points[this._curPointIndex])},NPMapLib.Symbols.Animation.prototype.stop=function(){this._timer&&window.clearInterval(this._timer),this._triggerEvent(NPMapLib.ANIMATION_EVENT_STOP,this._points[this._curPointIndex])},NPMapLib.Symbols.Animation.prototype.addEventListener=function(a,b){switch(a){case NPMapLib.ANIMATION_EVENT_START:this._listeners.start||(this._listeners.start=[]),this._listeners.start.push(b);break;case NPMapLib.ANIMATION_EVENT_PAUSE:this._listeners.pause||(this._listeners.pause=[]),this._listeners.pause.push(b);break;case NPMapLib.ANIMATION_EVENT_STOP:this._listeners.stop||(this._listeners.stop=[]),this._listeners.stop.push(b);break;case NPMapLib.ANIMATION_EVENT_MOVING:this._listeners.moving||(this._listeners.moving=[]),this._listeners.moving.push(b);break;case NPMapLib.ANIMATION_EVENT_MOVED:this._listeners.moved||(this._listeners.moved=[]),this._listeners.moved.push(b)}},NPMapLib.Symbols.Animation.prototype.removeEventListener=function(a,b){var c=this._listeners[a];if(c instanceof Array)for(var d=0;d<c.length;++d)if(c[d].toString()===b.toString()){c.pop(b);break}},NPMapLib.Symbols.Animation.prototype._initialize=function(){this._angle=0,this._isIncreaseDirection=!0,this._curPointIndex=0,this._interval=100,this._isReturn=!0,this._isRepeat=!0},NPMapLib.Symbols.Animation.prototype._startTimer=function(){this._timer=setInterval(function(){this._isPause||this._actionStart()}.bind(this),this._interval)},NPMapLib.Symbols.Animation.prototype._actionStart=function(){this._triggerEvent(NPMapLib.ANIMATION_EVENT_MOVING,this._points[this._curPointIndex]);var a=this._getNextPoint();if(this._moveTo(a),this._triggerEvent(NPMapLib.ANIMATION_EVENT_MOVED,a),this._curSegCount>=this._totalSegCount){if(this._points.length-1===this._curPointIndex)if(this._isRepeat&&!this._isReturn)this._curPointIndex=0;else if(this._isRepeat&&this._isReturn);else{if(this._isRepeat||!this._isReturn)return void this.stop();this._isHaveReturn=!0}if(this._isHaveReturn&&0===this._curPointIndex)return void this.stop();this._turningPoint()}else this._curSegCount++},NPMapLib.Symbols.Animation.prototype._getNextPoint=function(){return this._curSegCount>=this._totalSegCount?(this._isIncreaseDirection?++this._curPointIndex:--this._curPointIndex,this._points[this._curPointIndex]):this._isIncreaseDirection?this._getPoint(this._points[this._curPointIndex],this._points[this._curPointIndex+1]):this._getPoint(this._points[this._curPointIndex],this._points[this._curPointIndex-1])},NPMapLib.Symbols.Animation.prototype._getPoint=function(a,b){var c=this.mapAdapter.pointToPixel(NPMap.T.setPoint(this.mapAdapter,a)),d=this.mapAdapter.pointToPixel(NPMap.T.setPoint(this.mapAdapter,b)),e=this._curSegCount/this._totalSegCount,f=(d.x-c.x)*e+c.x,g=(d.y-c.y)*e+c.y;EzServerClient.GlobeParams.VML;var h=new NPMapLib.Geometry.Pixel(f,g);return NPMap.T.getPoint(this.mapAdapter,this.mapAdapter.pixelToPoint(h))},NPMapLib.Symbols.Animation.prototype._turningPoint=function(){var a=this._curPointIndex;if((a>=this._points.length-1||0>=a)&&(this._isIncreaseDirection=this._isReturn?this._isIncreaseDirection:!this._isIncreaseDirection),this._isIncreaseDirection){this._calculateSegment(this._points[a],this._points[a+1]);var b=this._getAngle(this._points[a],this._points[a+1]);this._changeAngle(b)}else{this._calculateSegment(this._points[a],this._points[a-1]);var b=this._getAngle(this._points[a],this._points[a-1]);this._changeAngle(b)}},NPMapLib.Symbols.Animation.prototype._calculateSegment=function(a,b){var c=this._getDistance(a,b),d=c/(this._speed*this._interval/1e3);this._totalSegCount=Math.ceil(d)-1,this._curSegCount=0},NPMapLib.Symbols.Animation.prototype._getDistance=function(a,b){return this.mapAdapter.getDistance(a,b,"EPSG:4326")},NPMapLib.Symbols.Animation.prototype._moveTo=function(a){this.mapAdapter.setOverlayPosition(this._overlay,NPMap.T.setPoint(this.mapAdapter,a))},NPMapLib.Symbols.Animation.prototype._getAngle=function(a,b){var c=180*Math.atan2(b.lat-a.lat,b.lon-a.lon)/Math.PI;return c=c>0?360-c:0-c},NPMapLib.Symbols.Animation.prototype._changeAngle=function(a){this._angle!=a&&this._overlay instanceof NPMapLib.Overlay&&(this._overlay.rotate(a),this._angle=a)},NPMapLib.Symbols.Animation.prototype._triggerEvent=function(a,b){var c=this._listeners[a];if(c instanceof Array)for(var d=0;d<c.length;++d)c[d].apply(this,b)}}(),NPMapLib.Symbols.Animation.Options={speed:100,isReturn:!0,isRepeat:!0},function(){NPMapLib.Symbols.Icon=function(a,b,c){this.CLASS_NAME="NPMapLib.Symbols.Icon",this.id=-1,this.border=0,b instanceof NPMapLib.Geometry.Size&&(this._imageUrl=a,this._imageSize=b,this._anchor=new NPMapLib.Geometry.Size(-b.width/2,-b.height),c&&(c.anchor&&(this._anchor=c.anchor),c.border&&(this.border=c.border)))},NPMapLib.Symbols.Icon.prototype.setImageUrl=function(a){"string"==typeof a&&(this._imageUrl=a)},NPMapLib.Symbols.Icon.prototype.getImageUrl=function(){return this._imageUrl},NPMapLib.Symbols.Icon.prototype.setImageSize=function(a){a instanceof NPMapLib.Geometry.Size&&(this._imageSize=a)},NPMapLib.Symbols.Icon.prototype.getImageSize=function(){return this._imageSize},NPMapLib.Symbols.Icon.prototype.setAnchor=function(a){a instanceof NPMapLib.Geometry.Size&&(this._anchor=a)},NPMapLib.Symbols.Icon.prototype.getAnchor=function(){return this._anchor}}(),NPMapLib.INFOWINDOW_EVENT_CLOSE="close",NPMapLib.INFOWINDOW_EVENT_OPEN="open",NPMapLib.INFOWINDOW_EVENT_HIDE="hide",NPMapLib.INFOWINDOW_EVENT_CLICK_CLOSE="clickclose",function(){NPMapLib.Symbols.InfoWindow=function(a,b,c,d){this.CLASS_NAME="NPMapLib.Symbols.InfoWindow",this.overlayType=NPMapLib.OVERLAY_TYPE_INFOWIN,this.id=-1,this._title=b,this._content="",this._dom=null,"string"==typeof c?this._content=c:this._dom=c,this._position=a,this._isOpen=!1,this._offset=new NPMapLib.Geometry.Size(1,1),this._width=260,this._height=180,this._arrow=!0,this._enableCloseOnClick=!1,this._eventHandle={};var e=this;if(this.autoSize=!0,this.iscommon=!1,this._enableCloseOnClick=!1,this.positionBlock={},this.paddingForPopups=new NPMapLib.Geometry.Extent(70,20,15,15),this._closeCallback=function(){e.close()},this.isAdaptation=!1,this.isAnimationOpen=!0,d){if(d.width&&(this._width=d.width),d.height&&(this._height=d.height),d.offset&&(this._offset=d.offset),(d.iscommon||0==d.iscommon)&&(this.iscommon=d.iscommon),"boolean"==typeof d.arrow&&(this._arrow=d.arrow),"boolean"==typeof d.enableCloseOnClick&&(this._enableCloseOnClick=d.enableCloseOnClick),"boolean"==typeof d.autoSize&&(this.autoSize=d.autoSize),d.paddingForPopups instanceof NPMapLib.Geometry.Extent&&(this.paddingForPopups=d.paddingForPopups),d.isAdaptation&&(this.isAdaptation=d.isAdaptation),(d.isAnimationOpen||0==d.isAnimationOpen)&&(this.isAnimationOpen=d.isAnimationOpen),d.positionBlock&&d.positionBlock.imageSrc){this.positionBlock.imageSrc=d.positionBlock.imageSrc;var f=new Image;f.src=this.positionBlock.imageSrc;var g=d.positionBlock.imageSize?d.positionBlock.imageSize.width:f.width,h=d.positionBlock.imageSize?d.positionBlock.imageSize.height:f.height;this.autoSize&&this._dom&&this._dom.style&&this._dom.style.width&&(this._width=-1!=this._dom.style.width.indexOf("px")?this._dom.style.width.substring(0,this._dom.style.width.indexOf("px")):this._dom.style.width),d.positionBlock.offset?this.positionBlock.offset=new OpenLayers.Pixel(d.positionBlock.offset.width,d.positionBlock.offset.height):(this.positionBlock.offset=new OpenLayers.Pixel(-(this._width-g)/2,-(h-2)),(d.positionBlock.offsetX||0==d.positionBlock.offsetX)&&(this.positionBlock.offset=new OpenLayers.Pixel(0-d.positionBlock.offsetX,-(h-2)))),this.positionBlock.padding=new OpenLayers.Bounds(0,h+2,0,0),this.positionBlock.imageSize=new OpenLayers.Size(g,h),this.positionBlock.blocks=[];var i={};i.size=this.positionBlock.imageSize,i.anchor=new OpenLayers.Bounds(0-this.positionBlock.offset.x-parseInt(g/2),3,null,null),i.position=new OpenLayers.Pixel(0,0),this.positionBlock.blocks.push(i)}d.useDomStyle&&(this.useDomStyle=!0)}},NPMapLib.Symbols.InfoWindow.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.InfoWindow.prototype.open=function(a,b){if(!this._isOpen){"undefined"==typeof b&&(b=!0);var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a&&a instanceof NPMapLib.Geometry.Size&&c&&b){var d=this.getPositionByInfowindow(this._position,a);this.isAnimationOpen?c.panTo(d):c.setCenter(d)}else if(c&&b){var e=c.getInfoWindowSize(this),d=this.getPositionByInfowindow(this._position,e);this.isAnimationOpen?c.panTo(d):c.setCenter(d)}c&&c.openInfoWindow(this),this._isOpen=!0,this._actionEventHandle(NPMapLib.INFOWINDOW_EVENT_OPEN)}},NPMapLib.Symbols.InfoWindow.prototype.setPosition=function(a){this._position=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setOverlayPosition(this,NPMapLib.T.setPoint(b,a))},NPMapLib.Symbols.InfoWindow.prototype.getBaseDiv=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return a?a.getInfoWindowBaseDiv(this):void 0},NPMapLib.Symbols.InfoWindow.prototype.getContentDivStyle=function(){return this._apiObj?this._apiObj.getContentDivStyle():void 0},NPMapLib.Symbols.InfoWindow.prototype.getPosition=function(){return this._position},NPMapLib.Symbols.InfoWindow.prototype.setOffset=function(a){this._offset=a},NPMapLib.Symbols.InfoWindow.prototype.getOffset=function(){return this._offset},NPMapLib.Symbols.InfoWindow.prototype.close=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.closeInfoWindow(this),this._isOpen=!1,this._actionEventHandle(NPMapLib.INFOWINDOW_EVENT_CLOSE)},NPMapLib.Symbols.InfoWindow.prototype.hide=function(){if(this._isOpen){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideInfoWindow(this),this._isOpen=!1,this._actionEventHandle(NPMapLib.INFOWINDOW_EVENT_HIDE)}},NPMapLib.Symbols.InfoWindow.prototype.show=function(){if(!this._isOpen){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&(a.openInfoWindow(this),this._isOpen=!0)}},NPMapLib.Symbols.InfoWindow.prototype.setWidth=function(a){if("number"==typeof a){var b=this.getSize();b&&(this._width=b.width,this._height=b.height),this._width=a;var c=new NPMapLib.Geometry.Size(this._width,this._height);this.setSize(c)}},NPMapLib.Symbols.InfoWindow.prototype.setHeight=function(a){if("number"==typeof a){var b=this.getSize();b&&(this._width=b.width,this._height=b.height),this._height=a;var c=new NPMapLib.Geometry.Size(this._width,this._height);this.setSize(c)}},NPMapLib.Symbols.InfoWindow.prototype.setSize=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setInfoWindowSize(this,a)},NPMapLib.Symbols.InfoWindow.prototype.updateSize=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.updateInfoWindowSize(this)},NPMapLib.Symbols.InfoWindow.prototype.getSize=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return a?a.getInfoWindowSize(this):void 0},NPMapLib.Symbols.InfoWindow.prototype.setTitle=function(a){this._title=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setTitle(this)},NPMapLib.Symbols.InfoWindow.prototype.getTitle=function(){return this._title},NPMapLib.Symbols.InfoWindow.prototype.setContent=function(a){this._content=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setContent(this)},NPMapLib.Symbols.InfoWindow.prototype.setBackgroundColor=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setBackgroundColor(this,a)},NPMapLib.Symbols.InfoWindow.prototype.getContent=function(){return this._content},NPMapLib.Symbols.InfoWindow.prototype.setContentDom=function(a,b){this._dom=a;var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.setInfoWindow(this),b&&this._apiObj&&this._apiObj.setOpacity(0)},NPMapLib.Symbols.InfoWindow.prototype.getContentDom=function(){return this._dom},NPMapLib.Symbols.InfoWindow.prototype.isOpen=function(){return this._isOpen},NPMapLib.Symbols.InfoWindow.prototype.enableCloseOnClick=function(){this._enableCloseOnClick||(this._enableCloseOnClick=!0)},NPMapLib.Symbols.InfoWindow.prototype.disableCloseOnClick=function(){this._enableCloseOnClick&&(this._enableCloseOnClick=!1)},NPMapLib.Symbols.InfoWindow.prototype.addEventListener=function(a,b){this._eventHandle[a]||a!==NPMapLib.INFOWINDOW_EVENT_CLOSE&&a!==NPMapLib.INFOWINDOW_EVENT_OPEN&&a!==NPMapLib.INFOWINDOW_EVENT_HIDE&&a!==NPMapLib.INFOWINDOW_EVENT_CLICK_CLOSE||(this._eventHandle[a]=b)},NPMapLib.Symbols.InfoWindow.prototype.removeEventListener=function(a){this._eventHandle[a]&&delete this._eventHandle[a]},NPMapLib.Symbols.InfoWindow.prototype._actionEventHandle=function(a){var b=this._eventHandle[a];b&&b()},NPMapLib.Symbols.InfoWindow.prototype.setCloseCallback=function(a){this._closeCallback=a},NPMapLib.Symbols.InfoWindow.prototype.moveTo=function(a){this.setPosition(a)},NPMapLib.Symbols.InfoWindow.prototype.getPositionByInfowindow=function(a,b){var c=b.width,d=b.height;this.iscommon||(d=b.height+31);var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a=NPMapLib.T.setPoint(e,a);var f=e.getCenter(),g=e.pointToPixel(f),h=e.getExtent(),i=new NPMapLib.Geometry.Point(h.ne.lon,h.sw.lat),j=e.pointToPixel(i),k=e.pointToPixel(a),l=0,m=0,n=-60;this.iscommon&&(n=0),this.positionBlock&&this.positionBlock.offset&&(n=this.positionBlock.offset.x),k.x<this.paddingForPopups.left-n?l=this.paddingForPopups.left-n-k.x:k.x+n>j.x-c-this.paddingForPopups.right&&(l=j.x-c-k.x-this.paddingForPopups.right-n);var o=-32,p=0;if(this.iscommon&&(o=0,p=d),this.positionBlock&&this.positionBlock.offset&&(o=this.positionBlock.offset.y-this.paddingForPopups.top),k.y<d-o?m=d-o-k.y:k.y+p+this.paddingForPopups.bottom>j.y&&(m=j.y-k.y-p-this.paddingForPopups.bottom),0==l&&0==m)return f;var q=new NPMapLib.Geometry.Pixel(g.x-l,g.y-m),r=e.pixelToPoint(q);return r},NPMapLib.Symbols.InfoWindow.prototype.updatePosition=function(){this._apiObj&&this._apiObj.updatePosition()}}(),NPMapLib.LABEL_EVENT_CLICK="click",NPMapLib.LABEL_EVENT_DBLCLICK="dblclick",NPMapLib.LABEL_EVENT_RIGHT_CLICK="rightclick",NPMapLib.LABEL_EVENT_MOUSE_DOWN="mousedown",NPMapLib.LABEL_EVENT_MOUSE_UP="mouseup",NPMapLib.LABEL_EVENT_MOUSE_OVER="mouseover",NPMapLib.LABEL_EVENT_MOUSE_OUT="mouseout",NPMapLib.LABEL_EVENT_DRAG_START="dragstart",NPMapLib.LABEL_EVENT_DRAG_END="dragend",function(){NPMapLib.Symbols.Label=function(a,b){this.CLASS_NAME="NPMapLib.Symbols.Label",this.overlayType=NPMapLib.OVERLAY_TYPE_LABEL,this._content=a,this._offset=new NPMapLib.Geometry.Size(0,0),this._fontSize=12,this._fontFamily="宋体",this._color="red",this._align="m",this._isBold=!1,this._style={},b&&(this._offset=b.offset?b.offset:new NPMapLib.Geometry.Size(0,0),this._position=b.position?b.position:new NPMapLib.Geometry.Point(0,0))},NPMapLib.Symbols.Label.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.Label.prototype.setStyle=function(a){a&&(this._style=a||{},a.FontSize&&(this._fontSize=a.FontSize),a.FontFamily&&(this._fontFamily=a.FontFamily),a.Color&&(this._color=a.Color),"boolean"==typeof a.IsBold&&(this._isBold=a.IsBold),a.Align&&(this._align=a.Align),a.Offset&&(this._offset=a.Offset),a.fontSize&&(this._fontSize=a.fontSize),a.fontFamily&&(this._fontFamily=a.fontFamily),a.color&&(this._color=a.color),a.bgColor&&(this._bgColor=a.bgColor),a.bordColor&&(this._bordColor=a.bordColor),a.borderSize&&(this._borderSize=a.borderSize),"boolean"==typeof a.isBold&&(this._isBold=a.isBold),a.align&&(this._align=a.align),a.offset&&(this._offset=a.offset))},NPMapLib.Symbols.Label.prototype.getStyle=function(){return{fontSize:this._fontSize,fontFamily:this._fontFamily,color:this._color,align:this._align,isBold:this._isBold}},NPMapLib.Symbols.Label.prototype.setContent=function(a){this._content=a},NPMapLib.Symbols.Label.prototype.getContent=function(){return this._content},NPMapLib.Symbols.Label.prototype.setPosition=function(a){this._position=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setOverlayPosition(this,NPMapLib.T.setPoint(b,a))},NPMapLib.Symbols.Label.prototype.getPosition=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getOverlayPosition(this);b&&(b=NPMapLib.T.getPoint(a,b),this._position=b)}return this._position},NPMapLib.Symbols.Label.prototype.setOffset=function(a){this._offset=a},NPMapLib.Symbols.Label.prototype.getOffset=function(){return this._offset},NPMapLib.Symbols.Label.prototype.setTitle=function(a){this._title=a},NPMapLib.Symbols.Label.prototype.getTitle=function(){return this._title},NPMapLib.Symbols.Label.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},NPMapLib.Symbols.Label.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)}}(),NPMapLib.MARKER_EVENT_CLICK="click",NPMapLib.MARKER_EVENT_DBLCLICK="dblclick",NPMapLib.MARKER_EVENT_RIGHT_CLICK="rightclick",NPMapLib.MARKER_EVENT_MOUSE_DOWN="mousedown",NPMapLib.MARKER_EVENT_MOUSE_UP="mouseup",NPMapLib.MARKER_EVENT_MOUSE_OVER="mouseover",NPMapLib.MARKER_EVENT_MOUSE_OUT="mouseout",NPMapLib.MARKER_EVENT_DRAG_START="dragstart",NPMapLib.MARKER_EVENT_DRAG_END="dragend",function(){NPMapLib.Symbols.Marker=function(a,b){this.CLASS_NAME="NPMapLib.Symbols.Marker",this.overlayType=NPMapLib.OVERLAY_TYPE_MARKER,this._position=a,this._offset=new NPMapLib.Geometry.Size(0,0),this._icon,this._label,this.title=null,b&&(this._offset=b.offset?b.offset:new NPMapLib.Geometry.Size(0,0),b.icon&&(this._icon=b.icon),b.title&&(this.title=b.title),b.rotation&&(this._rotation=b.rotation))},NPMapLib.Symbols.Marker.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.Marker.prototype.setIcon=function(a){this._icon=a instanceof NPMapLib.Symbols.Icon?a:new NPMapLib.Symbols.Icon(a.imageUrl,new NPMapLib.Geometry.Size(a.imageSize.Width,a.imageSize.Height),{anchor:new NPMapLib.Geometry.Size(a.anchor.X,a.anchor.Y)})},NPMapLib.Symbols.Marker.prototype.getIcon=function(){return this._icon},NPMapLib.Symbols.Marker.prototype.setPosition=function(a){this._position=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setOverlayPosition(this,NPMapLib.T.setPoint(b,a))},NPMapLib.Symbols.Marker.prototype.getPosition=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getOverlayPosition(this);b&&(b=NPMapLib.T.getPoint(a,b),this._position=b)}return this._position},NPMapLib.Symbols.Marker.prototype.setOffset=function(a){this._offset=a},NPMapLib.Symbols.Marker.prototype.getOffset=function(){return this._offset},NPMapLib.Symbols.Marker.prototype.setLabel=function(a){this._label=a,this._label.setPosition(this._position)},NPMapLib.Symbols.Marker.prototype.getLabel=function(){return this._label},NPMapLib.Symbols.Marker.prototype.showLabel=function(){if(this._label){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showMarkerLabel(this)}},NPMapLib.Symbols.Marker.prototype.hideLabel=function(){if(this._label){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideMarkerLabel(this)}},NPMapLib.Symbols.Marker.prototype.setTitle=function(a){this.title=a},NPMapLib.Symbols.Marker.prototype.getTitle=function(){return this.title},NPMapLib.Symbols.Marker.prototype.moveTo=function(a){this.setPosition(a)},NPMapLib.Symbols.Marker.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},NPMapLib.Symbols.Marker.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)},NPMapLib.Symbols.Marker.prototype.removeMenu=function(){this._menu&&(this._menu.destroy(),this._menu=null)}}(),function(){NPMapLib.Symbols.ClusterPoints=function(a,b){if(this.CLASS_NAME="NPMapLib.Symbols.ClusterPoints",this.overlayType=NPMapLib.OVERLAY_TYPE_ClusterPoints,this.id=-1,this.dataJson=a,this.layName="聚合层",this.threshold=2,this.distance=200,b){b.distance&&(this.distance=b.distance),b.threshold&&(this.threshold=b.threshold);for(var c=0;c<this.dataJson.length;c++)this.dataJson[c].container=this}},NPMapLib.Symbols.ClusterPoints.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.ClusterPoints.prototype.getMarkersByMarkType=function(a){for(var b=[],c=0;c<this.dataJson.length;c++)this.dataJson[c].markType===a&&b.push(this.dataJson[c]);return b},NPMapLib.Symbols.ClusterPoints.prototype.getClusterPoints=function(){return this.dataJson}}(),function(){NPMapLib.Symbols.ClusterMarker=function(a,b){this.location=a,this.location._visible=!0,this._apiObj=null,this.markType=" ",b&&(this.markType=b.markType?b.markType:"")},NPMapLib.Symbols.ClusterMarker.prototype.changeStyle=function(a,b){if(this._apiObj&&this._apiObj.layer){for(var c in a)this._apiObj.style[c]=a[c];b&&this._apiObj.layer.drawFeature(this._apiObj)}},NPMapLib.Symbols.ClusterMarker.prototype.setVisible=function(a){this.location._visible=a,this._apiObj&&this.container&&(this._apiObj.layer=this._apiObj.layer||this.container._layer._apiObj,this._apiObj.style&&(this._apiObj.style.display=a?"":"none"),this._apiObj.layer.drawFeature(this._apiObj))},NPMapLib.Symbols.ClusterMarker.prototype.flash=function(a){this._apiObj&&this._apiObj.getVisibility()&&(a=a||1,this._apiObj.flash(2*a))},NPMapLib.Symbols.ClusterMarker.prototype.flashStop=function(){this._apiObj&&this._apiObj.flashStop()},NPMapLib.Symbols.ClusterMarker.prototype.getData=function(){return this.location},NPMapLib.Symbols.ClusterMarker.prototype.getPosition=function(){return this.location.lon&&this.location.lat?new NPMapLib.Geometry.Point(this.location.lon,this.location.lat):void 0},NPMapLib.Symbols.ClusterMarker.prototype.setPosition=function(a){if(a&&"NPMapLib.Geometry.Point"==a.CLASS_NAME&&(this.location.lon=a.lon,this.location.lat=a.lat,this._apiObj)){var b=NPMapLib.T.setPoint(this._apiObj.layer.map,this.location);this._apiObj.move(new OpenLayers.LonLat(b.lon,b.lat))}}}(),function(){var a=NPMapLib.Symbols.CurveLine=function(a,b){this.CLASS_NAME="NPMapLib.Symbols.CurveLine";var c=this.getCurvePoints(a);NPMapLib.Geometry.Polyline.call(this,c,b)};a.prototype=new NPMapLib.Geometry.Polyline,a.prototype.getPolyline=function(){return this.polyline},a.prototype.getCurvePoints=function(a){for(var b=[],c=0;c<a.length-1;c++){var d=this.getCurveByTwoPoints(a[c],a[c+1]);d&&d.length>0&&(b=b.concat(d))}return b},a.prototype.getCurveByTwoPoints=function(a,b){if(!(a&&b&&a instanceof NPMapLib.Geometry.Point&&b instanceof NPMapLib.Geometry.Point))return null;var c=function(a){return 1-2*a+a*a},d=function(a){return 2*a-2*a*a},e=function(a){return a*a};curveCoordinates=[];var f,g,h,i,j,k,l,m=30,n=0,o=0;if("undefined"==typeof b)return void("undefined"!=typeof curveCoordinates&&(curveCoordinates=[]));var p=parseFloat(a.lat),q=parseFloat(b.lat),r=parseFloat(a.lon),s=parseFloat(b.lon);for(s>r&&parseFloat(s-r)>180&&0>r&&(r=parseFloat(360+r)),r>s&&parseFloat(r-s)>180&&0>s&&(s=parseFloat(360+s)),k=0,l=0,q==p?(f=0,g=r-s):s==r?(f=Math.PI/2,g=p-q):(f=Math.atan((q-p)/(s-r)),g=(q-p)/Math.sin(f)),0==l&&(l=f+Math.PI/5),h=g/2,j=h*Math.cos(l)+r,i=h*Math.sin(l)+p,n=0;m+1>n;n++)curveCoordinates.push(new NPMapLib.Geometry.Point(r*c(o)+j*d(o)+s*e(o),p*c(o)+i*d(o)+q*e(o))),o+=1/m;return curveCoordinates}}(),function(){NPMapLib.Symbols.DialogOptions={width:260,height:180,arrow:!0}}(),function(){var a=NPMapLib.Symbols.Dialog=function(a,b,c,d){this.overlayType=NPMapLib.OVERLAY_TYPE_DIALOG,this.id=-1,this._title=b,this._content=c,this.map=a,this._isOpen=!1,this._offset=new NPMapLib.Geometry.Size(1,1),this._width=260,this._height=180,this._arrow=!1,this.autoSize=!0,d&&(d.width&&(this._width=d.width),d.height&&(this._height=d.height),"boolean"==typeof d.arrow&&(this._arrow=d.arrow))};a.prototype=new NPMapLib.Overlay,a.prototype.open=function(a,b){if(!this._isOpen){this._popup||(this._popup=new NPMapLib.Utils.Popup({arrow:this._arrow,caption:this._title,content:this._content,width:this._width,height:this._height},this.map));var c=this.map.getSize();a=a?a:c.width/2,b=b?b:c.height/2;var d=this;this._popup.open(b+this._offset.height,a+this._offset.width,function(){d.close()}),this._isOpen=!0}},a.prototype.close=function(){this._isOpen&&this._popup&&this._popup.close()},a.prototype.setWidth=function(a){"number"==typeof a&&(this._width=a,this._popup.getStyle().width=a+"px")},a.prototype.setHeight=function(a){"number"==typeof a&&(this._height=a,this._popup.getStyle().height=a+"px")},a.prototype.setContent=function(a){this._content=a,this._popup.setContent(a)},a.prototype.getContent=function(){return this._content},a.prototype.isOpen=function(){return this._isOpen},a.prototype.setVisible=function(a){this._popup.getStyle().display=a?"":"none"}}(),NPMapLib.BUBBLE_EVENT_CLICK="click",NPMapLib.BUBBLE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.BUBBLE_EVENT_MOUSE_OVER="mouseover",NPMapLib.BUBBLE_EVENT_MOUSE_OUT="mouseout",function(){"use strict";var a=NPMapLib.Symbols.Bubble=function(a,b){this.CLASS_NAME="NPMapLib.Symbols.Bubble",this.overlayType=NPMapLib.OVERLAY_TYPE_BUBBLE,this._position=a,this._offset=new NPMapLib.Geometry.Size(0,0),this._color="#FF0000",this._options={x:0,y:0,width:29,height:58,interval:50,bubbles:[{r:3,s:[27,30],e:[27,-55],p:4.25},{r:4,s:[27,40],e:[27,-35],p:3.75},{r:6,s:[27,50],e:[27,-15],p:3.25}],wave:{a:6,w:6.28,k:.1,width:26.8593355,height:30.832615},dropPath:"M 0,30.832615 C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 c -1.062271,-39.9612311 -55.0572777,-35.5688568 -53.5570575,0 z",wavePath:" C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 z",shadowPath:"m 54,87.987175 a 27.25,6.375 0 1 1 -54.5,0 27.25,6.375 0 1 1 54.5,0 z"};var c=this._options.bubbles;this._bubbleLength=c.length,this._bubbles=[],this._b=[],this._heat=4,this._speed=4,this._increase=31,this._a=this._options.wave.a,this._w=this._options.wave.w,this._k=this._options.wave.k,this._width=this._options.wave.width,this._height=this._options.wave.height,this._waveTop=30.918412,this._start=0,this._end=Math.floor(2*this._options.wave.width),this._circle=!0,this._t=0;for(var d=0;this._bubbleLength>d;d++)this._bubbles.push({r:c[d].r,sx:c[d].s[0],sy:c[d].s[1],ex:c[d].e[0],ey:c[d].e[1],speed:c[d].p}),this._b.push([c[d].s[0],c[d].s[1]]);this._bubbleST,b&&(b.offset&&(this._offset=b.offset),b.color&&(this._color=b.color))};a.prototype=new NPMapLib.Overlay,a.prototype.setPosition=function(a){this._position=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setOverlayPosition(this,NPMapLib.T.setPoint(b,a))},a.prototype.getPosition=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(a){var b=a.getOverlayPosition(this);b&&(b=NPMapLib.T.getPoint(a,b),this._position=b)}return this._position
},a.prototype.setOffset=function(a){this._offset=a},a.prototype.getOffset=function(){return this._offset},a.prototype.setColor=function(a){this._color=a},a.prototype.getColor=function(){return this._color},a.prototype.addEventListener=function(a,b){var c=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);c&&c.addEventListener(this,a,b)},a.prototype.removeEventListener=function(a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.removeEventListener(this,a)},a.prototype._stopAnimate=function(){this._bubbleST&&clearTimeout(this._bubbleST)},a.prototype._animate=function(a){var b=document.getElementById(a);if(b){if("svg"===b.nodeName){var c=this._drawWave(),d=b.childNodes[0],e=d.childNodes[0],f=d.childNodes[1],g=d.childNodes[2];if(f&&g&&(f.setAttributeNS(null,"d",c[0]),g.setAttributeNS(null,"d",c[1]),this._circle)){var h,i=this._drawBubbleCircle(),j=e.childNodes.length;for(h=0;j>h;h++)e.childNodes[h].setAttributeNS(null,"cy",i[h].y),e.childNodes[h].setAttributeNS(null,"opacity",i[h].opacity)}}var k=this;this._bubbleST=setTimeout(function(){k._animate(a)},this._options.interval)}},a.prototype._drawBubbleCircle=function(){for(var a=[],b=0;this._bubbleLength>b;b++){var c=this._bubbles[b],d=c.sy,e=0;this._b[b][1]-=c.speed,this._b[b][1]<=c.sy&&this._b[b][1]>=c.ey?(d=this._b[b][1],e=Math.abs((c.ey-this._b[b][1])/(c.ey-c.sy))):this._b[b][1]<c.ey&&(this._b[b][1]=c.sy+c.speed*(2*(11-this._heat)-7)),a.push({y:d,opacity:e})}return a},a.prototype._drawWave=function(){for(var a=["M 53.5570575,30.832615 L"],b=["M 53.5570575,30.832615 L"],c=this._end;c>=this._start;c--){var d=.6*Math.sin(this._w*this._t*2*this._speed+.9*this._k*c)*this._a+this._waveTop;a.push(" "),a.push(c),a.push(","),a.push(this._limitLine(c,d).y);var e=Math.sin(this._w*this._t*this._speed-this._k*c)*this._a+this._waveTop;b.push(" "),b.push(c),b.push(","),b.push(this._limitLine(c,e).y)}return a.push(this._options.wavePath),b.push(this._options.wavePath),this._t=(this._t+this._increase)%27644437,[a.join(""),b.join("")]},a.prototype._limitLine=function(a,b){var c,d;return c=this._bezierTop(a),d=a>=this._options.wave.width?this._bezierRight(a):this._bezierLeft(a),b>=c&&d>=b?{y:b,at:0}:c>b?{y:c,at:-1}:b>d?{y:d,at:1}:void 0},a.prototype._bezierTop=function(a){var b=108.4279626,c=-158.7982071,d=-3.186813,e=53.5570575,f=-13.1771229,g=133.0608162,h=-119.8836933,i=30.832615,j=this._getBezierPoint(a,b,c,d,e,f,g,h,i);return j[1]},a.prototype._bezierRight=function(a){var b=-36.761122,c=47.378061,d=16.080783,e=26.8593355,f=34.527833,g=-52.852602,h=-34.910442,i=84.067826,j=this._getBezierPoint(a,b,c,d,e,f,g,h,i);return j[1]},a.prototype._bezierLeft=function(a){var b=-40.4136581,c=66.5953407,d=.6776529,e=0,f=-44.123888,g=65.732988,h=31.626111,i=30.832615;if(0===a)return i;var j=this._getBezierPoint(a,b,c,d,e,f,g,h,i);return j[1]},a.prototype._getBezierPoint=function(a,b,c,d,e,f,g,h,i){for(var j,k=0,l=1,m=.5,n=1/0,o=0;Math.abs(n-o)>.01;)n=b*Math.pow(k,3)+c*k*k+d*k+e-a,o=b*Math.pow(m,3)+c*m*m+d*m+e-a,0>n*o?(l=m,m=.5*(k+m)):(k=m,m=.5*(m+l));return j=Math.round(f*Math.pow(m,3)+g*m*m+h*m+i),new Array(a,j)}}(window),function(){NPMapLib.Control=function(){this.CLASS_NAME="NPMapLib.Control",this.id=-1,this.controlType=NPMapLib.CONTROL_TYPE_UNKNOWN,this.offset=new NPMapLib.Geometry.Size(0,0),this.visible=!1,this.mapId=-1,this.anchor}}(),NPMapLib.Control.prototype={isVisible:function(){return this.visible},getOffset:function(){return this.offset},getAnchor:function(){return this.anchor}},function(){NPMapLib.Controls.CopyRightControl=function(a){this.controlType=NPMapLib.CONTROL_TYPE_COPYRIGHT,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_LEFT,this.CLASS_NAME="NPMapLib.Controls.CopyRightControl",this._info=a?a:"NetPosa"},NPMapLib.Controls.CopyRightControl.prototype=new NPMapLib.Control,NPMapLib.Controls.CopyRightControl.prototype.setInfo=function(a){this._info=a;var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&b.setCopyRight(this._info)},NPMapLib.Controls.CopyRightControl.prototype.getInfo=function(){return this._info},NPMapLib.Controls.CopyRightControl.prototype.show=function(){if(!this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&(a.setCopyRight(this._info),a.showCopyRightControl()),this.visible=!this.visible}},NPMapLib.Controls.CopyRightControl.prototype.hide=function(){if(this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideCopyRightControl(),this.visible=!this.visible}},NPMapLib.Controls.CopyRightControl.prototype.setOffset=function(a){this.offset=a},NPMapLib.Controls.CopyRightControl.prototype.setAnchor=function(a){a instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==a&&(this.anchor=a)}}(),function(){NPMapLib.Controls.NavigationControl=function(a){this.controlType=NPMapLib.CONTROL_TYPE_NAVIGATION,this.anchor=NPMapLib.CONTROL_ANCHOR_TOP_LEFT,this.CLASS_NAME="NPMapLib.Controls.NavigationControl",this._levelBarVisible=!1,this.opts=a||{},this.opts.position&&(this.position=this.opts.position),this.navigationType=this.opts.navigationType||"common"},NPMapLib.Controls.NavigationControl.prototype=new NPMapLib.Control,NPMapLib.Controls.NavigationControl.prototype.showLevelBar=function(){this._levelBarVisible||(this._levelBarVisible=!0)},NPMapLib.Controls.NavigationControl.prototype.hideLevelBar=function(){this._levelBarVisible&&(this._levelBarVisible=!1)},NPMapLib.Controls.NavigationControl.prototype.show=function(){if(!this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showNavigationControl(this),this.visible=!this.visible}},NPMapLib.Controls.NavigationControl.prototype.hide=function(){if(this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideNavigationControl(),this.visible=!this.visible}},NPMapLib.Controls.NavigationControl.prototype.setOffset=function(a){this.offset=a},NPMapLib.Controls.NavigationControl.prototype.setAnchor=function(a){a instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==a&&(this.anchor=a)}}(),function(){NPMapLib.Controls.OverviewControl=function(a){this.controlType=NPMapLib.CONTROL_TYPE_OVERVIEW,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_RIGHT,this.options=a,this._isOpen=!1,this.CLASS_NAME="NPMapLib.Controls.OverviewControl"},NPMapLib.Controls.OverviewControl.prototype=new NPMapLib.Control,NPMapLib.Controls.OverviewControl.prototype.changeView=function(a){if(this._isOpen!==a){var b=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);b&&(a?b.showOverviewControl():b.hideOverviewControl(),this._isOpen=a)}},NPMapLib.Controls.OverviewControl.prototype.show=function(){if(!this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.addOverviewControl(this.options),this.visible=!this.visible}},NPMapLib.Controls.OverviewControl.prototype.hide=function(){if(this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.removeOverviewControl(),this.visible=!this.visible}},NPMapLib.Controls.OverviewControl.prototype.setOffset=function(a){this.offset=a},NPMapLib.Controls.OverviewControl.prototype.setAnchor=function(a){a instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==a&&(this.anchor=a)}}(),function(){NPMapLib.Controls.ScaleControl=function(){this.controlType=NPMapLib.CONTROL_TYPE_SCALE,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_RIGHT,this._unit=NPMapLib.MAP_UNITS_KILOMETERS,this.CLASS_NAME="NPMapLib.Controls.ScaleControl"},NPMapLib.Controls.ScaleControl.prototype=new NPMapLib.Control,NPMapLib.Controls.ScaleControl.prototype.getUnit=function(){return this._unit},NPMapLib.Controls.ScaleControl.prototype.setUnit=function(a){a instanceof NPMapLib.Enums.Units&&this._unit!==a&&(this._unit=a)},NPMapLib.Controls.ScaleControl.prototype.show=function(){if(!this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showScaleControl(),this.visible=!this.visible}},NPMapLib.Controls.ScaleControl.prototype.hide=function(){if(this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideScaleControl(),this.visible=!this.visible}},NPMapLib.Controls.ScaleControl.prototype.setOffset=function(a){this.offset=a},NPMapLib.Controls.ScaleControl.prototype.setAnchor=function(a){a instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==a&&(this.anchor=a)}}(),function(){NPMapLib.Controls.NorthControl=function(){this.controlType=NPMapLib.CONTROL_TYPE_NORTH,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_LEFT,this.CLASS_NAME="NPMapLib.Controls.NorthControl"},NPMapLib.Controls.NorthControl.prototype=new NPMapLib.Control,NPMapLib.Controls.NorthControl.prototype.show=function(){if(!this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showNorthControl(),this.visible=!this.visible}},NPMapLib.Controls.NorthControl.prototype.hide=function(){if(this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideNorthControl(),this.visible=!this.visible}}}(),function(){NPMapLib.Controls.MousePositionControl=function(a){this.controlType=NPMapLib.CONTROL_TYPE_MOUSEPOSITION,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_RIGHT,this.type=a,this.CLASS_NAME="NPMapLib.Controls.MousePositionControl"},NPMapLib.Controls.MousePositionControl.prototype=new NPMapLib.Control,NPMapLib.Controls.MousePositionControl.prototype.show=function(){if(!this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.showMousePosition(this.type),this.visible=!this.visible}},NPMapLib.Controls.MousePositionControl.prototype.hide=function(){if(this.visible){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.hideMousePosition(),this.visible=!this.visible}}}(),function(){NPMapLib.Controls.zoomAnimationControl=function(){this.controlType=NPMapLib.CONTROL_TYPE_ZOOMANIMATION,this.mapAdapter=null,this.CLASS_NAME="NPMapLib.Controls.zoomAnimationControl"},NPMapLib.Controls.zoomAnimationControl.prototype=new NPMapLib.Control,NPMapLib.Controls.zoomAnimationControl.prototype.timer=-1,NPMapLib.Controls.zoomAnimationControl.prototype.show=function(){if(!this.visible&&(this.mapAdapter=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),this.mapAdapter)){var a=this.mapAdapter.map.div;this._createContainer(a),this.mapAdapter.addEventListener(this.mapAdapter,"zoomstart",this._action.bind(this)),this.mapAdapter.addEventListener(this.mapAdapter,"zoomend",this._unaction.bind(this)),this.visible=!this.visible}},NPMapLib.Controls.zoomAnimationControl.prototype.hide=function(){this.visible&&(this._removeContainer(),this.mapAdapter.removeEventListener(this.mapAdapter,"zoomstart",this._action),this.mapAdapter.removeEventListener(this.mapAdapter,"zoomend",this._unaction),this.visible=!this.visible)},NPMapLib.Controls.zoomAnimationControl.prototype._createContainer=function(a){var b=document.createElement("div");b.setAttribute("id","zoomer"),b.style.left=285,b.style.top=183.5,b.style.width=120,b.style.height=91,b.style.overflow="hidden",b.style.visibility="hidden",b.style.position="absolute",b.style.zIndex=99999,b.style.pointerEvents="none",a.appendChild(b);var c=document.createElement("div");c.className="BMap_zoomer",c.style.left=0,c.style.top=0,b.appendChild(c);var d=document.createElement("div");d.className="BMap_zoomer",d.style.backgroundPosition="0 0",d.style.top=0,d.style.right=0,b.appendChild(d);var e=document.createElement("div");e.className="BMap_zoomer",e.style.backgroundPosition="0 0",e.style.left=0,e.style.bottom=0,b.appendChild(e);var f=document.createElement("div");f.className="BMap_zoomer",f.style.backgroundPosition="0 0",f.style.right=0,f.style.bottom=0,b.appendChild(f),b.getElementsByClassName||(b.getElementsByClassName=function(a){for(var b=this.getElementsByTagName("*"),c=[],d=0;d<b.length;d++)for(var e=b[d],f=e.className.split(" "),g=0;g<f.length;g++)if(f[g]===a){c.push(e);break}return c});for(var g=b.getElementsByClassName("BMap_zoomer"),h=g.length,i=0;h>i;++i)g[i].style.width="10px",g[i].style.height="10px",g[i].style.overflow="hidden",g[i].style.fontSize=1,g[i].style.position="absolute"},NPMapLib.Controls.zoomAnimationControl.prototype._removeContainer=function(){var a=document.getElementById("zoomer");a.parentNode.removeChild(a)},NPMapLib.Controls.zoomAnimationControl.prototype._action=function(a,b,c){if("wheelChange"===c){window.clearTimeout(this.timer);var d=document.getElementById("zoomer"),e=d.style,f=d.children,g=OpenLayers.Util.getImageLocation("ul.png"),h=OpenLayers.Util.getImageLocation("ur.png"),i=OpenLayers.Util.getImageLocation("bl.png"),j=OpenLayers.Util.getImageLocation("br.png");f[0].style.background="url("+g+") no-repeat",f[1].style.background="url("+h+") no-repeat",f[2].style.background="url("+i+") no-repeat",f[3].style.background="url("+j+") no-repeat",a||(f[0].style.background="url("+j+") no-repeat",f[1].style.background="url("+i+") no-repeat",f[2].style.background="url("+h+") no-repeat",f[3].style.background="url("+g+") no-repeat");var k=60,l=120,m=4/3,n=Math.ceil((a?k:l)/2),o=Math.max(15,n/m),p=b.x-n,q=b.y-o;e.width=2*n+"px",e.height=2*o+"px",e.left=p+"px",e.top=q+"px";var r=Math.ceil((a?l:k)/2),s=Math.max(15,r/m);r-=n,s=Math.ceil(s-o);var t=1/3,u=this,v=function(){var a=Math.ceil(r*t),b=Math.ceil(s*t);e.width=2*(n+a)+"px",e.height=2*(o+b)+"px",e.left=p-a+"px",e.top=q-b+"px",t+=1/3,1>t?u.timer=window.setTimeout(function(){v()},100):u._unaction()};this.timer=window.setTimeout(function(){e.visibility="visible",v()},100)}},NPMapLib.Controls.zoomAnimationControl.prototype._unaction=function(){setTimeout(function(){var a=document.getElementById("zoomer");a&&(a.style.visibility="hidden")},250)}}(),function(){var a=NPMapLib.ContextMenu=function(){this.id=-1,this._items=[],this._separator=[],this._createDOMElement()};a.prototype._createDOMElement=function(){this.DIVElement=document.createElement("div"),this.DIVElement.className="contextMenu",document.body.appendChild(this.DIVElement)},a.prototype.addItem=function(a){a&&this.DIVElement&&a instanceof NPMapLib.ContextMenuItem&&(this.ULElement||(this.ULElement=document.createElement("ul"),this.DIVElement.appendChild(this.ULElement)),this.ULElement.appendChild(a._getDOMElement()),this._items.push(a))},a.prototype.getItem=function(a){return!this.ULElement||0>a||this._items.length-1<a?void 0:this._items[a]},a.prototype.removeItem=function(a){if(!(!this.ULElement||0>a||this._items.length-1<a)){var b=this._items[a];this.ULElement.removeChild(b._getDOMElement()),this._items.splice(a,1)}},a.prototype.addSeparator=function(){if(this.ULElement){this.ULElement||(this.ULElement=document.createElement("ul"),this.DIVElement.appendChild(this.ULElement));var a=document.createElement("li");this.ULElement.appendChild(a),a.className="li-seperate";var b=document.createElement("div");a.appendChild(b),b.className="menu-seperate",this._separator.push(a)}},a.prototype.removeSeparator=function(a){if(!(!this.ULElement||0>a||this._separator.length-1<a)){var b=this._separator[a];this.ULElement.removeChild(b),this._separator.splice(a,1)}},a.prototype.show=function(a){this.DIVElement.style.left=a.x+"px",this.DIVElement.style.top=a.y+"px",this.DIVElement.style.display=""},a.prototype.hide=function(){this.DIVElement.style.display="none"}}(),function(){var a=NPMapLib.ContextMenuItem=function(a){this._items=[],this._separator=[],this._createDOMElement(),this.setText(a)};a.prototype._createDOMElement=function(){this.LIElement=document.createElement("li"),this.AElement=document.createElement("a"),this.LIElement.appendChild(this.AElement),this.AElement.className="contextMenu-a";var a=hideTimer=null;this.LIElement.onmouseover=function(){var b=this,c=b.getElementsByTagName("ul");b.className+="active",c[0]&&(clearTimeout(hideTimer),a=setTimeout(function(){for(var a=0;a<b.parentNode.children.length;a++)b.parentNode.children[a].getElementsByTagName("ul")[0]&&(b.parentNode.children[a].getElementsByTagName("ul")[0].style.display="none");c[0].style.display="block",c[0].style.top=b.offsetTop+"px",c[0].style.left=b.offsetWidth+"px";var d=0;for(a=0;a<c[0].children.length;a++){var e=c[0].children[a],f=e.clientWidth-2*parseInt(e.currentStyle?e.currentStyle.paddingLeft:getComputedStyle(e,null).paddingLeft);f>d&&(d=f)}for(a=0;a<c[0].children.length;a++)c[0].children[a].style.width=d+"px"},300))},this.LIElement.onmouseout=function(){var b=this;b.className=b.className.replace(/\s?active/,""),clearTimeout(a),hideTimer=setTimeout(function(){for(i=0;i<b.parentNode.children.length;i++)b.parentNode.children[i].getElementsByTagName("ul")[0]&&(b.parentNode.children[i].getElementsByTagName("ul")[0].style.display="none")},300)}},a.prototype._getDOMElement=function(){return this.LIElement},a.prototype.setText=function(a){this.AElement&&(this.AElement.innerHTML='<font class="contextMenu-text">'+a+"</font>")},a.prototype.addChildItem=function(a){a&&this.LIElement&&a instanceof NPMapLib.ContextMenuItem&&(this.ULElement||(this.ULElement=document.createElement("ul"),this.LIElement.appendChild(this.ULElement),this.LIElement.className="sub",this.SPANElement=document.createElement("span"),this.SPANElement.className="contextMenu-ico",this.AElement.appendChild(this.SPANElement)),this.ULElement.appendChild(a._getDOMElement()),this._items.push(a))},a.prototype.getChildItem=function(a){return!this.ULElement||0>a||this._items.length-1<a?void 0:this._items[a]},a.prototype.addSeparator=function(){if(this.ULElement){this.ULElement||(this.ULElement=document.createElement("ul"),this.LIElement.appendChild(this.ULElement));var a=document.createElement("li");this.ULElement.appendChild(a);var b=document.createElement("hr");a.appendChild(b),this._separator.push(a)}},a.prototype.removeSeparator=function(a){if(!(!this.ULElement||0>a||this._separator.length-1<a)){var b=this._separator[a];this.ULElement.removeChild(b),this._separator.splice(a,1)}},a.prototype.enable=function(){this.LIElement.disabled&&(this.LIElement.disabled=!1)},a.prototype.disable=function(){this.LIElement.disabled||(this.LIElement.disabled=!0)}}(),NPMapLib.Adapter.AdapterFactory=function(){var a={},b={},c={};return a.createMapAdapter=function(a,d,e){if(!("number"!=typeof e||0>=e)){if(!a||!a.id||b[a.id])return null;var f;return d.mapId=e,f=new NPMapLib.Adapter.OpenLayers.MapAdapter(a,d),b[a.id]=f,c[e]=f,f}},a.getMapAdapter=function(a){return c[a]},a.getAdapters=function(){return b},a}(),function(){NPMapLib.Tools.DrawingTool=function(a){this._mode=NPMapLib.DRAW_MODE_POLYLINE,this._isStartUp=!1,this.mapId=a,this.CLASS_NAME="NPMapLib.Tools.DrawingTool"},NPMapLib.Tools.DrawingTool.prototype.setMode=function(a,b,c){if((a===NPMapLib.DRAW_MODE_NONE||a===NPMapLib.DRAW_MODE_RECT||a===NPMapLib.DRAW_MODE_CIRCLE||a===NPMapLib.DRAW_MODE_POLYLINE||a===NPMapLib.DRAW_MODE_POLYLGON||a===NPMapLib.DRAW_MODE_CIRCLE_DIAMETER||a===NPMapLib.DRAW_MODE_FREEHAND)&&(this._mode=a),this.startUp(),this._isStartUp){var d=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(d){var e=this,f=function(a,c,d,f){e.cancel(),"function"==typeof b&&b(a,c,d,f)};d.drawing(this,f,c)}}},NPMapLib.Tools.DrawingTool.prototype.getMode=function(){return this._mode},NPMapLib.Tools.DrawingTool.prototype.startUp=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.pan(),this._isStartUp=!0},NPMapLib.Tools.DrawingTool.prototype.cancel=function(){if(this._isStartUp){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.pan(),this._isStartUp=!1}}}(),function(){NPMapLib.Tools.MeasureTool=function(a,b){this.CLASS_NAME="NPMapLib.Tools.MeasureTool",this._lengthUnit=NPMapLib.MAP_UNITS_METERS,this._areaUnit=NPMapLib.MAP_UNITS_SQUARE_KILOMETERS,this._mode=NPMapLib.MEASURE_MODE_DISTANCE,this._isStartUp=!1,this.mapId=a,b&&(b.lengthUnit&&(this._lengthUnit=b.lengthUnit),b.areaUnit&&(this._areaUnit=b.areaUnit))},NPMapLib.Tools.MeasureTool.prototype.getLengthUnit=function(){return this._lengthUnit},NPMapLib.Tools.MeasureTool.prototype.setLengthUnit=function(a){this._lengthUnit=a},NPMapLib.Tools.MeasureTool.prototype.getAreaUnit=function(){return this._areaUnit},NPMapLib.Tools.MeasureTool.prototype.setAreaUnit=function(a){this._areaUnit=a},NPMapLib.Tools.MeasureTool.prototype.setMode=function(a,b,c){if((a===NPMapLib.MEASURE_MODE_DISTANCE||a===NPMapLib.MEASURE_MODE_AREA||a===NPMapLib.MEASURE_MODE_LOCATION)&&(this._mode=a),this.startUp(),this._isStartUp){var d=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(d){var e=this;d.measure(this,function(a){if(e._stop(),"function"==typeof b)b(a);else try{OnMeasureComplete(a)}catch(c){}},c)}}},NPMapLib.Tools.MeasureTool.prototype.getMode=function(){return this._mode},NPMapLib.Tools.MeasureTool.prototype.startUp=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.pan(),this._isStartUp=!0},NPMapLib.Tools.MeasureTool.prototype._stop=function(){if(this._isStartUp){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.pan(),this._isStartUp=!1}},NPMapLib.Tools.MeasureTool.prototype.finishGeometry=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a.finishGeometry(),this._isStartUp=!1},NPMapLib.Tools.MeasureTool.prototype.stop=function(){if(this._isStartUp){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&a._measureControl.handler.finishGeometry(),this._stop()}},NPMapLib.Tools.MeasureTool.prototype.cancel=function(){var a=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);a&&(a.pan(),a.removeMeasureFeatures()),this._isStartUp=!1}}(),NPNamespace.register("NPMapLib"),function(){NPMapLib.GisToolKit=function(){},NPMapLib.GisToolKit.prototype.getDistanceByProjection=function(a,b){var c="";return b instanceof OpenLayers.Map?c=b.units:b&&(c=b.getMapUnits()),a*OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT.degrees},NPMapLib.GisToolKit.prototype.getDistanceByProjection2=function(a,b){var c="";return b instanceof OpenLayers.Map?c=b.units:b&&(c=b.getMapUnits()),"m"==c?a:a*OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT.degrees},NPMapLib.GisToolKit.prototype.getPlatDistanceByProjection2=function(a,b){var c="";return c=b instanceof OpenLayers.Map?b.units:b.getMapUnits(),"m"==c?a:a*OpenLayers.INCHES_PER_UNIT.degrees/OpenLayers.INCHES_PER_UNIT.m},NPMapLib.GisToolKit.prototype.getPlatDistanceByProjection=function(a){return a*OpenLayers.INCHES_PER_UNIT.degrees/OpenLayers.INCHES_PER_UNIT.m}}(),function(){function a(a){var b,c,d,e="",g="",h="",i=0;if(d=/[^A-Za-z0-9\+\/\=]/g,!a||d.exec(a))return a;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do b=f.indexOf(a.charAt(i++)),c=f.indexOf(a.charAt(i++)),d=f.indexOf(a.charAt(i++)),h=f.indexOf(a.charAt(i++)),b=b<<2|c>>4,c=(15&c)<<4|d>>2,g=(3&d)<<6|h,e+=String.fromCharCode(b),64!=d&&(e+=String.fromCharCode(c)),64!=h&&(e+=String.fromCharCode(g));while(i<a.length);return e}function b(a){return"string"==typeof a}function c(c,d){isNaN(c)&&(c=a(c),c=isNaN(c)?0:c),b(c)&&(c=parseFloat(c)),isNaN(d)&&(d=a(d),d=isNaN(d)?0:d),b(d)&&(d=parseFloat(d)),this.lng=c,this.lat=d}var d=function(){var a=3.141592653589793,b=.006693421622965943,c=52.35987755982988,d=20037508.34,e=6378245,f={};return f.transform=function(c,d){c=parseFloat(c),d=parseFloat(d);var f={};if(this.outofChina(d,c))return f.lon=c,f.lat=d,f;var g=this.transformLat(c-105,d-35),h=this.transformLon(c-105,d-35),i=d/180*a,j=Math.sin(i);j=1-b*j*j;var k=Math.sqrt(j);g=180*g/(e*(1-b)/(j*k)*a),h=180*h/(e/k*Math.cos(i)*a);var l=d+g,m=c+h;return f.lon=m,f.lat=l,f},f.outofChina=function(a,b){return 72.004>b||b>137.8347?!0:.8293>a||a>55.8271?!0:!1},f.transformLat=function(b,c){var d=-100+2*b+3*c+.2*c*c+.1*b*c+.2*Math.sqrt(Math.abs(b));return d+=2*(20*Math.sin(6*b*a)+20*Math.sin(2*b*a))/3,d+=2*(20*Math.sin(c*a)+40*Math.sin(c/3*a))/3,d+=2*(160*Math.sin(c/12*a)+320*Math.sin(c*a/30))/3},f.transformLon=function(b,c){var d=300+b+2*c+.1*b*b+.1*b*c+.1*Math.sqrt(Math.abs(b));return d+=2*(20*Math.sin(6*b*a)+20*Math.sin(2*b*a))/3,d+=2*(20*Math.sin(b*a)+40*Math.sin(b/3*a))/3,d+=2*(150*Math.sin(b/12*a)+300*Math.sin(b/30*a))/3},f.gcj2wgs=function(a,b){var c={lon:0,lat:0},d=a-(this.transform(a,b).lon-a),e=b-(this.transform(a,b).lat-b);return c.lon=d,c.lat=e,c},f.bd_encrypt=function(a,b){var d=a,e=b,f=Math.sqrt(d*d+e*e)+2e-5*Math.sin(e*c),g=Math.atan2(e,d)+3e-6*Math.cos(d*c),h=f*Math.cos(g)+.0065,i=f*Math.sin(g)+.006;return{lon:h,lat:i}},f.bd_decrypt=function(a,b){var d=a-.0065,e=b-.006,f=Math.sqrt(d*d+e*e)-2e-5*Math.sin(e*c),g=Math.atan2(e,d)-3e-6*Math.cos(d*c),h=f*Math.cos(g),i=f*Math.sin(g);return{lon:h,lat:i}},f.webMoctorJW2PM=function(a,b){var c={lon:0,lat:0};a=parseFloat(a),b=parseFloat(b),c.lon=a/180*20037508.34,b>85.05112&&(b=85.05112),-85.05112>b&&(b=-85.05112),b=Math.PI/180*b;var d=Math.PI/4+b/2;return c.lat=20037508.34*Math.log(Math.tan(d))/Math.PI,c},f.inverseMercator=function(a,b){return a=180*a/d,b=180/Math.PI*(2*Math.atan(Math.exp(b/d*Math.PI))-Math.PI/2),{lon:a,lat:b}},f},f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g={$O:6370996.81,lG:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Au:[75,60,45,30,15,0],fP:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],p:null,JD:function(a,b,c){for(;a>c;)a-=c-b;for(;b>a;)a+=c-b;return a},ND:function(a,b,c){return null!=b&&(a=Math.max(a,b)),null!=c&&(a=Math.min(a,c)),a},Fb:function(a){if(a.lng=a.lon,a.lat=a.lat,!a||180<a.lng||-180>a.lng||90<a.lat||-90>a.lat)return new c(0,0);var b,d;a.lng=this.JD(a.lng,-180,180),a.lat=this.ND(a.lat,-74,74),b=new c(a.lng,a.lat);for(var e=0;e<this.Au.length;e++)if(b.lat>=this.Au[e]){d=this.iG[e];break}if(!d)for(e=this.Au.length-1;e>=0;e--)if(b.lat<=-this.Au[e]){d=this.iG[e];break}return a=this.gK(a,d),a=new c(a.lng,a.lat),new NPMapLib.Geometry.Point(a.lng,a.lat)},gK:function(a,b){if(a&&b){var d=b[0]+b[1]*Math.abs(a.lng),e=Math.abs(a.lat)/b[9],e=b[2]+b[3]*e+b[4]*e*e+b[5]*e*e*e+b[6]*e*e*e*e+b[7]*e*e*e*e*e+b[8]*e*e*e*e*e*e,d=d*(0>a.lng?-1:1),e=e*(0>a.lat?-1:1);return new c(d,e)}},ToLL:function(a){a.lng=a.lon;for(var b,c=0;c<this.lG.length;c++)if(a.lat>=this.lG[c]){b=this.fP[c];break}return a=this.gK(a,b),new NPMapLib.Geometry.Point(a.lng.toFixed(6),a.lat.toFixed(6))}},h=NPMapLib.T={};h.Baidu=g;var i=new d,j=function(a){var b;return a._mapAdapter&&(b=a._mapAdapter.map.baseLayer),a.map&&(b=a.map.baseLayer),a.baseLayer&&(b=a.baseLayer),b};h.helper=i,h.setPoint=function(a,b){if(!NPMap.ISPOINTCONVERT)return b;if("EPSG:900913"===a.getProjection()){var c=j(a);return-1!=c.CLASS_NAME.indexOf("Baidu")?(e=NPMap.ISWGS84?i.transform(b.lon,b.lat):b,e=i.bd_encrypt(e.lon,e.lat),NPMap.T.Baidu.Fb(e)):(e=NPMap.ISWGS84?-1!=c.CLASS_NAME.indexOf("OSM")&&0==c.isChina?b:i.transform(b.lon,b.lat):b,e=i.webMoctorJW2PM(e.lon,e.lat),new NPMapLib.Geometry.Point(e.lon,e.lat))}return b},h.setPoints=function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(NPMapLib.T.setPoint(a,b[d]));return c},h.getPoint=function(a,b){if(!NPMap.ISPOINTCONVERT)return b;if(b.lon>-180&&b.lon<180)return b;if("EPSG:900913"===a.getProjection()){var c=i.inverseMercator(b.lon,b.lat),d=j(a);return-1!=d.CLASS_NAME.indexOf("Baidu")?(c=NPMap.T.Baidu.ToLL(b),c=i.bd_decrypt(c.lon,c.lat),NPMap.ISWGS84&&(c=i.gcj2wgs(c.lon,c.lat)),new NPMapLib.Geometry.Point(c.lon,c.lat)):(NPMap.ISWGS84&&(c=-1!=d.CLASS_NAME.indexOf("OSM")&&0==d.isChina?c:i.gcj2wgs(c.lon,c.lat)),new NPMapLib.Geometry.Point(c.lon,c.lat))}return b},h.getPoints=function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(NPMapLib.T.getPoint(a,b[d]));return c},h.setExtent=function(a,b){if("EPSG:900913"==a.getProjection()){var c=NPMapLib.T.setPoint(a,{lon:b.left,lat:b.top}),d=NPMapLib.T.setPoint(a,{lon:b.right,lat:b.bottom});return new NPMapLib.Geometry.Extent(c.lon,d.lat,d.lon,c.lat)}return b},h.getExtent=function(a,b){if("EPSG:900913"==a.getProjection()){var c=NPMapLib.T.getPoint(a,{lon:b.left,lat:b.top}),d=NPMapLib.T.getPoint(a,{lon:b.right,lat:b.bottom});return new NPMapLib.Geometry.Extent(c.lon,d.lat,d.lon,c.lat)}return b}}(),function(){window.FeatureFacatroy=function(){},window.FeatureFacatroy.defaults={},window.FeatureFacatroy.createOverlay=function(e){var f,g=e.overlayType;switch(g){case NPMapLib.OVERLAY_TYPE_POLYLINE:f=a(e);break;case NPMapLib.OVERLAY_TYPE_POLYGON:f=b(e);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:f=c(e);break;case NPMapLib.OVERLAY_TYPE_POINT:f=d(e)}return f};var a=function(a){if(a instanceof NPMapLib.Geometry.Polyline){var b=a.getPath();if(b&&!(b.length<=0)){var c=new OpenLayers.Geometry.LineString(e(b)),d=new OpenLayers.Feature.Vector(c,a);return d}}},b=function(a){if(a instanceof NPMapLib.Geometry.Polygon){var b=a.getPath();if(b&&!(b.length<=0)){if(b[0]instanceof NPMapLib.Geometry.Point){var c=new OpenLayers.Geometry.LinearRing(e(b)),d=new OpenLayers.Geometry.Polygon(c),f=new OpenLayers.Feature.Vector(d,a);return f}for(var g=[],h=0;h<b.length;h++)g.push(new OpenLayers.Geometry.LinearRing(e(b[h])));var d=new OpenLayers.Geometry.Polygon(g),f=new OpenLayers.Feature.Vector(d,a);return f}}},c=function(a){if(a instanceof NPMapLib.Geometry.Circle){var b=a.getCenter(),c=a.getRadius();if(b&&c){if(b.lon<180&&b.lon>-180){var d=new NPMapLib.GisToolKit;c=d.getDistanceByProjection(c)}var e=new OpenLayers.Geometry.Point(b.lon,b.lat),f=OpenLayers.Geometry.Polygon.createRegularPolygon(e,c,60,10),g=new OpenLayers.Feature.Vector(f,a);return g}}},d=function(a){if(a instanceof NPMapLib.Geometry.Point){var b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,a.lat),a);return b}},e=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;++c)b.push(new OpenLayers.Geometry.Point(a[c].lon,a[c].lat));return b}}(window.FeatureFacatroy={}),function(a){window.GeoJSON=function(){},window.GeoJSON.defaults={},window.GeoJSON.write=function(a,b){var c=new OpenLayers.Format.GeoJSON;c.createCRSObject=function(){return{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}},c.extract.point=function(a){if(b){var c=NPMap.T.getPoint(b,{lon:a.x,lat:a.y});return[c.lon,c.lat]}return[a.x,a.y]};var d=new OpenLayers.Format.JSON;if(!OpenLayers.Util.isArray(a)){var e=a._apiObj;a._apiObj||(e=FeatureFacatroy.createOverlay(a));var f=c.writeTojSON(e);return a.getData instanceof Function&&(f.properties=a.getData()),d.write(f)
}for(var g=[],h=0;h<a.length;h++){var e=a[h]._apiObj;a[h]._apiObj||(e=FeatureFacatroy.createOverlay(a[h])),g.push(e)}for(var i=c.writeTojSON(g),h=0;h<g.length;h++)i.features[h].properties=a[h].getData();return d.write(i)},window.GeoJSON.read=function(i,j){j=j?j:"FeatureCollection";var k=null;if(k="string"==typeof i?OpenLayers.Format.JSON.prototype.read.apply(this,[i,null]):i,k&&h(k,j))switch(k.type){case"MultiLineString":return d(k);case"LineString":return e(k);case"Point":return g(k);case"MultiPoint":return c(k);case"Polygon":return f(k);case"MultiPolygon":return b(k);case"FeatureCollection":for(var l=[],m=0;m<k.features.length;m++)l.push(a.read(k.features[m].geometry));return l}};var b=function(a){for(var b=[],c=0;c<a.coordinates.length;c++){ps=[];for(var d=0;d<a.coordinates[c][0].length;d++){var e=a.coordinates[c][0][d];ps.push(new NPMapLib.Geometry.Point(e[0],e[1]))}b.push(ps)}return new NPMapLib.Geometry.Polygon(b)},c=function(a){for(var b=[],c=0;c<a.coordinates.length;c++)b.push(new NPMapLib.Geometry.Point(a.coordinates[c][0],a.coordinates[c][1]));return b},d=function(a){for(var b=[],c=[],d=0;d<a.coordinates.length;d++){b=[];for(var e=0;e<a.coordinates[d].length;e++){var f=a.coordinates[d][e];b.push(new NPMapLib.Geometry.Point(f[0],f[1]))}c.push(new NPMapLib.Geometry.Polyline(b))}return c},e=function(a){for(var b=[],c=0;c<a.coordinates.length;c++){var d=a.coordinates[c];b.push(new NPMapLib.Geometry.Point(d[0],d[1]))}return new NPMapLib.Geometry.Polyline(b)},f=function(a){for(var b=[],c=0;c<a.coordinates[0].length;c++){var d=a.coordinates[0][c];b.push(new NPMapLib.Geometry.Point(d[0],d[1]))}return new NPMapLib.Geometry.Polygon(b)},g=function(a){return new NPMapLib.Geometry.Point(a.coordinates[0],a.coordinates[1])},h=function(a,b){var c=!1;switch(b){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],a.type)||(c=!0);break;case"FeatureCollection":c=!0;break;default:a.type==b&&(c=!0)}return c}}(window.GeoJSON={}),function(a){window.WKT=function(){},window.WKT.defaults={},window.WKT.write=function(a,b){var c=new OpenLayers.Format.WKT;if(c.extract.point=function(a){if(b){var c=NPMap.T.getPoint(b,{lon:a.x,lat:a.y});return c.lon+" "+c.lat}return a.x+" "+a.y},!OpenLayers.Util.isArray(a)){var d=a._apiObj;a._apiObj||(d=FeatureFacatroy.createOverlay(a));var e=c.write(d);return e}for(var f=[],g=0;g<a.length;g++){var d=a[g]._apiObj;a[g]._apiObj||(d=FeatureFacatroy.createOverlay(a[g])),f.push(d)}var h=c.write(f);return h},window.WKT.read=function(h){var i,j,k=new OpenLayers.Format.WKT;h=h.replace(/[\n\r]/g," ");var l=k.regExes.typeStr.exec(h);if(l)switch(i=l[1].toLowerCase(),j=l[2],i){case"multilinestring":return b(j);case"linestring":return c(j);case"point":return d(j);case"multipoint":return e(j);case"polygon":return f(j);case"multipolygon":return g(j);case"geometrycollection":var m=[];j=j.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=OpenLayers.String.trim(j).split("|"),o=0;o<n.length;o++)m.push(a.read(n[o]));return m}};var b=function(a){for(var b,c=new OpenLayers.Format.WKT,d=[],e=[],f=OpenLayers.String.trim(a).split(c.regExes.parenComma),g=0,h=f.length;h>g;++g){b=f[g].replace(c.regExes.trimParens,"$1");for(var i=OpenLayers.String.trim(b).split(","),j=0,k=i.length;k>j;++j){var l=OpenLayers.String.trim(i[j]).split(c.regExes.spaces),m=new NPMapLib.Geometry.Point(l[0],l[1]);d.push(m)}e.push(new NPMapLib.Geometry.Polyline(d))}return e},c=function(a){for(var b=new OpenLayers.Format.WKT,c=a.replace(b.regExes.trimParens,"$1"),d=OpenLayers.String.trim(c).split(","),e=[],f=0,g=d.length;g>f;++f){var h=OpenLayers.String.trim(d[f]).split(b.regExes.spaces),i=new NPMapLib.Geometry.Point(h[0],h[1]);e.push(i)}return new NPMapLib.Geometry.Polyline(e)},d=function(a){var b=new OpenLayers.Format.WKT,c=OpenLayers.String.trim(a).split(b.regExes.spaces);return new NPMapLib.Geometry.Point(c[0],c[1])},e=function(){for(var a=new OpenLayers.Format.WKT,b=OpenLayers.String.trim(str).split(","),c=[],e=0,f=b.length;f>e;++e){point=b[e].replace(a.regExes.trimParens,"$1");var g=d(point);c.push(g)}return c},f=function(a){for(var b=new OpenLayers.Format.WKT,c=[],e=OpenLayers.String.trim(a).split(b.regExes.parenComma),f=0,g=e.length;g>f;++f){var h=[];ring=e[f].replace(b.regExes.trimParens,"$1");for(var i=OpenLayers.String.trim(ring).split(","),j=0,k=i.length;k>j;++j){point=i[j].replace(b.regExes.trimParens,"$1");var l=d(point);h.push(l)}c.push(h)}return new NPMapLib.Geometry.Polygon(c)},g=function(a){for(var b=new OpenLayers.Format.WKT,c=OpenLayers.String.trim(a).split(b.regExes.parenComma),d=[],e=c.length-1;e>=0;e--)d.push(f(c[e]));return d}}(window.WKT={}),function(){NPMapLib.Services.BufferService=function(a,b){this.serviceType=b?b:EzServerClient.GlobeParams.MyMapType,this.url="",this.map=a,this.CLASS_NAME="NPMapLib.Services.BufferService"},NPMapLib.Services.BufferService.prototype.buffer=function(a,b,c,d){switch(d=d?d:function(a){return alert(NPMapLib.Utils.BaseUtils.toJson(a)),!1},this.serviceType){case NPMapLib.MAPTYPE_ARCGISTILE:return this._bufferArcGIS(a,b,c,d);case NPMapLib.MAPTYPE_PGIS:return this._bufferPgis(a,b,c,d);case NPMapLib.MAPTYPE_NPGIS:return this._queryNPGIS(a,b,c,d);default:return this._bufferGeoserver(a,b,c,d)}},NPMapLib.Services.BufferService.prototype._queryNPGIS=function(a,b,c,d){this._dataConfig(a,b,c,d);var e="&geometry="+this.geometry.toLocaleString()+"&distance="+this.distance+"&srid="+this.map.getProjection().split(":")[1];return OpenLayers.Request.POST({url:a,headers:{"Content-Type":"application/x-www-form-urlencoded"},scope:this,data:e,success:function(a){a.responseText&&"POLYGON EMPTY"!=a.responseText&&(a=WKT.read(a.responseText),this._callback(a,c))}})},NPMapLib.Services.BufferService.prototype._bufferArcGIS=function(url,params,successCallback,errorCallback){var unionResults=!0,geodesic=!1;if(url&&(this.url=url),params.geometry){var projection=this.map.getProjection();switch(projection){case"EPSG:4326":projection=4326;break;case"EPSG:900913":case"EPSG:3857":projection=3857}if(params.geometry instanceof NPMapLib.Geometry.Point){this.geometryType="esriGeometryPoint";var points=params.geometry,point={x:points.lon,y:points.lat,spatialReference:{wkid:projection}},points=[];points.push(point);var geometries={geometryType:this.geometryType,geometries:points}}else if(params.geometry instanceof NPMapLib.Geometry.Polyline){this.geometryType="esriGeometryPolyline";for(var points=params.geometry.getPath(),paths=[],path=[],i=0;i<points.length;i++)path.push([points[i].lon,points[i].lat]);paths.push(path);var polylines=[],polyline={paths:paths,spatialReference:{wkid:projection}};polylines.push(polyline);var geometries={geometryType:this.geometryType,geometries:polylines}}else if(params.geometry instanceof NPMapLib.Geometry.Polygon){this.geometryType="esriGeometryPolygon";for(var points=params.geometry.getPath(),rings=[],ring=[],i=0;i<points.length;i++)ring.push([points[i].lon,points[i].lat]);rings.push(ring);var polygons=[],polygon={rings:rings,spatialReference:{wkid:projection}};polygons.push(polygon);var geometries={geometryType:this.geometryType,geometries:polygons}}else params.geometry instanceof NPMapLib.Geometry.Multipoint&&(this.geometryType="esriGeometryMultipoint");geometries=NPMapLib.Utils.BaseUtils.toJson(geometries);var tool=new NPMapLib.GisToolKit;distance=tool.getDistanceByProjection(params.distance,this.map),params.geometry instanceof NPMapLib.Geometry.Point&&(distance=[distance,10]);var self=this}return OpenLayers.Request.GET({url:this.url,params:{f:params.format,unionResults:unionResults,geodesic:geodesic,geometries:geometries,inSR:projection,distances:distance,outSR:projection,bufferSR:projection,AK:window.NPGIS_AUTHKEY},success:function(reply){var projection=self.map.getProjection(),reply=eval("("+reply.responseText+")"),rings=[];if(!reply.error)for(var temp=[],i=0;i<reply.geometries[0].rings.length;i++){temp=[],ring=reply.geometries[0].rings[i];for(var j=0;j<ring.length;j++){var point=new NPMapLib.Geometry.Point(ring[j][0],ring[j][1]);temp.push(point)}rings.push(temp)}var out={rings:rings,spatialReference:projection};"function"==typeof successCallback&&successCallback(out)},failure:function(a){"function"==typeof errorCallback&&errorCallback(a.responseText)}})},NPMapLib.Services.BufferService.prototype._dataConfig=function(a,b){a&&(this.url=a);var c=new NPMapLib.GisToolKit;this.distance=c.getDistanceByProjection(b.distance,this.map),b.geometry&&(this.geometry=WKT.write(b.geometry,this.map))},NPMapLib.Services.BufferService.prototype._callback=function(a,b){var c=[],d=this.map.getProjection();a&&(c=a instanceof Array?1===a.length?a[0].getPath():a:a.getPath());var e={rings:c,spatialReference:d};"function"==typeof b&&b(e)},NPMapLib.Services.BufferService.prototype._bufferGeoserver=function(a,b,c,d){this._dataConfig(a,b,c,d);var e=new OpenLayers.WPSClient({servers:{opengeo:this.url}}),f=e.getProcess("opengeo","JTS:buffer");return f.execute({inputs:{geom:this.geometry,distance:this.distance},scope:this,success:function(a){var b=a.result;this._callback(b,c)},failure:function(a){"function"==typeof d?d(a):alert("failed")}})}}(),function(){NPMapLib.Services.bufferParams=function(){this.distance=0,this.unit="m",this.quadrantSegments="",this.capStyle="",this.format="json"}}(),function(){NPMapLib.Services.QueryService=function(a){this.serviceType=a?a:EzServerClient.GlobeParams.MyMapType,this.filter=null,this.CLASS_NAME="NPMapLib.Services.QueryService"},NPMapLib.Services.QueryService.prototype.query=function(a,b,c,d){switch(d=d?d:function(a){return alert(NPMapLib.Utils.BaseUtils.toJson(a)),!1},this.serviceType){case NPMapLib.MAPTYPE_ARCGISTILE:return this._queryArcGIS(a,b,c,d);case NPMapLib.MAPTYPE_PGIS:return this._queryPgis(a,b,c,d);case NPMapLib.MAPTYPE_NPGIS:return this._queryNPGIS(a,b,c,d);default:return this._queryGeoserver(a,b,c,d)}},NPMapLib.Services.QueryService.prototype._queryNPGIS=function(url,params,successCallback,errorCallback){return OpenLayers.Request.GET({url:url,headers:{"Content-Type":"text/xml; charset=utf-8"},scope:this,params:params,success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(result)}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})},NPMapLib.Services.QueryService.prototype.updata=function(url,params,successCallback,errorCallback){return errorCallback=errorCallback?errorCallback:function(a){return alert(NPMapLib.Utils.BaseUtils.toJson(a)),!1},OpenLayers.Request.POST({url:url,headers:{"Content-Type":"text/xml; charset=utf-8"},scope:this,params:params,success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(result)}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})},NPMapLib.Services.QueryService.prototype._queryGeoserver=function(url,params,successCallback,errorCallback){return url&&(this.url=url),params.searchText&&(this.filter='<Filter xmlns:ogc="http://www.opengis.net/ogc">',this.filter+="<PropertyIsEqualTo><PropertyName>",this.filter+=params.workSpace+":"+params.searchFields,this.filter+="</PropertyName><Literal>",this.filter+=params.searchText,this.filter+="</Literal></PropertyIsEqualTo></Filter>"),OpenLayers.Request.GET({url:this.url,scope:this,params:{typeName:params.layers.join(","),service:params.service,version:params.serviceVersion,outputFormat:params.outputFormat,request:params.request,filter:this.filter,AK:window.NPGIS_AUTHKEY},success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(this.arrangeGeoserverData(result.features))}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})},NPMapLib.Services.QueryService.prototype._formartGeometryType=function(a){if(a){if("MultiLineString"==a||"esriGeometryPolyline"==a)return"NPMapLib.Geometry.Polyline";if("point"==a||"Point"==a||"esriGeometryPoint"==a)return"NPMapLib.Geometry.Point"}return""},NPMapLib.Services.QueryService.prototype._queryArcGIS=function(url,params,successCallback,errorCallback){url&&(this.url=url);var me=this;return OpenLayers.Request.GET({url:this.url,scope:this,params:{f:params.outputFormat,searchText:params.searchText,contains:params.contains,returnGeometry:params.returnGeometry,layers:params.layers.join(","),searchFields:params.searchFields},success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(this.arrangeArcgisData(result.results))}},failure:function(a){"function"==typeof errorCallback&&errorCallback(a.responseText)}})},NPMapLib.Services.QueryService.prototype.arrangeArcgisData=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this._formartGeometryType(d.geometryType);b.push({displayFieldName:d.displayFieldName,foundFieldName:d.foundFieldName,geometryType:e,layerId:d.layerId,layerName:d.layerName,value:d.value,feature:{attributes:d.attributes,geometry:"NPMapLib.Geometry.Polyline"==e?d.geometry.paths:{x:d.geometry.x,y:d.geometry.y},featureType:e}})}return b},NPMapLib.Services.QueryService.prototype.arrangeGeoserverData=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push({displayFieldName:"",foundFieldName:"",geometryType:this._formartGeometryType(d.geometry.type),layerId:d.id,layerName:d.id,value:d.properties.NAME,feature:{attributes:d.properties,geometry:d.geometry.coordinates,featureType:this._formartGeometryType(d.geometry.type)}})}return b},NPMapLib.Services.QueryService.prototype.arrangeNpGISData=function(data){for(var result=[],i=0;i<data.length;i++){var item=data[i],geometry=eval("("+item.geometry+")");result.push({attributes:item,feature:{geometry:geometry,featureType:this._formartGeometryType(geometry.type)}})}return result},NPMapLib.Services.QueryService.prototype._queryPgis=function(){}}(),function(){NPMapLib.Services.queryParams=function(){this.returnGeometry=!0,this.searchFields="NAME",this.layers="",this.searchText="",this.contains=!0,this.service="WFS",this.serviceVersion="1.0.0",this.outputFormat="json",this.request="GetFeature"}}(),function(){NPMapLib.Services.RouteService=function(a,b){this.map=a,this.serviceType=b?b:EzServerClient.GlobeParams.MyMapType,this.url="",this.CLASS_NAME="NPMapLib.Services.RouteService"},NPMapLib.Services.RouteService.prototype.route=function(a,b,c,d){switch(d=d?d:function(a){return alert(NPMapLib.Utils.BaseUtils.toJson(a)),!1},this.serviceType){case NPMapLib.MAPTYPE_ARCGISTILE:return this._routeArcGIS(a,b,c,d);case NPMapLib.MAPTYPE_PGIS:return this._routePgis(a,b,c,d);default:return this._routeGeoserver(a,b,c,d)}},NPMapLib.Services.RouteService.prototype._routeGeoserver=function(url,params,successCallback,errorCallback){if(params.startStop instanceof NPMapLib.Geometry.Point&&params.endStop instanceof NPMapLib.Geometry.Point){var out_options={internalProjection:this.map.getProjection(),externalProjection:this.map.getProjection()};writer=new OpenLayers.Format.WKT(out_options);var in_options={internalProjection:this.map.getProjection(),externalProjection:this.map.getProjection()};reader=new OpenLayers.Format.WKT(in_options);var stops="",startStop=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(params.startStop.lon,params.startStop.lat));stops+=writer.write(startStop)+"|";var endStop=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(params.endStop.lon,params.endStop.lat));stops+=writer.write(endStop);for(var barries="",i=0;i<params.geoBarriers.length;i++){if(params.geoBarriers[i]instanceof NPMapLib.Geometry.Polygon&&params.geoBarriers[i].getPath().length>3){var feaure=this._createPolygon(params.geoBarriers[i]);barries+=""===barries?writer.write(feaure):"|"+writer.write(feaure)}if(params.geoBarriers[i]instanceof NPMapLib.Geometry.Circle&&params.geoBarriers[i].getPoints().length>3){var feaure=this._createPolygon(params.geoBarriers[i]);barries+=""===barries?writer.write(feaure):"|"+writer.write(feaure)}if(params.geoBarriers[i]instanceof NPMapLib.Geometry.Polyline){var feaure=this._createPolyline(params.geoBarriers[i]);barries+=""===barries?writer.write(feaure):"|"+writer.write(feaure)}}return url&&(this.url=url),OpenLayers.Request.GET({url:url,scope:this,params:{service:params.service,version:params.version?params.version:"1.0.0",outputFormat:params.outputFormat?params.outputFormat:"json",request:params.request,graph:params.networkName,algorithm:params.algorithm||"Dijkstra",weighter:params.weighter||"length",stops:stops,restrictField:params.trafficModel||"car",planroadtype:params.planRoadType||"1",geoms:barries,AK:window.NPGIS_AUTHKEY},success:function(reply){if(!(reply.status<2)){var infos={};if(infos=eval("("+reply.responseText+")"),infos!={}){var strs=infos.routelatlon;if(""!==strs){var messages=infos.routes||{segments:[]},features=[];""!=strs&&(features=GeoJSON.read(strs));for(var allPoints=features.length>0?features[0].getPath():[],k=0;k<messages.segments.length;k++){var tempfeatures=GeoJSON.read(messages.segments[k].routelatlon);messages.segments[k].features=tempfeatures}messages.endPoint=GeoJSON.read(messages.endPoint),messages.startPoint=GeoJSON.read(messages.startPoint),"function"==typeof successCallback&&successCallback({features:features,params:params,messages:messages,points:allPoints,routelatlon:strs})}}}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})}},NPMapLib.Services.RouteService.prototype._routeArcGIS=function(url,params,successCallback,errorCallback){var stops,barriers,polylineBarriers,polygonBarriers,outSR="",ignoreInvalidLocations=!0,accumulateAttributeNames="",impedanceAttributeName="Length",restrictionAttributeNames="",attributeParameterValues="",restrictUTurns="esriNFSBAllowBacktrack",useHierarchy=!1,returnDirections=!0,returnRoutes=!0,returnStops=!1,returnBarriers=!1,returnPolylineBarriers=!1,returnPolygonBarriers=!1,directionsLanguage="en-US",directionsStyleName="",outputLines="esriNAOutputLineTrueShapeWithMeasure",findBestSequence=!1,preserveFirstStop=!1,preserveLastStop=!1,useTimeWindows=!1,startTime=0,outputGeometryPrecision="",outputGeometryPrecisionUnits="esriDecimalDegrees",directionsOutputType="esriDOTComplete",directionsTimeAttributeName="",directionsLengthUnits="esriNAUMiles",returnZ=!1,f="json",projection=this.map.getProjection();switch(projection){case"EPSG:4326":projection=4326;break;case"EPSG:900913":projection=3857}if(url&&(this.url=url),params&&params.startStop&&params.endStop){var features=[],feature1={geometry:{x:params.startStop.lon,y:params.startStop.lat,spatialReference:{wkid:projection}}},feature2={geometry:{x:params.endStop.lon,y:params.endStop.lat,spatialReference:{wkid:projection}}};features.push(feature1),features.push(feature2);var stops={type:"features",features:features,doNotLocateOnRestrictedElements:!0}}if(stops=NPMapLib.Utils.BaseUtils.toJson(stops),params.geoBarriers){for(var points=[],polylines=[],polygons=[],i=0;i<params.geoBarriers.length;i++)params.geoBarriers[i]instanceof NPMapLib.Geometry.Point?points.push(params.geoBarriers[i]):params.geoBarriers[i]instanceof NPMapLib.Geometry.Polyline?polylines.push(params.geoBarriers[i]):(params.geoBarriers[i]instanceof NPMapLib.Geometry.Polygon||params.geoBarriers[i]instanceof NPMapLib.Geometry.Circle)&&polygons.push(params.geoBarriers[i]);for(var paths=[],i=0;i<polylines.length;i++){for(var _points=polylines[i]._points,path=[],j=0;j<_points.length;j++){var point=[_points[j].lon,_points[j].lat];path.push(point)}paths.push(path)}for(var polylineBarriers={features:[{geometry:{paths:paths,spatialReference:{wkid:projection}}}]},rings=[],i=0;i<polygons.length;i++){var _points;_points=polygons[i]instanceof NPMapLib.Geometry.Circle?polygons[i].getPoints():polygons[i]._points;for(var ring=[],j=0;j<_points.length;j++){var point=[_points[j].lon,_points[j].lat];ring.push(point)}rings.push(ring)}var polygonBarriers={features:[{geometry:{rings:rings,spatialReference:{wkid:projection}}}]};polylineBarriers=NPMapLib.Utils.BaseUtils.toJson(polylineBarriers),polygonBarriers=NPMapLib.Utils.BaseUtils.toJson(polygonBarriers)}OpenLayers.Request.GET({url:this.url,params:{stops:stops,barriers:barriers,polylineBarriers:polylineBarriers,polygonBarriers:polygonBarriers,outSR:outSR,ignoreInvalidLocations:ignoreInvalidLocations,accumulateAttributeNames:accumulateAttributeNames,impedanceAttributeName:impedanceAttributeName,restrictionAttributeNames:restrictionAttributeNames,attributeParameterValues:attributeParameterValues,restrictUTurns:restrictUTurns,useHierarchy:useHierarchy,returnDirections:returnDirections,returnRoutes:returnRoutes,returnStops:returnStops,returnBarriers:returnBarriers,returnPolylineBarriers:returnPolylineBarriers,returnPolygonBarriers:returnPolygonBarriers,directionsLanguage:directionsLanguage,directionsStyleName:directionsStyleName,outputLines:outputLines,findBestSequence:findBestSequence,preserveFirstStop:preserveFirstStop,preserveLastStop:preserveLastStop,useTimeWindows:useTimeWindows,startTime:startTime,outputGeometryPrecision:outputGeometryPrecision,outputGeometryPrecisionUnits:outputGeometryPrecisionUnits,directionsOutputType:directionsOutputType,directionsTimeAttributeName:directionsTimeAttributeName,directionsLengthUnits:directionsLengthUnits,returnZ:returnZ,f:f},success:function(reply){if("function"==typeof successCallback){var reply=eval("("+reply.responseText+")");if(!reply.routes)return void errorCallback(reply.error);var routes=reply.routes.features[0].geometry.paths[0],polyline=new NPMapLib.Geometry.Polyline(routes);this.map.addOverlay(polyline);for(var dirs=reply.directions[0].features,dirInfos=[],i=0;i<dirs.length;i++){var len=dirs[i].attributes.length,tool=new NPMapLib.GisToolKit;len=tool.getDistanceByProjection(length,this.map);var text=dirs[i].attributes.text,dirInfo={len:len,text:text};dirInfos.push(dirInfo)}var result={routes:routes,geometry:polyline,dirInfos:dirInfos};successCallback(result)}},failure:function(a){"function"==typeof errorCallback&&errorCallback(a.responseText)}})},NPMapLib.Services.RouteService.prototype._routePgis=function(){},NPMapLib.Services.RouteService.prototype._castPoint=function(a){return new OpenLayers.Geometry.Point(a.lon,a.lat)},NPMapLib.Services.RouteService.prototype._castPoints=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;++c)b.push(this._castPoint(a[c]));return b},NPMapLib.Services.RouteService.prototype._createPolygon=function(a){if(a instanceof NPMapLib.Geometry.Polygon||a instanceof NPMapLib.Geometry.Circle){var b=[];if(a instanceof NPMapLib.Geometry.Polygon&&(b=a.getPath()),a instanceof NPMapLib.Geometry.Circle&&(b=a.getPoints()),b&&!(b.length<=0)){var c=new OpenLayers.Geometry.LinearRing(this._castPoints(b)),d=new OpenLayers.Geometry.Polygon(c),e=new OpenLayers.Feature.Vector(d,a);return e}}},NPMapLib.Services.RouteService.prototype._createPolyline=function(a){if(a instanceof NPMapLib.Geometry.Polyline){var b=a.getPath();if(b&&!(b.length<=0)){var c=new OpenLayers.Geometry.LineString(this._castPoints(b)),d=new OpenLayers.Feature.Vector(c,a);return d}}};var each=function(a,b){for(var c=0;c<a.length;c++)b(c,a[c])},arraryContains=function(a,b){for(var c=0;c<a.length;c++)if(a[c].lon==b.lon&&a[c].lon==b.lon)return!0;return!1}}(),function(){NPMapLib.Services.routeParams=function(){this.service="na",this.request="getroute",this.networkName="",this.weighter="length",this.startStop,this.endStop,this.trafficModel,this.geoBarriers}}(),function(){NPMapLib.Symbols.AnimationLine=function(a,b,c){this.CLASS_NAME="NPMapLib.Symbols.AnimationLine",this.points,this.op_line,this.op_feature,this._layer,this.drawIndex=0,this.drawSpeed,this.isWait=!1,this.isAddPoint=!1,this.segArray,this.segIndex=0,this.panWay=-1,this.status,this.interval=10,this.newStart=!0,this.events=new NPMapLib.Events(this,["preDraw","afterDraw","afterStep"]),this.headerMarker=null,this.isHeaderRotate=!0,this.timer=null,this.lineStyle={color:"green"},c&&(c.color&&(this.lineStyle.color=c.color),c.opacity&&(this.lineStyle.opacity=c.opacity),c.weight&&(this.lineStyle.weight=c.weight)),this.id=-1,this._points=new Array,this._listeners={},this.mapId=a,this.layerName="动画线",this.mapAdapter=NPMapLib.Adapter.AdapterFactory.getMapAdapter(a),this.points=b,this.points instanceof Array||(this.points=[]),this.drawSpeed=15,this.status=0,c&&(this.headerMarker=c.headerMarker,this.isHeaderRotate=c.isHeaderRotate===!1?!1:!0),this._init()},NPMapLib.Symbols.AnimationLine.prototype.restart=function(){this.op_line&&this._layer.getOverlay(this.op_line.id)&&this._layer.removeOverlay(this.op_line),this._init(),this.start()},NPMapLib.Symbols.AnimationLine.prototype.start=function(){NPMapLib.isAnimat=!0,this.status>0||(this._triggerEvent(NPMapLib.ANIMATION_EVENT_START),this.status=1,this._layer||(this._layer=new NPMapLib.Layers.OverlayLayer(this.layerName,!1),this._layer.mapId=this.mapId,this.mapAdapter.addLayer(this._layer)),this._layer.getOverlay(this.op_line.id)||this._layer.addOverlay(this.op_line),this.panWay>=0&&this._suitView(this.points),this.newStart&&0==this.drawIndex&&this.points.length>0&&(this.headerMarker&&(this._rotateHeaderMarker(),this.headerMarker.moveTo(this.points[this.drawIndex])),this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),this.timer=window.setTimeout(this._startDraw.bind(this),this.interval))},NPMapLib.Symbols.AnimationLine.prototype.pause=function(){NPMapLib.isAnimat=!1,this.status=-1},NPMapLib.Symbols.AnimationLine.prototype.stop=function(){NPMapLib.isAnimat=!1,-1==this.status&&this._triggerEvent(NPMapLib.ANIMATION_EVENT_STOP),this.status=0,window.clearTimeout(this.timer)},NPMapLib.Symbols.AnimationLine.prototype.setSpeed=function(a){0==a?(this.isWait=!0,this.isAddPoint=!1,this.drawSpeed=0):(this.isWait=!1,this._rotateHeaderMarker(),this.drawSpeed=a)},NPMapLib.Symbols.AnimationLine.prototype.appendPoints=function(a){a instanceof Array&&!(a.length<=0)&&(this.points=this.points.concat(a),this.op_line||this._init(),this.panWay>=0&&this._suitView(a))},NPMapLib.Symbols.AnimationLine.prototype.setStyle=function(a){this.lineStyle=this._overwriteObj(this.lineStyle,a),this.op_line&&this._layer&&(this.op_line.setStyle(this.lineStyle),this._redraw())},NPMapLib.Symbols.AnimationLine.prototype._overwriteObj=function(a,b){if(!a||!b)return a;for(var c in b)c in a&&(a[c]=b[c]);return a},NPMapLib.Symbols.AnimationLine.prototype._startDraw=function(){if(0==this.status)return void this._triggerEvent(NPMapLib.ANIMATION_EVENT_STOP);if(-1==this.status)return void this._triggerEvent(NPMapLib.ANIMATION_EVENT_PAUSE);if(!this.op_line)return void(this.status=0);var a=this._preDraw();return a?this.isWait?(this.isAddPoint||(this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this.isAddPoint=!0,this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),void window.setTimeout(this._startDraw.bind(this),this.interval)):(this._addPoint(),void this._afterDraw()):void(this.status=0)},NPMapLib.Symbols.AnimationLine.prototype.continus=function(){this.isAddPoint=!1,this.drawIndex++},NPMapLib.Symbols.AnimationLine.prototype._preDraw=function(){0==this.drawIndex&&(this.segArray=this._calculateSeg(this.drawIndex));var a=0==this.drawIndex&&0==this.segIndex,b=this.segArray.length;return this.segIndex=this.segIndex+1,a&&this.events.triggerEvt("preDraw",{point:this.points[this.drawIndex],index:this.drawIndex}),(a||this.segIndex>=b-1)&&this._rotateHeaderMarker(),this.drawIndex>=this.points.length-1?!1:(this.segIndex>=b&&(this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex)),this.panWay<=0?!0:(!this._inView(this.segArray[this.segIndex])&&this.panWay>0&&this._setCenter(this.segArray[this.segIndex]),!0))},NPMapLib.Symbols.AnimationLine.prototype._addPoint=function(){this._moveHeaderMarker();var a=NPMapLib.T.setPoint(this.mapAdapter,this.segArray[this.segIndex]);if(this.op_line._apiObj){if(this.segIndex<=1||this.op_line._apiObj.geometry.components.length<2){if(this.drawIndex>0){var b=NPMapLib.T.setPoint(this.mapAdapter,this.points[this.drawIndex]),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.op_line._apiObj.geometry.components.push(c),c.parent=this.op_line._apiObj.geometry}var d=new OpenLayers.Geometry.Point(a.lon,a.lat);this.op_line._apiObj.geometry.components.push(d),d.parent=this.op_line._apiObj.geometry}else{var e=this.op_line._apiObj.geometry.components.length,d=new OpenLayers.Geometry.Point(a.lon,a.lat);this.op_line._apiObj.geometry.components[e-1]=d,d.parent=this.op_line._apiObj.geometry}this.op_line._apiObj.geometry.clearBounds(),this._redraw()}},NPMapLib.Symbols.AnimationLine.prototype._afterDraw=function(){var a=(0==this.drawIndex&&(1==this.segIndex||0==this.segIndex),this.segIndex>=this.segArray.length-1);a&&(this.drawIndex++,this.events.triggerEvt("preDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),this.drawIndex>0&&a&&(this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex}));var b=this.segIndex;this.segIndex>this.segArray.length-2&&(b=0),this.events.triggerEvt("afterStep",{stepIndex:b,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]}),this.segIndex>this.segArray.length-2&&this.drawIndex>this.points.length-2&&(this.status=0,NPMapLib.isAnimat=!1),this.timer=window.setTimeout(this._startDraw.bind(this),this.interval)},NPMapLib.Symbols.AnimationLine.prototype.nextPosition=function(){this.newStart=!1,this.drawIndex>0&&this.drawIndex--,this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this._rotateHeaderMarker(),this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex),this._setLine(this.drawIndex),this.events.triggerEvt("afterStep",{stepIndex:0,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]})},NPMapLib.Symbols.AnimationLine.prototype.afterPosition=function(){this.drawIndex<this.points.length-1&&(this.drawIndex++,this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this._rotateHeaderMarker(),this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex),this._setLine(this.drawIndex),this.events.triggerEvt("afterStep",{stepIndex:0,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]}))},NPMapLib.Symbols.AnimationLine.prototype.slicePoints=function(a){this.points=this.points.slice(0,a+1)},NPMapLib.Symbols.AnimationLine.prototype._setLine=function(a,b){if(this.op_line._apiObj){this.op_line._apiObj.geometry.components=[];for(var c=0;a+1>c;c++){var d=NPMapLib.T.setPoint(this.mapAdapter,this.points[c]),e=new OpenLayers.Geometry.Point(d.lon,d.lat);this.op_line._apiObj.geometry.components.push(e),e.parent=this.op_line._apiObj.geometry}if(b>0){var f=NPMapLib.T.setPoint(this.mapAdapter,this.segArray[b]),g=new OpenLayers.Geometry.Point(f.lon,f.lat);this.op_line._apiObj.geometry.components.push(g),g.parent=this.op_line._apiObj.geometry}this.op_line._apiObj.geometry.clearBounds(),this._redraw()}},NPMapLib.Symbols.AnimationLine.prototype.setLayer=function(a){this._layer=a},NPMapLib.Symbols.AnimationLine.prototype._init=function(){this.segArray=[],this.drawIndex=0;var a=[];this.points.length>0&&a.push(this.points[0]),this.op_line=new NPMapLib.Geometry.Polyline(a,this.lineStyle)},NPMapLib.Symbols.AnimationLine.prototype._redraw=function(){this.op_line&&this._layer&&this.op_line.refresh()},NPMapLib.Symbols.AnimationLine.prototype._calculateSeg=function(a){var b=[];if(a+1>=this.points.length)return b.push(0),b;var c=this.points[a],d=this.points[a+1],e=this._getDistance(c,d),f=0;this.drawSpeed>0&&(f=Math.round(e/this.drawSpeed));for(var g,h,i=1;f>i;i++)g=i/f,x=parseFloat((d.lon-c.lon)*g)+parseFloat(c.lon),y=parseFloat((d.lat-c.lat)*g)+parseFloat(c.lat),h=new NPMapLib.Geometry.Point(x,y),b.push(h);
return b.push(this.points[a+1]),b},NPMapLib.Symbols.AnimationLine.prototype._getDistance=function(a,b){return this.mapAdapter.getDistance(a,b,"EPSG:4326")},NPMapLib.Symbols.AnimationLine.prototype._inView=function(a){var b=this.mapAdapter.getExtent(),c=this.mapAdapter.containsPoint(b,NPMapLib.T.setPoint(this.mapAdapter,a));return c},NPMapLib.Symbols.AnimationLine.prototype._setCenter=function(a){this.mapAdapter.setCenter(NPMap.T.setPoint(this.mapAdapter,a))},NPMapLib.Symbols.AnimationLine.prototype._pointToPixel=function(a){return this.mapAdapter.pointToPixel(NPMap.T.setPoint(this.mapAdapter,a))},NPMapLib.Symbols.AnimationLine.prototype._pixelToPoint=function(a){return NPMap.T.getPoint(this.mapAdapter,this.mapAdapter.pixelToPoint(a))},NPMapLib.Symbols.AnimationLine.prototype._setLayer=function(a){if(a&&a._useCluster)throw"can not use cluster layer";this._layer=a},NPMapLib.Symbols.AnimationLine.prototype._suitView=function(a){a.length>1&&this._layer&&this._layer.map},NPMapLib.Symbols.AnimationLine.prototype._rotateHeaderMarker=function(){if(this.headerMarker&&this.isHeaderRotate){var a=this._calculateAngle();a>=0&&this.headerMarker.rotate(a)}},NPMapLib.Symbols.AnimationLine.prototype.setPosition=function(a,b){if(a>-1&&a<this.points.length){this.drawIndex=a;var c=this._calculateSeg(this.drawIndex);b>-1&&b<c.length?(this.segArray=c,this.segIndex=b):0>b?(this.segArray=c,this.segIndex=0):b>c.length-1&&(this.segArray=c,this.segIndex=c.length-2),1==c.length&&0==c[0]&&this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this._rotateHeaderMarker(),0==this.segIndex?this.headerMarker.moveTo(this.points[this.drawIndex]):this._moveHeaderMarker(),this._setLine(this.drawIndex,this.segIndex)}},NPMapLib.Symbols.AnimationLine.prototype._calculateAngle=function(){if(this.drawIndex>=this.points.length-1)return-1;var a=this.points[this.drawIndex],b=this.points[this.drawIndex+1],c=180*Math.atan2(b.lat-a.lat,b.lon-a.lon)/Math.PI;return c=c>0?360-c:0-c},NPMapLib.Symbols.AnimationLine.prototype._moveHeaderMarker=function(){if(this.headerMarker){var a=this.segArray[this.segIndex];if(a.lon&&a.lat){var b=new NPMapLib.Geometry.Point(a.lon,a.lat);this.headerMarker.moveTo(b)}}},NPMapLib.Symbols.AnimationLine.prototype.addEventListener=function(a,b){switch(a){case NPMapLib.ANIMATION_EVENT_START:this._listeners.start||(this._listeners.start=[]),this._listeners.start.push(b);break;case NPMapLib.ANIMATION_EVENT_PAUSE:this._listeners.pause||(this._listeners.pause=[]),this._listeners.pause.push(b);break;case NPMapLib.ANIMATION_EVENT_STOP:this._listeners.stop||(this._listeners.stop=[]),this._listeners.stop.push(b);break;case NPMapLib.ANIMATION_EVENT_MOVING:this._listeners.moving||(this._listeners.moving=[]),this._listeners.moving.push(b);break;case NPMapLib.ANIMATION_EVENT_MOVED:this._listeners.moved||(this._listeners.moved=[]),this._listeners.moved.push(b);break;case"preDraw":case"afterDraw":case"afterStep":this.events.register(a,b)}},NPMapLib.Symbols.AnimationLine.prototype.removeEventListener=function(a,b){if("preDraw"===a||"afterDraw"===a||"afterStep"===a)return void this.events.unregiste(a);var c=this._listeners[a];if(c instanceof Array)for(var d=0;d<c.length;++d)if(c[d].toString()==b.toString()){c.pop(b);break}},NPMapLib.Symbols.AnimationLine.prototype._triggerEvent=function(a,b){var c=this._listeners[a];if(c instanceof Array)for(var d=0;d<c.length;++d)c[d].apply(this,b)},NPMapLib.Symbols.AnimationLine.prototype.remove=function(){this.stop(),this.op_line&&this._layer.getOverlay(this.op_line.id)&&this._layer.removeOverlay(this.op_line),this._layer&&"动画线"===this._layer.name&&this.mapAdapter.removeLayer(this._layer)}}(),function(){var a=ClusterUtil=function(a,b){this.clusters,this._map=a,this._createcluster(b),this._initFeature(b)};a.prototype._initFeature=function(a){var b=a.dataJson.length;this.clusters.strategies[0]&&(this.clusters.strategies[0].callbackFun=a.opts.success);for(var c,d=0;b>d;d++)c={lon:a.dataJson[d].location.lon,lat:a.dataJson[d].location.lat},c=NPMapLib.T.setPoint(this._map,c),a.dataJson[d].geometry={x:c.lon,y:c.lat},this.clusters.showMarker[a.dataJson[d].markType]||(this.clusters.showMarker[a.dataJson[d].markType]=!0);this.clusters.removeFeatures(this.clusters.features),this.clusters.events.triggerEvent("beforefeaturesadded",{features:a.dataJson})},a.prototype._createcluster=function(a){var b=this._map.getLayersByName(a.layName);return b.length>0?(this.clusters=b[0],void this._map.addLayers([this.clusters])):void alert("无效的图层")}}(),NPNamespace.register("NPMapLib.Adapter.OpenLayers"),function(){function a(a){var b=this.map.getResolution(),c=this.map.getMaxExtent().top,d=this.map.getMaxExtent().left,e=Math.round((a.left-d)/(b*this.tileSize.w)),f=Math.round((c-a.top)/(b*this.tileSize.h)),g=this.map.getZoom(),h=""+g+"/"+e+"/"+f+"."+this.type;this.isOnline&&(h="L="+g+"&X="+e+"&Y="+f);var i=this.url;return i instanceof Array&&(i=this.selectUrl(h,i)),i+h}function b(a,b){this.name=a,this.func=b}var c={0:"solid",1:"dash",2:"dot",4:"dashdot",10:"longdashdot",9:"longdash"},d={"-1":"butt",0:"round",1:"square"},e=NPMapLib.Adapter.OpenLayers.MapAdapter=function(a,b){this.map=null,this._indexNum=0,this._container=a,this._featuresLayer=null,this._zoomBar=null,this._navigator=null,this._keyBord=null,this._overView=null,this._CopyRight=null,this._MousePosition=null,this._scale=null,this._drawControls=null,this._drawControl=null,this._measureControls=null,this._measureControl=null,this._mapClickControl=null,this._mouseContext=null,this._currentZoomControl=null,this._events=[],this._clicks=[],this._overlayEvents=[],this._boxSelectControl=null,this._modifyFeature=null,this._openLayersEvents=null,this._popupList=[],this.opts=b||{},this._selfLayers=[],this.currentDrawMode=null;var c=b.fullExtent;this._LayerSwitcher=null,this._measureFeatures=[],this._units={m:"米",km:"千米"},this.mapId=b.mapId,this.defaultMapCursor="",this.featureCursor="pointer",this.fractionalZoom=!0,this.cache=null,this.activeFeature=null,this.activMarkers=[],c&&(b.fullExtent=new OpenLayers.Bounds(c[0],c[1],c[2],c[3])),b.displayProjection=new OpenLayers.Projection(b.displayProjection),this._opts=b,this._initialize(),this._openLayersEvents=new OpenLayers.Events(this,null,["addoverlay","removeoverlay","clearoverlays"],!1),this.map.events.fallThrough=!0};e.prototype._initialize=function(){this._navigator=new OpenLayers.Control.Navigation,this._opts.controls=[];var a=OpenLayers.Function.bind(this.destroyMap,this);OpenLayers.Event.observe(window,"unload",a),this.map=new OpenLayers.Map(this._container.id,this._opts),this.setMapfractionalZoom(this.fractionalZoom),this.map.addControl(this._navigator);var b=this;this.map.events.on({zoomstart:function(){for(var a=0;a<this.layers.length;a++)this.layers[a].isBaseLayer||((this.layers[a]instanceof OpenLayers.Layer.TDTLayer||this.layers[a]instanceof OpenLayers.Layer.Baidu)&&this.layers[a].clearGrid(),this.layers[a].visibility&&(this.layers[a].setVisibility(!1),this.layers[a].clusterVisable=!1))},zoomend:function(){for(var a=0;a<this.layers.length;a++)this.layers[a].isBaseLayer||this.layers[a].clusterVisable===!1&&(this.layers[a].setVisibility(!0),this.layers[a].clusterVisable=!0)},scope:this.map}),this.map.div.oncontextmenu=function(){return!1};var c=new OpenLayers.Control.ClickControl({eventMethods:{click:function(a){var c=b._clicks.click;if(c){var d=this.map.getLonLatFromPixel(a.xy),e=new NPMapLib.Geometry.Point(d.lon,d.lat);c(NPMapLib.T.getPoint(b,e),a)}},rightclick:function(a){a.cancelBubble=!1,a.returnValue=!1;var c=this.map.events.getMousePosition(a),d=this.map.getLonLatFromPixel(c),e=new NPMapLib.Geometry.Point(d.lon,d.lat),f=b._clicks.rightclick,g=this.map.getFeatures(a,!1),h=NPMapLib.T.getPoint(b,e);if(!f||g&&0!=g.length){if(g&&0!=g.length){var i=g[0],f=b._overlayEvents[i.data.id+"_rightclick"];"function"==typeof f&&f.apply(this,[h,i.data,"rightclick"])}}else f(h,a)}}});this.map.addControl(c),c.activate(),this._mapClickControl=c,this.registerLayerFeatureclick()},e.prototype.addHandStyleForMap=function(){if(this._navigator){var a=OpenLayers.Util.getImageLocation("openhand.cur");this.defaultMapCursor="url("+a+"), default",this.featureCursor="pointer",this._setMouseCursor(this.defaultMapCursor);var b=this;this._navigator.dragPan.startFun=function(){if(!(b._measureControl&&b._measureControl.active||b._drawControl&&b._drawControl.active)){var a=OpenLayers.Util.getImageLocation("closedhand.cur");b._setMouseCursor("url("+a+"), move")}},this._navigator.dragPan.endFun=function(){b._measureControl&&b._measureControl.active||b._drawControl&&b._drawControl.active||b._setMouseCursor(b.defaultMapCursor)}}},e.prototype.deleteHandStyleForMap=function(){this._navigator&&(this.defaultMapCursor="default",this.featureCursor="pointer",this._setMouseCursor(this.defaultMapCursor),this._navigator.dragPan.startFun=null,this._navigator.dragPan.endFun=null)},e.prototype.setMapfractionalZoom=function(a){this.fractionalZoom=a,this.map.fractionalZoom=this.fractionalZoom},e.prototype.destroyMap=function(){},e.prototype.addDefaultLayer=function(a){this._featuresLayer=new OpenLayers.Layer.Vector(a.name,{hover:!0,highlightOnly:!0,rendererOptions:{zIndexing:!0},renderers:["SVGExtended","VMLExtended","CanvasExtended"]}),a._apiObj=this._featuresLayer;var b=this._featuresLayer;this._drawControls={point:new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Point),rect:new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),circle:new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:60,irregular:!1,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),circle2:new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.RegularPolygonExtend,{handlerOptions:{sides:60,irregular:!1,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),line:new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Path,{handlerOptions:{style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),polygon:new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Polygon,{handlerOptions:{style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),freehand:new OpenLayers.Control.DrawFeature(b,OpenLayers.Handler.Polygon,{handlerOptions:{freehand:!0,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}})},this._featuresLayer.displayInLayerSwitcher=!1,this.map.addLayers([this._featuresLayer]),this._registerLayerEvent(this._featuresLayer,!1),this._selfLayers[a.name]=this._featuresLayer,this._initMeasureControl(),this.map.registerMousePosition()},e.prototype._registerLayerEvent=function(a){var b=this;a.events.register("beforefeaturemodified",this,this._beforefeaturemodified),a.events.register("featuremodified",this,this._featuremodified),a.events.register("draging",this,this._featuresLayerDrag),a.events.register("featureclick",this,function(a){if(!(b._measureControl&&b._measureControl.active||b._drawControl&&b._drawControl.active||b._currentZoomControl&&b._currentZoomControl.active||b._navigator.isDrag)){var c=this._overlayEvents[a.feature.data.id+"_click"];if(c&&c instanceof Function)b.triggerEvent("featureclick",{feature:a.feature});else{var d=b._clicks.click;if(d&&d instanceof Function){var e=this._mapClickControl.handler.evt.xy,f=this.map.getLonLatFromPixel(e);d(NPMapLib.T.getPoint(b,f))}}}}),this.dblclickFunction||(this.dblclickFunction=function(a){var c=this.getFeatureFromEvent(a);if(c){var d=b._overlayEvents[c.data.id+"_dblclick"];if("function"==typeof d){var e=this.map.getLonLatFromPixel({x:a.x,y:a.y});e=NPMapLib.T.getPoint(b,e),d.apply(this,[new NPMapLib.Geometry.Point(e.lon,e.lat),c.data,"dblclick"])}}return!0}),NPMapLib.MapMeasure_CloseMarkDispaly||this.registerdblclick(a)},e.prototype.registerdblclick=function(a){a||(a=this._featuresLayer),a.events.register("dblclick",a,this.dblclickFunction)},e.prototype._unregisterdblclick=function(){this._featuresLayer.events.unregister("dblclick",this._featuresLayer,this.dblclickFunction)},e.prototype._featuresLayerClick=function(a){var b=a.feature;if(b.data&&b.data.id){var c=this._overlayEvents[b.data.id+"_click"];"function"==typeof c&&c.apply(this,[b.data,"click"])}return!1},e.prototype._mouseout=function(a){var b=a.xy,c=null;b&&(c=this.pixelToPoint(b));var d=a.feature;if(d.data&&d.data.id){if(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active||this._currentZoomControl&&this._currentZoomControl.active)return;this._setMouseCursor(this.defaultMapCursor);var e=this._overlayEvents[d.data.id+"_mouseout"];"function"==typeof e&&e.apply(this,[d.data,NPMap.T.getPoint(this,c)])}return!1},e.prototype._beforefeaturemodified=function(a){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){var b=a.feature,c=this._overlayEvents[b.data.id+"_dragstart"];return"function"==typeof c&&c.apply(this,[b.data,"dragstart"]),!0}},e.prototype._featuremodified=function(a){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){if(a&&a.feature&&a.feature.data){var b=a.feature,c=this._overlayEvents[b.data.id+"_dragend"];"function"==typeof c&&c.apply(this,[b.data,"dragend"])}return!1}},e.prototype._featuresLayerDrag=function(a){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){var b=a.vertex,c=a.position,d=this._overlayEvents[b.data.id+"_draging"];return"function"==typeof d&&(b.data._position.lon=c.lon,b.data._position.lat=c.lat,d.apply(this,[b.data,"draging"])),!1}},e.prototype._overFeature=function(a){var b=a.xy;a=a.feature?a.feature:a;var c=null;if(b&&(c=this.pixelToPoint(b)),a.data&&a.data.id){if(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active||this._currentZoomControl&&this._currentZoomControl.active)return;this._setMouseCursor("pointer");var d=this._overlayEvents[a.data.id+"_mouseover"];"function"==typeof d&&d.apply(this,[a.data,NPMap.T.getPoint(this,c)])}return!1},e.prototype._featureClick=function(a){var b=this._overlayEvents[a.data.id+"_click"];if("function"==typeof b){var c=this.map.getLonLatFromPixel(this.handlers.feature.evt.xy);b.apply(this,[new NPMapLib.Geometry.Point(c.lon,c.lat),a.data,"click"])}return!1},e.prototype.enableLayerSwitcher=function(){this._LayerSwitcher=new OpenLayers.Control.LayerSwitcher,this.map.addControl(this._LayerSwitcher),this._LayerSwitcher.activate()},e.prototype.disableLayerSwitcher=function(){this._LayerSwitcher&&(this._LayerSwitcher.deactivate(),this.map.removeControl(this._LayerSwitcher),delete this._LayerSwitcher)},e.prototype.enableScrollWheelZoom=function(){this._navigator&&this._navigator.enableZoomWheel()},e.prototype.disableScrollWheelZoom=function(){this._navigator&&this._navigator.disableZoomWheel()},e.prototype.enableDoubleClickZoom=function(){this._navigator&&this._navigator.handlers.click.activate()},e.prototype.disableDoubleClickZoom=function(){this._navigator&&this._navigator.handlers.click.deactivate()},e.prototype.enableMapOperation=function(){this._navigator&&this._navigator.activate()},e.prototype.disableMapOperation=function(){this._navigator&&this._navigator.deactivate()},e.prototype.enableKeyboard=function(){this._keyBord||(this._keyBord=new OpenLayers.Control.KeyboardDefaults,this.map.addControl(this._keyBord),this._keyBord.activate())},e.prototype.disableKeyboard=function(){this._keyBord&&(this._keyBord.deactivate(),this.map.removeControl(this._keyBord),delete this._keyBord)},e.prototype.enableInertialDragging=function(){},e.prototype.disableInertialDragging=function(){},e.prototype.enableBoxSelect=function(a){null!=this._boxSelectControl&&this.disableBoxSelect(),this._boxSelectControl=new OpenLayers.Control.SelectFeature([this._featuresLayer],{clickout:!1,toggle:!1,multiple:!1,hover:!1,toggleKey:"ctrlKey",multipleKey:"shiftKey",box:!0}),a&&this._boxSelectControl.events.register("boxselectionend",this._boxSelectControl,function(b){for(var c=[],d=0;d<b.layers.length;d++)for(var e=b.layers[d].selectedFeatures,f=0;f<e.length;f++)c.push(e[f].data?e[f].data:e[f].geometry);a(c)}),this.map.addControl(this._boxSelectControl),this._boxSelectControl.active||this._boxSelectControl.activate()},e.prototype.disableBoxSelect=function(){this._boxSelectControl&&(this._boxSelectControl.deactivate(),this.map.removeControl(this._boxSelectControl),delete this._boxSelectControl)},e.prototype.enableEditing=function(a,b,c){if(this._modifyFeature&&this.disableEditing(),this._modifyFeature)this._modifyFeature.mode=a?a:OpenLayers.Control.ModifyFeature.DRAG|OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE|OpenLayers.Control.ModifyFeature.RESHAPE;else{var d=b&&b._apiObj&&b._apiObj.layer?b._apiObj.layer:this._featuresLayer,e={};c&&c.virtualStyle&&(e.virtualStyle=OpenLayers.Util.extend(d.style||d.styleMap.createSymbolizer(null,null),c.virtualStyle)),this._modifyFeature=new OpenLayers.Control.ModifyFeature(d,e),this._modifyFeature.createVertices=!0,this._modifyFeature.mode=a?a:OpenLayers.Control.ModifyFeature.DRAG|OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE|OpenLayers.Control.ModifyFeature.RESHAPE,this.map.addControl(this._modifyFeature)}this._modifyFeature.activate()},e.prototype.resetEditVertices=function(){this._modifyFeature&&this._modifyFeature.resetVertices()},e.prototype.cancelEditing=function(a){this._modifyFeature&&a._apiObj&&a._apiObj.layer===this._modifyFeature.layer&&this._modifyFeature.unselectFeature(a._apiObj)},e.prototype.disableEditing=function(){this._modifyFeature&&(this._modifyFeature.deactivate(),this.map.removeControl(this._modifyFeature),delete this._modifyFeature,this._modifyFeature=null)},e.prototype.getMaxZoom=function(){return this.map.maxZoom},e.prototype.setMinZoom=function(a){return this.map.minZoom=a},e.prototype.setMaxZoom=function(a){return this.map.maxZoom=a},e.prototype.getExtent=function(){var a=this.map.getExtent();return new NPMapLib.Geometry.Extent(a.left,a.bottom,a.right,a.top)},e.prototype.getCenter=function(){var a=this.map.getCenter();return new NPMapLib.Geometry.Point(a.lon,a.lat)},e.prototype.getDistance=function(a,b,c){var d,e,f="m";!c&&a.lon>-180&&a.lon<180&&(c="EPSG:4326");var g=new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(a.lon,a.lat),new OpenLayers.Geometry.Point(b.lon,b.lat)]);c?(c=new OpenLayers.Projection(c),d=g.getGeodesicLength(c),e="m"):(d=g.getGeodesicLength(this.map.getProjectionObject()),e="m");var h=OpenLayers.INCHES_PER_UNIT[f];if(h){var i=OpenLayers.INCHES_PER_UNIT[e];d*=i/h}return d},e.prototype.getSize=function(){var a=this.map.getSize();return new NPMapLib.Geometry.Size(a.w,a.h)},e.prototype.getZoom=function(){return this.map.getZoom()},e.prototype.getMaxZoom=function(){return this.map.maxZoom},e.prototype.getMinZoom=function(){return this.map.minZoom},e.prototype.centerAndZoom=function(a,b){var c=new OpenLayers.LonLat(a.lon,a.lat);this.map.setCenter(c,this.adjustZoom(b))},e.prototype.panTo=function(a){var b=new OpenLayers.LonLat(a.lon,a.lat);this.map.panTo(b)},e.prototype.pan=function(){for(var a in this._measureControls)this._measureControls.hasOwnProperty(a)&&this._measureControls[a].deactivate();for(var b in this._drawControls)this._drawControls.hasOwnProperty(b)&&this._drawControls[b].deactivate();this._drawControl&&(this.map.removeControl(this._drawControl),delete this._drawControl),this._measureControl&&(this.map.removeControl(this._measureControl),delete this._measureControl),this._currentZoomControl&&this._currentZoomControl.deactivate(),this.deactivateMouseContext(),this._setMouseCursor(this.defaultMapCursor)},e.prototype.panByPixel=function(a,b){this.map.pan(a,b)},e.prototype.adjustZoom=function(a){return a=a||this.map.getZoom(),a=a>this.map.minZoom?a:this.map.minZoom,a=a<this.map.maxZoom?a:this.map.maxZoom},e.prototype.containsPoint=function(a,b){return new OpenLayers.Bounds(a.sw.lon,a.sw.lat,a.ne.lon,a.ne.lat).containsLonLat(new OpenLayers.LonLat(b.lon,b.lat))},e.prototype.reset=function(){this.fullExtent(this.opts.defaultZoom)},e.prototype.setCenter=function(a,b){var c=new OpenLayers.LonLat(a.lon,a.lat);this.map.setCenter(c,this.adjustZoom(b))},e.prototype.switchLayer=function(){},e.prototype.setZoom=function(a){this.map.zoomTo(this.adjustZoom(a))},e.prototype.zoomTo=function(a,b){b=b||this.map.maxZoom;var c=this.map.getPixelFromLonLat({lon:a.lon,lat:a.lat});this.map.zoomTo(b,c,null,a)},e.prototype.fullExtent=function(a){var b=this.map.originCenter,c=new OpenLayers.LonLat(b[0],b[1]);a=a||this.map.minZoom,this.centerAndZoom(c,a)},e.prototype._zoomInOut=function(a){if(this.pan(),this._currentZoomControl&&(this._currentZoomControl.deactivate(),this.map.removeControl(this._currentZoomControl)),"in"===a){this._currentZoomControl=new OpenLayers.Control.ZoomBox({alwaysZoom:!1});var b=OpenLayers.Util.getImageLocation("zoomOut.ico");this._setMouseCursor("url("+b+"), crosshair1")}else{this._currentZoomControl=new OpenLayers.Control.ZoomBox({alwaysZoom:!1,out:!0});var c=OpenLayers.Util.getImageLocation("zoomIn.ico");this._setMouseCursor("url("+c+"), crosshair1")}this.map.addControl(this._currentZoomControl),this._currentZoomControl.activate()},e.prototype.zoomIn=function(){this._zoomInOut("in")},e.prototype.zoomOut=function(){this._zoomInOut("out")},e.prototype.zoomInOutStop=function(){this._currentZoomControl&&(this._currentZoomControl.deactivate(),this.map.removeControl(this._currentZoomControl),delete this._currentZoomControl),this._setMouseCursor(this.defaultMapCursor)},e.prototype.zoomInFixed=function(){this.map.zoomIn()},e.prototype.zoomOutFixed=function(){this.map.zoomOut()},e.prototype.zoomToExtent=function(a){this.map.zoomToExtent(new OpenLayers.Bounds(a.left,a.bottom,a.right,a.top),!1)},e.prototype.getContainer=function(){return this._container},e.prototype.showNavigationControl=function(a){this._zoomBar||(this._zoomBar="common"===a.navigationType?new OpenLayers.Control.PanZoomBar(a.opts):new OpenLayers.Control.NPanZoomBar(a.opts)),this.map.addControl(this._zoomBar)},e.prototype.hideNavigationControl=function(){this.map.removeControl(this._zoomBar),this._zoomBar=null},e.prototype.addOverviewControl=function(a){var b={};this.map.restrictedExtent&&(b.restrictedExtent=this.map.restrictedExtent),b.minRatio=a&&a.minRatio?a.minRatio:10,b.maxRatio=a&&a.maxRatio?a.maxRatio:10,b.projection=this.map.projection,this._overView=new OpenLayers.Control.LTOverviewMap(b),this.map.addControl(this._overView)},e.prototype.removeOverviewControl=function(){this.map.removeControl(this._overView),this._overView.close(),this._overView=null},e.prototype.setOverViewSize=function(a,b){this._overView&&(this._overView.size.w=a,this._overView.size.h=b)},e.prototype.showOverviewControl=function(){this._overView&&this._overView.maximizeControl()},e.prototype.hideOverviewControl=function(){this._overView&&this._overView.minimizeControl()},e.prototype.showCopyRightControl=function(){this._CopyRight||(this._CopyRight=new OpenLayers.Control.CopyRightControl),this.map.addControl(this._CopyRight)},e.prototype.hideCopyRightControl=function(){this.map.removeControl(this._CopyRight),this._CopyRight=null},e.prototype.setCopyRight=function(a){this._CopyRight||(this._CopyRight=new OpenLayers.Control.CopyRightControl(a))},e.prototype.showScaleControl=function(){this._scale||(this._scale=new OpenLayers.Control.ScaleLine({bottomOutUnits:""})),this.map.addControl(this._scale)},e.prototype.hideScaleControl=function(){this.map.removeControl(this._scale),this._scale=null};var f;e.prototype.showNorthControl=function(){f||(f=new OpenLayers.Control.NorthControl),this.map.addControl(f)},e.prototype.hideNorthControl=function(){this.map.removeControl(f),f=null},e.prototype.showMousePosition=function(a){this._MousePosition&&this.map.removeControl(this._MousePosition),this._MousePosition=a?new OpenLayers.Control.JWMousePosition:new OpenLayers.Control.MousePosition,this.map.addControl(this._MousePosition)},e.prototype.hideMousePosition=function(){this.map.removeControl(this._MousePosition),this._MousePosition=null},e.prototype.addJWMousePosition=function(){this._MousePosition&&this.map.removeControl(this._MousePosition),this._MousePosition=new OpenLayers.Control.JWMousePosition,this.map.addControl(this._MousePosition)},e.prototype.removeJWMousePostion=function(){this._MousePosition instanceof OpenLayers.Control.JWMousePosition&&(this.map.removeControl(this._MousePosition),delete this._MousePosition,this._MousePosition=new OpenLayers.Control.MousePosition,this.map.addControl(this._MousePosition))},e.prototype.activateMouseContext=function(a,b){this._mouseContext||(this._mouseContext=new OpenLayers.Control.MouseContext,this.map.addControl(this._mouseContext),b&&(this._mouseContext.offset=b)),a&&this._mouseContext.setContext(a),this._mouseContext.activate()},e.prototype.deactivateMouseContext=function(){this._mouseContext&&(this._mouseContext.deactivate(),this.map.removeControl(this._mouseContext),delete this._mouseContext)},e.prototype.getMouseContextStyle=function(){return this._mouseContext?this._mouseContext.getContextStyle():void 0},e.prototype.setMouseContextStyle=function(a){this._mouseContext&&this._mouseContext.setContextStyle(a)},e.prototype.getMouseContextElement=function(){return this._mouseContext?this._mouseContext.getElement():void 0},e.prototype.falshOverlay=function(a,b){null!=a&&null!=a.id&&a._apiObj.flash(2*b)},e.prototype.rotateOverlay=function(a,b){null!=a&&null!=b&&null!=a._apiObj&&null!=a._apiObj.layer&&(a._apiObj.style.rotation=b,a._apiObj.layer.drawFeature(a._apiObj,a._apiObj.style))},e.prototype.addOverlay=function(a,b){var c,d=a.overlayType;b=b||this._featuresLayer;var e=b.name;switch(d){case NPMapLib.OVERLAY_TYPE_POLYLINE:c=this._createPolyline(a);break;case NPMapLib.OVERLAY_TYPE_POLYGON:c=this._createPolygon(a);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:c=this._createCircle(a);break;case NPMapLib.OVERLAY_TYPE_CIRCLESECTOR:c=this._creatCircleSector(a);break;case NPMapLib.OVERLAY_TYPE_ELLIPSE:c=this._createEllipse(a);break;case NPMapLib.OVERLAY_TYPE_LABEL:c=this._createLabel(a);break;case NPMapLib.OVERLAY_TYPE_MARKER:c=this._createMarker(a);break;case NPMapLib.OVERLAY_TYPE_BUBBLE:c=this._createBubble(a);break;case NPMapLib.OVERLAY_TYPE_INFOWIN:var f=a.getPosition();f=NPMapLib.T.setPoint(this.map,f);var g=new OpenLayers.Size(a._width,a._height),h=""+a.getTitle();h+=a.getContent();var i,j=a.getOffset();if(a.iscommon?(i=new OpenLayers.Popup.Anchored("npgis",new OpenLayers.LonLat(f.lon,f.lat),g,h,{size:new OpenLayers.Size(1,1),offset:new OpenLayers.Pixel(j.width,j.height)},!1,a._closeCallback),i.panMapIfOutOfView=!0):i=new OpenLayers.Popup.FramedCloud("npgis",new OpenLayers.LonLat(f.lon,f.lat),g,h,{size:new OpenLayers.Size(1,1),offset:new OpenLayers.Pixel(j.width,j.height)},!1,a._closeCallback,a.positionBlock),!i)return;i.closeOnMove=a._enableCloseOnClick,i.autoSize=a.autoSize,i.isAdaptation=a.isAdaptation,i.setSize(g),this.map.addPopup(i),i.map.paddingForPopups=new OpenLayers.Bounds(a.paddingForPopups.left,a.paddingForPopups.bottom,a.paddingForPopups.right,a.paddingForPopups.top),i.hide(),null!=a.getContentDom()&&i.setContentDom(a.getContentDom()),a.useDomStyle&&i.setOpacity(0),i.div.style.zIndex=99990,a.id=i.id,a._apiObj=i,this._popupList.push(a);break;case NPMapLib.OVERLAY_TYPE_ClusterPoints:a.layName=e?e:a.layName,new ClusterUtil(this.map,a);break;case NPMapLib.OVERLAY_TYPE_POINT:c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,a.lat),a);break;default:return void console.warn("不支持的覆盖物类型"+d)}if(c){if(this._indexNum++,c.style.graphicZIndex=this._indexNum,c.style.cursor=this.featureCursor,a._rotation&&(c.style.rotation=a._rotation),a._apiObj=c,a._graphicZIndex=this._indexNum,e){var k=this._selfLayers[e];k&&k.addFeatures([c])}else this._featuresLayer.addFeatures([c]);return NPMapLib.Managers.OverlayManager.addOverlay(a),this._openLayersEvents.triggerEvent("addoverlay"),!0}},e.prototype.refresh=function(a){if(a._apiObj){var b=a.overlayType;switch(b){case NPMapLib.OVERLAY_TYPE_POLYLINE:this._updatePolyLine(a);break;case NPMapLib.OVERLAY_TYPE_POLYGON:this._updatePolygon(a);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:this._updateCircle(a);break;case NPMapLib.OVERLAY_TYPE_CIRCLESECTOR:this._updateCircleSector(a);break;case NPMapLib.OVERLAY_TYPE_ELLIPSE:this._updateEllipse(a);break;case NPMapLib.OVERLAY_TYPE_LABEL:this._updateLabel(a);break;case NPMapLib.OVERLAY_TYPE_MARKER:this._updateMarker(a);break;case NPMapLib.OVERLAY_TYPE_INFOWIN:case NPMapLib.OVERLAY_TYPE_ClusterPoints:break;default:return void console.warn("不支持的覆盖物类型"+b)}a._rotation&&(a._apiObj.style.rotation=a._rotation),a._apiObj&&a._apiObj.layer&&a._apiObj.layer.drawFeature(a._apiObj)}},e.prototype._updateMarker=function(a){a._apiObj.style=this._getMarkerStyle(a)},e.prototype._updateLabel=function(a){var b=a.getStyle(),c={label:a.getContent(),fontSize:b.fontSize,fontFamily:b.fontFamily,fontWeight:b.isBold?"bold":"normal",labelXOffset:a.getOffset().width,labelYOffset:a.getOffset().height,labelAlign:"m",labelSelect:!0,graphicZIndex:a.getZIndex()};b.color&&(c.fontColor=b.color),a._apiObj.style=c},e.prototype._updatePolyLine=function(a){a._apiObj.style&&(a._apiObj.style.strokeColor=a.getColor(),a._apiObj.style.strokeWidth=a.getWeight(),a._apiObj.style.strokeOpacity=a.getOpacity(),a._apiObj.style.strokeDashstyle=c[a.getLineStyle()],a._apiObj.style.strokeLinecap=d[a.getArrowStyle()],a._apiObj.style.graphicZIndex=a.getZIndex())},e.prototype.openInfoWindow=function(a){a._apiObj instanceof OpenLayers.Popup&&a._apiObj.show()},e.prototype.hideInfoWindow=function(a){a._apiObj instanceof OpenLayers.Popup&&a._apiObj.hide(!1)},e.prototype.closeInfoWindow=function(a){a._apiObj instanceof OpenLayers.Popup&&this.map.removePopup(a._apiObj)},e.prototype.setInfoWindow=function(a){a._apiObj instanceof OpenLayers.Popup&&a._apiObj.setContentDom(a.getContentDom())},e.prototype.getInfoWindowBaseDiv=function(a){return a._apiObj instanceof OpenLayers.Popup?a._apiObj.div:void 0},e.prototype.setBackgroundColor=function(a,b){a._apiObj instanceof OpenLayers.Popup&&a._apiObj.setBackgroundColor(b)},e.prototype.setInfoWindowSize=function(a,b){a._apiObj instanceof OpenLayers.Popup&&(b=new OpenLayers.Size(b.width,b.height),a._apiObj.setSize(b))},e.prototype.getInfoWindowSize=function(a){if(a._apiObj instanceof OpenLayers.Popup){var b=a._apiObj.size;return new NPMapLib.Geometry.Size(b.w+2,b.h)}},e.prototype.updateInfoWindowSize=function(a){a._apiObj instanceof OpenLayers.Popup&&a._apiObj.updateSize()},e.prototype.addOverlays=function(a){for(var b=0;b<a.length;b++)this.addOverlay(a[b])},e.prototype.removeOverlay=function(a){if(a){if("NPMapLib.Symbols.InfoWindow"===a.CLASS_NAME&&a._apiObj)return void this.map.removePopup(a._apiObj);a._apiObj&&a._apiObj.layer&&(a._menu&&a._menu.hide(),a._apiObj.layer.removeFeatures([a._apiObj]),NPMapLib.Managers.OverlayManager.removeOverlay(a.id),this._openLayersEvents.triggerEvent("removeoverlay"))}},e.prototype.removeOverlays=function(a){for(var b=0;b<a.length;b++)this.removeOverlay(a[b])},e.prototype.getOverlays=function(){return NPMapLib.Managers.OverlayManager.getAllOverlays()},e.prototype.removerAllOverlaysByLayerName=function(a){for(var b=this.map.getLayersByName(a),c=0;c<b.length;c++)b[c].removeAllFeatures()},e.prototype.clearOverlays=function(){if(this._popupList){for(var a=0;a<this._popupList.length;a++)this.closeInfoWindow(this._popupList[a]),delete this._popupList[a];this._popupList=[]}},e.prototype.showOverlay=function(a){a&&null!=a._apiObj&&null!=a._apiObj.layer&&(a._apiObj.style.display="block",a._apiObj.layer.drawFeature(a._apiObj),a._apiObj.markerObj&&a._apiObj.markerObj.display(!0))
},e.prototype.hideOverlay=function(a){a&&null!=a._apiObj&&null!=a._apiObj.layer&&(a._apiObj.style.display="none",a._apiObj.layer.drawFeature(a._apiObj),a._apiObj.markerObj&&a._apiObj.markerObj.display(!1))},e.prototype.setOverlayPosition=function(a,b){if(a&&null!=a._apiObj)if(a._apiObj instanceof OpenLayers.Popup){var c=new OpenLayers.LonLat(b.lon,b.lat);a._apiObj.lonlat=c,a._apiObj.updatePosition()}else a._apiObj.move(new OpenLayers.LonLat(b.lon,b.lat))},e.prototype.getOverlayPosition=function(a){if(a){var b=a;if(b._apiObj&&b._apiObj.geometry&&b._apiObj.geometry instanceof OpenLayers.Geometry.Point)return new NPMapLib.Geometry.Point(b._apiObj.geometry.x,b._apiObj.geometry.y);if(b._apiObj&&b._apiObj.geometry&&b._apiObj.geometry instanceof OpenLayers.Geometry.Polygon){for(var c=[],d=0;d<b._apiObj.geometry.components.length;d++){for(var e=b._apiObj.geometry.components[d].components,f=[],g=0;g<e.length;g++)f.push(new NPMapLib.Geometry.Point(e[g].x,e[g].y));c.push(f)}return 1===c.length?c[0]:c}if(b._apiObj&&b._apiObj.geometry&&b._apiObj.geometry instanceof OpenLayers.Geometry.LineString){for(var h=b._apiObj.geometry.components,i=[],j=0;j<h.length;j++)i.push(new NPMapLib.Geometry.Point(h[j].x,h[j].y));return i}}},e.prototype.getInfoWindow=function(){var a=[];for(var b in this._popupList)"NPMapLib.Symbols.InfoWindow"===this._popupList[b].CLASS_NAME&&a.push(this._popupList[b]);return a},e.prototype.showMarkerLabel=function(a){a instanceof NPMapLib.Symbols.Marker&&a._label&&a._label._content&&(a._apiObj.style.label=a._label._content,a._apiObj.layer.drawFeature(a._apiObj))},e.prototype.hideMarkerLabel=function(a){a instanceof NPMapLib.Symbols.Marker&&(a._apiObj.style.label="",a._apiObj.layer.drawFeature(a._apiObj))},e.prototype._setMouseCursor=function(a){this.map&&(this.map.div.style.cursor=a)},e.prototype.getCursor=function(){return this.map?this.map.div.style.cursor:void 0},e.prototype.setCursor=function(a){this.defaultMapCursor=a,this._setMouseCursor(a)},e.prototype._createLayer=function(a){var b={};if(a._opts=a._opts||a.opts,a._opts){for(var c in a._opts)if(a._opts.hasOwnProperty(c)){var d=a._opts[c];void 0!==d&&(b[c]=d)}if(a._opts.fullExtent&&(b.maxExtent=new OpenLayers.Bounds(a._opts.fullExtent[0],a._opts.fullExtent[1],a._opts.fullExtent[2],a._opts.fullExtent[3])),!a._opts.centerPoint&&b.maxExtent){var e=b.maxExtent.getCenterLonLat();a._opts.centerPoint=[e.lon,e.lat]}a._opts.tilePixels&&(b.tileSize=new OpenLayers.Size(a._opts.tilePixels,a._opts.tilePixels)),a._opts.tileOrigin&&(b.tileOrigin=new OpenLayers.LonLat(a._opts.tileOrigin[0],a._opts.tileOrigin[1])),a._opts.origin&&(b.tileOrigin=new OpenLayers.LonLat(a._opts.origin[0],a._opts.origin[1]))}var f=this._opts.centerPoint;this._opts=b,f&&(this._opts.centerPoint=f);var g=null;return"NPMapLib.Layers.WMSLayer"===a.CLASS_NAME&&(g=this.WMSLayer(a,b)),"NPMapLib.Layers.WMTSLayer"===a.CLASS_NAME&&(g=this.WMTSLayer(a,b)),"NPMapLib.Layers.VectorGMLLayer"===a.CLASS_NAME&&(g=this.VectorGMLLayer(a,b)),"NPMapLib.Layers.ArcgisTileLayer"===a.CLASS_NAME&&(g=this.ArcgisCacheTile(a,b)),"NPMapLib.Layers.EzMapTileLayer"===a.CLASS_NAME&&(g=this._pgisLayer(a,b)),"NPMapLib.Layers.GoogleMapTileLayer"===a.CLASS_NAME&&(g=this._googleLayer(a,b)),"NPMapLib.Layers.BaiduTileLayer"===a.CLASS_NAME&&(g=this._baiduLayer(a,b)),"NPMapLib.Layers.BingTileLayer"===a.CLASS_NAME&&(g=this._bingLayer(a,b)),"NPMapLib.Layers.GaoDeLayer"===a.CLASS_NAME&&(g=this._gaodeLayer(a,b)),"NPMapLib.Layers.ImageLayer"===a.CLASS_NAME&&(g=this._imageLayer(a,a._opts)),"NPMapLib.Layers.GoogleOffLineLayer"===a.CLASS_NAME&&(g=this._googleOffLayer(a,b)),"NPMapLib.Layers.SuperMapLayer"===a.CLASS_NAME&&(g=this._supermapLayer(a,b)),"NPMapLib.Layers.TDMapLayer"===a.CLASS_NAME&&(g=this._tdmapLayer(a,b)),"NPMapLib.Layers.QQMapLayer"===a.CLASS_NAME&&(g=this._qqmapLayer(a,b)),"NPMapLib.Layers.HeatMapLayer"===a.CLASS_NAME&&(g=this._heatMapLayer(a,b)),"NPMapLib.Layers.OSMLayer"===a.CLASS_NAME&&(g=new OpenLayers.Layer.OSM(a.name,a.url,b)),this._opts.centerPoint?this.map.originCenter=this._opts.centerPoint:a._opts.centerPoint&&(this.map.originCenter=a._opts.centerPoint),g},e.prototype.addLayer=function(a){if(!a.isAddToMap)return void(this._selfLayers[a.name]=a);if("NPMapLib.Layers.OverlayLayer"===a.CLASS_NAME){if(a.name){var b=this.map.getLayersByName(a.name);if(b.length>0)return}var c={},d={zIndexing:!0};c.rendererOptions=d;var e=this;if(a.useCluster){c={isClusterLayer:!0,eventListeners:{featureover:function(b){if(e._measureControl&&e._measureControl.active||e._drawControl&&e._drawControl.active||e._currentZoomControl&&this._currentZoomControl.active||e._setMouseCursor("pointer"),b.feature.data.isStatistics)return!1;if(b.feature.cluster&&1!==b.feature.cluster.length){if(a.clusteronmouseover){for(var c=[],d={strokeOpacity:1,strokeColor:"orange",fillColor:"red",pointRadius:3},f=0;f<b.feature.cluster.length;f++)b.feature.cluster[f].style=d,c.push(b.feature.cluster[f]);b.feature.data.cluster=c,a.clusteronmouseover(b.feature.data)}}else{var g=b.feature.data;a.onmouseover(g,""===b.feature.style.externalGraphic||"undefined"==typeof b.feature.style.externalGraphic)}return!1},featureout:function(b){if(e._measureControl&&e._measureControl.active||e._drawControl&&e._drawControl.active||e._currentZoomControl&&e._currentZoomControl.active||e._setMouseCursor(e.defaultMapCursor),b.feature.data.isStatistics)return!1;if(!b.feature.cluster||1===b.feature.cluster.length){var c=b.feature.data;a.onmouseout(c,""===b.feature.style.externalGraphic||"undefined"==typeof b.feature.style.externalGraphic)}return!1},featureclick:function(b){if(!e._navigator.isDrag&&!a.isHideContext){var c=b.feature,d=c.layer,f=d.clicentData.tempcluster;if(f=f?f:[],c.cluster&&c.cluster.length>1){var g={fontColor:"white",title:name,opacity:.8,graphicHeight:29,graphicWidth:29},h={strokeOpacity:1,cursor:e.featureCursor,strokeColor:"orange",fillColor:"red",pointRadius:3};if("zoom"===a.clusterClickModel)if(a.selectZoom){var i=new OpenLayers.LonLat(c.geometry.x,c.geometry.y);d.map.setCenter(i,a.selectZoom)}else{var j=this.map.getPixelFromLonLat({lon:c.geometry.getCentroid().x,lat:c.geometry.getCentroid().y});d.map.zoomTo(d.map.getZoom()+1,j)}else{if(c.cluster.length>500)return window.alert("聚合点位过多，请放大地图"),!1;for(var k=0;k<f.length;k++)f[k].style=g;d.removeFeatures(f,{silent:!0});var l=c.cluster.slice();f=[];for(var m=0;m<l.length;m++)f[m]=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(l[m].geometry.x,l[m].geometry.y),l[m]),l[m]._apiObj=f[m];d.addFeatures(f,{silent:!0});for(var n=0;n<f.length;n++)f[n].style=h,f[n].layer.drawFeature(f[n]);d.clicentData.tempcluster=f}}else if(c.attributes.count>1&&"zoom"===a.clusterClickModel)if(a.selectZoom){var o=new OpenLayers.LonLat(c.geometry.x,c.geometry.y);d.map.setCenter(o,a.selectZoom)}else{var p=this.map.getPixelFromLonLat({lon:c.geometry.getCentroid().x,lat:c.geometry.getCentroid().y});d.map.zoomTo(d.map.getZoom()+1,p)}var q;return c.cluster?c.cluster&&(1===c.cluster.length?q=c.cluster[0]:0===c.cluster.length&&(c.data.feature._apiObj=c,q=c.data.feature)):q=c.data,(!c.cluster||c.cluster.length<2)&&q&&!c.data.isStatistics&&"function"==typeof a.onSelect&&a.onSelect(q,""===b.feature.style.externalGraphic||"undefined"==typeof b.feature.style.externalGraphic),!1}}}};for(var f=[],g=a.statistics,h=g.length-1;h>=0;h--){var i=NPMapLib.T.setPoint(e,{lon:g[h].x,lat:g[h].y});f.push({x:i.lon,y:i.lat,label:g[h].label})}var j=new OpenLayers.Strategy.AnimatedCluster({threshold:a.threshold||5,distance:a.distance,animationMethod:OpenLayers.Easing.Expo.easeOut,animationDuration:10,maxZoom:a.maxZoom||this.map.maxZoom,minZoom:a.minZoom||this.map.minZoom,statistics:f,isAsynchronous:a.isAsynchronous,clusterClickModel:a.clusterClickModel,minClusterCount:a.minClusterCount,callbackFun:a.opts.success});c.strategies=[j],c.rendererOptions=d;var k={context:{getCount:function(b){if(a.isHideContext)return"";if(b.attributes.isStatistics)return b.attributes.count;var c=b.attributes.count?1===b.attributes.count?"":b.attributes.count:"";return""===c&&(c=a.getContent(b)),c},getUrl:function(b){if(b.attributes.isStatistics){var c=1===b.attributes.count?2:b.attributes.count,d=b.data;return a.getUrl(c,d)}var e=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null,f=b.cluster&&1===b.cluster.length?b.cluster[0]:b.data;return a.getUrl(e,f)},getWidth:function(b){if(b.attributes.isStatistics){var c=1===b.attributes.count?2:b.attributes.count,d=b.data,e=a.getImageSize(c,d);return e.width}var f=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null,g=b.cluster&&1===b.cluster.length?b.cluster[0]:b.data,h=a.getImageSize(f,g);return h.width},getHeight:function(b){if(b.attributes.isStatistics){var c=1===b.attributes.count?2:b.attributes.count,d=b.data,e=a.getImageSize(c,d);return e.height}var f=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null,g=b.cluster&&1===b.cluster.length?b.cluster[0]:b.data,h=a.getImageSize(f,g);return h.height},getCursor:function(){return e.featureCursor},getRotation:function(b){if(b.attributes.isStatistics){var c=1===b.attributes.count?2:b.attributes.count,d=b.data;return a.getRotation(c,d)}var e=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null,f=b.cluster&&1===b.cluster.length?b.cluster[0]:b.data;return a.getRotation(e,f)},getgraphicYOffset:function(b){if(b.attributes.isStatistics){var c=1===b.attributes.count?2:b.attributes.count,d=b.data,e=a.getImageSize(c,d);return null===c?-e.height/2:-e.height}var f=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null,g=b.cluster&&1===b.cluster.length?b.cluster[0]:b.data,h=a.getImageSize(f,g);return null===f?-h.height/2:-h.height},getlabelYOffset:function(b){if(b.attributes.isStatistics){var c=1===b.attributes.count?2:b.attributes.count,d=b.data,e=a.getImageSize(c,d);return e.height/2+m}var f=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null,g=b.cluster&&1===b.cluster.length?b.cluster[0]:b.data,h=a.getImageSize(f,g);return f?h.height/2+m:a.customLabelOffset?a.customLabelOffset.height:a.getCustomLabelOffset instanceof Function?a.getCustomLabelOffset(g).height:void 0},getLabelFontColor:function(b){var c=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null;return c?a.defaultStyle.fontColor:a.defaultStyle.customLabelFontColor?a.defaultStyle.customLabelFontColor:a.defaultStyle.fontColor},getFontSize:function(b){var c=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null;return c?a.defaultStyle.fontSize:a.defaultStyle.customFontSize?a.defaultStyle.customFontSize:a.defaultStyle.fontSize},getlabelXOffset:function(b){var c=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null;return!c&&a.customLabelOffset?a.customLabelOffset.width:void 0},getTitle:function(b){var c=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null;return c?void 0:a.opts.getTitle(b.data)},getlabelbg:function(b){var c=b.attributes.count?1===b.attributes.count?null:b.attributes.count:null;return c?void 0:a.getBackGroundColor(b.data)}}},l=-1!==navigator.appName.indexOf("Microsoft Internet Explorer")&&document.all,m=l?-1:0;a.labelYOffset&&(m=a.labelYOffset),c.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({externalGraphic:"${getUrl}",graphicWidth:"${getWidth}",graphicHeight:"${getHeight}",graphicOpacity:1,graphicYOffset:"${getgraphicYOffset}",label:"${getCount}",labelYOffset:"${getlabelYOffset}",labelXOffset:"${getlabelXOffset}",labelSelect:!0,fontColor:"${getLabelFontColor}",fontSize:"${getFontSize}",rotation:"${getRotation}",labelBackgroundColor:"${getlabelbg}",title:"${getTitle}"},k)})}c.renderers=["SVGExtended","VMLExtended","CanvasExtended"];var n=new OpenLayers.Layer.Vector(a.name,c);return this.map.addLayers([n]),this._selfLayers[a.name]=n,a._apiObj=n,a.clusterStrategy=j,void(a.useCluster||this._registerLayerEvent(n,a.isAddSFControl))}var o=this._createLayer(a);if(null!=o){if(this.map.addLayer(o),this._selfLayers[a.name]=o,a._apiObj=o,"EPSG:900913"===this.map.getProjection()&&this.map.originCenter[0]<180){var p=NPMapLib.T.setPoint(this,{lon:this.map.originCenter[0],lat:this.map.originCenter[1]});this.map.originCenter=[p.lon,p.lat]}this.fullExtent(this.opts.defaultZoom),"EPSG:4326"===this.map.getProjection()&&(NPMap.PROJECT="4326")}},e.prototype._googleOffLayer=function(b,c){c.getURL=a;var d=new OpenLayers.Layer.TMS(b.name,b.url,c);return d},e.prototype._imageLayer=function(a,b){var c=new OpenLayers.Bounds(b.fullExtent[0],b.fullExtent[1],b.fullExtent[2],b.fullExtent[3]),d=new OpenLayers.Layer.Image(a.name,a.url,c,new OpenLayers.Size(b.size[0],b.size[1]));return d},e.prototype._bingLayer=function(a,b){return new OpenLayers.Layer.Bing(b)},e.prototype._baiduLayer=function(a,b){return new OpenLayers.Layer.Baidu(a.name,a.url,b)},e.prototype._gaodeLayer=function(a,b){return new OpenLayers.Layer.gaode(a.name,a.url,b)},e.prototype._heatMapLayer=function(a,b){return new OpenLayers.Layer.Heatmap(a.name,this.map,this.map.baselayer,{visible:a.visible,radius:a.radius},b)},e.prototype._googleLayer=function(a,b){return new OpenLayers.Layer.OSM(a.name,a.url,b)},e.prototype._supermapLayer=function(a,b){return new OpenLayers.Layer.SuperMap(a.name,a.url,b)},e.prototype._pgisLayer=function(a,b){return b.maxResolution=2,b.tileOrigin||(b.tileOrigin=new OpenLayers.LonLat(0,0)),new OpenLayers.Layer.TMS_PGIS(a.name,a.url,b)},e.prototype._tdmapLayer=function(a,b){return new OpenLayers.Layer.TDTLayer(a.name,a.url,b)},e.prototype._qqmapLayer=function(a,b){return new OpenLayers.Layer.QQMap(a.name,a.url,b)},e.prototype.addLayers=function(a){if(a)for(var b=0;b<a.length;++b)this.addLayer(a[b],!1)},e.prototype.removeLayer=function(a){var b=this.map.getLayer(a);if(b)this.map.removeLayer(b,!1);else{var c=this.map.getLayersByName(a.name);c&&c.length>0&&this.map.removeLayer(c[0],!1)}},e.prototype.removeLayerByName=function(a){var b=this.map.getLayersByName(a);b&&b.length>0&&this.map.removeLayer(b[0],!1)},e.prototype.getLayer=function(a){return this.map.getLayer(a)},e.prototype.getLayerByName=function(a){var b=this.map.getLayersByName(a);return b&&b.length>0?b[0]:null},e.prototype.ArcgisCacheTile=function(a,b){return new OpenLayers.Layer.ArcGISCache(a.name,a.url,b)},e.prototype.GoogleOffLineLayer=function(b,c){c.getURL=a;var d=new OpenLayers.Layer.TMS(b.name,b.url,c);return d},e.prototype.WMTSLayer=function(a,b){var c=new OpenLayers.Layer.WMTS({name:a.name,url:a.url,layer:b.layerName,format:"image/png",matrixSet:"CustomCRS4326ScaleXiAn_GOVMAP_2016",resolutions:b.resolutions,style:b.style,serviceMode:b.serviceMode,projection:b.projection,tileOrigin:new OpenLayers.LonLat(b.tileOrigin.lon,b.tileOrigin.lat),tileSize:new OpenLayers.Size(b.tileSize[0],b.tileSize[1])});return c},e.prototype.WMSLayer=function(a,b){var c=new OpenLayers.Layer.WMS(a.name,a.url,{layers:b.layerName,format:b.format,tiled:b.tiled,transparent:!1,version:b.version?b.version:"1.1.1"},{tileSize:new OpenLayers.Size(b.mapUnitPixels,b.mapUnitPixels),projection:b.projection,buffer:b.buffer,maxZoomLevel:b.maxZoomLevel,reproject:b.reproject,isBaseLayer:b.isBaseLayer});return c},e.prototype.VectorGMLLayer=function(a){var b=new OpenLayers.Layer.Vector(a.name,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.GML})});return b},e.prototype.VectorWFSLayer=function(){var a=new OpenLayers.Layer.Vector("WFS",{strategies:[new OpenLayers.Strategy.BBOX],protocol:new OpenLayers.Protocol.WFS({url:"http://demo.opengeo.org/geoserver/wfs",featureType:"tasmania_roads",featureNS:"http://www.openplans.org/topp"})});return a},e.prototype.pixelToPoint=function(a){var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.x,a.y));return new NPMapLib.Geometry.Point(b.lon,b.lat)},e.prototype.pointToPixel=function(a){var b=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a.lon,a.lat));return new NPMapLib.Geometry.Pixel(b.x,b.y)},e.prototype.drawing=function(a,b,c){var d="";switch(a._mode){case NPMapLib.DRAW_MODE_RECT:this._setMouseCursor("crosshair"),d="rect";break;case NPMapLib.DRAW_MODE_CIRCLE:this._setMouseCursor("crosshair"),d="circle";break;case NPMapLib.DRAW_MODE_CIRCLE_DIAMETER:this._setMouseCursor("crosshair"),d="circle2";break;case NPMapLib.DRAW_MODE_POLYLINE:this._setMouseCursor("crosshair"),d="line";break;case NPMapLib.DRAW_MODE_POLYLGON:this._setMouseCursor("crosshair"),d="polygon";break;case NPMapLib.DRAW_MODE_FREEHAND:this._setMouseCursor("crosshair"),d="freehand";break;case NPMapLib.DRAW_MODE_NONE:d=""}this._drawControl&&this.map.removeControl(this._drawControl);for(var e in this._drawControls)if(e===d){var f=this;if(this._drawControl=this._drawControls[e],c=c||{},c.cursor=c.cursor||"crosshair",c){var g=this._drawControl.handlerOptions.style;for(var h in c)if(c.hasOwnProperty(h)){var i=c[h];void 0!==i&&(g[h]=i)}this._drawControl.handlerOptions.style=g}this.map.addControl(this._drawControl),this._drawControl.activate(),this._drawControl.events.listeners={},this._unregisterdblclick(),this._drawControl.events.on({featureadded:function(d){f._setMouseCursor(f.defaultMapCursor);var e=d.feature.geometry,g=e.bounds,h=new NPMapLib.Geometry.Extent(g.left,g.bottom,g.right,g.top);h=NPMapLib.T.getExtent(f,h);var i=f._getNPGISGeometry(a._mode,e,c);if(d.feature.layer.removeFeatures(d.feature),b instanceof Function)if(a._mode===NPMapLib.DRAW_MODE_CIRCLE||a._mode===NPMap.DRAW_MODE_CIRCLE_DIAMETER){for(var j=[],k=e.components[0].components,l=0;l<k.length;l++)j.push(new NPMapLib.Geometry.Point(k[l].x,k[l].y));var m=e.getCentroid(),n=new OpenLayers.Geometry.Point(k[0].x,k[0].y),o=new OpenLayers.Geometry.Point(m.x,m.y),p=new OpenLayers.Projection("EPSG:900913");n.transform(f.map.getProjection(),p),o.transform(f.map.getProjection(),p);var q=n.distanceTo(o);m=NPMapLib.T.getPoint(f,{lon:m.x,lat:m.y});var r=m.lon+","+m.lat+","+q;b(h,i,r,NPMapLib.T.getPoints(f,j))}else{for(var s=i.getPath(),t="",u=0;u<s.length;u++)t+=s[u].toString()+",";b(h,i,t.substring(0,t.length-1))}}})}else this._drawControls[e].deactivate()},e.prototype._getStrPoints=function(a,b){var c="";switch(a){case NPMapLib.DRAW_MODE_POLYLINE:for(var d=b.components,e=0;e<d.length;e++)e<d.length-1&&(c+=d[e].x+","+d[e].y+","),e===d.length-1&&(c+=d[e].x+","+d[e].y);break;case NPMapLib.DRAW_MODE_POLYLGON:case NPMapLib.DRAW_MODE_RECT:for(var f=b.components[0].components,g=0;g<f.length;g++)g<f.length-1&&(c+=f[g].x+","+f[g].y+","),g===f.length-1&&(c+=f[g].x+","+f[g].y);break;case NPMapLib.DRAW_MODE_CIRCLE:var h=b.bounds,i=h.getCenterLonLat(),j=b.components[0].components;if(j.length>0){var k=new OpenLayers.Geometry.Point(i.lon,i.lat),l=new OpenLayers.Geometry.Point(j[0].x,j[0].y),m=new OpenLayers.Projection("EPSG:900913");k.transform(this.map.getProjection(),m),l.transform(this.map.getProjection(),m);var n=k.distanceTo(l);c+=i.lon+","+i.lat+","+n}}return c},e.prototype._getNPGISGeometry=function(a,b,c){switch(a){case NPMapLib.DRAW_MODE_POLYLINE:var d=b.components,e=this._getPoint(d);return new NPMapLib.Geometry.Polyline(NPMapLib.T.getPoints(this,e),c);case NPMapLib.DRAW_MODE_POLYLGON:case NPMap.DRAW_MODE_FREEHAND:case NPMapLib.DRAW_MODE_RECT:var f=b.components[0].components,g=this._getPoint(f);return new NPMapLib.Geometry.Polygon(NPMapLib.T.getPoints(this,g),c);case NPMapLib.DRAW_MODE_CIRCLE:case NPMap.DRAW_MODE_CIRCLE_DIAMETER:return this._getCircleGeometry(a,b,c)}},e.prototype._getCircleGeometry=function(a,b,c){var d=b.bounds,e=d.getCenterLonLat(),f=b.components[0].components;if(f.length>0){var g=new OpenLayers.Geometry.Point(e.lon,e.lat),h=new OpenLayers.Geometry.Point(f[0].x,f[0].y),i=new OpenLayers.Projection("EPSG:900913");g.transform(this.map.getProjection(),i),h.transform(this.map.getProjection(),i);var j=g.distanceTo(h);return new NPMapLib.Geometry.Circle(NPMapLib.T.getPoint(this,e),j,c)}},e.prototype._getPoint=function(a){for(var b=[],c=0;c<a.length;c++)b.push(new NPMapLib.Geometry.Point(a[c].x,a[c].y));return b},e.prototype._initMeasureControl=function(){var a={Point:{pointRadius:4,graphicName:"circle",fillColor:"white",fillOpacity:1,strokeWidth:.5,strokeOpacity:1,strokeColor:"red",cursor:"inherit"},Line:{strokeWidth:1.5,strokeOpacity:1,strokeColor:"#ff0000"},Polygon:{strokeWidth:1.5,strokeOpacity:1,fillOpacity:.3,fillColor:"yellow",strokeColor:"#ff0000"}},b=new OpenLayers.Style;b.addRules([new OpenLayers.Rule({symbolizer:a})]);var c=new OpenLayers.StyleMap({"default":b});this._measureControls={Path:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{displayUnits:"km",geodesic:!0,persist:!0,handlerOptions:{layerOptions:{styleMap:c}}}),Polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{displayUnits:"km",persist:!1,geodesic:!0,handlerOptions:{layerOptions:{styleMap:c}}})}},e.prototype._getMesureLength=function(a){var b="km",c=this.map.getUnits(),d=OpenLayers.INCHES_PER_UNIT[b];if(d){var e=OpenLayers.INCHES_PER_UNIT[c];a*=e/d}return a},e.prototype.removeMeasureFeatures=function(){for(var a=0;a<this._measureFeatures.length;a++)this._measureFeatures[a]instanceof OpenLayers.Feature.Vector?this._measureFeatures[a].layer&&this._measureFeatures[a].layer.removeFeatures(this._measureFeatures[a]):this.removeOverlay(this._measureFeatures[a]),delete this._measureFeatures[a];this._measureFeatures=[]},e.prototype.centerAtMouse=function(){this.map.panTo(this.map.mousePosition)},e.prototype.measure=function(a,b,c){var d="",e=OpenLayers.Util.getImageLocation("ruler.cur");switch(a._mode){case NPMapLib.MEASURE_MODE_DISTANCE:d="Path",this._setMouseCursor("url("+e+"), crosshair");break;case NPMapLib.MEASURE_MODE_AREA:this._setMouseCursor("url("+e+"), crosshair"),d="Polygon";break;case NPMapLib.MEASURE_MODE_LOCATION:d="Point"}var f,g,h,i,j=this,k=[],l=-1!==navigator.appName.indexOf("Microsoft Internet Explorer")&&document.all;if(l){var m=navigator.appVersion.split(";")[1].replace(/[ ]/g,"");i="MSIE6.0"===m||"MSIE7.0"===m||"MSIE8.0"===m}var n=i?new NPMapLib.Geometry.Size(0,10):new NPMapLib.Geometry.Size(0,4);this.removeOverlays(this.activMarkers),this._measureControl&&this.map.removeControl(this._measureControl);for(var o in this._measureControls)o===d?(this._measureControl=this._measureControls[o],this.map.addControl(this._measureControl),this._measureControl.activate(),this._measureControl.events.listeners={},this._unregisterdblclick(),this._measureControl.events.on({measure:function(a){if(0!==a.measure){var d=[],e=[],i=a.geometry,l={pointRadius:4,graphicName:"circle",fillColor:"white",fillOpacity:1,strokeWidth:1.5,strokeOpacity:1,strokeColor:"red"},m=i.components[i.components.length-2],o=i.components[i.components.length-1];if(j.activMarkers.length>0&&1===a.order){var p=j.activMarkers[j.activMarkers.length-1];p.getPosition().lon===o.x&&p.getPosition().lat===o.y&&j.removeOverlay(p)}if(j.activMarkers=[],1===a.order){var q=new NPMapLib.Geometry.Point(m.x,m.y),r=new NPMapLib.Geometry.Point(o.x,o.y),s=r;r=NPMapLib.T.getPoint(j,r);var t="CN"===NPMap.CULTURE?j._units[a.units]:"千米"===j._units[a.units]?"km":"m";label=("CN"===NPMap.CULTURE?"总长":"Total:")+a.measure.toFixed(1)+t;var u=new NPMapLib.Geometry.Size(20,10);a.measure>=1e3?(g=new NPMapLib.Geometry.Size(110,15),h="110_15.gif"):a.measure>=100?(g=new NPMapLib.Geometry.Size(100,15),h="100_15.gif"):a.measure>=10?(g=new NPMapLib.Geometry.Size(90,15),h="90_15.gif"):(g=new NPMapLib.Geometry.Size(80,15),h="80_15.gif");var v=OpenLayers.Util.getImageLocation(h),w=new NPMapLib.Symbols.Icon(v,g),x=new NPMapLib.Symbols.Label(label);x.setStyle({FontSize:12,FontFamily:"宋体",Color:"red",Align:"center",IsBold:!0,BordColor:"red",offset:n});var y=new NPMapLib.Symbols.Marker(r);if(y.setIcon(w),y.setLabel(x),y.setOffset(q.lon<s.lon?new NPMapLib.Geometry.Size(u.width/2+g.width/2,0):new NPMapLib.Geometry.Size(-u.width/2-g.width/2-8,0)),j.addOverlay(y),j._measureFeatures.push(y),k.push(y),i.components.length>0)for(var z=0;z<i.components.length;z++)d.push(new NPMapLib.Geometry.Point(i.components[z].x,i.components[z].y)),e.push(new OpenLayers.Geometry.Point(i.components[z].x,i.components[z].y));var A=new OpenLayers.Geometry.MultiPoint(e);f=new OpenLayers.Feature.Vector(A,null,l),d=NPMapLib.T.getPoints(j,d),E=new NPMapLib.Geometry.Polyline(d,{color:"red",strokeLinecap:"round"}),"function"==typeof b?(j.addOverlay(E),E.mapId=j.mapId,E.setZIndex(-1),this.map.getLayersByName("featureLayer")[0].addFeatures([f]),b(label,d)):(j.addOverlay(E),E.mapId=j.mapId,E.setZIndex(-1),this.map.getLayersByName("featureLayer")[0].addFeatures([f])),j._measureFeatures.push(E),j._measureFeatures.push(f),k.push(E);var B=new NPMapLib.Geometry.Size(12,12),C=new NPMapLib.Symbols.Icon(OpenLayers.Util.getImageLocation("close.gif"),B);closeMarker=new NPMapLib.Symbols.Marker(r),closeMarker.setIcon(C),closeMarker.setOffset(q.lon<s.lon?new NPMapLib.Geometry.Size(u.width/2+g.width+8,-1.5):new NPMapLib.Geometry.Size(-u.width/2,-1.5)),closeMarker.mapId=j.mapId,NPMapLib.MapMeasure_CloseMarkDispaly&&j.addOverlay(closeMarker),k.push(closeMarker),j._measureFeatures.push(closeMarker),closeMarker.addEventListener(NPMapLib.MARKER_EVENT_CLICK,function(){j.removeOverlays(k),this.map.getLayersByName("featureLayer")[0].removeFeatures(f),"function"==typeof c&&c()})}else{if(label="CN"===NPMap.CULTURE?parseFloat(a.measure).toFixed(2)+"平方"+j._units[a.units]:parseFloat(a.measure).toFixed(2)+("千米"===j._units[a.units]?"k㎡":"㎡"),i.components.length>0&&i.components[0].components.length>0)for(var D=0;D<i.components[0].components.length;D++){var E=i.components[0].components[D];d.push(new NPMapLib.Geometry.Point(E.x,E.y)),e.push(new OpenLayers.Geometry.Point(E.x,E.y))}A=new OpenLayers.Geometry.MultiPoint(e),f=new OpenLayers.Feature.Vector(A,null,l),d=NPMapLib.T.getPoints(j,d),E=new NPMapLib.Geometry.Polygon(d,{color:"red",fillColor:"yellow",opacity:.6,fillOpacity:.3}),k.push(E),"function"==typeof b?(j.addOverlay(E),this.map.getLayersByName("featureLayer")[0].addFeatures([f]),b(label,d)):(j.addOverlay(E),this.map.getLayersByName("featureLayer")[0].addFeatures([f])),j._measureFeatures.push(E),j._measureFeatures.push(f);var F=E._apiObj.geometry.bounds,G=F.getCenterLonLat(),H=new NPMapLib.Symbols.Label(label);H.setStyle({borderSize:2,bgColor:"green",color:"red",IsBold:!0,offset:n}),a.measure>=1e3?(g=new NPMapLib.Geometry.Size(110,15),h="110_15.gif"):a.measure>=100?(g=new NPMapLib.Geometry.Size(100,15),h="100_15.gif"):a.measure>=10?(g=new NPMapLib.Geometry.Size(90,15),h="90_15.gif"):(g=new NPMapLib.Geometry.Size(80,15),h="80_15.gif");var I=new NPMapLib.Symbols.Icon(OpenLayers.Util.getImageLocation(h),g),J=new NPMapLib.Symbols.Marker(NPMapLib.T.getPoint(j,new NPMapLib.Geometry.Point(G.lon,F.top)));J.setIcon(I),J.setLabel(H),j.addOverlay(J),j._measureFeatures.push(J),k.push(J);var K=new NPMapLib.Geometry.Size(12,12),L=new NPMapLib.Symbols.Icon(OpenLayers.Util.getImageLocation("close.gif"),K),M=[];M.offset=new NPMapLib.Geometry.Size(g.width/2+8,-1.5),closeMarker=new NPMapLib.Symbols.Marker(NPMapLib.T.getPoint(j,new NPMapLib.Geometry.Point(G.lon,F.top)),M),closeMarker.setIcon(L),closeMarker.mapId=j.mapId,NPMapLib.MapMeasure_CloseMarkDispaly&&j.addOverlay(closeMarker),k.push(closeMarker),j._measureFeatures.push(closeMarker)}closeMarker.addEventListener(NPMapLib.MARKER_EVENT_CLICK,function(){j.removeOverlays(k),this.map.getLayersByName("featureLayer")[0].removeFeatures(f),"function"==typeof c&&c()})}},measureProcess:function(a){if(!i&&1===a.order){var b=a.measure.toFixed(1)+j._units[a.units];if(0==a.measure.toFixed(1)&&(b="CN"===NPMap.CULTURE?"起点":"Origin"),0===a.measure){var c=new NPMapLib.Geometry.Size(35,15);h="35_15.gif"}else a.measure>=1e3?(c=new NPMapLib.Geometry.Size(80,15),h="80_15.gif"):a.measure>=100?(c=new NPMapLib.Geometry.Size(70,15),h="70_15.gif"):a.measure>=10?(c=new NPMapLib.Geometry.Size(60,15),h="60_15.gif"):(c=new NPMapLib.Geometry.Size(50,15),h="50_15.gif");var d=OpenLayers.Util.getImageLocation(h),e=new NPMapLib.Symbols.Icon(d,c),f=new NPMapLib.Symbols.Label(b);f.setStyle({FontSize:12,FontFamily:"宋体",Color:"red",Align:"center",IsBold:!0,BordColor:"red",offset:n});var g=new NPMapLib.Geometry.Point(a.point.x,a.point.y);g=NPMapLib.T.getPoint(j,g);var l=new NPMapLib.Symbols.Marker(g);l.setIcon(e),l.setLabel(f),j.addOverlay(l),j._measureFeatures.push(l),k.push(l),j.activMarkers.push(l)}}})):this._measureControls[o].deactivate()},e.prototype._createPolyline=function(a){if(a instanceof NPMapLib.Geometry.Polyline){var b=NPMapLib.T.setPoints(this,a.getPath()),c=new OpenLayers.Geometry.LineString(this._castPoints(b));if(b&&!(b.length<=0)){var d=this._getPolylineStyle(a),e=new OpenLayers.Feature.Vector(c,a,d);return e}}},e.prototype._getPolylineStyle=function(a){var b=a.getArrowStyle(),e={strokeColor:a.getColor(),strokeWidth:a.getWeight(),strokeOpacity:a.getOpacity(),strokeDashstyle:c[a.getLineStyle()],graphicName:"triangle",pointRadius:2*a.getWeight(),arrowStyle:b};return d[b]&&(e.strokeLinecap=d[b]),e},e.prototype._updatePolygon=function(a){a._apiObj.style=this._getPolygonStyle(a)},e.prototype._getPolygonStyle=function(a){if(a instanceof NPMapLib.Geometry.Polygon){var b={fill:!0,fillColor:a.getFillColor(),fillOpacity:a.getFillOpacity(),strokeColor:a.getColor(),strokeWidth:a.getWeight(),strokeOpacity:a.getOpacity(),pointRadius:a.getPointRadius(),label:a.text?a.text:"",graphicZIndex:a.getZIndex(),strokeDashstyle:c[a.getLineStyle()]};return b}},e.prototype._createPolygon=function(a){if(a instanceof NPMapLib.Geometry.Polygon){var b=this._getPolygonStyle(a),c=a.getPath();if(c&&!(c.length<=0)){var d=[];if(c[0]instanceof NPMapLib.Geometry.Point)c=NPMapLib.T.setPoints(this,c),d=new OpenLayers.Geometry.LinearRing(this._castPoints(c));else for(var e=0;e<c.length;e++)d.push(new OpenLayers.Geometry.LinearRing(this._castPoints(NPMapLib.T.setPoints(this,c[e]))));var f=new OpenLayers.Geometry.Polygon(d),g=new OpenLayers.Feature.Vector(f,a,b);return g}}},e.prototype._updateCircle=function(a){var b=NPMapLib.T.setPoint(this,a.getCenter()),c=a._apiObj.geometry.components[0].components[0],d=Math.sqrt((b.lon-c.x)*(b.lon-c.x)+(b.lat-c.y)*(b.lat-c.y)),e=parseFloat(a._radius),f=new NPMapLib.GisToolKit;if(e=f.getDistanceByProjection2(e,this.map),0===d||0===e)return void(a._apiObj.style=this._getCircleStyle(a));var g=e/d,h=new OpenLayers.Geometry.Point(b.lon,b.lat);a._apiObj.geometry.resize(g,h),a._apiObj.style=this._getCircleStyle(a)},e.prototype._getCircleStyle=function(a){var b=a.getRadius(),d=new NPMapLib.GisToolKit;return b=d.getDistanceByProjection2(b,this.map),{fill:!0,fillColor:a.getFillColor(),fillOpacity:a.getFillOpacity(),strokeOpacity:a.getOpacity(),strokeWidth:a.getWeight(),strokeColor:a.getColor(),pointRadius:b,label:a.text?a.text:"",graphicZIndex:a.getZIndex(),strokeDashstyle:c[a.getLineStyle()]}},e.prototype._getEllipseStyle=function(a){return{fill:!0,fillColor:a.getFillColor(),fillOpacity:a.getFillOpacity(),strokeOpacity:a.getOpacity(),strokeWidth:a.getWeight(),strokeColor:a.getColor(),label:a.text?a.text:"",graphicZIndex:a.getZIndex(),strokeDashstyle:c[a.getLineStyle()]}},e.prototype._createCircle=function(a){if(a instanceof NPMapLib.Geometry.Circle){var b=NPMapLib.T.setPoint(this,a.getCenter()),c=a.getRadius();if(b&&c){var d=new OpenLayers.Geometry.Point(b.lon,b.lat),e=new NPMapLib.GisToolKit;c=e.getDistanceByProjection2(c,this.map);var f=OpenLayers.Geometry.Polygon.createRegularPolygon(d,c,60,10),g=new OpenLayers.Feature.Vector(f,a,this._getCircleStyle(a));return g}}},e.prototype._createEllipse=function(a){if(a instanceof NPMapLib.Geometry.Ellipse&&a._firstPoint&&a._secondPoint&&a._distance){var b=NPMapLib.T.setPoint(this,a._firstPoint),c=NPMapLib.T.setPoint(this,a._secondPoint),d=(b.lon+c.lon)/2,e=(b.lat+c.lat)/2,f=this.getDistance(b,c),g=a._distance/2,h=Math.sqrt(a._distance/2*(a._distance/2)-f/2*(f/2)),i=new NPMapLib.Geometry.Point(b.lon,e),j=this.getDistance(b,i),k=Math.asin(j/(f/2))/Math.PI*180;(b.lon-c.lon)*(b.lat-c.lat)<0&&(k=180-k);var l=new NPMapLib.GisToolKit;g=l.getDistanceByProjection2(g,this.map),h=l.getDistanceByProjection2(h,this.map);var m=new OpenLayers.Geometry.Point(d,e),n=OpenLayers.Geometry.Polygon.createEllipsePolygion(m,g,h,60,k),o=new OpenLayers.Feature.Vector(n,a,this._getEllipseStyle(a));
return o}},e.prototype._updateEllipse=function(a){var b=a._apiObj.layer;b.removeFeatures([a._apiObj]);var c=this._createEllipse(a);b.addFeatures([c]),a._apiObj=c},e.prototype._updateCircleSector=function(a){var b=a._apiObj.layer;b.removeFeatures([a._apiObj]);var c=this._creatCircleSector(a);b.addFeatures([c]),a._apiObj=c},e.prototype._getCircleSectorStyle=function(a){return{fill:!0,fillColor:a.getFillColor(),fillOpacity:a.getFillOpacity(),strokeOpacity:a.getOpacity(),strokeWidth:a.getWeight(),strokeColor:a.getColor(),graphicZIndex:a.getZIndex(),strokeDashstyle:c[a.getLineStyle()]}},e.prototype._creatCircleSector=function(a){if(a instanceof NPMapLib.Geometry.CircleSector){var b=a.getCenter(),c=a.getRadius(),d=a.getSides(),e=a.getAntBearing(),f=a.getLobeAngle();if(b&&c&&d&&e&&(f||0===f)){b=NPMapLib.T.setPoint(this,b);var g=new OpenLayers.Geometry.Point(b.lon,b.lat),h=new NPMapLib.GisToolKit;c=h.getDistanceByProjection2(c,this.map);var i=this._createOpenLayersCircleSector(g,c,d,e,f),j=new OpenLayers.Feature.Vector(i,a,this._getCircleSectorStyle(a));return j}}},e.prototype._createOpenLayersCircleSector=function(a,b,c,d,e){var f=360-d,g=Math.PI*(1/c-.5);f&&(g+=f/180*Math.PI);for(var h,i,j,k=[],l=0;c>l;l++){var m=l*((360-f)/360);h=g+2*m*Math.PI/c,i=a.x+b*Math.cos(h),j=a.y+b*Math.sin(h),k.push(new OpenLayers.Geometry.Point(i,j))}0!==f&&k.push(a);var n=new OpenLayers.Geometry.LinearRing(k);return n.rotate(parseFloat(d)+90+parseFloat(e),a),new OpenLayers.Geometry.Polygon([n])},e.prototype._createBubble=function(a){var b=NPMapLib.T.setPoint(this,a.getPosition()),c=this._getBubbleStyle(a),d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),a,c);return d},e.prototype._getBubbleStyle=function(a){var b=a.getOffset(),c=a.getColor(),d={color:c,offset:b,bubble:!0};return d},e.prototype._getMarkerStyle=function(a){var b=a.getIcon();if(!b)return{};var c=a.getOffset(),d=null,e=a.getLabel();e&&(d=this._getLabelStyle(e,c));var f={graphicWidth:b.getImageSize().width,graphicHeight:b.getImageSize().height,graphicXOffset:b.getAnchor().width+c.width,graphicYOffset:b.getAnchor().height-c.height,externalGraphic:b.getImageUrl(),graphicZIndex:a.getZIndex()};if(null!=d)for(var g in d)f[g]=d[g];var h=a.getTitle();return h&&(f.title=h),f},e.prototype._createMarker=function(a){var b=NPMapLib.T.setPoint(this,a.getPosition()),c=this._getMarkerStyle(a),d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),a,c);return d},e.prototype._createLabel=function(a){if(a){a._style.align="m";var b=this._getLabelStyle(a),c=NPMapLib.T.setPoint(this,a.getPosition()),d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),a,b);return d}},e.prototype._getLabelStyle=function(a,b){var c=a.getStyle();b=b?b:{width:0,height:0};var d={label:a.getContent(),fontSize:c.fontSize+"px",fontFamily:c.fontFamily,fontWeight:c.isBold?"bold":"normal",labelXOffset:a.getOffset().width+b.width,labelYOffset:a.getOffset().height-b.height,labelAlign:a._style.align||"cb",labelSelect:!0,labelBackgroundColor:a._style.labelBackgroundColor,title:a.getContent()};return c.color&&(d.fontColor=c.color),d},e.prototype._castPoint=function(a){return new OpenLayers.Geometry.Point(a.lon,a.lat)},e.prototype._castPoints=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;++c)b.push(this._castPoint(a[c]));return b},e.prototype.getOverlayStyle=function(a){var b=a.overlayType,c=null;switch(b){case NPMapLib.OVERLAY_TYPE_POLYLINE:c=this._getPolylineStyle(a);break;case NPMapLib.OVERLAY_TYPE_POLYGON:c=this._getPolygonStyle(a);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:c=this._getCircleStyle(a);break;case NPMapLib.OVERLAY_TYPE_CIRCLESECTOR:c=this._getCircleSectorStyle(a);break;case NPMapLib.OVERLAY_TYPE_LABEL:c=this._getLabelStyle(a);break;case NPMapLib.OVERLAY_TYPE_MARKER:c=this._getMarkerStyle(a);break;case NPMapLib.OVERLAY_TYPE_BUBBLE:c=this._getBubbleStyle(a)}return c},e.prototype.getAreaOverlays=function(a,b,c){var d,e=[];b=void 0===b?"featureLayer":b,c=void 0===c||"function"!=typeof c?function(){return!0}:c;var f=a.bounds,g=this.map.getLayersByName("featureLayer")[0].features;for(var h in g)if(g.hasOwnProperty(h)){if(d=g[h],!c(d))continue;f.containsLonLat(new OpenLayers.LonLat(d.position.op_point.x,d.position.op_point.y))&&e.push(d)}return e},e.prototype.showMenu=function(a){var c=a.MenuList,d=a.id;if(c){a._menu&&a._menu.hide();for(var e=[],f=c.split(";"),g=0,h=0;h<f.length;h++){for(var i=f[h].split(","),j=0;j<i.length;j++)e.push(new b(i[j],"overlayContextMenuCallBack("+g+","+d+")")),g++;e.push(null)}if(e.length>0){_menu=new OpenLayers.Menu("menulist",e),_menu.map=this.map;var k=_menu.draw();k&&this.map.layerContainerDiv.appendChild(k),this.map.events.register("click",_menu,function(){this.hide(),a._menu=null})}_menu.show(),a._menu=_menu}},e.prototype.showMapMenu=function(a,c,d){if(c){this.map._menu&&this.map._menu.hide();for(var e=[],f=0,g=0;g<c.length;g++){var h=c[g];for(j in h)h.hasOwnProperty(j)&&e.push(new b(j,h[j])),f++;e.push(null)}if(e.length>0){_menu=new OpenLayers.Menu("mapMenuList",e),_menu.map=this.map;var i=_menu.draw();i&&this.map.div.appendChild(i);var k=this;i.onclick=function(){_menu.hide(),k.map._menu=null},this.map.events.unregister("movestart",this,this.mapMenuHide),this.map.events.unregister("click",this,this.mapMenuHide),this.map.events.register("movestart",this,this.mapMenuHide),this.map.events.register("click",this,this.mapMenuHide)}_menu.show(a,d),this.map._menu=_menu}},e.prototype.mapMenuHide=function(){this.map._menu&&this.map._menu.hide()},e.prototype.getOverlayExtent=function(a){var b=new NPMapLib.Geometry.Extent(0,0,0,0);if(a._apiObj){var c=a._apiObj.geometry.bounds;b=new NPMapLib.Geometry.Extent(c.left,c.bottom,c.right,c.top)}return b},e.prototype._registerMapClick=function(a,b){this._clicks[a]=b},e.prototype._registerMapRightClick=function(a,b){this._clicks[a]=b},e.prototype._registerMapDoubleClick=function(a,b){var c=this,d=new OpenLayers.Control.ClickControl({eventMethods:{dblclick:function(b){var d=this.map.events.getMousePosition(b),e=this.map.getLonLatFromPixel(d),f=c._clicks[a];f&&f(NPMapLib.T.getPoint(c,e))}}});this._clicks[a]=b,this.map.addControl(d),d.activate()},e.prototype.addEventListener=function(a,b,c){if(a&&null!=a&&(a instanceof NPMapLib.Map||a instanceof NPMapLib.Adapter.OpenLayers.MapAdapter||a instanceof NPMapLib.Symbols.Marker||a instanceof NPMapLib.Symbols.Label||a instanceof NPMapLib.Geometry.Polyline||a instanceof NPMapLib.Geometry.Polygon||a instanceof NPMapLib.Geometry.CircleSector||a instanceof NPMapLib.Geometry.Circle||a instanceof NPMapLib.Symbols.Bubble)){var d=b+"_"+a.id;if(a instanceof NPMapLib.Map&&(d+="_map"),!this._events[d]){var e,f=this;if(a instanceof NPMapLib.Map||a instanceof NPMapLib.Adapter.OpenLayers.MapAdapter)switch(b){case NPMapLib.MAP_EVENT_CLICK:this._registerMapClick(b,c);break;case NPMapLib.MAP_EVENT_RIGHT_CLICK:this._registerMapRightClick(b,c);break;case NPMapLib.MAP_EVENT_DBLCLICK:this._registerMapDoubleClick(b,c);break;case NPMapLib.MAP_EVENT_ZOOM_END:e=function(a){if(a&&a.object){var b=a.object.getZoom();c(b)}},this.map.events.register(b,a,e);break;case NPMapLib.MAP_EVENT_MOUSE_MOVE:e=function(a){var b=a.object,d=b.getLonLatFromPixel(a.xy),e=new NPMapLib.Geometry.Point(d.lon,d.lat);e=NPMapLib.T.getPoint(f,e),c(e,a)},this.map.events.register(b,a,e);break;case NPMapLib.MAP_EVENT_MOVE_END:case NPMapLib.MAP_EVENT_MOVE_START:case NPMapLib.MAP_EVENT_DRAGGING:case NPMapLib.MAP_EVENT_DRAG_START:case NPMapLib.MAP_EVENT_DRAG_END:case NPMapLib.MAP_EVENT_MOUSE_OVER:case NPMapLib.MAP_EVENT_MOUSE_OUT:e=function(a){a&&a.object&&c(a)},this.map.events.register(b,a,e);break;case NPMapLib.MAP_EVENT_ADD_OVERLAY:case NPMapLib.MAP_EVENT_REMOVE_OVERLAY:case NPMapLib.MAP_EVENT_CLEAR_OVERLAYS:case NPMapLib.MAP_EVENT_ADD_CONTROL:case NPMapLib.MAP_EVENT_REMOVE_CONTROL:e=c,this._openLayersEvents.register(b,a,c);break;case NPMapLib.MAP_EVENT_ZOOM_START:e=function(a){var b=a.zoom,d=a.object.getZoom(),e=!0;d>b&&(e=!1),c(e,a.xy,a.zoomType)},this.map.events.register(b,a,e);break;case NPMapLib.MAP_EVENT_RESIZE:e=c,this.map.events.register("updatesize",a,e);break;case NPMapLib.MAP_EVENT_ZOOMCHANGE:var g=this;e=function(a){if(a.zoomChanged){var b=g.getZoom();b&&c(b)}},this.map.events.register("movestart",a,e);break;default:return void console.warn("暂不支持"+b+"事件")}else a.id&&(this._overlayEvents[a.id+"_"+b]=c,e=c);this._events[d]=e}}},e.prototype._unregisterMapClicks=function(a){this._clicks[a]&&delete this._clicks[a]},e.prototype.updateSize=function(){this.map.updateSize()},e.prototype.removeEventListener=function(a,b){if(a&&null!=a&&(a instanceof NPMapLib.Map||a instanceof NPMapLib.Adapter.OpenLayers.MapAdapter||a instanceof NPMapLib.Symbols.Marker||a instanceof NPMapLib.Symbols.Label||a instanceof NPMapLib.Geometry.Polyline||a instanceof NPMapLib.Geometry.Polygon||a instanceof NPMapLib.Geometry.CircleSector||a instanceof NPMapLib.Geometry.Circle||a instanceof NPMapLib.Symbols.Bubble)){var c=b+"_"+a.id;if(a instanceof NPMapLib.Map&&(c+="_map"),a instanceof NPMapLib.Map||a instanceof NPMapLib.Adapter.OpenLayers.MapAdapter)switch(b){case NPMapLib.MAP_EVENT_CLICK:case NPMapLib.MAP_EVENT_DBLCLICK:case NPMapLib.MAP_EVENT_RIGHT_CLICK:this._unregisterMapClicks(b);break;case NPMapLib.MAP_EVENT_MOUSE_MOVE:case NPMapLib.MAP_EVENT_MOUSE_OVER:case NPMapLib.MAP_EVENT_MOUSE_OUT:case NPMapLib.MAP_EVENT_ZOOM_START:case NPMapLib.MAP_EVENT_ZOOM_END:case NPMapLib.MAP_EVENT_DRAGGING:case NPMapLib.MAP_EVENT_DRAG_START:case NPMapLib.MAP_EVENT_DRAG_END:case NPMapLib.MAP_EVENT_MOVE_END:case NPMapLib.MAP_EVENT_MOVE_START:case NPMapLib.MAP_EVENT_ZOOMCHANGE:this.map.events.unregister(b,a,this._events[c]);break;case NPMapLib.MAP_EVENT_RESIZE:this.map.events.unregister("updatesize",a,this._events[c]);break;case NPMapLib.MAP_EVENT_ADD_OVERLAY:case NPMapLib.MAP_EVENT_REMOVE_OVERLAY:case NPMapLib.MAP_EVENT_CLEAR_OVERLAYS:case NPMapLib.MAP_EVENT_ADD_CONTROL:case NPMapLib.MAP_EVENT_REMOVE_CONTROL:this._openLayersEvents.unregister(b,a,this._events[c]);break;default:console.warn("取消事件"+b+"不支持")}else this._overlayEvents[a.id+"_"+b]&&delete this._overlayEvents[a.id+"_"+b];this._events[c]&&delete this._events[c]}},e.prototype.getTop=function(a){if(a&&a._apiObj){var b=a._apiObj.geometry.bounds;return NPMapLib.T.getPoint(this,new NPMapLib.Geometry.Point(b.getCenterLonLat().lon,b.top))}return null},e.prototype.setFillText=function(a,b,c){a&&a._apiObj&&(a._apiObj.style.label=b,c&&(a._apiObj.style.fontSize=c),a._apiObj.layer.drawFeature(a._apiObj))},e.prototype.showLayer=function(a){for(var b=this.map.getLayersByName(a.name),c=0;c<b.length;c++)b[c].setVisibility(!0)},e.prototype.clearTiles=function(a){for(var b=this.map.getLayersByName(a.name),c=0;c<b.length;c++)b[c].clearGrid()},e.prototype.hideLayer=function(a){for(var b=this.map.getLayersByName(a.name),c=0;c<b.length;c++)b[c].setVisibility(!1)},e.prototype.getBounds=function(a){if(a&&a._apiObj){var b=a._apiObj.geometry.getBounds();return NPMapLib.T.getExtent(this,new NPMapLib.Geometry.Extent(b.left,b.bottom,b.right,b.top))}return null},e.prototype.setTitle=function(a){a&&a._apiObj&&a._apiObj.setContentHTML(a.getTitle()+a.getContent())},e.prototype.setContent=function(a){a&&a._apiObj&&a._apiObj.setContentHTML(a.getTitle()+a.getContent())},e.prototype.getOverlayCenter=function(a){if(a&&a._apiObj){var b=a._apiObj.geometry.getBounds().getCenterLonLat();return NPMapLib.T.getPoint(this,new NPMapLib.Geometry.Point(b.lon,b.lat))}return null},e.prototype.getRadius=function(a){if(a&&a._apiObj){var b=a._apiObj.geometry.getBounds().getCenterLonLat(),c=a._apiObj.geometry,d=c.components[0].components[0],e=d.distanceTo(new OpenLayers.Geometry.Point(b.lon,b.lat)),f=new NPMapLib.GisToolKit;return f.getPlatDistanceByProjection2(e,this.map).toFixed(2)}return null},e.prototype.setBaseLayer=function(a){var b=this.map.getLayersByName(a.name);if(b.length>0)this.map.setBaseLayer(b[0]);else{var c=this._createLayer(a);null!=c&&this.map.setBaseLayer(c)}},e.prototype.getCirclePoints=function(a){if(a&&a._apiObj&&a._apiObj.geometry){for(var b=a._apiObj.geometry.components[0].components,c=[],d=0;d<b.length;d++)c.push(new NPMapLib.Geometry.Point(b[d].x,b[d].y));return c}},e.prototype.setVisibilityDefalutLayer=function(a){for(var b=this.map.getLayersByName("featureLayer"),c=0;c<b.length;c++)b[c].setVisibility(a?!0:!1)},e.prototype.getArea=function(a,b){return a&&a._apiObj?this._getArea(a._apiObj.geometry,b,!1):void 0},e.prototype._getArea=function(a,b,c){var d,e;c?(d=a.getGeodesicArea(this.map.getProjectionObject()),e="m"):(d=a.getArea(),e=this.map.getUnits());var f=OpenLayers.INCHES_PER_UNIT[b];if(f){var g=OpenLayers.INCHES_PER_UNIT[e];d*=Math.pow(g/f,2)}return d},e.prototype.getOverlayZIndex=function(a){return a._graphicZIndex},e.prototype.setOverlayZIndex=function(a,b){a._graphicZIndex=b,a.refresh()},e.prototype.setMakrerTypeVisiable=function(a,b,c){if(null!=a._apiObj&&"undefined"!=typeof a._apiObj.showMarker[b]){if(a._apiObj.showMarker[b]===c)return;if(a._apiObj.showMarker[b]=c,c){var d=a.getOverlaysArry();if(d.length>0){var e=d[0].getMarkersByMarkType(b);a._apiObj.strategies[0].addClusterMarker(e)}}else for(var f=a._apiObj.features.slice(),g=f.length,h=[],i=0;g>i;i++)f[i].data.markType===b&&(a._apiObj.removeFeatures(f[i]),h.push(f[i]))}},e.prototype.getMapUnits=function(){return this.map.units},e.prototype.setDefaultMapCursor=function(a){this.defaultMapCursor=a,this.setCursor(this.defaultMapCursor)},e.prototype.registerLayerFeatureclick=function(){this.cache={},this.map.events.register("mousedown",this,this.layerstart,{extension:!0}),this.map.events.register("touchstart",this,this.layerstart,{extension:!0}),this.map.events.register("touchmove",this,this.cancel,{extension:!0}),this.map.events.register("mousemove",this,this.onMousemove,{extension:!0})},e.prototype.triggerEvent=function(a,b){var c=this;if(b.feature){if(b.feature.layer&&this._selfLayers[b.feature.layer.name]&&"NPMapLib.Layers.HotspotLayer"===this._selfLayers[b.feature.layer.name].CLASS_NAME){var d=this._selfLayers[b.feature.layer.name],e=b.feature.data;switch(a){case"featureclick":d.click(e);break;case"featureover":d.onmouseover(e);break;case"featureout":d.onmouseout(e)}return!1}var f=b.feature;switch(a){case"featureclick":f.layer&&f.layer.eventListeners&&f.layer.eventListeners.featureclick?f.layer.eventListeners.featureclick(b):this._featuresLayerClick(b);break;case"featuremousedown":if(f.data&&f.data.id){var g=this._overlayEvents[f.data.id+"_featuremousedown"];"function"==typeof g&&g.apply(this,[f.data,"featuremousedown"])}break;case"featuremouseup":if(f.data&&f.data.id){var h=this._overlayEvents[f.data.id+"_featuremouseup"];"function"==typeof h&&h.apply(this,[f.data,"featuremouseup"])}break;case"featureover":f.layer&&f.layer.eventListeners&&f.layer.eventListeners.featureover?f.layer.eventListeners.featureover(b):this._overFeature(b);break;case"featureout":f.layer&&f.layer.eventListeners&&f.layer.eventListeners.featureout?f.layer.eventListeners.featureout(b):this._mouseout(b);break;case"featuremoving":var i=b.xy,j=null;if(i&&(j=this.pixelToPoint(i)),f.data&&f.data.id){"NPMapLib.Geometry.Polyline"===f.data.CLASS_NAME&&(j=NPMap.T.getPoint(c,j),j=this.getPointInLine(f.data,j));var k=this._overlayEvents[f.data.id+"_featuremoving"];"function"==typeof k&&k.apply(this,[f.data,j])}}return!1}},e.prototype.getPointInLine=function(a,b){for(var c=a.getPath(),d=null,e=99999,f=c.length-1;f>0;f--){var g=this._findShortPointInLine(b,c[f].lon,c[f].lat,c[f-1].lon,c[f-1].lat),h=this._calculateEuclideanDistance(b.lon,b.lat,g.lon,g.lat);e>h&&(e=h,d=g)}return d},e.prototype._findShortPointInLine=function(a,b,c,d,e){var f,g,h,i=a.lon,j=a.lat;if(f=this._calculateEuclideanDistance(b,c,d,e),g=this._calculateEuclideanDistance(b,c,i,j),h=this._calculateEuclideanDistance(d,e,i,j),f===g+h)return new NPMapLib.Geometry.Point(i,j);if(1e-6>=f)return new NPMapLib.Geometry.Point(b,c);if(h*h>=f*f+g*g)return new NPMapLib.Geometry.Point(b,c);if(g*g>=f*f+h*h)return new NPMapLib.Geometry.Point(d,e);if(d-b===0)return new NPMapLib.Geometry.Point(b,j);var k=(e-c)/(d-b),l=(i+(j-c)*k+k*k*b)/(k*k+1),m=k*l-k*b+c;return new NPMapLib.Geometry.Point(l,m)},e.prototype._calculateEuclideanDistance=function(a,b,c,d){var e=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b));return e},e.prototype.getFeatures=function(a){return this.map.getFeatures(a)},e.prototype.onMousemove=function(a){for(var b,c=this.getFeatures(a),d={},e=[],f=0,g=c.length;g>f;++f)b=c[f],d[b.id]=b,e.push(b);var h;e.length>0&&(h=e[0]);for(var i=0;i<e.length;i++)h.style.graphicZIndex<e[i].style.graphicZIndex&&(h=e[i]);c.length>0&&this.triggerEvent("featuremoving",{feature:this.activeFeature,xy:{x:a.clientX,y:a.clientY}}),0===e.length&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:a.offsetX,y:a.offsetY}}),delete this.cache[this.activeFeature.id]),this.activeFeature=null),this.activeFeature!==h&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:a.offsetX,y:a.offsetY}}),delete this.cache[this.activeFeature.id],this.activeFeature=null),this.triggerEvent("featureover",{feature:h,xy:{x:a.offsetX,y:a.offsetY}}),this.activeFeature=h,this.cache[c.id]=h)},e.prototype.layerstart=function(a){this.startEvt=a;for(var b in this.cache)if(this.cache.hasOwnProperty(b)&&(feature=this.cache[b])){var c=this.triggerEvent("featuremousedown",{feature:feature});if(this.curretFeature=feature,c===!1)break}},e.prototype.removeOverlayEvent=function(a){if(a&&a.id){var b=a.id+"_";for(var c in this._overlayEvents)0===c.indexOf(b)&&delete this._overlayEvents[c]}},e.prototype.filterClusterMarks=function(a,b){a._apiObj.strategies[0].filterClusterMarks(b)},e.prototype.getProjection=function(){return this.map.getProjection()},e.prototype.finishGeometry=function(){this._measureControl&&this._measureControl.handler&&this._measureControl.handler.finishGeometry()},e.prototype.setMapStyle=function(a){this.map.setMapStyle(a);for(var b=map._mapAdapter.map.layers,c=0;c<b.length;c++)!b[c]||!b[c].visibility||b[c]instanceof OpenLayers.Layer.Vector||b[c].redraw()}}();