window.NPMobile={ISPOINTCONVERT:!0,VERSION:"1.0.0",inherits:function(e,t){var r=t.prototype,n=e.prototype;for(var a in r)n[a]=r[a];n.uber=r,e.prototype.constructor=e}},NPMobile.Geometry={},NPMobile.Util={},NPMobile.Util.clone=function(e,t){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);t=t||new e.constructor;for(var r in e)t[r]="undefined"==typeof t[r]?NPMobile.Util.clone(e[r],null):t[r];return t},NPMobile.Util.extend=function(e,t){e=e||{};for(var r in t)void 0===e[r]&&(e[r]=NPMobile.Util.clone(t[r]));return e},NPMobile.Layers={LAYERID:0},NPMobile.Layers.Layer=function(e){this.id=null},NPMobile.Layers.Layer.prototype={display:function(e){this._layer.display(e)},getId:function(){return this.id}},NPMobile.Geometry.Curve=function(){this._vector=null,this.id=null},NPMobile.Geometry.Curve.prototype={_castPoints:function(e){if(!e)return[];for(var t,r=[],n=0;n<e.length;++n)t=e[n],r.push(new OpenLayers.Geometry.Point(t.lon,t.lat));return r},refresh:function(){var e=this._vector.layer;e&&e.drawFeature(this._vector)},show:function(){this._vector.style.display="block",this.refresh()},hide:function(){this._vector.style.display="none",this.refresh()},register:function(e,t){this._vector["_"+e]=t},unregister:function(e){this._vector["_"+e]=null},getPoints:function(){if(!this._vector)return[];if(this._vector.geometry&&this._vector.geometry instanceof OpenLayers.Geometry.Point)return NPMobile.Geometry.Point.getPoint(this._vector.geometry.x,this._vector.geometry.y);if(this._vector.geometry&&this._vector.geometry instanceof OpenLayers.Geometry.Polygon){for(var e=[],t=0;t<this._vector.geometry.components.length;t++){for(var r=this._vector.geometry.components[t].components,n=[],a=0;a<r.length;a++)n.push(NPMobile.Geometry.Point.getPoint(r[a].x,r[a].y));e.push(n)}return 1===e.length?e[0]:e}if(this._vector.geometry&&this._vector.geometry instanceof OpenLayers.Geometry.LineString){for(var i=this._vector.geometry.components,o=[],a=0;a<i.length;a++)o.push(NPMobile.Geometry.Point.getPoint(i[a].x,i[a].y));return o}},getLength:function(){return this._vector.geometry.getLength()},getArea:function(){return this._vector.geometry.getArea()}},NPMobile.Layers.CustomerLayer=function(e){NPMobile.Layers.Layer.call(this,e),this._layer=new OpenLayers.Layer.Vector(e||"默认图层1",{rendererOptions:{zIndexing:!0}}),this._layer.events.register("featureclick",this,function(e){e.feature._click&&e.feature._click.call(e.feature.data)})},NPMobile.Layers.CustomerLayer.prototype={addOverlay:function(e){this._layer.addFeatures(e._vector)},removeOverlay:function(e){this._layer.removeFeatures(e._vector,{silent:!0})},removeAllOverlays:function(){this._layer.removeAllFeatures()}},NPMobile.inherits(NPMobile.Layers.CustomerLayer,NPMobile.Layers.Layer),NPMobile.Geometry.ClusterMarker=function(e,t,r){this._point=e,this._clientData=r,this.showMarker=t,this._visible=!0;var n=NPMobile.T.setPoint(this._map,e);this.geometry={x:n.lon,y:n.lat}},NPMobile.Geometry.ClusterMarker.prototype={getClientData:function(){return this._clientData},getData:function(){var e=this._clientData||{};return e._visible=this._visible,e},changeStyle:function(e){if(this._apiObj){for(var t in e)this._apiObj.style[t]=e[t];this._apiObj.layer.drawFeature(this._apiObj)}}},NPMobile.Layers.ClusterLayer=function(e,t){NPMobile.Layers.Layer.call(this,e,t),this._events={_getUrl:function(){return"img/Flag.png"},_getImageSize:function(){return{width:32,height:32}},_getContent:function(){return""}},t=NPMobile.Util.extend(t,{distance:200,clusterClickModel:"zoom",isAsynchronous:!1,zIndexing:!0,defaultStyle:{fontColor:"white",fontSize:""}});var r=this,n={isClusterLayer:!0,eventListeners:{featureselected:function(e){var n=e.feature,a=n.layer;if(!(n.cluster&&n.cluster.length>1)){if(n.attributes.count>0&&"zoom"===t.clusterClickModel)if(t.selectZoom){var i=new OpenLayers.LonLat(n.geometry.x,n.geometry.y);a.map.setCenter(i,t.selectZoom)}else{var o=a.map.getPixelFromLonLat({lon:n.geometry.getCentroid().x,lat:n.geometry.getCentroid().y});a.map.zoomTo(a.map.getZoom()+1,o)}var s;return n.cluster?(n.cluster&&1===n.cluster.length&&(s=n.cluster[0].data),n.cluster&&0===n.cluster.length&&(n.data.feature._apiObj=n,s=n.data.feature)):s=n.data,(!n.cluster||n.cluster.length<2)&&s&&!n.data.isStatistics&&r._trigger("click",s.id,""===e.feature.style.externalGraphic||"undefined"==typeof e.feature.style.externalGraphic),!1}}}},a=new OpenLayers.Strategy.AnimatedCluster({threshold:t.threshold||5,distance:t.distance||200,animationMethod:OpenLayers.Easing.Expo.easeOut,animationDuration:10,maxZoom:t.maxZoom||15,minZoom:t.minZoom||0,isAsynchronous:t.isAsynchronous,clusterClickModel:t.clusterClickModel,minClusterCount:t.minClusterCount,callbackFun:null});n.strategies=[a],n.rendererOptions={zIndexing:!0};var i={context:{getCount:function(e){return e.getCount()||r._trigger("getContent",e)},getUrl:function(e){return r._trigger("getUrl",e.getCount(),e.getData())},getWidth:function(e){return r._trigger("getImageSize",e.getCount(),e.getData()).width},getHeight:function(e){return r._trigger("getImageSize",e.getCount(),e.getData()).height},getRotation:function(e){return r._trigger("getRotation",e.getCount(),e.getData())},getgraphicYOffset:function(e){var t=e.getCount(),n=r._trigger("getImageSize",t,e.getData());return null===t?-n.height/2:-n.height},getlabelYOffset:function(e){var n=e.getCount(),a=e.getData(),i=r._trigger("getImageSize",n,a);return n?i.height/2:t.customLabelOffset?t.customLabelOffset.height:r._trigger("getCustomLabelOffset",n,a)},getLabelFontColor:function(e){var r=e.getCount();return r?t.defaultStyle.fontColor:t.defaultStyle.customLabelFontColor||t.defaultStyle.fontColor},getFontSize:function(e){var r=e.getCount();return r?t.defaultStyle.fontSize:t.defaultStyle.customLabelFontColor||t.defaultStyle.fontSize},getlabelXOffset:function(e){var r=e.getCount();if(!r&&t.customLabelOffset)return t.customLabelOffset.width},getTitle:function(e){var t=e.getCount(),n=!t&&r._trigger("getTitle",e.getData());return n||""},getlabelbg:function(e){var t=e.getCount();return!t&&r._trigger("getBackGroundColor",e.getData())}}};n.styleMap=new OpenLayers.StyleMap({default:new OpenLayers.Style({externalGraphic:"${getUrl}",graphicWidth:"${getWidth}",graphicHeight:"${getHeight}",graphicOpacity:1,graphicYOffset:"${getgraphicYOffset}",label:"${getCount}",labelYOffset:"${getlabelYOffset}",labelXOffset:"${getlabelXOffset}",labelSelect:!0,fontColor:"${getLabelFontColor}",fontSize:"${getFontSize}",rotation:"${getRotation}",labelBackgroundColor:"${getlabelbg}",title:"${getTitle}"},i)}),this._layer=new OpenLayers.Layer.Vector(e||"聚合图层",n)},NPMobile.Layers.ClusterLayer.prototype={display:function(e){this._layer.display(e)},_trigger:function(e){var t=this._events["_"+e];if(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);return t.apply(this,r)}},unregister:function(e){return this._events["_"+e]=null,this},register:function(e,t){return this._events["_"+e]=t,this},addOverlays:function(e){this._layer.removeAllFeatures();for(var t=0;t<e.length;t++)this._layer.showMarker[e[t].markType]||(this._layer.showMarker[e[t].markType]=!0);return this._layer.events.triggerEvent("beforefeaturesadded",{features:e}),this}},NPMobile.inherits(NPMobile.Layers.ClusterLayer,NPMobile.Layers.Layer),NPMobile.Geometry.MultiLineString=function(){},NPMobile.inherits(NPMobile.Geometry.MultiLineString,NPMobile.Geometry.Curve),NPMobile.Geometry.LineString=function(e,t){NPMobile.Geometry.Curve.call(e,t),t=NPMobile.Util.extend(t,{graphicName:"triangle",strokeColor:"red",strokeWidth:2,strokeDashstyle:"solid",pointRadius:6,strokeLinecap:"round"});var r=new OpenLayers.Geometry.LineString(this._castPoints(NPMobile.T.setPoints(this._map,e)));this._vector=new OpenLayers.Feature.Vector(r,this,t)},NPMobile.inherits(NPMobile.Geometry.LineString,NPMobile.Geometry.Curve),NPMobile.Geometry.Polygon=function(e,t){NPMobile.Geometry.Curve.call(e,t),t=NPMobile.Util.extend(t,{fill:!0,fillColor:"red",fillOpacity:1,strokeColor:"#ee9900",strokeWidth:1,strokeOpacity:1,pointRadius:6,label:""}),e=NPMobile.T.setPoints(null,e);var r=new OpenLayers.Geometry.LinearRing(this._castPoints(e)),n=new OpenLayers.Geometry.Polygon(r);this._vector=new OpenLayers.Feature.Vector(n,this,t)},NPMobile.inherits(NPMobile.Geometry.Polygon,NPMobile.Geometry.Curve),NPMobile.Geometry.MultiPolygon=function(){},NPMobile.inherits(NPMobile.Geometry.MultiPolygon,NPMobile.Geometry.Curve),NPMobile.Geometry.Point=function(e,t){this.lon=Number(e),this.lat=Number(t)},NPMobile.Geometry.Point.setPoint=function(e,t){return NPMobile.T.setPoint(null,{lon:e,lat:t})},NPMobile.Geometry.Point.getPoint=function(e,t){return NPMobile.T.getPoint(null,{lon:e,lat:t})},NPMobile.Geometry.Marker=function(e,t){NPMobile.Geometry.Curve.call(this,e);var r={graphicWidth:t.graphicWidth,graphicHeight:t.graphicHeight,graphicXOffset:t.graphicXOffset,graphicYOffset:t.graphicYOffset,externalGraphic:t.externalGraphic,graphicZIndex:t.graphicZIndex},n=NPMobile.T.setPoint(this._map,e);this._vector=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(n.lon,n.lat),this,r)},NPMobile.Geometry.Marker.prototype={setStyle:function(e){for(var t in e)this._vector.style[t]=e[t];this.refresh()}},NPMobile.inherits(NPMobile.Geometry.Marker,NPMobile.Geometry.Curve),NPMobile.Map=function(e,t){this._events=[],this._selectControl=null,this._layers=[];var r=new OpenLayers.Control.Geolocate({id:"iploc",bind:!1,geolocationOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:7e3}});t.mapOpts.controls=[new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}}),r,new OpenLayers.Control.Zoom],t.mapOpts.centerPoint=t.mapOpts.centerPoint||t.vectorLayer[0].layerOpt.centerPoint,t.mapOpts.zoom=t.mapOpts.defaultZoom||t.mapOpts.minZoom,t.mapOpts.originCenter=t.mapOpts.centerPoint,this._map=new OpenLayers.Map(e,t.mapOpts),$(".icon").click(function(){console.log("click"),r.active?r.getCurrentLocation():r.activate()});var n=this,a=new OpenLayers.Layer.Vector("Vector Layer",{});if(this._map.addLayer(a),r.events.register("locationfailed",this,function(e){console.error(e.error.message)}),r.events.register("locationupdated",this,function(e){n.setCenter(e.position,n.getMaxZoom());var t=NPMobile.T.setPoint(n._map,e.position);a.removeAllFeatures(),a.addFeatures([new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{},{strokeOpacity:1,strokeColor:"rgb(23,146,255)",fillColor:"rgb(23,146,255)",pointRadius:5}),new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(t.lon,t.lat),"m"==n._map.getUnits()?15:1e-4,50,0),{},{fillOpacity:.3,fillColor:"rgb(23,146,255)",strokeColor:"rgb(23,146,255)",strokeOpacity:.3})])}),this._mapJson={map:this._map,vectorLayer:this._getLayers(t.vectorLayer),sattilateLayer:this._getLayers(t.sattilateLayer)},this._map.addLayers(this._mapJson.vectorLayer),this._defaultLayer=new OpenLayers.Layer.Vector("_默认图层",{rendererOptions:{zIndexing:!0}}),this._map.addLayers([this._defaultLayer]),"EPSG:900913"===this._map.getProjection()&&t.mapOpts.centerPoint[0]<180){var i=NPMobile.T.setPoint(this._map,{lon:t.mapOpts.centerPoint[0],lat:t.mapOpts.centerPoint[1]});this._map.originCenter=[i.lon,i.lat]}this.fullExtent(t.mapOpts.zoom),this._defaultLayer.events.register("featureclick",this,function(e){e.feature._click&&e.feature._click(e.feature)}),NPMobile.T.map=this._map},NPMobile.Map.prototype={donothing:function(){},register:function(e,t){if("click"===e&&t){var r=function(e){try{t(NPMobile.T.getPoint(this,this.getLonLatFromLayerPx(e.xy)))}catch(e){}return!1};this._events["_"+e]=r,this._map.events.register("click",this._map,r)}else this._events["_"+e]=t},addOverlay:function(e){this._defaultLayer.addFeatures([e._vector])},unregister:function(e){"click"===e&&this._map.events.unregister("click",this._map,this._events["_"+e]),this._events["_"+e]=null},getMinZoom:function(){return this._map.minZoom},getMaxZoom:function(){return this._map.maxZoom},addLayer:function(e){this._map.addLayers([e._layer]),this._layers.push(e._layer),this._selectControl?this._selectControl.setLayer(this._layers):(this._selectControl=new OpenLayers.Control.SelectFeature(this._layers,{autoActivate:!0,onSelect:function(e){e._click&&e._click(e.data)}}),this._map.addControl(this._selectControl))},fullExtent:function(e){var t=this._map.originCenter,r=new OpenLayers.LonLat(t[0],t[1]);e=e||this._map.minZoom,this._map.setCenter(r,e)},_getLayers:function(e){for(var t=function(e){var t=this.map.getResolution(),r=this.map.getMaxExtent().top,n=this.map.getMaxExtent().left,a=Math.round((e.left-n)/(t*this.tileSize.w)),i=Math.round((r-e.top)/(t*this.tileSize.h)),o=this.map.getZoom(),s=""+o+"/"+a+"/"+i+"."+this.type;this.isOnline&&(s="L="+o+"&X="+a+"&Y="+i);var l=this.url;return l instanceof Array&&(l=this.selectUrl(s,l)),l+s},r=[],n=0;n<e.length;n++){var a=e[n],i=null;if("NPMapLib.Layers.NPLayer"===a.layerType){var o=a.layerOpt.url+"/getTile?",s=a.layerOpt.layerInfo;switch(a.layerOpt.layerInfo.layerType){case"tiandi":case"NPMapLib.Layers.TDMapLayer":s._opts={mapType:s.type,centerPoint:s.centerPoint,fullExtent:s.fullExtent,topLevel:0,bottomLevel:18,isBaseLayer:!0,zoomOffset:0},s._opts.fullExtent=[-180,-90,180,90],i=new OpenLayers.Layer.TDTLayer(s.name,o,s._opts);break;case"gaode":case"NPMapLib.Layers.GaoDeLayer":s._opts={centerPoint:s.centerPoint,fullExtent:s.fullExtent,isBaseLayer:s.isBaseLayer},i=new OpenLayers.Layer.gaode(o,s.name,s._opts);break;case"google":case"NPMapLib.Layers.GoogleOffLineLayer":s._opts={isOnline:!0,centerPoint:s.centerPoint,fullExtent:s.fullExtent,isBaseLayer:s.isBaseLayer},s._opts.getURL=t,i=new OpenLayers.Layer.TMS(o,s.name,s._opts);break;case"baidu":case"NPMapLib.Layers.BaiduTileLayer":o+="X=${x}&Y=${y}&L=${z}",s._opts={centerPoint:s.centerPoint,fullExtent:s.fullExtent,isBaseLayer:s.isBaseLayer,tileOrigin:new OpenLayers.LonLat(0,0),maxResolution:262144},i=new OpenLayers.Layer.Baidu(o,s.name,s._opts);break;case"streetmap":case"NPMapLib.Layers.OSMLayer":o+="X=${x}&Y=${y}&L=${z}",i=new OpenLayers.Layer.OSM(o,s.name,{isChian:!1,centerPoint:s.centerPoint,isBaseLayer:s.isBaseLayer});break;case"pgis":case"NPMapLib.Layers.EzMapTileLayer":o+="X=${x}&Y=${y}&L=${z}",s.tileOrigin=s.tileOrigin||new OpenLayers.LonLat(0,0),s.maxResolution=2,i=new OpenLayers.Layer.TMS_PGIS(o,s.name,s)}}else{var o=a.layerOpt.url,s=a.layerOpt;switch(a.layerType){case"NPMapLib.Layers.GoogleMapTileLayer":i=new OpenLayers.Layer.OSM(a.layerName,o,s);break;case"NPMapLib.Layers.TDMapLayer":s.fullExtent=[-180,-90,180,90],i=new OpenLayers.Layer.TDTLayer(a.layerName,o,s);break;case"NPMapLib.Layers.GaoDeLayer":i=new OpenLayers.Layer.gaode(a.layerName,o,s);break;case"NPMapLib.Layers.BaiduTileLayer":s.tileOrigin=new OpenLayers.LonLat(0,0),s.maxResolution=262144,i=new OpenLayers.Layer.Baidu(a.layerName,o,s);break;case"NPMapLib.Layers.OSMLayer":i=new OpenLayers.Layer.OSM(a.layerName,o,s);break;case"NPMapLib.Layers.ArcgisTileLayer":var l=a.layerOpt.layerInfo,c=l.tileInfo,s={};if(c.lods){s.resolutions=[];for(var n=0;n<c.lods.length;n++)s.resolutions.push(c.lods[n].resolution)}c.rows&&(s.tileSize=new OpenLayers.Size(c.rows,c.rows)),c.origin&&(s.tileOrigin=new OpenLayers.LonLat(c.origin.x,c.origin.y)),l.fullExtent&&(s.maxExtent=new OpenLayers.Bounds(l.fullExtent.xmin,l.fullExtent.ymin,l.fullExtent.xmax,l.fullExtent.ymax)),c.spatialReference&&(s.projection="EPSG:"+c.spatialReference.wkid),c.format&&(s.type="jpg"),i=new OpenLayers.Layer.ArcGISCache(a.layerName,o,s)}}r.push(i)}return r},showVectorLayer:function(e){if(this._mapJson&&this._mapJson.vectorLayer){if(this._mapJson.vectorLayer.length>1)for(var t=0;t<this._mapJson.vectorLayer.length;t++)this._mapJson.vectorLayer[t].show(),this._mapJson.vectorLayer[t].setZIndex(this._mapJson.vectorLayer[0].getZIndex()+t+1);if(this._mapJson.sattilateLayer.length>1)for(var t=this._mapJson.sattilateLayer.length-1;t>=1;t--)this._mapJson.sattilateLayer[t].hide();this._mapJson.vectorLayer.length>0&&this._mapJson.map.setBaseLayer(this._mapJson.vectorLayer[0])}},showSattilateLayer:function(e){if(this._mapJson&&this._mapJson.sattilateLayer){if(this._mapJson.sattilateLayer.length>1)for(var t=this._mapJson.sattilateLayer.length-1;t>=1;t--)this._mapJson.sattilateLayer[t].show(),this._mapJson.sattilateLayer[t].setZIndex(this._mapJson.sattilateLayer[0].getZIndex()+t+1);if(this._mapJson.vectorLayer.length>1)for(var t=this._mapJson.vectorLayer.length-1;t>=1;t--)this._mapJson.vectorLayer[t].hide();this._mapJson.sattilateLayer.length>0&&this._mapJson.map.setBaseLayer(this._mapJson.sattilateLayer[0])}},getCenter:function(){var e=this._map.getCenter();return NPMobile.T.getPoint(this._map,e)},setCenter:function(e,t){var r=NPMobile.T.setPoint(this._map,e);this._map.setCenter(new OpenLayers.LonLat(r.lon,r.lat),t||this.getZoom())},getZoom:function(){return this._map.getZoom()},createMarker:function(e,t,r){var n={graphicWidth:t.graphicWidth,graphicHeight:t.graphicHeight,graphicXOffset:t.graphicXOffset,graphicYOffset:t.graphicYOffset,externalGraphic:t.externalGraphic,graphicZIndex:t.graphicZIndex},a=NPMobile.T.setPoint(this._map,e),i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,a.lat),{point:e,style:n},n);this._defaultLayer.addFeatures([i]),i._click=r}},function(){function t(e){var t,r,n,a="",o="",s="",l=0;if(n=/[^A-Za-z0-9\+\/\=]/g,!e||n.exec(e))return e;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do t=i.indexOf(e.charAt(l++)),r=i.indexOf(e.charAt(l++)),n=i.indexOf(e.charAt(l++)),s=i.indexOf(e.charAt(l++)),t=t<<2|r>>4,r=(15&r)<<4|n>>2,o=(3&n)<<6|s,a+=String.fromCharCode(t),64!=n&&(a+=String.fromCharCode(r)),64!=s&&(a+=String.fromCharCode(o));while(l<e.length);return a}function r(e){return"string"==typeof e}function n(e,n){isNaN(e)&&(e=t(e),e=isNaN(e)?0:e),r(e)&&(e=parseFloat(e)),isNaN(n)&&(n=t(n),n=isNaN(n)?0:n),r(n)&&(n=parseFloat(n)),this.lng=e,this.lat=n}var a=function(){var e=3.141592653589793,t=.006693421622965943,r=52.35987755982988,n=20037508.34,a=6378245,i={};return i.transform=function(r,n){r=parseFloat(r),n=parseFloat(n);var i={};if(this.outofChina(n,r))return i.lon=r,i.lat=n,i;var o=this.transformLat(r-105,n-35),s=this.transformLon(r-105,n-35),l=n/180*e,c=Math.sin(l);c=1-t*c*c;var u=Math.sqrt(c);o=180*o/(a*(1-t)/(c*u)*e),s=180*s/(a/u*Math.cos(l)*e);var h=n+o,y=r+s;return i.lon=y,i.lat=h,i},i.outofChina=function(e,t){return t<72.004||t>137.8347||(e<.8293||e>55.8271)},i.transformLat=function(t,r){var n=-100+2*t+3*r+.2*r*r+.1*t*r+.2*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,n+=2*(20*Math.sin(r*e)+40*Math.sin(r/3*e))/3,n+=2*(160*Math.sin(r/12*e)+320*Math.sin(r*e/30))/3},i.transformLon=function(t,r){var n=300+t+2*r+.1*t*t+.1*t*r+.1*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,n+=2*(20*Math.sin(t*e)+40*Math.sin(t/3*e))/3,n+=2*(150*Math.sin(t/12*e)+300*Math.sin(t/30*e))/3},i.gcj2wgs=function(e,t){var r={lon:0,lat:0},n=e-(this.transform(e,t).lon-e),a=t-(this.transform(e,t).lat-t);return r.lon=n,r.lat=a,r},i.bd_encrypt=function(e,t){var n=e,a=t,i=Math.sqrt(n*n+a*a)+2e-5*Math.sin(a*r),o=Math.atan2(a,n)+3e-6*Math.cos(n*r),s=i*Math.cos(o)+.0065,l=i*Math.sin(o)+.006;return{lon:s,lat:l}},i.bd_decrypt=function(e,t){var n=e-.0065,a=t-.006,i=Math.sqrt(n*n+a*a)-2e-5*Math.sin(a*r),o=Math.atan2(a,n)-3e-6*Math.cos(n*r),s=i*Math.cos(o),l=i*Math.sin(o);return{lon:s,lat:l}},i.webMoctorJW2PM=function(e,t){var r={lon:0,lat:0};e=parseFloat(e),t=parseFloat(t),r.lon=e/180*20037508.34,t>85.05112&&(t=85.05112),t<-85.05112&&(t=-85.05112),t=Math.PI/180*t;var n=Math.PI/4+t/2;return r.lat=20037508.34*Math.log(Math.tan(n))/Math.PI,r},i.inverseMercator=function(e,t){return e=180*e/n,t=180/Math.PI*(2*Math.atan(Math.exp(t/n*Math.PI))-Math.PI/2),{lon:e,lat:t}},i},i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o={$O:6370996.81,lG:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Au:[75,60,45,30,15,0],fP:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],p:null,JD:function(e,t,r){for(;e>r;)e-=r-t;for(;e<t;)e+=r-t;return e},ND:function(e,t,r){return null!=t&&(e=Math.max(e,t)),null!=r&&(e=Math.min(e,r)),e},Fb:function(e){if(e.lng=e.lon,e.lat=e.lat,!e||180<e.lng||-180>e.lng||90<e.lat||-90>e.lat)return new n(0,0);var t,r;e.lng=this.JD(e.lng,-180,180),e.lat=this.ND(e.lat,-74,74),t=new n(e.lng,e.lat);for(var a=0;a<this.Au.length;a++)if(t.lat>=this.Au[a]){r=this.iG[a];break}if(!r)for(a=this.Au.length-1;0<=a;a--)if(t.lat<=-this.Au[a]){r=this.iG[a];break}return e=this.gK(e,r),e=new n(e.lng,e.lat),new NPMobile.Geometry.Point(e.lng,e.lat)},gK:function(e,t){if(e&&t){var r=t[0]+t[1]*Math.abs(e.lng),a=Math.abs(e.lat)/t[9],a=t[2]+t[3]*a+t[4]*a*a+t[5]*a*a*a+t[6]*a*a*a*a+t[7]*a*a*a*a*a+t[8]*a*a*a*a*a*a,r=r*(0>e.lng?-1:1),a=a*(0>e.lat?-1:1);return new n(r,a)}},ToLL:function(e){e.lng=e.lon;for(var t,r=0;r<this.lG.length;r++)if(e.lat>=this.lG[r]){t=this.fP[r];break}return e=this.gK(e,t),new NPMobile.Geometry.Point(e.lng.toFixed(6),e.lat.toFixed(6))}},s=NPMobile.T={};s.Baidu=o;var l=new a,c=function(e){var t;return e._mapAdapter&&(t=e._mapAdapter.map.baseLayer),e.map&&(t=e.map.baseLayer),e.baseLayer&&(t=e.baseLayer),t};s.helper=l,s.setPoint=function(t,r){if(!NPMobile.ISPOINTCONVERT)return r;if(t=t||NPMobile.T.map,"EPSG:900913"==t.getProjection()){var n=c(t);return n.CLASS_NAME.indexOf("Baidu")!=-1?(e=l.transform(r.lon,r.lat),e=l.bd_encrypt(e.lon,e.lat),NPMobile.T.Baidu.Fb(e)):(e=n.CLASS_NAME.indexOf("OSM")!=-1&&0==n.isChina?r:l.transform(r.lon,r.lat),e=l.webMoctorJW2PM(e.lon,e.lat),new NPMobile.Geometry.Point(e.lon,e.lat))}return r},s.setPoints=function(e,t){for(var r=[],n=0;n<t.length;n++)r.push(NPMobile.T.setPoint(e,t[n]));return r},s.getPoint=function(e,t){if(!NPMobile.ISPOINTCONVERT)return t;if(e=e||NPMobile.T.map,t.lon>-180&&t.lon<180)return t;if("EPSG:900913"==e.getProjection()){var r=l.inverseMercator(t.lon,t.lat),n=c(e);return n.CLASS_NAME.indexOf("Baidu")!=-1?(r=NPMobile.T.Baidu.ToLL(t),r=l.bd_decrypt(r.lon,r.lat),r=l.gcj2wgs(r.lon,r.lat),new NPMobile.Geometry.Point(r.lon,r.lat)):(r=n.CLASS_NAME.indexOf("OSM")!=-1&&0==n.isChina?r:l.gcj2wgs(r.lon,r.lat),new NPMobile.Geometry.Point(r.lon,r.lat))}return t},s.getPoints=function(e,t){for(var r=[],n=0;n<t.length;n++)r.push(NPMobile.T.getPoint(e,t[n]));return r},s.setExtent=function(e,t){if("EPSG:900913"==e.getProjection()){var r=NPMobile.T.setPoint(e,{lon:t.left,lat:t.top}),n=NPMobile.T.setPoint(e,{lon:t.right,lat:t.bottom});return new NPMap.Geometry.Extent(r.lon,n.lat,n.lon,r.lat)}return t},s.getExtent=function(e,t){if("EPSG:900913"==e.getProjection()){var r=NPMobile.T.getPoint(e,{lon:t.left,lat:t.top}),n=NPMobile.T.getPoint(e,{lon:t.right,lat:t.bottom});return new NPMap.Geometry.Extent(r.lon,n.lat,n.lon,r.lat)}return t}}(),window.NPMobileHelper={_map:null,_objs:{},_createClass:function(e){var t=null;switch(e.className){case"NPMobile.Layers.CustomerLayer":t=new NPMobile.Layers.CustomerLayer(e.name);break;case"NPMobile.Geometry.Marker":t=new NPMobile.Geometry.Marker(e.point,e.options);break;case"NPMobile.Geometry.Point":return t=new NPMobile.Geometry.Point(e.lon,e.lat);case"NPMobile.Map":"string"==typeof e.mapConfig&&($.ajaxSettings.async=!1,$.getJSON(e.mapConfig,function(t,r){e.mapConfig=t})),t=new NPMobile.Map(e.mapContainer||"viewerContainer",e.mapConfig),window.NPMobileHelper._map=t;break;case"NPMobile.Layers.ClusterLayer":e.options.maxZoom=e.options.maxZoom||window.NPMobileHelper._map.getMaxZoom(),e.options.selectZoom=e.options.selectZoom||window.NPMobileHelper._map.getMaxZoom(),t=new NPMobile.Layers.ClusterLayer(e.name,e.options),t.register("getUrl",function(t){return""!=t?e.options.clusterImage.url:e.options.singleImage.url}),t.register("getImageSize",function(t){return""!=t?e.options.clusterImage.imageSize:e.options.singleImage.imageSize}),t.register("getContent",function(){return""});break;case"NPMobile.Geometry.ClusterMarker":t=new NPMobile.Geometry.ClusterMarker(e.point,null,e)}return t.id=e.id,this._objs[e.id]=t,t},callMethod:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),r=this._objs[t.id]||this._createClass(t),n=[],a=1;a<e.length;a++)if("object"==typeof e[a]&&e[a].className)n.push(this._createClass(e[a]));else if(Array.isArray(e[a])){for(var i=[],o=0;o<e[a].length;o++){var s=e[a][o];"object"==typeof s&&s.className?i.push(this._createClass(s)):i.push(s)}n.push(i)}else n.push(e[a]);if("register"===e[0]||"unregister"===e[0])return r[e[0]](n[0],function(){var e={id:r.id,eventType:n[0],args:Array.prototype.slice.call(arguments)};window.WebViewJavascriptBridge.callHandler("NPMobileHelper.Event.Call",e,function(e){})}),"";var l=r[e[0]].apply(r,n);return JSON.stringify(l)}};