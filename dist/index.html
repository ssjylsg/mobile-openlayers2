<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="theme/default/style.mobile.css" type="text/css">
    <style>
    html,
    body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
    }

    @media only screen and (max-width: 600px) {
        html,
        body {
            height: 117%;
        }
    }

    .olControlAttribution {
        position: absolute;
        font-size: 10px;
        bottom: 0 !important;
        right: 0 !important;
        background: rgba(0, 0, 0, 0.1);
        font-family: Arial;
        padding: 2px 4px;
        border-radius: 5px 0 0 0;
    }

    #viewerContainer {
        width: 100%;
        position: absolute;
        height: 100%;
    }

    .attr-list {
        padding-left: 20px;
    }

    window,
    html,
    body {
        overflow-x: hidden !important;
        -webkit-overflow-scrolling: touch !important;
        overflow: scroll !important;
    }
    </style>
</head>

<body>
    <div style="position: absolute;width: 100%;height: 100%">
        <div style="float: right;width: 20%;height: 100%;padding-left: 20px;display: none">
            <div class="attr-list">
                <h4>地图资源</h4>
                <p>
                    <input type="button" url='mapConfig.json' value="百度地图" event='createLocalMap'>
                    <input type="button" url='mapConfig_gaode.json' value="高德地图" event='createLocalMap'>
                    <input type="button" url='mapConfig_google.json' value="谷歌地图" event='createLocalMap'>
                </p>
            </div>
            <div class="attr-list">
                <h4>Marker 覆盖物</h4>
                <p>
                    <input type="button" value="新增Marker" event="createMarker"> </p>
                <p>
                    <input type="button" value="聚合" event="cluster"> </p>
            </div>
            <div class="attr-list">
                <h4>Map 事件</h4>
                <p>
                    <input type="button" value="Map Click" event="mapClick"> </p>
            </div>
            <div class="attr-list">
                <h4>其他</h4>
                <p>
                    <input type="button" value="计算两点距离" event="distance"> </p>
                <p>
                    <input type="button" value="百度路况" event="baidutrafficLayer"> </p>
                <p>
                    <input type="button" value="全图" event="fullExtent"> </p>
                <p>
                    <input type="button" value="获取地图中心点" event="getCenter"> </p>
                <p>
                    <input type="button" value="获取当前层级" event="getZoom"> </p>
            </div>
        </div>
        <div style="position: absolute;float: right;width: 100%;height: 100%">
            <div style="width:100%;height: 90px;display:none" id="mapConfig">
                <input type="button" value="测距">
                <input type="button" value="面积测量">
                <br>
                <textarea cols="150" rows="3"></textarea>
                <input type="button" value="执行">
            </div>
            <div id="viewerContainer"></div>
            <div id="iploc" class="ipLocCont BMap_noprint anchorBR" style="position: absolute; z-index: 10; bottom: 50px; right: 10px; top: auto; left: auto;width: 20px">
                <div style="text-align: center;"><span><img method = '-' src="img/zoomin.png"></span></div>
                <div style="text-align: center;"><span><img method = '+' src="img/zoomout.png"></span></div>
            </div>
        </div>
    </div>
    <script src="featureStyle.js"></script>
    <script src="iconSetInfo_high.js"></script>
    <script src="jquery.js"></script>
    <script src="OpenLayers.js"></script>
    <!-- <script src="../source/lib/OpenLayers.js"></script> -->
    <script src="NPMobileMap.js"></script>
    <script src="WebViewJavascriptBridge.js"></script>
    <script src="../source/lib/OpenLayers/Control/Navigation.js"></script>
    <script src="../source/lib/OpenLayers/Control/ZoomBox.js"></script>
    <script src="../source/lib/OpenLayers/Handler/Box.js"></script>
    <script src="../source/lib/OpenLayers/Handler/MouseWheel.js"></script>
    <script type="text/javascript">
    var map;
    var fixSize = function() {
        window.scrollTo(0, 0);
        document.body.style.height = '100%';
        if (!(/(iphone|ipod)/.test(navigator.userAgent.toLowerCase()))) {
            if (document.body.parentNode) {
                document.body.parentNode.style.height = '100%';
            }
        }
    };

    setTimeout(fixSize, 700);
    setTimeout(fixSize, 1500);
    var map = null,
        tool,
        marker = null;
    var demo = {
        createMarker: function() {
            function createMarker(point, name, f) {
                var layer = new NPMobile.Layers.CustomerLayer(name);
                map.addLayer(layer);
                marker = new NPMobile.Geometry.Marker(point, {
                    graphicWidth: 21,
                    graphicHeight: 25,
                    graphicXOffset: 0,
                    graphicYOffset: 0,
                    externalGraphic: 'img/marker.png',
                    graphicZIndex: 0
                });
                marker.register('click', f)
                layer.addOverlay(marker);
            }

            createMarker(map.getCenter(), '自定义图层', function(argument) {
                window.alert('Marker');
            });
        },
        cluster: function() {
            /////////**************** 聚合************************************
            var c = map.getCenter(),
                clusterLayer = window.clusterLayer || new NPMobile.Layers.ClusterLayer('聚合', {
                    selectZoom: map.getMaxZoom(),
                    maxZoom: map.getMaxZoom(),
                    // distance: 200,
                    // threshold: 10,
                    fontSize: '50px',
                    clusterClickModel: 'zoom',
                    fontColor: 'blank',
                    statistics: [{
                        x: c.lon,
                        y: c.lat,
                        label: '1000'
                    }],
                    minZoom: 6,
                    defaultStyle: {
                        fontColor: 'white',
                        customLabelOffset: {
                            height: 10
                        }
                    }
                }),
                markers = [];
            clusterLayer.register(
                'getUrl',
                function() {
                    return 'img/Flag.png'
                }).register(
                'getImageSize',
                function() {
                    return {
                        w: 32,
                        h: 32
                    }
                }).register(
                'getContent',
                function() {
                    return '';
                }).register('click', function(f) {
                console.log(f);
                window.alert('hellow');
            });
            if (!window.clusterLayer) {
                map.addLayer(clusterLayer);
            }

            for (var i = 0; i < 4; i++) {
                markers.push(new NPMobile.Geometry.ClusterMarker(new NPMobile.Geometry.Point(c.lon + Math.random() * Math.pow(-1, i) * 0.01, c.lat + Math.random() * Math.pow(-1, i + 1) * 0.01), i % 2 == 0 ? "偶数" : "奇数"));
            }
            clusterLayer.addOverlays(markers, true);
            window.clusterLayer = clusterLayer;
        },
        registerMapClick: function() {},
        TrafficLayerVisable: true,
        baidutrafficLayer: function() {
            map.setBaiduTrafficLayerVisable(!this.TrafficLayerVisable);
            this.TrafficLayerVisable = !this.TrafficLayerVisable;
        },
        distance: function() {
            var r = map.distance(map.getCenter(), {
                lon: 108.4032,
                lat: 31.2565
            });
            this.showMsg(r);
        },
        showMsg: function(msg) {
            msg && window.alert(msg);
        },
        fullExtent: function() {
            map.fullExtent();
        },
        getCenter: function() {
            var c = map.getCenter();
            this.showMsg(c.lon + "," + c.lat);
        },
        getZoom: function() {
            this.showMsg(map.getZoom());
        },
        createLocalMap: function(mapUrl) {
            map && map.destroy();
            createMap($(mapUrl).attr('url'));
            this.TrafficLayerVisable = true;
        },
        mapClick: function() {
            var that = this;
            var _map = map._map;
            // _map.events.register('touchend', _map, function(f) {
            //     var length = this.getFeatures(f, true).length;
            //     if (length == 0 && this.dragging == false) {
            //         that.showMsg('touchend:' + length + this.dragging);
            //     }
            // })
            // map.register('touchend', function(lon, lat) {
            //     that.showMsg(lon + ";" + lat);
            // })
            // map.register('click', function(lon, lat) {
            //     that.showMsg(lon + ";" + lat);
            //     var c = new NPMobile.Geometry.Circle({
            //         lon: Number(lon),
            //         lat: Number(lat)
            //     }, 10000);
            //     map.addOverlay(c);
            // })
        }
    }

    function createMap(mapConfig, callback) {
        $.getJSON(mapConfig || 'mapConfig.json', function(json, textStatus) {
            map = new NPMobile.Map(viewerContainer, json);
            OpenLayers.Control.Navigation && map._map.addControl(new OpenLayers.Control.Navigation())
            demo.baidutrafficLayer();
            callback && callback(map);
        });
    }

    function testCluster() {
        demo.cluster();
    }
    createMap(null, function(map) {
        window.NPMobileHelper._map = map;
        demo.mapClick();
        demo.cluster();
    });

    $(function() {
        $('input').click(function() {
            demo[$(this).attr('event')]($(this));
        });

        $("img", $("#iploc")).click(function() {
            if ($(this).attr('method') == '-') {
                map.setZoom(map.getZoom() - 1);
            } else {
                map.setZoom(map.getZoom() + 1);
            }
        });
    })


    function test() {
        var coordHelper = (function() {
            var pi = 3.14159265358979324; // 圆周率
            var ee = 0.00669342162296594323; // WGS 偏心率的平方
            var x_pi = 3.14159265358979324 * 3000.0 / 180.0;
            var pole = 20037508.34;
            var a = 6378245.0 // WGS 长轴半径
            var helper = {};
            // 84->火星
            helper.transform = function(lon, lat) {
                lon = parseFloat(lon);
                lat = parseFloat(lat);
                var localHashMap = {};
                if (this.outofChina(lat, lon)) {
                    localHashMap.lon = lon;
                    localHashMap.lat = lat;
                    return localHashMap;
                }
                var dLat = this.transformLat(lon - 105.0, lat - 35.0);
                var dLon = this.transformLon(lon - 105.0, lat - 35.0);
                var radLat = lat / 180.0 * pi;
                var magic = Math.sin(radLat);
                magic = 1 - ee * magic * magic;
                var sqrtMagic = Math.sqrt(magic);
                dLat = (dLat * 180.0) / ((a * (1 - ee)) / (magic * sqrtMagic) * pi);
                dLon = (dLon * 180.0) / (a / sqrtMagic * Math.cos(radLat) * pi);
                var mgLat = lat + dLat;
                var mgLon = lon + dLon;
                localHashMap.lon = mgLon;
                localHashMap.lat = mgLat;
                return localHashMap;
            };

            helper.outofChina = function(lat, lon) {
                if (lon < 72.004 || lon > 137.8347)
                    return true;
                if (lat < 0.8293 || lat > 55.8271)
                    return true;
                return false;
            };

            helper.transformLat = function(x, y) {
                var ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.sqrt(Math.abs(x));
                ret += (20.0 * Math.sin(6.0 * x * pi) + 20.0 * Math.sin(2.0 * x * pi)) * 2.0 / 3.0;
                ret += (20.0 * Math.sin(y * pi) + 40.0 * Math.sin(y / 3.0 * pi)) * 2.0 / 3.0;
                ret += (160.0 * Math.sin(y / 12.0 * pi) + 320 * Math.sin(y * pi / 30.0)) * 2.0 / 3.0;
                return ret;
            };

            helper.transformLon = function(x, y) {
                var ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.sqrt(Math.abs(x));
                ret += (20.0 * Math.sin(6.0 * x * pi) + 20.0 * Math.sin(2.0 * x * pi)) * 2.0 / 3.0;
                ret += (20.0 * Math.sin(x * pi) + 40.0 * Math.sin(x / 3.0 * pi)) * 2.0 / 3.0;
                ret += (150.0 * Math.sin(x / 12.0 * pi) + 300.0 * Math.sin(x / 30.0 * pi)) * 2.0 / 3.0;
                return ret;
            };
            // 火星->84
            helper.gcj2wgs = function(lon, lat) {
                var p = {
                    lon: 0,
                    lat: 0
                }
                var lontitude = lon - (this.transform(lon, lat).lon - lon);
                var latitude = lat - (this.transform(lon, lat).lat - lat);
                p.lon = lontitude;
                p.lat = latitude;
                return p;
            };

            // 火星坐标转百度坐标
            helper.bd_encrypt = function(gg_lon, gg_lat) {
                var x = gg_lon,
                    y = gg_lat;
                var z = Math.sqrt(x * x + y * y) + 0.00002 * Math.sin(y * x_pi);
                var theta = Math.atan2(y, x) + 0.000003 * Math.cos(x * x_pi);
                var bd_lon = z * Math.cos(theta) + 0.0065;
                var bd_lat = z * Math.sin(theta) + 0.006;
                return {
                    lon: bd_lon,
                    lat: bd_lat
                };
            };

            // 百度坐标转火星坐标
            helper.bd_decrypt = function(bd_lon, bd_lat) {
                var x = bd_lon - 0.0065,
                    y = bd_lat - 0.006;
                var z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * x_pi);
                var theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * x_pi);
                var gg_lon = z * Math.cos(theta);
                var gg_lat = z * Math.sin(theta);
                return {
                    lon: gg_lon,
                    lat: gg_lat
                };
            };

            // 经纬度-> 墨卡托投影转换
            helper.webMoctorJW2PM = function(lon, lat) {
                var c = {
                    lon: 0,
                    lat: 0
                };
                lon = parseFloat(lon);
                lat = parseFloat(lat);
                c.lon = (lon / 180.0) * 20037508.34;
                if (lat > 85.05112) {
                    lat = 85.05112;
                }
                if (lat < -85.05112) {
                    lat = -85.05112;
                }
                lat = (Math.PI / 180.0) * lat;
                var tmp = Math.PI / 4.0 + lat / 2.0;
                c.lat = 20037508.34 * Math.log(Math.tan(tmp)) / Math.PI;
                return c;
            };
            // 墨卡托投影转换-》经纬度
            helper.inverseMercator = function(lon, lat) {
                lon = 180 * lon / pole;
                lat = 180 / Math.PI * (2 * Math.atan(Math.exp((lat / pole) * Math.PI)) - Math.PI / 2);
                return {
                    lon: lon,
                    lat: lat
                };
            }

            return helper;
        });

        var geom = {
            "type": "MultiPolygon",
            "coordinates": [
                [
                    [
                        [116.437451162189, 39.8714810389579],
                        [116.43739907672, 39.8711989606321],
                        [116.437320927112, 39.8709468345423],
                        [116.437173612169, 39.870738583785],
                        [116.437008244037, 39.8706302968443],
                        [116.436799774508, 39.8705519336347],
                        [116.436600321637, 39.8705215854173],
                        [116.436383829304, 39.8705122079922],
                        [116.434654963408, 39.8705732530118],
                        [116.429002375719, 39.8707974300166],
                        [116.420727429932, 39.8713069210801],
                        [116.41946763017, 39.8714155794576],
                        [116.418885832343, 39.8714369849061],
                        [116.416984365266, 39.8714361496771],
                        [116.416567868375, 39.8713057757727],
                        [116.415794979397, 39.8710061053411],
                        [116.415187302715, 39.8707805963942],
                        [116.414240273596, 39.8705548296046],
                        [116.413641646573, 39.8704323645398],
                        [116.413068059802, 39.8703539319605],
                        [116.410636772165, 39.8700762592861],
                        [116.410671839768, 39.8697892966144],
                        [116.407424259071, 39.8697404547574],
                        [116.407432432041, 39.868425527339],
                        [116.409595089031, 39.868426703559],
                        [116.409595148188, 39.8679617279468],
                        [116.408813522028, 39.8679352799374],
                        [116.408813585514, 39.8674363061838],
                        [116.408899662543, 39.8673623582189],
                        [116.408960725643, 39.8672453987317],
                        [116.408995954403, 39.8656655022054],
                        [116.40944731667, 39.8656787613584],
                        [116.409455351978, 39.8654527780828],
                        [116.410524255884, 39.8654884284774],
                        [116.410445332235, 39.8643424397153],
                        [116.409594604546, 39.8643679180513],
                        [116.409663931718, 39.8622460735377],
                        [116.409585885312, 39.8621020350023],
                        [116.408874315621, 39.8620676269463],
                        [116.408848268083, 39.8622806008229],
                        [116.408170745398, 39.8623102308566],
                        [116.408135677813, 39.8626361947052],
                        [116.407727378499, 39.862635983339],
                        [116.407910006144, 39.8587422899935],
                        [116.407289564547, 39.8587299787357],
                        [116.407236533149, 39.8586869552576],
                        [116.407172483629, 39.8587279219257],
                        [116.406199841873, 39.8587074739874],
                        [116.406213973771, 39.8577405338958],
                        [116.406181960187, 39.8576875227699],
                        [116.406214986617, 39.8576445396888],
                        [116.406217001754, 39.8575355466512],
                        [116.404384939676, 39.8574738182288],
                        [116.401987821316, 39.8575130856952],
                        [116.400624198951, 39.8585627264564],
                        [116.400530171384, 39.858544709763],
                        [116.400477154387, 39.858547699795],
                        [116.398610693031, 39.8583644444629],
                        [116.398518677992, 39.8583344370354],
                        [116.39744950251, 39.8582633627553],
                        [116.397407492997, 39.8582913591566],
                        [116.39676941388, 39.8582973373405],
                        [116.395294317728, 39.8583073555627],
                        [116.395260316957, 39.8583073571187],
                        [116.39522131615, 39.8583073589658],
                        [116.394452316565, 39.8583134086072],
                        [116.394373322723, 39.8582804170333],
                        [116.394281321111, 39.8583144231652],
                        [116.393234383716, 39.858321539934],
                        [116.39327851954, 39.8572235952279],
                        [116.389266296342, 39.8572794702159],
                        [116.389265279854, 39.8574114631476],
                        [116.389311260631, 39.8574534468509],
                        [116.389263268756, 39.8575034586213],
                        [116.389249127598, 39.8586463993241],
                        [116.389214003538, 39.8597053515162],
                        [116.389127988039, 39.8600353598686],
                        [116.38891900824, 39.8603954058246],
                        [116.38874602315, 39.8607214437547],
                        [116.388711013885, 39.8608854462218],
                        [116.388719953897, 39.8613334188052],
                        [116.388329087837, 39.8613325500228],
                        [116.388042191196, 39.8613326503793],
                        [116.388042209898, 39.8611856584013],
                        [116.388042248065, 39.8608856747942],
                        [116.387495456046, 39.8608938751671],
                        [116.386756761666, 39.8609071655462],
                        [116.386739586895, 39.8623390945308],
                        [116.386027916119, 39.8622953992805],
                        [116.385055400848, 39.8622958462326],
                        [116.385003422275, 39.8623418687164],
                        [116.385053387011, 39.8624128408475],
                        [116.385029191975, 39.8640447643272],
                        [116.381469389759, 39.8639957346051],
                        [116.381582261856, 39.8643776438998],
                        [116.381634191228, 39.8646475973026],
                        [116.381660143373, 39.8648815687618],
                        [116.381677101799, 39.8651155458015],
                        [116.381660003717, 39.8659795102845],
                        [116.379107017626, 39.8653802444123],
                        [116.379038037371, 39.8656712784144],
                        [116.377961021802, 39.8651371038594],
                        [116.377153783402, 39.8648367463103],
                        [116.376337567182, 39.8646724135213],
                        [116.375373514653, 39.8646242258858],
                        [116.374453448341, 39.8646630287208],
                        [116.374468436302, 39.8646350168613],
                        [116.37441249039, 39.8646680650051],
                        [116.373576360459, 39.864810816944],
                        [116.373175787775, 39.8648851858346],
                        [116.373134834994, 39.8648682251892],
                        [116.373082887931, 39.8649022722208],
                        [116.372325718363, 39.8650439876914],
                        [116.371918170694, 39.8651613790431],
                        [116.371770337027, 39.8652005226382],
                        [116.371439712033, 39.8652918463681],
                        [116.371136069766, 39.86530415088],
                        [116.370910339454, 39.86530437982],
                        [116.371058153193, 39.8653782257515],
                        [116.371631455836, 39.8655386421492],
                        [116.372508436116, 39.8656347797816],
                        [116.372490425551, 39.8658777841656],
                        [116.372421478763, 39.8660728402377],
                        [116.37239547949, 39.8662988533278],
                        [116.372945854732, 39.8663553240901],
                        [116.372987808726, 39.8663512846346],
                        [116.373019771942, 39.8663622538715],
                        [116.373376375574, 39.8663989176972],
                        [116.373376352954, 39.8665769082755],
                        [116.374331335631, 39.8665510372226],
                        [116.374288203591, 39.8679440023365],
                        [116.37446198664, 39.8682218322679],
                        [116.374357900293, 39.8697538451259],
                        [116.378603838272, 39.8700853620979],
                        [116.380201536007, 39.8701852304626],
                        [116.381737404172, 39.8702672374668],
                        [116.381787369154, 39.8702712066615],
                        [116.381829340135, 39.870272180984],
                        [116.386305740621, 39.8705118430236],
                        [116.392861832411, 39.8707999245177],
                        [116.392779622476, 39.8725208485234],
                        [116.392808583293, 39.8728028296517],
                        [116.392755562206, 39.87301582694],
                        [116.392479857821, 39.8788125800437],
                        [116.392227892346, 39.8788126235068],
                        [116.392201783912, 39.8796935846794],
                        [116.392357764205, 39.8796755581629],
                        [116.39234058073, 39.8811344895484],
                        [116.392193113997, 39.8849623302747],
                        [116.391889572341, 39.8895801679041],
                        [116.391628971973, 39.894636985418],
                        [116.391463688666, 39.8970939078721],
                        [116.391454679884, 39.8971759060622],
                        [116.391420678451, 39.8972369105038],
                        [116.391359685651, 39.8972709220064],
                        [116.391176715338, 39.8973189599095],
                        [116.390421854445, 39.8975361305498],
                        [116.39015290685, 39.8976491956044],
                        [116.38999592724, 39.8978092307547],
                        [116.389848936796, 39.898043260827],
                        [116.38977892269, 39.8983042687436],
                        [116.389787872166, 39.8986812492622],
                        [116.389648684055, 39.9004612092491],
                        [116.38957057344, 39.9015031855032],
                        [116.38931899874, 39.9065890366102],
                        [116.386010295025, 39.9064802698139],
                        [116.386132185066, 39.9068921985539],
                        [116.386453989495, 39.9072660444425],
                        [116.386447881809, 39.908132009494],
                        [116.386447878495, 39.9081580083707],
                        [116.386447876837, 39.9081710078091],
                        [116.386436671842, 39.9098179415182],
                        [116.385594069669, 39.9098303116368],
                        [116.385636943744, 39.9106512568264],
                        [116.385741887765, 39.9106862077545],
                        [116.385715860693, 39.9109982061457],
                        [116.385854789869, 39.911024142604],
                        [116.385819747491, 39.9114891383866],
                        [116.386392474912, 39.9115188873259],
                        [116.386324275394, 39.9133268393462],
                        [116.386313274312, 39.9133748420092],
                        [116.386321266822, 39.9134048373197],
                        [116.386306222438, 39.913806826698],
                        [116.385941472349, 39.9210246830057],
                        [116.390577808845, 39.9211250738547],
                        [116.39057871395, 39.9218670429286],
                        [116.39053572005, 39.9218980523639],
                        [116.390578702851, 39.9219540393357],
                        [116.390578688944, 39.9220630348356],
                        [116.393218249872, 39.9221635243711],
                        [116.392983690258, 39.9267253699981],
                        [116.392827687015, 39.9268813867971],
                        [116.392575707289, 39.9269554234113],
                        [116.390457099428, 39.9269068665091],
                        [116.389918735983, 39.9386555355528],
                        [116.389740773299, 39.9387435818902],
                        [116.389699777316, 39.9388015912499],
                        [116.389650792873, 39.9387876058499],
                        [116.388902972091, 39.9391548181786],
                        [116.388703031448, 39.9392028809456],
                        [116.388025266009, 39.9392281117129],
                        [116.387955827731, 39.9428609920049],
                        [116.387722122117, 39.9490768309194],
                        [116.387478337283, 39.9559646501433],
                        [116.380532388296, 39.9556152844189],
                        [116.381122637281, 39.9580848037757],
                        [116.381418242083, 39.959521560301],
                        [116.383233024604, 39.9596354859315],
                        [116.383258739177, 39.9617443883056],
                        [116.386136176559, 39.9617659670379],
                        [116.386266121584, 39.9617239125663],
                        [116.386409050603, 39.9617678498898],
                        [116.386791880416, 39.9617706907253],
                        [116.386877846791, 39.9617436569147],
                        [116.386950812045, 39.9617716264441],
                        [116.388267296515, 39.9617811343949],
                        [116.388408245597, 39.9617910856588],
                        [116.388572189183, 39.961791030482],
                        [116.388675154097, 39.9617939962872],
                        [116.388797118959, 39.9617529581221],
                        [116.388855092245, 39.9618139370173],
                        [116.388930071625, 39.9617859141595],
                        [116.39070858389, 39.9617984149393],
                        [116.39197642704, 39.9611261682584],
                        [116.392489349585, 39.961157076081],
                        [116.392602358706, 39.9609740647967],
                        [116.39345327244, 39.9609829427273],
                        [116.394199273564, 39.9606448751654],
                        [116.395050258883, 39.9606758111818],
                        [116.395198217247, 39.9610187899432],
                        [116.39643128146, 39.9610277627499],
                        [116.397421469812, 39.9604418126481],
                        [116.397942545789, 39.9604858423342],
                        [116.398219595336, 39.9604858639221],
                        [116.399227814638, 39.9604639720128],
                        [116.39923576725, 39.9608499577992],
                        [116.401624518664, 39.9607723959151],
                        [116.401528104222, 39.963733256453],
                        [116.40149397119, 39.964675211321],
                        [116.401467900096, 39.9651561863086],
                        [116.401415836504, 39.9655041606965],
                        [116.401302739006, 39.9659461179045],
                        [116.401233678789, 39.9662240917296],
                        [116.401215631361, 39.9665450750759],
                        [116.401137385258, 39.9682549903415],
                        [116.401111306748, 39.9687979632006],
                        [116.401155287251, 39.9690709617303],
                        [116.401233270336, 39.9694189647414],
                        [116.4012942589, 39.9696789677651],
                        [116.401320234377, 39.9699439629593],
                        [116.401329198758, 39.97024795284],
                        [116.401259873753, 39.9725958438323],
                        [116.40310862594, 39.9726313238127],
                        [116.40309181065, 39.9711253788803],
                        [116.40257058277, 39.9710902294921],
                        [116.402535699782, 39.9700572610046],
                        [116.404845843036, 39.9700490185798],
                        [116.40497825275, 39.9674261734802],
                        [116.404984262036, 39.9673801776228],
                        [116.404982265247, 39.9673461782016],
                        [116.405175864234, 39.9635254050063],
                        [116.405913304522, 39.9635387074993],
                        [116.405939469291, 39.9623757646439],
                        [116.407893788793, 39.9624066869301],
                        [116.407954041389, 39.9607747825252],
                        [116.418635117706, 39.9608908804688],
                        [116.418716230935, 39.9608559628222],
                        [116.418777318316, 39.9608150256118],
                        [116.418860430555, 39.9608141091466],
                        [116.418913507704, 39.9607721642821],
                        [116.419103776691, 39.9606913602104],
                        [116.419199279584, 39.9577695725554],
                        [116.421084957575, 39.9578025754176],
                        [116.421138038463, 39.9577826348729],
                        [116.4211770934, 39.9578046772527],
                        [116.423190178978, 39.9578389950269],
                        [116.423270308078, 39.9578270914463],
                        [116.423357445297, 39.9578421955108],
                        [116.424287954861, 39.9578583329284],
                        [116.424392469497, 39.9551715686821],
                        [116.423602181533, 39.9551455972061],
                        [116.423576047781, 39.9558655372132],
                        [116.422777777456, 39.9558785826582],
                        [116.42293308454, 39.9553837855571],
                        [116.422968196801, 39.9549368447428],
                        [116.422977297332, 39.954259882144],
                        [116.422768973055, 39.9542336369406],
                        [116.422794183896, 39.9528877195386],
                        [116.423061602397, 39.9529100353775],
                        [116.423129709938, 39.9529131164142],
                        [116.423158756552, 39.9529091512434],
                        [116.423160762028, 39.9528911543461],
                        [116.423162771583, 39.9528411587116],
                        [116.423193908494, 39.9521542229277],
                        [116.423324116999, 39.9521463793142],
                        [116.423263234169, 39.9504623724565],
                        [116.423741000265, 39.9504749496661],
                        [116.423741010716, 39.9503929529036],
                        [116.423975391326, 39.9503972397453],
                        [116.423992482213, 39.9499022802335],
                        [116.423671961481, 39.9499018881158],
                        [116.423662982218, 39.9496248880908],
                        [116.423272355342, 39.9496244163544],
                        [116.422820633546, 39.9496808768245],
                        [116.42282971971, 39.9491159097755],
                        [116.423237373667, 39.9490423973303],
                        [116.42325443507, 39.948773428357],
                        [116.426077146304, 39.948791981999],
                        [116.426832480426, 39.9487919908743],
                        [116.427266264758, 39.9487575825523],
                        [116.427552795944, 39.9486749800942],
                        [116.427779225965, 39.9485532989175],
                        [116.427883440792, 39.9483714513334],
                        [116.42793556943, 39.9481155342352],
                        [116.427956618316, 39.9480365667836],
                        [116.427989683961, 39.9480006144846],
                        [116.427987689936, 39.947924614683],
                        [116.428144009785, 39.9476858435099],
                        [116.428603872791, 39.9476554961663],
                        [116.428881371802, 39.9478508858767],
                        [116.430488482766, 39.9478682497411],
                        [116.43048847004, 39.9479682457874],
                        [116.430592671569, 39.9480074012516],
                        [116.43058361499, 39.9483113756293],
                        [116.430201854196, 39.9483678005239],
                        [116.430001452896, 39.9484364995018],
                        [116.429524402145, 39.9494177574635],
                        [116.429801933445, 39.9494651636925],
                        [116.429241701707, 39.9506552964132],
                        [116.429200616767, 39.9507052347927],
                        [116.429202616524, 39.9507372364371],
                        [116.429620419862, 39.9507378463997],
                        [116.429671515558, 39.9507629205113],
                        [116.429755681642, 39.9507400453481],
                        [116.432875981121, 39.9508118430595],
                        [116.432911095192, 39.9504949117929],
                        [116.433093477517, 39.9505122042448],
                        [116.433171719516, 39.9499093540966],
                        [116.433058494012, 39.9498001758917],
                        [116.433049683574, 39.9481602261859],
                        [116.433512654914, 39.9482489720019],
                        [116.433557750179, 39.948257045131],
                        [116.433588815804, 39.9482630955371],
                        [116.434048793421, 39.9483508464856],
                        [116.434256401729, 39.9471012389091],
                        [116.434933836595, 39.9474773561556],
                        [116.434969912505, 39.9475064158096],
                        [116.434989954592, 39.9475234489378],
                        [116.435017011436, 39.9475464936844],
                        [116.435076141022, 39.9475555931969],
                        [116.435672427066, 39.9478875949974],
                        [116.435959090552, 39.9477400936779],
                        [116.435341802425, 39.9469890658985],
                        [116.435333839241, 39.9465590692803],
                        [116.435263682749, 39.9465629499327],
                        [116.435125481337, 39.9457337483505],
                        [116.434500110248, 39.9456996992408],
                        [116.434169459264, 39.9451611713465],
                        [116.433735514298, 39.9452344544357],
                        [116.433457920156, 39.945239001457],
                        [116.433336601974, 39.9457117859115],
                        [116.433128162828, 39.9456904498103],
                        [116.433031934222, 39.9458902869754],
                        [116.432372642119, 39.9451992625823],
                        [116.432441793404, 39.9451393744175],
                        [116.43306714635, 39.9448043864302],
                        [116.433240529657, 39.9446746712691],
                        [116.433865929339, 39.9441717101322],
                        [116.434091432937, 39.9440370867275],
                        [116.434352012085, 39.9439285225778],
                        [116.434595552906, 39.9438549312785],
                        [116.434856134832, 39.9437763711833],
                        [116.435072617984, 39.9437337377992],
                        [116.43538531833, 39.9436852701181],
                        [116.435567728275, 39.9436635821639],
                        [116.435707039199, 39.943672820346],
                        [116.435819287028, 39.9437070117583],
                        [116.435915495394, 39.9437721747987],
                        [116.436071828564, 39.9439284385183],
                        [116.43630632385, 39.9442158337983],
                        [116.436375471892, 39.9442889512287],
                        [116.436444623346, 39.9443370698379],
                        [116.437339623611, 39.9448106276449],
                        [116.437443862283, 39.9448408120846],
                        [116.437643325579, 39.9448581677769],
                        [116.438138486703, 39.9448800582313],
                        [116.438476287549, 39.944879671705],
                        [116.440152346811, 39.9448367813229],
                        [116.44036988658, 39.9448061936736],
                        [116.440517257936, 39.9447504754025],
                        [116.440647596901, 39.9446247282589],
                        [116.440742867056, 39.9443599202965],
                        [116.440873222369, 39.9441161789312],
                        [116.441020614831, 39.9439214689416],
                        [116.441081783707, 39.9437955913121],
                        [116.441081800204, 39.9436655964704],
                        [116.441046726295, 39.9435565334347],
                        [116.440968550759, 39.9434003896712],
                        [116.440647872441, 39.9424538144188],
                        [116.440361270223, 39.941608303549],
                        [116.440283099997, 39.9414301626737],
                        [116.440248019154, 39.9413860981084],
                        [116.440195902404, 39.9412950032878],
                        [116.440108699586, 39.9412038424376],
                        [116.439987412954, 39.9411176175881],
                        [116.439866124352, 39.9410523924567],
                        [116.438754510934, 39.940461354725],
                        [116.438589141797, 39.9402580601583],
                        [116.438493964158, 39.9398709017972],
                        [116.438415835045, 39.9394237771929],
                        [116.438346786032, 39.9385166875867],
                        [116.438346878591, 39.9377877167063],
                        [116.438311852156, 39.9373406708386],
                        [116.438259764984, 39.937054587669],
                        [116.438008238587, 39.9365201538356],
                        [116.437556300907, 39.9355563806305],
                        [116.437513232872, 39.9353003139123],
                        [116.4375526863, 39.9324474984975],
                        [116.437554696311, 39.9324055037737],
                        [116.437553698161, 39.9323725033137],
                        [116.437555730009, 39.9321585155301],
                        [116.437526922708, 39.9301065465804],
                        [116.437526926643, 39.9300755478367],
                        [116.437525926845, 39.9300555468572],
                        [116.437520963398, 39.9296755533147],
                        [116.437511951758, 39.9296015402094],
                        [116.437518977257, 39.929529555658],
                        [116.437487185317, 39.9273015890311],
                        [116.437438068269, 39.9273225005834],
                        [116.437363897908, 39.9273053691729],
                        [116.43595867452, 39.9273479049945],
                        [116.43594263709, 39.9273578769321],
                        [116.435923595309, 39.9273488444722],
                        [116.435005543582, 39.9273762776704],
                        [116.43496445556, 39.9273552092301],
                        [116.434909330988, 39.9273791153984],
                        [116.434056466657, 39.927404693037],
                        [116.432928098153, 39.9271088693272],
                        [116.432877988372, 39.9271437875771],
                        [116.432850932435, 39.9271367445308],
                        [116.432816854702, 39.9271856880085],
                        [116.432788793444, 39.927204642367],
                        [116.432797763301, 39.9275906410497],
                        [116.431842782179, 39.9276041321044],
                        [116.431833688715, 39.9281940940148],
                        [116.430921839552, 39.9282196877649],
                        [116.431269665805, 39.9272172604038],
                        [116.430739604108, 39.927208452016],
                        [116.430722454881, 39.9281153892708],
                        [116.428056328505, 39.92815449812],
                        [116.428273368502, 39.9231370081686],
                        [116.428438101293, 39.9197863794808],
                        [116.428594895495, 39.91584476673],
                        [116.42869933981, 39.9138919979942],
                        [116.428777654366, 39.9125771657221],
                        [116.428828791209, 39.9122602525152],
                        [116.428872910461, 39.9119783278584],
                        [116.42935909486, 39.9099471181977],
                        [116.429437299098, 39.9095212505515],
                        [116.429463398254, 39.9091353052419],
                        [116.429540837573, 39.9068475171682],
                        [116.429628182312, 39.9054587055749],
                        [116.4297495824, 39.9041569409895],
                        [116.430114535106, 39.9022515653037],
                        [116.430244918976, 39.9012408044443],
                        [116.430271023643, 39.9008198621198],
                        [116.430271042947, 39.9006678688916],
                        [116.43058366401, 39.9006373397674],
                        [116.430974402431, 39.9009539182348],
                        [116.431225887241, 39.9011152957517],
                        [116.4314603503, 39.901201652895],
                        [116.431790017186, 39.9012361627107],
                        [116.432493470315, 39.9012192693952],
                        [116.433674957358, 39.9012721696471],
                        [116.433995644321, 39.9012886950245],
                        [116.434343389567, 39.9013502674512],
                        [116.435376624788, 39.9016499915119],
                        [116.435767488719, 39.9017276563055],
                        [116.436869982883, 39.9018145696041],
                        [116.437616707796, 39.9018588930165],
                        [116.438493775915, 39.9018504775594],
                        [116.439900174932, 39.9017900816925],
                        [116.440352285043, 39.9017899338297],
                        [116.440838488405, 39.901798858348],
                        [116.442539778244, 39.901886159651],
                        [116.442886923691, 39.8998939353036],
                        [116.441845260354, 39.8998758866023],
                        [116.439691934638, 39.8996717856975],
                        [116.439779270424, 39.8986989924392],
                        [116.440638385141, 39.8986826150596],
                        [116.440647461216, 39.8982586513199],
                        [116.440623406896, 39.8982166074093],
                        [116.440648473455, 39.8981816566979],
                        [116.440672685243, 39.8969807567845],
                        [116.440620586777, 39.8967376685376],
                        [116.440646732189, 39.8960997471292],
                        [116.440821216151, 39.895699098092],
                        [116.440976966908, 39.8928275271385],
                        [116.444701587431, 39.8927369225457],
                        [116.444693720887, 39.8915129627947],
                        [116.446221840946, 39.8915181375553],
                        [116.446220845415, 39.8914611380939],
                        [116.446181741869, 39.8914360569967],
                        [116.446218850308, 39.8913791376857],
                        [116.446203903697, 39.8906321408321],
                        [116.444841228061, 39.8906103075041],
                        [116.444763236831, 39.8888912273466],
                        [116.444206760073, 39.8888910901447],
                        [116.4438427758, 39.8890953427025],
                        [116.442131342307, 39.8891469345644],
                        [116.442019030083, 39.8893557050275],
                        [116.441210979036, 39.8894461331734],
                        [116.441176849741, 39.8897930513137],
                        [116.440802910072, 39.889845332057],
                        [116.440750740895, 39.8901582178999],
                        [116.43971820102, 39.890157267696],
                        [116.439778521221, 39.8887864445063],
                        [116.437876984719, 39.8886729592755],
                        [116.43799038015, 39.8876532114627],
                        [116.438519156586, 39.8834953684295],
                        [116.43853921985, 39.8833724109461],
                        [116.438542230424, 39.8833454177387],
                        [116.438548247774, 39.8833214298745],
                        [116.439153161025, 39.8796407196976],
                        [116.439457112809, 39.8779183680578],
                        [116.439457160661, 39.8775403868823],
                        [116.439431138806, 39.8772143546977],
                        [116.439352996214, 39.8768462278967],
                        [116.439187649275, 39.8764329422025],
                        [116.438276680896, 39.8747923555547],
                        [116.438068239643, 39.8743889984823],
                        [116.437928961348, 39.8739977670001],
                        [116.437737632106, 39.8730524710129]
                    ]
                ]
            ]
        };

        var helper = new coordHelper();

        function dataFormat(lonlon) {
            var p = helper.transform(lonlon[0], lonlon[1]); // 84 -> 火星
            p = helper.bd_encrypt(p.lon, p.lat);
            p = helper.gcj2wgs(p.lon, p.lat);
            return [p.lon, p.lat];
        }

        for (var j = 0; j < geom.coordinates.length; j++) {
            var coordinates = geom.coordinates[j];
            for (var k = coordinates.length - 1; k >= 0; k--) {
                for (var m = coordinates[k].length - 1; m >= 0; m--) {
                    geom.coordinates[j][k][m] = dataFormat(coordinates[k][m])
                }
            }
        }
        console.log(geom)
    }
    </script>
</body>

</html>